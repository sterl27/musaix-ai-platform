(()=>{(function(){"use strict";function d(i,n=[],o={}){return{botId:i,triggers:JSON.parse(JSON.stringify(n)),schemas:o,isDirty:!1,editingTriggerId:null}}window.aipkit_initTriggerBuilderState=d})();(function(){"use strict";function d(i){let n=document.getElementById(`aipkit_trigger_builder_${i}`),o=n?n.querySelector(".aipkit_trigger_raw_data_source"):null;if(!o)return console.warn(`AIPKit Trigger Data: Raw data source input for bot ${i} not found.`),[];let r=o.value;try{let t=JSON.parse(r);return Array.isArray(t)?t:[]}catch(t){return console.error(`AIPKit Trigger Data: Failed to parse initial triggers JSON for bot ${i}. Error:`,t,"Raw JSON:",r),[]}}window.aipkit_loadInitialTriggers=d})();(function(){"use strict";function d(i){let n=document.getElementById(`aipkit_trigger_builder_${i}`),o=n?n.querySelector(".aipkit_trigger_schemas_source"):null;if(!o)return console.warn(`AIPKit Trigger Data: Schemas source input for bot ${i} not found.`),{};let r=o.getAttribute("data-schemas");try{let t=JSON.parse(r);return typeof t=="object"&&t!==null?t:{}}catch(t){return console.error(`AIPKit Trigger Data: Failed to parse trigger schemas JSON for bot ${i}. Error:`,t),{}}}window.aipkit_loadTriggerSchemas=d})();(function(){"use strict";function d(i,n){let o=document.getElementById(`aipkit_bot_${i}_triggers_json`);if(!o)return console.error(`AIPKit Trigger Data: Main hidden textarea for triggers JSON (bot ID: ${i}) not found.`),!1;try{return o.value=JSON.stringify(n,null,2),!0}catch(r){return console.error(`AIPKit Trigger Data: Failed to stringify triggers array for bot ${i}.`,r),o.value="[]",!1}}window.aipkit_updateTriggersJsonForSave=d})();(function(){"use strict";let d=null;function i(o){d=o}function n(){return d}window.aipkit_setTriggerBuilderState=i,window.aipkit_getUIBuilderState=n})();(function(){"use strict";function d(i,n){let o=window.aipkit_escapeHtml||function(s){return s},r=[],t=n?.ConditionSchema?.properties?.field;if(!t||!t.description)return console.warn("GetConditionFields: Field schema or description missing."),r;let e=t.description.match(/Examples: (.*)\./);return e&&e[1]&&e[1].split(",").forEach(a=>{let c=a.trim().replace(/"/g,"");i==="user_context"&&(c.includes("user_")||c.includes("logged_in"))?r.push({value:c,label:o(c.replace(/_/g," "))}):i==="text_content"&&c.includes("message_text")?r.push({value:c,label:o(c.replace(/_/g," "))}):i==="conversation_state"&&c.includes("message_count")?r.push({value:c,label:o(c.replace(/_/g," "))}):i==="ai_model_context"&&(c.includes("provider")||c.includes("model"))?r.push({value:c,label:o(c.replace(/_/g," "))}):i==="error_context"&&(c.includes("error_")||c.includes("failed_"))?r.push({value:c,label:o(c.replace(/_/g," "))}):i==="http_context"&&(c.includes("http_")||c.includes("user_agent")||c.includes("referer"))?r.push({value:c,label:o(c.replace(/_/g," "))}):i==="post_context"&&c.includes("post_")&&r.push({value:c,label:o(c.replace(/_/g," "))})}),r.length===0&&t.enum&&t.enum.forEach(s=>r.push({value:s,label:o(s.replace(/_/g," "))})),r.length===0&&r.push({value:"custom_field",label:"Custom Field (Advanced)"}),r.sort((s,a)=>s.label.localeCompare(a.label))}window.aipkit_getConditionFieldsForType=d})();(function(){"use strict";function d(i,n,o){let r=window.aipkit_escapeHtml||function(a){return a},t=o?.ConditionSchema?.properties?.operator?.enum||[],e=[],s="string";return n==="is_logged_in"?s="boolean":n==="message_count"||n==="post_id"||n==="priority"?s="numeric":n==="user_role"&&(s="array_string"),t.forEach(a=>{let c=r(a.replace(/_/g," "));s==="boolean"&&["is_true","is_false"].includes(a)?e.push({value:a,label:c}):s==="string"&&["equals","not_equals","contains","not_contains","starts_with","ends_with","matches_regex","is_empty","is_not_empty","is_one_of","is_not_one_of","equals_ignore_case"].includes(a)?e.push({value:a,label:c}):s==="numeric"&&["greater_than","less_than","equals_numeric","not_equals_numeric","greater_than_or_equals","less_than_or_equals"].includes(a)?e.push({value:a,label:c}):s==="array_string"&&["is_one_of","is_not_one_of","contains","not_contains"].includes(a)&&e.push({value:a,label:c})}),e.length===0&&t.forEach(a=>e.push({value:a,label:r(a.replace(/_/g," "))})),e.sort((a,c)=>a.label.localeCompare(c.label))}window.aipkit_getConditionOperatorsForField=d})();(function(){"use strict";function d(i,n,o=null){if(!window.aipkit_getUIBuilderState()||!i||!n)return;let t=window.aipkit_escapeHtml||function(a){return a},e=i.value;if(["is_true","is_false","is_empty","is_not_empty"].includes(e))n.style.display="none",n.value="";else{n.style.display="",n.type="text",n.placeholder=t("Value");let l=i.closest(".aipkit_condition_row").querySelector(".aipkit_condition_field_select").value;(l==="message_count"||l==="priority")&&(n.type="number",n.step="1"),o&&o.value!==void 0?Array.isArray(o.value)&&(e==="is_one_of"||e==="is_not_one_of")?n.value=o.value.join(", "):n.value=String(o.value):n.value=""}}window.aipkit_updateConditionValueInput=d})();(function(){"use strict";function d(i,n,o,r=null){let t=window.aipkit_getUIBuilderState();if(!t||!i||!n||!o)return;let e=window.aipkit_escapeHtml||function(l){return l},s=i.closest(".aipkit_condition_row").querySelector(".aipkit_condition_type_select").value,a=i.value;if(n.innerHTML="",typeof window.aipkit_getConditionOperatorsForField!="function"){console.error("UpdateConditionOperators: aipkit_getConditionOperatorsForField function not found.");return}let c=window.aipkit_getConditionOperatorsForField(s,a,t.schemas);c.forEach(l=>{n.appendChild(new Option(e(l.label),e(l.value)))}),r&&r.operator?n.value=r.operator:c.length>0&&(n.value=c[0].value),typeof window.aipkit_updateConditionValueInput=="function"&&window.aipkit_updateConditionValueInput(n,o,r)}window.aipkit_updateConditionOperators=d})();(function(){"use strict";function d(i,n,o,r,t=null){let e=window.aipkit_getUIBuilderState();if(!e||!i||!n||!o||!r)return;let s=window.aipkit_escapeHtml||function(l){return l},a=i.value;if(n.innerHTML="",typeof window.aipkit_getConditionFieldsForType!="function"){console.error("UpdateConditionFields: aipkit_getConditionFieldsForType function not found.");return}let c=window.aipkit_getConditionFieldsForType(a,e.schemas);c.forEach(l=>{n.appendChild(new Option(s(l.label),s(l.value)))}),t&&t.field?n.value=t.field:c.length>0&&(n.value=c[0].value),typeof window.aipkit_updateConditionOperators=="function"&&window.aipkit_updateConditionOperators(n,o,r,t)}window.aipkit_updateConditionFields=d})();(function(){"use strict";function d(i,n=null){let o=window.aipkit_getUIBuilderState();if(!o||!i)return;let r=window.aipkit_escapeHtml||function(p){return p},t=document.querySelector(".aipkit_condition_row_template");if(!t){console.error("RenderConditionRow: Condition row template not found.");return}let s=t.content.cloneNode(!0).querySelector(".aipkit_condition_row"),a=s.querySelector(".aipkit_condition_type_select"),c=s.querySelector(".aipkit_condition_field_select"),l=s.querySelector(".aipkit_condition_operator_select"),_=s.querySelector(".aipkit_condition_value_input");(o.schemas?.ConditionSchema?.properties?.type?.enum||[]).forEach(p=>{a.appendChild(new Option(r(p.replace(/_/g," ")),r(p)))}),n?(a.value=n.type||"",typeof window.aipkit_updateConditionFields=="function"&&window.aipkit_updateConditionFields(a,c,l,_,n)):(a.options.length>0&&(a.value=a.options[0].value),typeof window.aipkit_updateConditionFields=="function"&&window.aipkit_updateConditionFields(a,c,l,_)),i.appendChild(s)}window.aipkit_renderConditionRow=d})();(function(){"use strict";function d(i,n=[]){if(!window.aipkit_getUIBuilderState()||!i)return;let r=window.aipkit_escapeHtml||function(s){return s},t=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:s=>s,e=i.querySelector(".aipkit_options_list");e&&(e.innerHTML="",(n||[]).forEach((s,a)=>{let c=document.createElement("div");c.className="aipkit_form_element_option_row",c.dataset.optionIndex=a;let l=document.createElement("input");l.type="text",l.className="aipkit_form-input aipkit_element_option_value aipkit_form_element_prop_change",l.placeholder=t("Value (e.g., option1)","gpt3-ai-content-generator"),l.value=r(s.value||""),l.dataset.property=`options[${a}].value`;let _=document.createElement("input");_.type="text",_.className="aipkit_form-input aipkit_element_option_text aipkit_form_element_prop_change",_.placeholder=t("Display Text (e.g., Option One)","gpt3-ai-content-generator"),_.value=r(s.text||""),_.dataset.property=`options[${a}].text`;let p=document.createElement("button");p.type="button",p.className="aipkit_btn aipkit_btn-icon aipkit_form_option_remove_btn",p.title=t("Remove Option","gpt3-ai-content-generator"),p.innerHTML='<span class="dashicons dashicons-no-alt"></span>',c.appendChild(l),c.appendChild(_),c.appendChild(p),e.appendChild(c)}))}window.aipkit_updateFormElementOptionControls=d})();(function(){"use strict";function d(i,n,o){if(!window.aipkit_getUIBuilderState())return console.error("RenderFormElementEditorItem: UI Builder state not initialized."),null;let t=window.aipkit_escapeHtml||function(v){return v},e=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:v=>v,s=`${o}_${i.id||`el_${Date.now()}_${n}`}`,a=document.createElement("div");a.className="aipkit_form_element_editor_item",a.dataset.elementIndex=n,a.dataset.elementId=i.id||"";let c=document.createElement("div");c.className="aipkit_form_element_editor_header";let l=document.createElement("span");l.className="aipkit_form_element_editor_title",l.innerHTML=`${t(i.label||i.id||e("New Element","gpt3-ai-content-generator"))} <span class="aipkit_element_type_badge">${t(i.type||"text_input")}</span> <span class="aipkit_element_id_badge">${i.id?t(i.id):""}</span>`;let _=document.createElement("div");_.className="aipkit_form_element_editor_actions";let p=document.createElement("button");p.type="button",p.className="aipkit_btn aipkit_btn-icon aipkit_form_element_remove_btn",p.title=e("Remove Element","gpt3-ai-content-generator"),p.innerHTML='<span class="dashicons dashicons-trash"></span>',_.appendChild(p),c.appendChild(l),c.appendChild(_),a.appendChild(c);let f=document.createElement("div");f.className="aipkit_form_element_editor_content";let g='<div class="aipkit_form-row">';g+=`<div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_type_${t(s)}">${e("Element Type","gpt3-ai-content-generator")}</label>
            <select id="fe_type_${t(s)}" data-property="type" class="aipkit_form-input aipkit_form_element_prop_change">
                ${["text_input","textarea","dropdown","checkbox_group","radio_group","label","heading"].map(v=>`<option value="${t(v)}" ${i.type===v?"selected":""}>${t(v.replace(/_/g," ").replace(/\b\w/g,I=>I.toUpperCase()))}</option>`).join("")}
            </select>
        </div>`,g+=`<div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_id_${t(s)}">${e("Field ID / Variable","gpt3-ai-content-generator")}</label>
            <input type="text" id="fe_id_${t(s)}" data-property="id" class="aipkit_form-input aipkit_form_element_prop_change" value="${t(i.id||"")}" placeholder="${e("e.g., product_name","gpt3-ai-content-generator")}">
        </div></div>`,g+=`<div class="aipkit_form-row"><div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_label_${t(s)}">${i.type==="label"||i.type==="heading"?e("Text Content","gpt3-ai-content-generator"):e("Display Label","gpt3-ai-content-generator")}</label>
            <input type="text" id="fe_label_${t(s)}" data-property="label" class="aipkit_form-input aipkit_form_element_prop_change" value="${t(i.label||"")}">
        </div></div>`,["text_input","textarea"].includes(i.type)&&(g+=`<div class="aipkit_form-row"><div class="aipkit_form-group aipkit_form-col">
                <label class="aipkit_form-label" for="fe_placeholder_${t(s)}">${e("Placeholder Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="fe_placeholder_${t(s)}" data-property="placeholder" class="aipkit_form-input aipkit_form_element_prop_change" value="${t(i.placeholder||"")}">
            </div></div>`);let E="";if(["label","heading"].includes(i.type)||(E+=`<div class="aipkit_form-group aipkit_form-col">
                <label class="aipkit_checkbox-label" for="fe_required_${t(s)}">
                    <input type="checkbox" id="fe_required_${t(s)}" data-property="required" class="aipkit_toggle_switch aipkit_form_element_prop_change" ${i.required?"checked":""}>
                    ${e("Required Field","gpt3-ai-content-generator")}
                </label>
            </div>`,E+=`<div class="aipkit_form-group aipkit_form-col">
                <label class="aipkit_form-label" for="fe_default_value_${t(s)}">${e("Default Value","gpt3-ai-content-generator")}</label>
                <input type="text" id="fe_default_value_${t(s)}" data-property="default_value" class="aipkit_form-input aipkit_form_element_prop_change" value="${t(String(i.default_value||""))}">
                <p class="aipkit_form-help">${i.type==="checkbox_group"?e("For checkboxes, separate multiple default values with a comma (e.g., val1,val2).","gpt3-ai-content-generator"):""}</p>
            </div>`),E&&(g+=`<div class="aipkit_form-row">${E}</div>`),g+=`<div class="aipkit_form-row"><div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_help_text_${t(s)}">${e("Help Text (Optional)","gpt3-ai-content-generator")}</label>
            <input type="text" id="fe_help_text_${t(s)}" data-property="help_text" class="aipkit_form-input aipkit_form_element_prop_change" value="${t(i.help_text||"")}">
        </div></div>`,["dropdown","checkbox_group","radio_group"].includes(i.type)&&(g+=`<div class="aipkit_form_element_options_editor" data-element-type="${t(i.type)}"><h6>${e("Options","gpt3-ai-content-generator")}</h6><div class="aipkit_options_list"></div>
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_form_add_option_btn"><span class="dashicons dashicons-plus-alt"></span> ${e("Add Option","gpt3-ai-content-generator")}</button>
            <p class="aipkit_form-help">${e("Format: actual_value|Display Text. e.g., blue_val|Blue Sky","gpt3-ai-content-generator")}</p></div>`),f.innerHTML=g,a.appendChild(f),["dropdown","checkbox_group","radio_group"].includes(i.type)){let v=a.querySelector(".aipkit_form_element_options_editor");v&&typeof window.aipkit_updateFormElementOptionControls=="function"&&window.aipkit_updateFormElementOptionControls(v,i.options||[])}return c.addEventListener("click",()=>{let v=f.style.display==="block";f.style.display=v?"none":"block",f.classList.toggle("aipkit_expanded",!v)}),i.id||(f.style.display="block",f.classList.add("aipkit_expanded")),a}window.aipkit_renderFormElementEditorItem=d})();(function(){"use strict";function d(i,n,o={},r=null){let t=window.aipkit_getUIBuilderState();if(!t||!i)return;let e=window.aipkit_escapeHtml||function(p){return p},s=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:p=>p,a=t.schemas||{};i.innerHTML="";let c=a.ActionSchema?.properties?.payload?.properties||{},l="";function _(p,f,g,E="action.payload."){let v='<div class="aipkit_form-group">';v+=`<label class="aipkit_form-label" for="action_payload_${e(p)}_${t.editingTriggerId||""}">${e(f.description||p.replace(/_/g," "))}</label>`;let I=`${E}${p}`;return f.type==="boolean"?v+=`<input type="checkbox" id="action_payload_${e(p)}_${t.editingTriggerId||""}" data-field="${e(I)}" class="aipkit_form-input aipkit_trigger_field" ${g===!0?"checked":""}>`:f.enum?(v+=`<select id="action_payload_${e(p)}_${t.editingTriggerId||""}" data-field="${e(I)}" class="aipkit_form-input aipkit_trigger_field">`,f.enum.forEach(b=>{v+=`<option value="${e(b)}" ${g===b?"selected":""}>${e(b.replace(/_/g," "))}</option>`}),v+="</select>"):f.type==="integer"||f.type==="number"?(v+=`<input type="number" id="action_payload_${e(p)}_${t.editingTriggerId||""}" data-field="${e(I)}" class="aipkit_form-input aipkit_trigger_field" value="${e(String(g||f.default||""))}"`,f.minimum!==void 0&&(v+=` min="${e(String(f.minimum))}"`),f.maximum!==void 0&&(v+=` max="${e(String(f.maximum))}"`),v+=">"):f.type==="object"?(v+=`<textarea id="action_payload_${e(p)}_${t.editingTriggerId||""}" data-field="${e(I)}" class="aipkit_form-input aipkit_trigger_field" rows="3" placeholder="${e('e.g., {"X-My-Header": "Value"}')}">${e(JSON.stringify(g||{},null,2))}</textarea>`,v+=`<div class="aipkit_form-help">${e("Enter as a valid JSON object.")}</div>`):p==="message"||p==="content"||p==="body_template"||p==="reason"||p==="log_message_format"?v+=`<textarea id="action_payload_${e(p)}_${t.editingTriggerId||""}" data-field="${e(I)}" class="aipkit_form-input aipkit_trigger_field" rows="3">${e(g||f.default||"")}</textarea>`:v+=`<input type="text" id="action_payload_${e(p)}_${t.editingTriggerId||""}" data-field="${e(I)}" class="aipkit_form-input aipkit_trigger_field" value="${e(g||"")}">`,v+="</div>",v}if(Object.keys(c).forEach(p=>{let f=c[p],g=!0;n==="bot_reply"&&!["message","stop_processing_ai"].includes(p)&&(g=!1),n==="inject_context"&&!["placement","content"].includes(p)&&(g=!1),n==="block_message"&&!["reason"].includes(p)&&(g=!1),n==="call_webhook"&&!["endpoint_url","http_method","headers","body_template","timeout_seconds"].includes(p)&&(g=!1),n==="set_variable"&&!["scope","key"].includes(p)&&(g=!1),n==="display_form"&&!["title","elements","submit_button_text"].includes(p)&&(g=!1),n==="store_form_submission"&&!["log_message_format"].includes(p)&&(g=!1),g&&(n==="display_form"&&p==="elements"||(l+=_(p,f,o[p])))}),n==="set_variable"){let p=a.ActionSchema?.properties?.value||{type:"string",description:"Value"};l+=_("value",p,r,"action.")}if(n==="display_form"){let p=o&&typeof o.form_id=="string"&&o.form_id.trim()!==""?o.form_id:`form_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;o||(o={}),o.form_id=p,l+=`<input type="hidden" class="aipkit_trigger_field" data-field="action.payload.form_id" value="${e(p)}">`,l+=`<div class="aipkit_form_elements_editor_container">
                <h6>${s("Form Elements","gpt3-ai-content-generator")}</h6>
                <div class="aipkit_form_elements_list"></div>
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_form_add_element_btn">
                    <span class="dashicons dashicons-plus"></span> ${s("Add Form Element","gpt3-ai-content-generator")}
                </button>
            </div>`}if(i.innerHTML=l,n==="display_form"){let p=i.querySelector(".aipkit_form_elements_list");p&&o&&Array.isArray(o.elements)&&o.elements.forEach((f,g)=>{if(typeof window.aipkit_renderFormElementEditorItem=="function"){let E=window.aipkit_renderFormElementEditorItem(f,g,o.form_id);E&&p.appendChild(E)}})}}window.aipkit_renderActionPayloadFields=d})();(function(){"use strict";function d(i,n){let o=window.aipkit_getUIBuilderState();if(!o||!i||!n){console.error("AIPKit RenderTriggerEditorForm: Missing state, content element, or trigger data.");return}let r=window.aipkit_escapeHtml||function(l){return l},t=o.schemas||{},e=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:l=>l,s=`
            <div class="aipkit_form-row">
                <div class="aipkit_form-group aipkit_form-col">
                    <label class="aipkit_form-label" for="trigger_name_${n.id}">${r(e("Trigger Name","gpt3-ai-content-generator"))}</label>
                    <input type="text" id="trigger_name_${n.id}" data-field="name" class="aipkit_form-input aipkit_trigger_field" value="${r(n.name||"")}">
                </div>
                <div class="aipkit_form-group aipkit_form-col">
                    <label class="aipkit_form-label" for="trigger_event_${n.id}">${r(e("Event","gpt3-ai-content-generator"))}</label>
                    <select id="trigger_event_${n.id}" data-field="event_name" class="aipkit_form-input aipkit_trigger_field">
                        ${(t.EventSchema?.properties?.name?.enum||[]).map(l=>`<option value="${r(l)}" ${n.event_name===l?"selected":""}>${r(l.replace(/_/g," ").replace(/\b\w/g,_=>_.toUpperCase()))}</option>`).join("")}
                    </select>
                </div>
                <div class="aipkit_form-group aipkit_form-col" style="max-width: 120px;">
                    <label class="aipkit_form-label" for="trigger_priority_${n.id}">${r(e("Priority","gpt3-ai-content-generator"))}</label>
                    <input type="number" id="trigger_priority_${n.id}" data-field="priority" class="aipkit_form-input aipkit_trigger_field" value="${r(String(n.priority||10))}" min="0" step="1">
                </div>
            </div>
        `;s+=`<div class="aipkit_conditions_container"><h6>${r(e("Conditions (All must be met)","gpt3-ai-content-generator"))}</h6><div class="aipkit_condition_rows_list">`,n.conditions&&n.conditions.length>0||(s+=`<p class="aipkit_form-help">${r(e("No conditions defined. This trigger will run if the event occurs.","gpt3-ai-content-generator"))}</p>`),s+=`</div><button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_trigger_add_condition_btn" style="margin-top:10px;"><span class="dashicons dashicons-plus"></span> ${r(e("Add Condition","gpt3-ai-content-generator"))}</button></div>`,s+=`<div class="aipkit_action_container"><h6>${r(e("Action","gpt3-ai-content-generator"))}</h6>`,s+=`<div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="action_type_${n.id}">${r(e("Action Type","gpt3-ai-content-generator"))}</label>
                        <select id="action_type_${n.id}" data-field="action.type" class="aipkit_form-input aipkit_trigger_field aipkit_trigger_action_type_select">
                            ${(t.ActionSchema?.properties?.type?.enum||[]).map(l=>`<option value="${r(l)}" ${n.action?.type===l?"selected":""}>${r(l.replace(/_/g," ").replace(/\b\w/g,_=>_.toUpperCase()))}</option>`).join("")}
                        </select>
                     </div>`,s+='<div class="aipkit_action_payload_container"></div>',s+="</div>",i.innerHTML=s;let a=i.querySelector(".aipkit_condition_rows_list");a&&n.conditions&&n.conditions.length>0&&(a.innerHTML="",n.conditions.forEach(l=>{typeof window.aipkit_renderConditionRow=="function"&&window.aipkit_renderConditionRow(a,l)}));let c=i.querySelector(".aipkit_action_payload_container");c&&n.action?.type&&typeof window.aipkit_renderActionPayloadFields=="function"&&window.aipkit_renderActionPayloadFields(c,n.action.type,n.action.payload,n.action.value)}window.aipkit_renderTriggerEditorForm=d})();(function(){"use strict";function d(i){if(!window.aipkit_getUIBuilderState())return console.error("AIPKit RenderSingleTriggerItem: UI Builder state not initialized."),null;let o=window.aipkit_escapeHtml||function(_){return _},r=document.querySelector(".aipkit_trigger_editor_template");if(!r)return console.error("AIPKit RenderSingleTriggerItem: Trigger editor template not found."),null;let e=r.content.cloneNode(!0).querySelector(".aipkit_trigger_item"),s=e.querySelector(".aipkit_trigger_item_name_display"),a=e.querySelector(".aipkit_trigger_item_id_display"),c=e.querySelector(".aipkit_trigger_is_active_checkbox"),l=e.querySelector(".aipkit_trigger_item_content");return e.dataset.triggerId=i.id,s&&(s.textContent=o(i.name||"Unnamed Trigger")),a&&(a.textContent=`(ID: ${o(i.id)})`),c&&(c.checked=i.is_active===!0),l?l.innerHTML="":console.error("AIPKit RenderSingleTriggerItem: .aipkit_trigger_item_content missing in template for trigger:",i.id),e}window.aipkit_renderSingleTriggerItem=d})();(function(){"use strict";function d(){let i=window.aipkit_getUIBuilderState();if(!i){console.error("RenderTriggerList: UI Builder state not initialized.");return}let n=document.getElementById(`aipkit_trigger_list_for_${i.botId}`),o=n?n.querySelector(".aipkit_trigger_list_empty_message"):null;if(!n){console.error(`RenderTriggerList: List container for bot ${i.botId} not found.`);return}n.querySelectorAll(".aipkit_trigger_item").forEach(r=>r.remove()),i.triggers&&i.triggers.length>0?(o&&(o.style.display="none"),i.triggers.forEach(r=>{if(typeof window.aipkit_renderSingleTriggerItem=="function"){let t=window.aipkit_renderSingleTriggerItem(r);t&&n.appendChild(t)}else console.error("RenderTriggerList: aipkit_renderSingleTriggerItem function not found.")})):o&&(o.style.display="block")}window.aipkit_renderTriggerList=d})();(function(){"use strict";let d=null;function i(o){d=o}function n(){return d}window.aipkit_setTriggerEventManagerState=i,window.aipkit_getTriggerEventManagerState=n})();(function(){"use strict";function d(i,n,o){let r=n.split("."),t=i;for(let e=0;e<r.length-1;e++)(!t[r[e]]||typeof t[r[e]]!="object")&&(t[r[e]]={}),t=t[r[e]];t[r[r.length-1]]=o}window.aipkit_setNestedValue=d})();(function(){"use strict";function d(i,n,o){let r=window.aipkit_getTriggerEventManagerState();if(!r)return;let t=r.triggers.findIndex(e=>e.id===i);if(t===-1){console.warn(`UpdateTriggerData: Trigger ID ${i} not found in state for bot ${r.botId}.`);return}window.aipkit_setNestedValue(r.triggers[t],n,o),r.isDirty=!0}window.aipkit_updateTriggerData=d})();(function(){"use strict";function d(i,n){let o=window.aipkit_getTriggerEventManagerState();if(!o||!n)return console.error("SaveTriggerFromForm: State or triggerItemElement missing."),!1;let r=o.triggers.findIndex(a=>a.id===i);if(r===-1)return console.warn(`SaveTriggerFromForm: Trigger ID ${i} not found in state for bot ${o.botId}.`),!1;let t=n.querySelector(".aipkit_trigger_item_content");if(!t||t.style.display==="none")return!0;let e=JSON.parse(JSON.stringify(o.triggers[r]));t.querySelectorAll(".aipkit_trigger_field[data-field]").forEach(a=>{let c=a.dataset.field,l=a.type==="checkbox"?a.checked:a.type==="number"?parseFloat(a.value)||0:a.value;window.aipkit_setNestedValue(e,c,l)}),e.conditions=[],t.querySelectorAll(".aipkit_condition_row").forEach(a=>{let c=a.querySelector(".aipkit_condition_type_select")?.value,l=a.querySelector(".aipkit_condition_field_select")?.value,_=a.querySelector(".aipkit_condition_operator_select")?.value,p=a.querySelector(".aipkit_condition_value_input"),f=p?.value;if(p?.type==="number"?f=parseFloat(f)||0:p?.type==="text"&&(_==="is_one_of"||_==="is_not_one_of")&&(f=f.split(",").map(g=>g.trim()).filter(g=>g!=="")),p?.style.display==="none"&&(f=void 0),c&&l&&_){let g={type:c,field:l,operator:_};f!==void 0&&(g.value=f),e.conditions.push(g)}});let s=t.querySelector(".aipkit_trigger_action_type_select");if(s&&(e.action.type=s.value),e.action&&e.action.type){e.action.payload={},t.querySelectorAll('.aipkit_action_payload_container .aipkit_trigger_field[data-field^="action.payload."').forEach(c=>{let l=c.dataset.field.substring(15),_=c.type==="checkbox"?c.checked:c.value;if(l==="headers"&&typeof _=="string")try{_=JSON.parse(_||"{}")}catch{_={}}(e.action.type==="store_form_submission"&&l==="log_message_format"||l&&l!=="elements")&&(e.action.payload[l]=_)}),e.action.type==="display_form"&&(e.action.payload.elements=[],t.querySelectorAll(".aipkit_form_element_editor_item").forEach(c=>{let l={};c.querySelectorAll(".aipkit_form_element_prop_change").forEach(_=>{let p=_.dataset.property,f=_.type==="checkbox"?_.checked:_.value;l[p]=f}),["dropdown","checkbox_group","radio_group"].includes(l.type)&&(l.options=[],c.querySelectorAll(".aipkit_form_element_option_row").forEach(_=>{let p=_.querySelector(".aipkit_element_option_value")?.value,f=_.querySelector(".aipkit_element_option_text")?.value;p!==void 0&&f!==void 0&&l.options.push({value:p,text:f})})),e.action.payload.elements.push(l)}));let a=t.querySelector('.aipkit_action_payload_container .aipkit_trigger_field[data-field="action.value"]');a?e.action.value=a.value:delete e.action.value}return o.triggers[r]=e,o.isDirty=!0,!0}window.aipkit_saveTriggerFromForm=d})();(function(){"use strict";let d;function i(n,o){clearTimeout(d),d=setTimeout(()=>{typeof window.aipkit_saveTriggerFromForm=="function"?window.aipkit_saveTriggerFromForm(n,o):console.error("DebouncedSave: aipkit_saveTriggerFromForm function not found.")},750)}window.aipkit_debouncedSave=i})();(function(){"use strict";function d(){let i=window.aipkit_getTriggerEventManagerState();if(!i){console.error("AIPKit AddNewTrigger: State not found.");return}let n=`trigger_${Date.now()}_${Math.random().toString(36).substring(2,7)}`,o=i.schemas?.EventSchema?.properties?.name?.enum[0]||"user_message_received",r=i.schemas?.ActionSchema?.properties?.type?.enum[0]||"bot_reply",t={id:n,name:"New Trigger",event_name:o,conditions:[],action:{type:r,payload:{}},priority:10,is_active:!0};i.triggers.push(t),i.isDirty=!0;let e=document.getElementById(`aipkit_trigger_list_for_${i.botId}`);if(!e){console.error("AIPKit AddNewTrigger: List container not found.");return}let s=e.querySelector(".aipkit_trigger_list_empty_message");if(s&&(s.style.display="none"),typeof window.aipkit_renderSingleTriggerItem=="function"){let a=window.aipkit_renderSingleTriggerItem(t);if(a)if(e.appendChild(a),typeof window.aipkit_toggleTriggerItemContent=="function"){window.aipkit_toggleTriggerItemContent(a,n,!0);let c=a.querySelector('input[data-field="name"]');c?c.focus():console.warn("AIPKit AddNewTrigger: Name input not found after expanding.")}else console.error("AIPKit AddNewTrigger: aipkit_toggleTriggerItemContent function not found.");else console.error("AIPKit AddNewTrigger: aipkit_renderSingleTriggerItem returned null.")}else console.error("AIPKit AddNewTrigger: aipkit_renderSingleTriggerItem function not found.")}window.aipkit_handleAddNewTrigger=d})();(function(){"use strict";function d(i,n,o=!1){let r=window.aipkit_getUIBuilderState(),t=window.aipkit_getTriggerEventManagerState();if(!r||!t){console.error("AIPKit ToggleContent: UI Builder or Event Manager State not found.");return}let e=i.querySelector(".aipkit_trigger_item_content"),s=i.querySelector(".aipkit_trigger_item_header");if(!e||!s){console.error("AIPKit ToggleContent: Content or header element not found.");return}let a=e.style.display==="block";if(o&&a&&t.editingTriggerId===n){let c=r.triggers.find(l=>l.id===n);c&&typeof window.aipkit_renderTriggerEditorForm=="function"&&window.aipkit_renderTriggerEditorForm(e,c);return}if(a&&!o)e.style.display="none",e.classList.remove("aipkit_expanded"),s.classList.remove("aipkit_expanded"),t.editingTriggerId===n&&(typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(n,i),t.editingTriggerId=null);else{let c=document.querySelector(`#aipkit_trigger_list_for_${r.botId} .aipkit_trigger_item_content.aipkit_expanded`);if(c&&c!==e){let l=c.closest(".aipkit_trigger_item");l&&l.dataset.triggerId&&(typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(l.dataset.triggerId,l),c.style.display="none",c.classList.remove("aipkit_expanded"),c.previousElementSibling?.classList.remove("aipkit_expanded"))}if(e.style.display="block",e.classList.add("aipkit_expanded"),s.classList.add("aipkit_expanded"),t.editingTriggerId=n,e.innerHTML.trim()===""||o){let l=r.triggers.find(_=>_.id===n);l&&typeof window.aipkit_renderTriggerEditorForm=="function"?window.aipkit_renderTriggerEditorForm(e,l):console.error("AIPKit ToggleContent: Trigger data or render function not found for form rendering.")}}}window.aipkit_toggleTriggerItemContent=d})();(function(){"use strict";function d(i){let n=window.aipkit_getTriggerEventManagerState();if(!n)return;let r=(window.aipkit_trigger_builder_config?.text||{}).confirmDeleteTrigger||`Are you sure you want to delete trigger ID: ${i}?`;if(!confirm(r))return;n.triggers=n.triggers.filter(s=>s.id!==i),n.isDirty=!0;let t=document.querySelector(`.aipkit_trigger_item[data-trigger-id="${i}"]`);t&&t.remove();let e=document.getElementById(`aipkit_trigger_list_for_${n.botId}`);if(e){let s=e.querySelector(".aipkit_trigger_list_empty_message");n.triggers.length===0&&s&&(s.style.display="block")}}window.aipkit_handleDeleteTrigger=d})();(function(){"use strict";function d(i){let n=window.aipkit_getTriggerEventManagerState();if(!n||!i)return;let o=i.querySelector(".aipkit_condition_rows_list");o&&typeof window.aipkit_renderConditionRow=="function"?(window.aipkit_renderConditionRow(o),n.isDirty=!0,typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(i.dataset.triggerId,i)):console.error("HandleAddCondition: Condition rows list or render function not found.")}window.aipkit_handleAddCondition=d})();(function(){"use strict";function d(i){let n=window.aipkit_getTriggerEventManagerState();if(!n||!i||!i.parentNode)return;let o=i.closest(".aipkit_trigger_item");i.remove(),n.isDirty=!0,o&&typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(o.dataset.triggerId,o)}window.aipkit_handleRemoveCondition=d})();(function(){"use strict";function d(i){let n=window.aipkit_getTriggerEventManagerState();if(!n||!i)return;let o=i.dataset.triggerId,r=n.triggers.findIndex(l=>l.id===o);if(r===-1)return;let t=n.triggers[r];if(t.action.type!=="display_form")return;(!t.action.payload.elements||!Array.isArray(t.action.payload.elements))&&(t.action.payload.elements=[]);let e=t.action.payload.elements.length,a={id:`field_${Date.now()}_${e}`,type:"text_input",label:"New Field",placeholder:"",required:!1,default_value:"",help_text:""};t.action.payload.elements.push(a),n.isDirty=!0;let c=i.querySelector(".aipkit_form_elements_list");if(c&&typeof window.aipkit_renderFormElementEditorItem=="function"){let l=window.aipkit_renderFormElementEditorItem(a,e,t.action.payload.form_id);if(l){c.appendChild(l);let _=l.querySelector(".aipkit_form_element_editor_content");_&&(_.style.display="block",_.classList.add("aipkit_expanded"));let p=l.querySelector('input[data-property="id"]');p&&p.focus()}typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(o,i)}}window.aipkit_handleAddFormElement=d})();(function(){"use strict";function d(i){let n=window.aipkit_getTriggerEventManagerState();if(!n||!i||!i.parentNode)return;let o=i.closest(".aipkit_trigger_item");if(!o)return;let r=o.dataset.triggerId,t=n.triggers.findIndex(a=>a.id===r);if(t===-1)return;let e=parseInt(i.dataset.elementIndex,10);if(isNaN(e))return;let s=n.triggers[t];if(s.action.type==="display_form"&&s.action.payload.elements&&e>=0&&e<s.action.payload.elements.length){s.action.payload.elements.splice(e,1),n.isDirty=!0,i.remove();let a=o.querySelector(".aipkit_form_elements_list");a&&a.querySelectorAll(".aipkit_form_element_editor_item").forEach((c,l)=>{c.dataset.elementIndex=l,c.querySelectorAll(".aipkit_element_option_value, .aipkit_element_option_text").forEach(_=>{let p=_.dataset.prop.split(".")[1];_.dataset.property=`options[${optionRow.dataset.optionIndex}].${p}`})}),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(r,o)}}window.aipkit_handleRemoveFormElement=d})();(function(){"use strict";function d(i){let n=window.aipkit_getTriggerEventManagerState();if(!n)return;let o=i.target,r=o.dataset.property;if(!r)return;let t=o.closest(".aipkit_form_element_editor_item"),e=o.closest(".aipkit_trigger_item");if(!t||!e)return;let s=e.dataset.triggerId,a=parseInt(t.dataset.elementIndex,10);if(isNaN(a))return;let c=n.triggers.findIndex(g=>g.id===s);if(c===-1)return;let l=n.triggers[c];if(l.action.type!=="display_form"||!l.action.payload.elements||a<0||a>=l.action.payload.elements.length)return;let _=l.action.payload.elements[a],p=o.type==="checkbox"?o.checked:o.value,f=r.match(/^options\[(\d+)\]\.(value|text)$/);if(f){let g=parseInt(f[1],10),E=f[2];_.options||(_.options=[]),_.options[g]||(_.options[g]={}),_.options[g][E]=p}else _[r]=p;if(n.isDirty=!0,r==="type"){let g=t.querySelector(".aipkit_element_type_badge").textContent.toLowerCase().replace(" ","_");if(e.querySelector(".aipkit_action_payload_container")&&typeof window.aipkit_renderActionPayloadFields=="function"){let v=window.aipkit_renderFormElementEditorItem(_,a,l.action.payload.form_id);if(v&&t.parentNode){t.parentNode.replaceChild(v,t);let I=v.querySelector(".aipkit_form_element_editor_content");I&&(I.style.display="block",I.classList.add("aipkit_expanded"))}}}else if(r==="label"||r==="id"){let g=t.querySelector(".aipkit_form_element_editor_title");g&&(g.innerHTML=`${window.aipkit_escapeHtml(_.label||_.id||"New Element")} <span class="aipkit_element_type_badge">${window.aipkit_escapeHtml(_.type||"text_input")}</span> <span class="aipkit_element_id_badge">${_.id?window.aipkit_escapeHtml(_.id):""}</span>`)}typeof window.aipkit_debouncedSave=="function"&&window.aipkit_debouncedSave(s,e)}window.aipkit_handleFormElementPropertyChange=d})();(function(){"use strict";function d(i){if(!window.aipkit_getTriggerEventManagerState())return;let o=i.target,r=o.closest(".aipkit_trigger_item");if(!r)return;let t=r.dataset.triggerId;t&&(o.closest(".aipkit_trigger_item_header")&&!o.closest(".aipkit_trigger_item_actions button, .aipkit_trigger_is_active_toggle input")?typeof window.aipkit_toggleTriggerItemContent=="function"&&window.aipkit_toggleTriggerItemContent(r,t):o.closest(".aipkit_trigger_edit_btn")?typeof window.aipkit_toggleTriggerItemContent=="function"&&window.aipkit_toggleTriggerItemContent(r,t,!0):o.closest(".aipkit_trigger_delete_btn")?typeof window.aipkit_handleDeleteTrigger=="function"&&window.aipkit_handleDeleteTrigger(t):o.closest(".aipkit_trigger_add_condition_btn")?typeof window.aipkit_handleAddCondition=="function"&&window.aipkit_handleAddCondition(r):o.closest(".aipkit_condition_remove_btn")&&typeof window.aipkit_handleRemoveCondition=="function"&&window.aipkit_handleRemoveCondition(o.closest(".aipkit_condition_row")))}window.aipkit_handleListContainerClick=d})();(function(){"use strict";function d(i){let n=window.aipkit_getTriggerEventManagerState();if(!n)return;let o=i.target,r=o.closest(".aipkit_trigger_item");if(!r)return;let t=r.dataset.triggerId;if(t)if(o.matches(".aipkit_trigger_is_active_checkbox"))typeof window.aipkit_updateTriggerData=="function"&&window.aipkit_updateTriggerData(t,"is_active",o.checked);else if(o.matches(".aipkit_condition_type_select")){let e=o.closest(".aipkit_condition_row");e&&typeof window.aipkit_updateConditionFields=="function"&&window.aipkit_updateConditionFields(o,e.querySelector(".aipkit_condition_field_select"),e.querySelector(".aipkit_condition_operator_select"),e.querySelector(".aipkit_condition_value_input")),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(t,r)}else if(o.matches(".aipkit_condition_field_select")){let e=o.closest(".aipkit_condition_row");e&&typeof window.aipkit_updateConditionOperators=="function"&&window.aipkit_updateConditionOperators(o,e.querySelector(".aipkit_condition_operator_select"),e.querySelector(".aipkit_condition_value_input")),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(t,r)}else if(o.matches(".aipkit_condition_operator_select")){let e=o.closest(".aipkit_condition_row");e&&typeof window.aipkit_updateConditionValueInput=="function"&&window.aipkit_updateConditionValueInput(o,e.querySelector(".aipkit_condition_value_input")),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(t,r)}else if(o.matches(".aipkit_trigger_action_type_select")){let e=r.querySelector(".aipkit_action_payload_container"),s=n.triggers.find(a=>a.id===t);e&&typeof window.aipkit_renderActionPayloadFields=="function"&&window.aipkit_renderActionPayloadFields(e,o.value,s?.action?.payload,s?.action?.value),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(t,r)}else o.matches(".aipkit_trigger_field")&&typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(t,r)}window.aipkit_handleListContainerChange=d})();(function(){"use strict";function d(i){if(!window.aipkit_getTriggerEventManagerState())return;let o=i.target,r=o.closest(".aipkit_trigger_item");if(!r)return;let t=r.dataset.triggerId;if(t)if(o.matches('input[data-field="name"]')){let e=r.querySelector(".aipkit_trigger_item_name_display");e&&(e.textContent=o.value||"Unnamed Trigger"),typeof window.aipkit_debouncedSave=="function"&&window.aipkit_debouncedSave(t,r)}else o.matches(".aipkit_trigger_field")&&typeof window.aipkit_debouncedSave=="function"&&window.aipkit_debouncedSave(t,r)}window.aipkit_handleListContainerInput=d})();(function(){"use strict";function d(i){let n=document.getElementById(`aipkit_trigger_builder_${i}`);if(!n){console.warn(`InitEventListeners: Builder container for bot ${i} not found.`);return}if(n.dataset.eventManagerInitialized==="true")return;let o=n.querySelector(".aipkit_trigger_add_new_btn");o&&typeof window.aipkit_handleAddNewTrigger=="function"?o.addEventListener("click",window.aipkit_handleAddNewTrigger):o&&console.error("InitEventListeners: aipkit_handleAddNewTrigger function not found.");let r=n.querySelector(".aipkit_trigger_list_container");r?(typeof window.aipkit_handleListContainerClick=="function"?r.addEventListener("click",window.aipkit_handleListContainerClick):console.error("InitEventListeners: aipkit_handleListContainerClick function not found."),typeof window.aipkit_handleListContainerChange=="function"?r.addEventListener("change",window.aipkit_handleListContainerChange):console.error("InitEventListeners: aipkit_handleListContainerChange function not found."),typeof window.aipkit_handleListContainerInput=="function"?r.addEventListener("input",window.aipkit_handleListContainerInput):console.error("InitEventListeners: aipkit_handleListContainerInput function not found."),r.addEventListener("click",function(t){let e=t.target.closest(".aipkit_form_add_element_btn"),s=t.target.closest(".aipkit_form_element_remove_btn"),a=t.target.closest(".aipkit_form_add_option_btn"),c=t.target.closest(".aipkit_form_option_remove_btn");if(e){let l=e.closest(".aipkit_trigger_item");l&&typeof window.aipkit_handleAddFormElement=="function"&&window.aipkit_handleAddFormElement(l)}else if(s){let l=s.closest(".aipkit_form_element_editor_item");l&&typeof window.aipkit_handleRemoveFormElement=="function"&&window.aipkit_handleRemoveFormElement(l)}else if(a){let l=a.closest(".aipkit_form_element_options_editor"),_=l.closest(".aipkit_trigger_item"),p=l.closest(".aipkit_form_element_editor_item");if(l&&_&&p&&typeof window.aipkit_saveTriggerFromForm=="function"&&typeof window.aipkit_updateFormElementOptionControls=="function"){let f=window.aipkit_getTriggerEventManagerState(),g=_.dataset.triggerId,E=parseInt(p.dataset.elementIndex,10),v=f.triggers.find(I=>I.id===g);v&&v.action.payload.elements[E]&&(v.action.payload.elements[E].options||(v.action.payload.elements[E].options=[]),v.action.payload.elements[E].options.push({value:"",text:""}),f.isDirty=!0,window.aipkit_updateFormElementOptionControls(l,v.action.payload.elements[E].options),window.aipkit_saveTriggerFromForm(g,_))}}else if(c){let l=c.closest(".aipkit_form_element_option_row"),_=c.closest(".aipkit_form_element_options_editor"),p=_.closest(".aipkit_trigger_item"),f=_.closest(".aipkit_form_element_editor_item");if(l&&_&&p&&f&&typeof window.aipkit_saveTriggerFromForm=="function"&&typeof window.aipkit_updateFormElementOptionControls=="function"){let g=parseInt(l.dataset.optionIndex,10),E=window.aipkit_getTriggerEventManagerState(),v=p.dataset.triggerId,I=parseInt(f.dataset.elementIndex,10),b=E.triggers.find(T=>T.id===v);b&&b.action.payload.elements[I]&&b.action.payload.elements[I].options[g]!==void 0&&(b.action.payload.elements[I].options.splice(g,1),E.isDirty=!0,window.aipkit_updateFormElementOptionControls(_,b.action.payload.elements[I].options),window.aipkit_saveTriggerFromForm(v,p))}}}),r.addEventListener("change",function(t){let e=t.target;e.matches&&(e.matches(".aipkit_form_element_prop_change")||e.closest(".aipkit_form_element_option_row input"))&&typeof window.aipkit_handleFormElementPropertyChange=="function"&&window.aipkit_handleFormElementPropertyChange(t)}),r.addEventListener("input",function(t){let e=t.target;e.matches&&(e.matches(".aipkit_form_element_prop_change")||e.closest(".aipkit_form_element_option_row input"))&&typeof window.aipkit_handleFormElementPropertyChange=="function"&&(clearTimeout(e.aipkitDebounceTimeout),e.aipkitDebounceTimeout=setTimeout(()=>{window.aipkit_handleFormElementPropertyChange(t)},500))})):console.warn(`InitEventListeners: List container not found for bot ${i}.`),n.dataset.eventManagerInitialized="true"}window.aipkit_initTriggerBuilderEventListeners=d})();(function(){"use strict";let d={};function i(o){if(!o){console.error("AIPKit Trigger Main: Bot ID is required to initialize UI.");return}let r=document.getElementById(`aipkit_trigger_builder_${o}`);if(!r){console.error(`AIPKit Trigger Main: Builder container for bot ${o} not found.`);return}if(r.dataset.triggerUiInitialized==="true")return;let t=["aipkit_loadInitialTriggers","aipkit_loadTriggerSchemas","aipkit_initTriggerBuilderState","aipkit_setTriggerBuilderState","aipkit_setTriggerEventManagerState","aipkit_renderTriggerList","aipkit_initTriggerBuilderEventListeners","aipkit_renderFormElementEditorItem","aipkit_updateFormElementOptionControls","aipkit_handleAddFormElement","aipkit_handleRemoveFormElement","aipkit_handleFormElementPropertyChange"],e=!1;if(t.forEach(_=>{typeof window[_]!="function"&&(console.error(`AIPKit Trigger Main: CRITICAL DEPENDENCY MISSING -> ${_}. Check script loading and function names.`),e=!0)}),e){r.innerHTML='<p style="color:red;">Error: Trigger UI components failed to load. Check console for details.</p>';return}let s=window.aipkit_loadInitialTriggers(o),a=window.aipkit_loadTriggerSchemas(o);(!a||Object.keys(a).length===0)&&console.error(`AIPKit Trigger Main: Trigger schemas not loaded for bot ${o}.`);let c=window.aipkit_initTriggerBuilderState(o,s,a);d[o]=c,window.aipkit_setTriggerBuilderState(c),window.aipkit_setTriggerEventManagerState(c),window.aipkit_renderTriggerList(),window.aipkit_initTriggerBuilderEventListeners(o),r.dataset.triggerUiInitialized="true";let l=r.closest("form.aipkit_chatbot_settings_form");l?l.dataset.triggerSaveListenerAttached||(l.addEventListener("submit",function(_){let p=window.aipkit_getTriggerBuilderState(o);if(p){let f=window.aipkit_getTriggerEventManagerState();if(f&&f.editingTriggerId){let g=document.querySelector(`.aipkit_trigger_item[data-trigger-id="${f.editingTriggerId}"]`);g&&typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(f.editingTriggerId,g)}typeof window.aipkit_updateTriggersJsonForSave=="function"?window.aipkit_updateTriggersJsonForSave(o,p.triggers):console.error("AIPKit Trigger Main: aipkit_updateTriggersJsonForSave is not defined. Triggers JSON might not be saved correctly.")}}),l.dataset.triggerSaveListenerAttached="true"):console.warn(`AIPKit Trigger Main: Could not find parent form for bot ${o} to attach pre-save hook.`)}function n(o){return d[o]||null}window.aipkit_initTriggerBuilderUI=i,window.aipkit_getTriggerBuilderState=n})();(function(){"use strict";function d(o){if(!o)return;let r=o.querySelector(".aipkit_enable_realtime_voice_toggle"),t=o.querySelector(".aipkit_realtime_voice_settings_container");if(!r||!t)return;let e=r.checked;t.style.display=e?"block":"none",typeof i=="function"&&i(o)}function i(o){if(!o)return;let r=o.querySelector(".aipkit_enable_realtime_voice_toggle"),t=o.querySelector('input[name="direct_voice_mode"]'),e=t?t.closest(".aipkit_form-group"):null,s=o.closest(".aipkit_chatbot-settings-area"),a=s?s.querySelector('input[name="popup_enabled"]'):null;if(!r||!t||!e||!a)return;let c=r.checked,l=a.checked,_=c&&l,p=e.getAttribute("data-tooltip-disabled")||"";_?(t.disabled=!1,e.removeAttribute("title"),e.classList.remove("aipkit-disabled-tooltip")):(t.checked&&(t.checked=!1,t.dispatchEvent(new Event("change",{bubbles:!0}))),t.disabled=!0,e.setAttribute("title",p),e.classList.add("aipkit-disabled-tooltip"))}function n(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o)return;let r="data-realtime-voice-ui-listener-attached";o.getAttribute(r)||(o.addEventListener("change",function(t){let e=t.target,s=e.closest(".aipkit_chatbot-settings-area");if(s){if(e.matches&&e.matches(".aipkit_enable_realtime_voice_toggle")){let a=e.closest(".aipkit_accordion-content");a&&d(a)}else if(e.matches&&e.matches('input[name="popup_enabled"]')){let a=s.querySelector('.aipkit_accordion[data-section="voice-agent"] .aipkit_accordion-content');a&&i(a)}}}),o.setAttribute(r,"true"),o.querySelectorAll('.aipkit_accordion[data-section="voice-agent"] .aipkit_accordion-content').forEach(t=>{d(t)}))}window.aipkit_initRealtimeVoiceAgentUI=n,window.aipkit_updateDirectVoiceModeState=i})();(function(){"use strict";function d(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let n="data-embed-copy-listener-attached";i.getAttribute(n)||(i.setAttribute(n,"true"),i.addEventListener("click",function(o){let r=o.target.closest(".aipkit_copy_embed_code_btn");if(!r)return;let t=r.dataset.target;if(!t)return;let e=document.getElementById(t);if(e){let s=e.value;typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(s,r):(console.error("AIPKit Embed: copyShortcode utility not found."),alert("Could not copy code."))}}))}window.aipkit_initEmbedCodeCopy=d})();(function(){"use strict";let d,i=window.aipkit_escapeHtml||function(t){return t};function n(t,e,s="",a="",c=""){if(!t)return;let l=t.querySelector(".aipkit_gsheets_indicator"),_=t.querySelector(".aipkit_gsheets_file_display"),p=t.querySelector(".aipkit_gsheets_shortcut_link_wrapper"),f=t.querySelector(".aipkit_gsheets_shortcut_link");if(!l||!_)return;let g=(window.aipkit_cw_pro_config||{}).gsheets_text||{};switch(l.innerHTML="",l.className="aipkit_gsheets_indicator",p&&(p.style.display="none"),_.style.display="none",e){case"verifying":l.innerHTML=`<span class="aipkit_spinner" style="display:inline-block; width:14px; height:14px; border-width:2px; vertical-align:middle; margin-right:4px;"></span> ${g.verifying||"Verifying..."}`,l.classList.add("aipkit_gsheets_indicator--verifying");break;case"success":l.innerHTML=`<span class="dashicons dashicons-yes-alt" style="color:green;"></span> ${g.accessible||"Accessible"}`,l.classList.add("aipkit_gsheets_indicator--success"),_&&c&&(_.innerHTML=`<span>${i(c)}</span> <span class="dashicons dashicons-yes-alt"></span>`,_.style.display="inline-block"),p&&f&&a&&(f.href=`https://docs.google.com/spreadsheets/d/${encodeURIComponent(a)}/edit`,p.style.display="block");break;case"loaded":l.innerHTML="",_&&c&&(_.innerHTML=`<span>${i(c)}</span> <span class="dashicons dashicons-yes-alt"></span>`,_.style.display="inline-block");break;case"error":l.innerHTML=`<span class="dashicons dashicons-warning" style="color:red;"></span> ${g.error_prefix||"Error:"} ${i(s)}`,l.classList.add("aipkit_gsheets_indicator--error");break;case"clear":default:l.innerHTML="",_.innerHTML="",_.style.display="none";break}}async function o(t){if(!t)return;let e=t.querySelector(".aipkit_gsheets_sheet_id_input"),s=t.querySelector(".aipkit_gsheets_credentials_hidden_input"),a=(window.aipkit_cw_pro_config||{}).gsheets_text||{},c=e?e.value.trim():"",l=s?s.value.trim():"";if(!c||!l){n(t,"clear");return}let _=s.dataset.filename||"credentials.json";n(t,"verifying");try{let p=document.getElementById("aipkit_content_writer_nonce"),f=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,g=p?p.value:f;if(!g)throw new Error("Security token could not be found.");await window.aipkit_apiRequest("aipkit_content_writer_verify_gsheets",{gsheets_sheet_id:c,gsheets_credentials:l,_ajax_nonce:g}),n(t,"success","Connection successful.",c,_)}catch(p){n(t,"error",p.message||a.invalid_creds||"Invalid credentials or sheet not shared.")}}function r(){if(!window.aipkit_dashboard||!window.aipkit_dashboard.isProPlan)return;let t=document.getElementById("aipkit_module-container");if(!t)return;let e="data-gsheets-listener-attached";t.getAttribute(e)||(t.addEventListener("input",s=>{if(s.target.matches(".aipkit_gsheets_sheet_id_input")){clearTimeout(d);let a=s.target.closest(".aipkit_gsheets_section_container");d=setTimeout(()=>o(a),1e3)}}),t.addEventListener("change",s=>{if(s.target.matches(".aipkit_gsheets_credentials_file_input")){let a=s.target,c=a.closest(".aipkit_gsheets_section_container");if(!c)return;let l=c.querySelector(".aipkit_gsheets_credentials_hidden_input");if(!l)return;let _=a.files[0];if(!_){l.value="",delete l.dataset.filename,n(c,"clear");return}let p=new FileReader;p.onload=function(f){l.value=f.target.result,l.dataset.filename=_.name,clearTimeout(d),o(c)},p.onerror=function(){console.error("Error reading file."),n(c,"error","Could not read the selected file.")},p.readAsText(_)}}),t.setAttribute(e,"true"),document.querySelectorAll(".aipkit_gsheets_section_container").forEach(s=>{let a=s.querySelector(".aipkit_gsheets_credentials_hidden_input");a&&a.value.trim()!==""&&(a.dataset.filename="credentials.json",o(s))}))}window.aipkit_initGsheetsVerification=r,window.aipkit_verifyGSheetsCredentials=o,window.aipkit_setGsheetsIndicator=n})();(function(){"use strict";function d(){let i=document.getElementById("aipkit_cw_test_scrape_btn"),n=document.getElementById("aipkit_cw_url_list"),o=document.getElementById("aipkit_cw_scrape_results_wrapper"),r=document.getElementById("aipkit_cw_scrape_results");!i||!n||!o||!r||i.addEventListener("click",async()=>{let t=n.value.trim().split(`
`),e=t[0]?t[0].trim():"";if(!e){o.style.display="block",r.textContent="Please enter at least one URL to test.";return}o.style.display="block",r.textContent="Scraping...",typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!0,"Test Scrape","Scraping...");try{let s=document.getElementById("aipkit_content_writer_nonce"),a=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,c=s?s.value:a;if(!c)throw new Error("Security token could not be found.");let l=await window.aipkit_apiRequest("aipkit_content_writer_scrape_url",{url:e,_ajax_nonce:c});r.textContent=l.scraped_text||"No text could be extracted."}catch(s){r.textContent=`Error: ${s.message||"Failed to scrape URL."}`,console.error("URL Scrape Error:",s)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!1,"Test First URL")}})}window.aipkit_initUrlScrapeHandler=d})();(function(){"use strict";function d(){let n=document.getElementById("aipkit_settings_container"),o=document.getElementById("aipkit_whatsapp_connectors_container"),r=document.getElementById("aipkit_whatsapp_connector_tpl"),t=document.getElementById("aipkit_whatsapp_add_btn"),e=document.getElementById("aipkit_whatsapp_load_btn"),s=document.getElementById("aipkit_whatsapp_spinner"),a=document.getElementById("aipkit_whatsapp_status"),c=document.getElementById("aipkit_whatsapp_nonce");if(!n||!o||!r||!t||!e||!s||!a||!c)return!1;if(o.getAttribute("data-wa-init")==="1")return!0;let l=c.value||"";function _(b){[t,e].forEach(T=>T&&(T.disabled=b)),s.style.display=b?"inline-block":"none"}function p(b){let T=r.content.cloneNode(!0),u=T.querySelector("[data-connector]"),m={label:b&&b.label||"",id:b&&b.id||"",phone_number_id:b&&b.phone_number_id||"",access_token:b&&b.access_token||"",app_secret:b&&b.app_secret||"",verify_token:b&&b.verify_token||"",api_version:b&&b.api_version||"v20.0"};u.querySelectorAll("[data-field]").forEach(k=>{let h=k.getAttribute("data-field");Object.prototype.hasOwnProperty.call(m,h)&&(k.value=m[h])}),o.appendChild(T)}function f(){let b=[];return o.querySelectorAll("[data-connector]").forEach(T=>{let u={};T.querySelectorAll("[data-field]").forEach(m=>{u[m.getAttribute("data-field")]=(m.value||"").trim()}),b.push(u)}),b}function g(b){for(let T=0;T<b.length;T++){let u=b[T],m=["label","phone_number_id","access_token","app_secret","verify_token"];for(let k of m)if(!u[k])return`Connector ${T+1}: missing ${k}`}return""}let E=null;function v(){E&&clearTimeout(E),E=setTimeout(I,600)}function I(){_(!0),a.textContent="";let b=f(),T=g(b);if(T){a.textContent=T,_(!1);return}let u=new FormData;u.append("action","aipkit_whatsapp_save_connectors"),u.append("_ajax_nonce",l),u.append("connectors",JSON.stringify(b)),fetch(window.ajaxurl,{method:"POST",credentials:"same-origin",body:u}).then(m=>m.json()).then(m=>{a.textContent=m&&m.success?"Saved.":m&&m.data&&m.data.message||"Error"}).catch(()=>{a.textContent="Error"}).finally(()=>_(!1))}return n.addEventListener("click",function(b){let T=b.target;if(T===t){p({});return}if(T===e){_(!0),a.textContent="";let k=new FormData;k.append("action","aipkit_whatsapp_get_connectors"),fetch(window.ajaxurl,{method:"POST",credentials:"same-origin",body:k}).then(h=>h.json()).then(h=>{o.innerHTML="";let S=h&&h.success?h.data.connectors||[]:[];S.length?S.forEach(p):p({})}).finally(()=>_(!1));return}let u=T.closest("[data-remove]");if(u){let k=u.closest("[data-connector]");if(k){let h=k.nextElementSibling;h&&h.tagName==="HR"&&h.remove(),k.remove(),v()}return}let m=T.closest("[data-connector] [data-test-send]");if(m){let k=m.closest("[data-connector]"),h={};k.querySelectorAll("[data-field]").forEach(C=>{h[C.getAttribute("data-field")]=(C.value||"").trim()});let S=h.test_to||"",w=h.test_message||"";if(!S||!w){a.textContent="Enter test recipient and message.";return}_(!0),a.textContent="";let y=new FormData;y.append("action","aipkit_whatsapp_test_send"),y.append("_ajax_nonce",l);let x={id:h.id,label:h.label,phone_number_id:h.phone_number_id,access_token:h.access_token,app_secret:h.app_secret,verify_token:h.verify_token,api_version:h.api_version};y.append("connector",JSON.stringify(x)),y.append("to",S),y.append("message",w),fetch(window.ajaxurl,{method:"POST",credentials:"same-origin",body:y}).then(C=>C.json()).then(C=>{a.textContent=C&&C.success?"Test message sent.":C&&C.data&&C.data.message||C.message||"Error"}).catch(()=>{a.textContent="Error"}).finally(()=>_(!1));return}}),n.addEventListener("change",function(b){let T=b.target;if(T.closest("[data-connector]")&&T.hasAttribute("data-field")){let u=T.getAttribute("data-field");u!=="test_to"&&u!=="test_message"&&v()}}),n.addEventListener("blur",function(b){let T=b.target;if(T.closest("[data-connector]")&&T.hasAttribute("data-field")){let u=T.getAttribute("data-field");u!=="test_to"&&u!=="test_message"&&v()}},!0),e.click(),o.setAttribute("data-wa-init","1"),!0}function i(){d()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i(),document.addEventListener("click",function(n){n.target.closest(".aipkit_tabs .aipkit_tab")&&setTimeout(i,0)})})();(function(){"use strict";let d=window.aipkit_escapeHtml||(r=>r);function i(r,t){let e=window.aipkit_automated_tasks_config||{},s,a,c,l,_;r==="openai"?(s=t.querySelector("#aipkit_task_ce_openai_vector_store_ids"),a=e.openai_vector_stores||[],c="id",l="name",_="No OpenAI stores found."):r==="pinecone"?(s=t.querySelector("#aipkit_task_ce_pinecone_index_name"),a=e.pinecone_indexes||[],c="name",l="name",_="No Pinecone indexes found."):r==="qdrant"&&(s=t.querySelector("#aipkit_task_ce_qdrant_collection_name"),a=e.qdrant_collections||[],c="name",l="name",_="No Qdrant collections found."),s&&(s.innerHTML="",a.length>0?(s.multiple?a.forEach(p=>{s.add(new Option(d(p[l]),p[c]))}):(s.add(new Option("-- Select --","")),a.forEach(p=>{s.add(new Option(d(p[l]),p[c]))})),s.disabled=!1):(s.add(new Option(_,"")),s.disabled=!0))}function n(r,t){let e=t.querySelector("#aipkit_task_ce_vector_embedding_model");if(!e)return;let s=window.aipkit_automated_tasks_config||{},a=r==="google"?s.google_embedding_models||[]:r==="azure"?s.azure_embedding_models||[]:s.openai_embedding_models||[];e.innerHTML="",a.length>0?(e.add(new Option("-- Select Model --","")),a.forEach(c=>{e.add(new Option(d(c.name||c.id),c.id))}),e.disabled=!1):(e.add(new Option("No models found","")),e.disabled=!0)}function o(r){let t=document.getElementById("aipkit_automated_task_form");if(!t)return;let e=document.getElementById("aipkit_task_ce_post_types");e&&(Array.from(e.options).forEach(w=>w.selected=!1),(r.post_types||[]).forEach(w=>{let y=e.querySelector(`option[value="${w}"]`);y&&(y.selected=!0)}));let s=document.getElementById("aipkit_task_ce_post_categories");s&&(Array.from(s.options).forEach(w=>w.selected=!1),(r.post_categories||[]).forEach(w=>{let y=s.querySelector(`option[value="${w}"]`);y&&(y.selected=!0)}));let a=document.getElementById("aipkit_task_ce_post_authors");a&&(Array.from(a.options).forEach(w=>w.selected=!1),(r.post_authors||[]).forEach(w=>{let y=a.querySelector(`option[value="${w}"]`);y&&(y.selected=!0)}));let c=document.getElementById("aipkit_task_ce_post_status");c&&(Array.from(c.options).forEach(w=>w.selected=!1),(r.post_statuses||["publish"]).forEach(w=>{let y=c.querySelector(`option[value="${w}"]`);y&&(y.selected=!0)}));let l=document.getElementById("aipkit_task_ce_update_title");l&&(l.checked=r.update_title==="1");let _=document.getElementById("aipkit_task_ce_update_excerpt");_&&(_.checked=r.update_excerpt==="1");let p=document.getElementById("aipkit_task_ce_update_content");p&&(p.checked=r.update_content==="1");let f=document.getElementById("aipkit_task_ce_update_meta");f&&(f.checked=r.update_meta==="1");let g=document.getElementById("aipkit_task_ce_enhance_existing_now_flag");g&&(g.checked=r.enhance_existing_now_flag==="1"),typeof window.aipkit_initContentEnhancementTaskFormUI=="function"&&setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0);let E=document.getElementById("aipkit_task_ce_title_prompt");E&&(E.value=r.title_prompt||"");let v=document.getElementById("aipkit_task_ce_excerpt_prompt");v&&(v.value=r.excerpt_prompt||"");let I=document.getElementById("aipkit_task_ce_content_prompt");I&&(I.value=r.content_prompt||"");let b=document.getElementById("aipkit_task_ce_meta_prompt");b&&(b.value=r.meta_prompt||"");let T=document.getElementById("aipkit_task_ce_ai_provider"),u=document.getElementById("aipkit_task_ce_ai_model");T&&u&&(T.value=r.ai_provider?r.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&r.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=r.ai_model),typeof window.aipkit_task_ce_populateModels=="function"&&window.aipkit_task_ce_populateModels(T,u));let m=document.getElementById("aipkit_task_ce_ai_temperature");if(m){m.value=r.ai_temperature||1;let w=document.getElementById(m.id+"_value");w&&(w.textContent=m.value)}let k=document.getElementById("aipkit_task_ce_content_max_tokens");if(k){k.value=r.content_max_tokens||4e3;let w=document.getElementById(k.id+"_value");w&&(w.textContent=k.value)}let h=t.elements.ce_reasoning_effort;h&&(h.value=r.reasoning_effort||"low"),u&&typeof window.aipkit_autogpt_ce_toggleReasoningEffort=="function"&&setTimeout(()=>u.dispatchEvent(new Event("change",{bubbles:!0})),100),t.elements.task_frequency&&(t.elements.task_frequency.value=r.task_frequency||"daily");let S=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_knowledge_base"]');if(S){let w=S.querySelector("#aipkit_task_ce_enable_vector_store"),y=S.querySelector(".aipkit_task_ce_vector_store_settings_container");if(w&&y){let x=r.enable_vector_store==="1";w.checked=x,w.dispatchEvent(new Event("change",{bubbles:!0}))}if(r.enable_vector_store==="1"){let x=r.vector_store_provider||"openai",C=S.querySelector("#aipkit_task_ce_vector_store_provider");C&&(C.value=x,C.dispatchEvent(new Event("change",{bubbles:!0})));let $=S.querySelector("#aipkit_task_ce_vector_store_top_k");if($&&($.value=r.vector_store_top_k||"3"),x==="openai"){let q=S.querySelector("#aipkit_task_ce_openai_vector_store_ids");q&&Array.isArray(r.openai_vector_store_ids)&&Array.from(q.options).forEach(F=>{F.selected=r.openai_vector_store_ids.includes(F.value)})}else if(x==="pinecone"){let q=S.querySelector("#aipkit_task_ce_pinecone_index_name");q&&(q.value=r.pinecone_index_name||"")}else if(x==="qdrant"){let q=S.querySelector("#aipkit_task_ce_qdrant_collection_name");q&&(q.value=r.qdrant_collection_name||"")}if(x==="pinecone"||x==="qdrant"){let q=r.vector_embedding_provider||"openai",F=S.querySelector("#aipkit_task_ce_vector_embedding_provider"),A=S.querySelector("#aipkit_task_ce_vector_embedding_model");F&&(F.value=q,F.dispatchEvent(new Event("change",{bubbles:!0}))),A&&r.vector_embedding_model&&setTimeout(()=>{A.value=r.vector_embedding_model},50)}}}}window.aipkit_form_populateContentEnhancementFields=o})();(function(){"use strict";function d(){let i=document.getElementById("aipkit_automated_task_form"),n=window.aipkit_dashboard||{};if(!i)return;let o=document.getElementById("aipkit_task_ce_ai_provider"),r=document.getElementById("aipkit_task_ce_ai_model"),t=i.elements.ce_reasoning_effort;if(o&&r){let a=(n.main_provider||"openai").toLowerCase();if(o.value=a,typeof window.aipkit_task_ce_populateModels=="function"){window.aipkit_task_ce_populateModels(o,r);let c="",l=n?.models?.[a];switch(a){case"openai":c="gpt-4o-mini";break;case"google":c="gemini-1.5-flash-latest";break;case"openrouter":c="anthropic/claude-3.5-sonnet";break;case"azure":case"deepseek":case"ollama":Array.isArray(l)&&l.length>0&&(c=l[0].id||"");break}r.querySelector(`option[value="${CSS.escape(c)}"]`)?r.value=c:console.warn(`Default model ${c} not found for provider ${a}.`),r.dispatchEvent(new Event("change",{bubbles:!0}))}}t&&(t.value="low");let e=i.querySelector("#aipkit_task_ce_content_max_tokens"),s=i.querySelector("#aipkit_task_ce_content_max_tokens_value");if(e&&s){let a="4000";e.value=a,s.textContent=a}}window.aipkit_form_setContentEnhancementDefaults=d})();(function(){"use strict";function d(i,n){if(i.task_type==="enhance_existing_content"){let o={ce_ai_provider:"ai_provider",ce_ai_model:"ai_model",ce_ai_temperature:"ai_temperature",ce_content_max_tokens:"content_max_tokens",ce_reasoning_effort:"reasoning_effort",ce_title_prompt:"title_prompt",ce_excerpt_prompt:"excerpt_prompt",ce_content_prompt:"content_prompt",ce_meta_prompt:"meta_prompt",ce_vector_store_provider:"vector_store_provider",ce_vector_store_top_k:"vector_store_top_k",ce_pinecone_index_name:"pinecone_index_name",ce_qdrant_collection_name:"qdrant_collection_name",ce_vector_embedding_provider:"vector_embedding_provider",ce_vector_embedding_model:"vector_embedding_model"};for(let[t,e]of Object.entries(o))i[t]!==void 0&&(i[e]=i[t],delete i[t]);i.post_types=n.getAll("ce_post_types[]"),i.post_categories=n.getAll("ce_post_categories[]"),i.post_authors=n.getAll("ce_post_authors[]"),i.post_statuses=n.getAll("ce_post_statuses[]"),i.openai_vector_store_ids=n.getAll("ce_openai_vector_store_ids[]"),i.update_title=n.has("ce_update_title")?"1":"0",i.update_excerpt=n.has("ce_update_excerpt")?"1":"0",i.update_content=n.has("ce_update_content")?"1":"0",i.update_meta=n.has("ce_update_meta")?"1":"0",i.enhance_existing_now_flag=n.has("ce_enhance_existing_now_flag")?"1":"0",i.enable_vector_store=n.has("ce_enable_vector_store")?"1":"0",delete i["ce_post_types[]"],delete i["ce_post_categories[]"],delete i["ce_post_authors[]"],delete i["ce_post_statuses[]"],delete i["ce_openai_vector_store_ids[]"],delete i.ce_update_title,delete i.ce_update_excerpt,delete i.ce_update_content,delete i.ce_update_meta,delete i.ce_enhance_existing_now_flag,delete i.ce_enable_vector_store,["post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","content_title_bulk","content_keywords","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","openai_vector_store_ids[]","csv_file_input"].forEach(t=>delete i[t])}return i}window.aipkit_save_task_handleContentEnhancement=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||(t=>t);function i(t,e){let s=window.aipkit_automated_tasks_config||{},a,c,l,_,p;t==="openai"?(a=e.querySelector("#aipkit_task_ce_openai_vector_store_ids"),c=s.openai_vector_stores||[],l="id",_="name",p="No OpenAI stores found."):t==="pinecone"?(a=e.querySelector("#aipkit_task_ce_pinecone_index_name"),c=s.pinecone_indexes||[],l="name",_="name",p="No Pinecone indexes found."):t==="qdrant"&&(a=e.querySelector("#aipkit_task_ce_qdrant_collection_name"),c=s.qdrant_collections||[],l="name",_="name",p="No Qdrant collections found."),a&&(a.innerHTML="",c.length>0?(a.multiple?c.forEach(f=>{a.add(new Option(d(f[_]),f[l]))}):(a.add(new Option("-- Select --","")),c.forEach(f=>{a.add(new Option(d(f[_]),f[l]))})),a.disabled=!1):(a.add(new Option(p,"")),a.disabled=!0))}function n(t,e){let s=e.querySelector("#aipkit_task_ce_vector_embedding_model");if(!s)return;let a=window.aipkit_automated_tasks_config||{},c=[];t==="google"?c=a.google_embedding_models||[]:t==="azure"?c=a.azure_embedding_models||[]:c=a.openai_embedding_models||[],s.innerHTML="",c.length>0?(s.add(new Option("-- Select Model --","")),c.forEach(l=>{s.add(new Option(d(l.name||l.id),l.id))}),s.disabled=!1):(s.add(new Option("No models found","")),s.disabled=!0)}function o(t,e){let s=e.querySelector(".aipkit_task_ce_vector_openai_field"),a=e.querySelector(".aipkit_task_ce_vector_pinecone_field"),c=e.querySelector(".aipkit_task_ce_vector_qdrant_field"),l=e.querySelector(".aipkit_task_ce_vector_embedding_config_row");s&&(s.style.display="none"),a&&(a.style.display="none"),c&&(c.style.display="none"),l&&(l.style.display="none"),t==="openai"&&s?(s.style.display="block",i("openai",e)):t==="pinecone"&&a&&l?(a.style.display="block",l.style.display="block",i("pinecone",e),n(e.querySelector("#aipkit_task_ce_vector_embedding_provider").value,e)):t==="qdrant"&&c&&l&&(c.style.display="block",l.style.display="block",i("qdrant",e),n(e.querySelector("#aipkit_task_ce_vector_embedding_provider").value,e))}function r(){let t=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_knowledge_base"]');if(!t||t.dataset.kbListenerAttached)return;let e=t.querySelector(".aipkit_task_ce_vector_store_toggle"),s=t.querySelector(".aipkit_task_ce_vector_store_settings_container"),a=t.querySelector(".aipkit_task_ce_vector_store_provider_select"),c=t.querySelector(".aipkit_task_ce_vector_embedding_provider_select");e&&s&&e.addEventListener("change",()=>{s.style.display=e.checked?"block":"none"}),a&&s&&a.addEventListener("change",()=>o(a.value,s)),c&&s&&c.addEventListener("change",()=>{n(c.value,s)}),s&&a&&o(a.value,s),t.dataset.kbListenerAttached="true"}window.aipkit_initCeKnowledgeBaseUI=r})();(function(){"use strict";function d(){let i=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),n=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(!i||!n)return;["title","excerpt","content","meta"].forEach(_=>{let p=i.querySelector(`#aipkit_task_ce_update_${_}`),f=n.querySelector(`#aipkit_task_ce_${_}_prompt_section`);if(p&&f){let g=()=>{f.style.display=p.checked?"block":"none"};p.dataset.enhancerListenerAttached||(p.addEventListener("change",g),p.dataset.enhancerListenerAttached="true"),g()}});let r=n.querySelector("#aipkit_task_ce_ai_provider"),t=n.querySelector("#aipkit_task_ce_ai_model");r&&t&&typeof window.aipkit_task_ce_populateModels=="function"&&(r.dataset.ceProviderListenerAttached||(r.addEventListener("change",()=>window.aipkit_task_ce_populateModels(r,t)),r.dataset.ceProviderListenerAttached="true"),t.dataset.ceModelListenerAttached||(t.addEventListener("change",()=>{typeof window.aipkit_autogpt_ce_toggleReasoningEffort=="function"&&window.aipkit_autogpt_ce_toggleReasoningEffort()}),t.dataset.ceModelListenerAttached="true"),window.aipkit_task_ce_populateModels(r,t));let e=n.querySelector("#aipkit_task_ce_ai_temperature");e&&typeof window.aipkit_task_ce_handleTemperatureSlider=="function"&&window.aipkit_task_ce_handleTemperatureSlider(e);let s=n.querySelector("#aipkit_task_ce_content_max_tokens");s&&typeof window.aipkit_task_ce_handleMaxTokensSlider=="function"&&window.aipkit_task_ce_handleMaxTokensSlider(s);let a=n.querySelector("#aipkit_task_ce_ai_settings_toggle"),c=n.querySelector("#aipkit_task_ce_ai_parameters_row");a&&c&&(a.dataset.ceAiSettingsListenerAttached||(a.addEventListener("click",()=>{let _=c.style.display==="none"||c.style.display==="";c.style.display=_?"block":"none",a.classList.toggle("aipkit_active",_),a.setAttribute("aria-expanded",_)}),a.dataset.ceAiSettingsListenerAttached="true"));let l=n.querySelector("#aipkit_task_config_enhancement_ai_and_prompts_main");l&&(l.dataset.cePromptListenerAttached||(l.addEventListener("click",_=>{let p=_.target.closest(".aipkit_textarea_toggle");if(!p)return;let f=p.dataset.target,g=document.getElementById(f),E=p.querySelector(".dashicons");if(!g||!E)return;g.classList.toggle("aipkit_collapsed")?(E.classList.remove("dashicons-minus"),E.classList.add("dashicons-plus-alt2"),p.title="Expand"):(E.classList.remove("dashicons-plus-alt2"),E.classList.add("dashicons-minus"),p.title="Collapse")}),l.dataset.cePromptListenerAttached="true")),typeof window.aipkit_initCeKnowledgeBaseUI=="function"?window.aipkit_initCeKnowledgeBaseUI():console.error("AIPKit CE UI: Knowledge base UI initializer not found.")}window.aipkit_initContentEnhancementTaskFormUI=d})();(function(){"use strict";function d(i){if(!i)return;let n=i.closest(".aipkit_slider_wrapper").querySelector(".aipkit_slider_value");n&&(n.textContent=i.value,i.dataset.listenerAttached||(i.addEventListener("input",()=>n.textContent=i.value),i.dataset.listenerAttached="true"))}window.aipkit_task_ce_handleMaxTokensSlider=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(n){return n};function i(n,o){let r=n.value,t=r?r.toLowerCase():"",e=window.aipkit_dashboard?.models,s=window.aipkit_automated_tasks_form_state||{};if(!o)return;if(!e){o.innerHTML=`<option value="">${d("Error: Model data object not found")}</option>`,o.disabled=!0;return}let a=e[t],c=s.pendingModelSelection||o.value;if(o.innerHTML="",t==="openai"&&typeof a=="object"&&!Array.isArray(a)?Object.keys(a).forEach(l=>{let _=document.createElement("optgroup");_.label=d(l),Array.isArray(a[l])&&a[l].forEach(p=>{p&&p.id&&_.appendChild(new Option(d(p.name||p.id),p.id))}),o.appendChild(_)}):Array.isArray(a)&&a.forEach(l=>{l&&l.id&&o.appendChild(new Option(d(l.name||l.id),l.id))}),o.options.length===0)o.appendChild(new Option(d(`No models for ${r}`),"")),o.disabled=!0;else{o.disabled=!1;let l=!1;if(c&&o.querySelector(`option[value="${CSS.escape(c)}"]`)&&(o.value=c,l=!0),!l&&o.options.length>0){let _=o.querySelector('option:not([value=""])');_&&(o.value=_.value)}}s&&(s.pendingModelSelection=null),typeof window.aipkit_autogpt_ce_toggleReasoningEffort=="function"&&window.aipkit_autogpt_ce_toggleReasoningEffort()}window.aipkit_task_ce_populateModels=i})();(function(){"use strict";function d(i){if(!i)return;let n=i.closest(".aipkit_slider_wrapper").querySelector(".aipkit_slider_value");n&&(n.textContent=i.value,i.dataset.listenerAttached||(i.addEventListener("input",()=>n.textContent=i.value),i.dataset.listenerAttached="true"))}window.aipkit_task_ce_handleTemperatureSlider=d})();(function(){"use strict";function d(){let i=document.querySelector("#aipkit_task_ce_ai_provider"),n=document.querySelector("#aipkit_task_ce_ai_model"),o=document.querySelector(".aipkit_task_ce_reasoning_effort_field");if(!i||!n||!o){o&&(o.style.display="none");return}let r=i.value,e=(n.value||"").toLowerCase(),s=e.startsWith("o1")||e.startsWith("o3")||e.startsWith("o4"),a=e.includes("gpt-5");r.toLowerCase()==="openai"&&(s||a)?o.style.display="block":o.style.display="none"}window.aipkit_autogpt_ce_toggleReasoningEffort=d})();(function(){"use strict";let d={files:[],uploading:!1,currentXhr:null,cancelled:!1,totals:{loaded:0,size:0}};function i(){let u=window.aipkit_dashboard?.isProPlan;return u===!0||u===1||u==="1"}function n(u){return document.getElementById(u)}function o(){let u=n("aipkit_vs_global_file_queue");if(!u)return;if(!d.files.length){u.innerHTML="";return}let m=d.files.map((k,h)=>{let S=Math.round(k.size/1048576*10)/10,w=(typeof Intl<"u"?new Intl.NumberFormat(void 0,{minimumFractionDigits:1,maximumFractionDigits:1}):{format:y=>y.toFixed(1)}).format(S);return`<div class="aipkit_queue_item" data-idx="${h}" data-status="pending" style="display:flex;align-items:center;gap:8px;margin:4px 0;">
        <span class="aipkit_queue_item_icon" title="Pending" aria-label="Pending" style="font-size:14px;line-height:1;width:18px;text-align:center;">\u23F3</span>
        <div class="aipkit_queue_item_meta" style="flex:1 1 auto;min-width:0;">
          <div style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="${r(k.name)}">${r(k.name)}</div>
          <div class="aipkit_queue_item_progress" style="height:4px;background:#eee;border-radius:2px;overflow:hidden;margin-top:4px;">
            <div class="aipkit_queue_item_bar" style="width:0%;height:100%;background:#007cba;transition:width .2s;"></div>
          </div>
        </div>
  <div class="aipkit_queue_item_size" style="font-size:11px;color:#666;min-width:64px;text-align:right;">${w} MB</div>
        <button type="button" class="aipkit_queue_remove_btn aipkit_btn_icon" aria-label="Remove file" title="Remove" style="border:none;background:transparent;cursor:pointer;">
          <span class="dashicons dashicons-no"></span>
        </button>
      </div>`}).join("");u.innerHTML=m,u.querySelectorAll(".aipkit_queue_remove_btn").forEach(k=>{k.addEventListener("click",h=>{let S=h.currentTarget.closest(".aipkit_queue_item");if(!S)return;let w=parseInt(S.dataset.idx,10);isNaN(w)||(d.files.splice(w,1),o())})})}function r(u){let m=document.createElement("div");return m.textContent=String(u??""),m.innerHTML}function t(u,m){typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(u,m||"info","aipkit_knowledge_base_global_status")}let e=["text/plain","application/pdf","application/x-pdf","text/html","application/xhtml+xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];function s(){let u=window.aipkit_uploadLimits?.allowed_mime_types;return Array.isArray(u)&&u.length?u:e}function a(u){let m=Number(window.aipkit_effectiveUploadLimitBytes||0);if(!Number.isFinite(m)||m<=0)if(u==="openai")m=10*1024*1024;else return Number.POSITIVE_INFINITY;return u==="openai"&&(m=Math.min(m,10*1024*1024)),m}function c(u,m){let k=s(),h=a(m),S=[];u.size>h&&S.push(`Too large: ${u.name} (${l(u.size)}). Max ${l(h)}.`);let w=k.map(x=>x.toLowerCase()),y=String(u.type||"").toLowerCase();if(y&&!w.includes(y)){let x=(u.name.split(".").pop()||"").toLowerCase(),$={txt:"text/plain",text:"text/plain",log:"text/plain",md:"text/plain",pdf:"application/pdf",htm:"text/html",html:"text/html",xhtml:"application/xhtml+xml",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}[x];(!$||!w.includes($.toLowerCase()))&&S.push(`Unsupported type: ${u.name} (${u.type}).`)}return S}function l(u){if(!Number.isFinite(u))return`${u}`;let m=["B","KB","MB","GB"],k=0,h=u;for(;h>=1024&&k<m.length-1;)h/=1024,k++;return`${(typeof Intl<"u"?new Intl.NumberFormat(void 0,{maximumFractionDigits:1}):{format:w=>w.toFixed(1)}).format(h)} ${m[k]}`}function _(u,m){let k=n("aipkit_vs_global_file_queue");if(!k)return;let h=k.querySelector(`.aipkit_queue_item[data-idx="${u}"]`);if(!h)return;let S=h.querySelector(".aipkit_queue_item_bar");S&&(S.style.width=Math.max(0,Math.min(100,m))+"%")}function p(u,m){let k=n("aipkit_vs_global_file_queue");if(!k)return;let h=k.querySelector(`.aipkit_queue_item[data-idx="${u}"]`);if(!h)return;let S=h.querySelector(".aipkit_queue_item_icon"),{icon:w,label:y}=f(m);S&&(S.textContent=w,S.title=y,S.setAttribute("aria-label",y)),h.dataset.status=m}function f(u){switch(u){case"completed":return{icon:"\u2705",label:"Completed"};case"error":return{icon:"\u274C",label:"Error"};case"processing":return{icon:"\u{1F504}",label:"Processing"};case"pending":default:return{icon:"\u23F3",label:"Pending"}}}function g(u){}function E(u,m){let k=new FormData,h=u.vectorStoreProvider;if(k.append("provider",h),k.append("source_type","file_upload"),u.embeddingProvider&&k.append("embedding_provider",u.embeddingProvider),u.embeddingModel&&k.append("embedding_model",u.embeddingModel),h==="openai"){let S=u.targetStoreId.startsWith("_create_new_")?"":u.targetStoreId;k.append("target_store_id",S),k.append("new_store_name_openai",u.newStoreNameOpenAI||"")}else if(h==="pinecone"){let S=u.targetStoreId.startsWith("_create_new_")?"":u.targetStoreId;k.append("index_name",S),k.append("target_store_id",u.targetStoreId)}else h==="qdrant"&&k.append("target_store_id",u.targetStoreId);return m&&k.append("_ajax_nonce",m),k}function v(u,m,k){return new Promise((h,S)=>{let w=new XMLHttpRequest;d.currentXhr=w,w.open("POST",u,!0),w.withCredentials=!0,w.upload.onprogress=y=>{if(y.lengthComputable&&typeof k=="function"){let x=y.loaded/y.total*100;k(x)}},w.onreadystatechange=function(){if(w.readyState===4){d.currentXhr=null;try{let y=JSON.parse(w.responseText||"{}");if(w.status>=200&&w.status<300&&y.success)h(y.data);else{let x=new Error(y?.data?.message||`Upload failed (${w.status})`);x.server=y,S(x)}}catch{S(new Error(`Upload error: invalid JSON (${w.status})`))}}},w.onerror=()=>{d.currentXhr=null,S(new Error("Network error"))},w.send(m)})}async function I(u){if(!i()||!d.files.length||!window.aipkit_dashboard?.ajaxurl)return!1;let m=u.vectorStoreProvider,k="";if(m==="openai"?k="aipkit_upload_and_add_file_to_store_direct_openai":m==="pinecone"?k="aipkit_upload_file_and_upsert_to_pinecone":m==="qdrant"&&(k="aipkit_upload_file_and_upsert_to_qdrant"),!k)return!1;let w=n(m==="openai"?"aipkit_vector_store_nonce_openai":m==="pinecone"?"aipkit_vector_store_pinecone_nonce_management":"aipkit_vector_store_qdrant_nonce_management")?.value||"";t("Uploading files...","info"),d.uploading=!0,d.cancelled=!1,d.totals.size=d.files.reduce((y,x)=>y+(x?.size||0),0),d.totals.loaded=0;for(let y=0;y<d.files.length;y++){let x=d.files[y];if(d.cancelled)break;let C=c(x,m);if(C.length){p(y,"error"),C.forEach(F=>t(F,"warning")),_(y,100),d.totals.loaded+=x.size,d.totals.loaded/Math.max(1,d.totals.size)*100;continue}p(y,"processing");let $=E(u,w),q=m==="openai"?"aipkit_vs_global_file_to_submit":"file_to_upload";$.append("action",k),$.append(q,x);try{let F=await v(window.aipkit_dashboard.ajaxurl,$,A=>{_(y,A)});_(y,100),p(y,"completed"),t(F?.message||`${x.name} uploaded`,"success"),d.totals.loaded+=x.size,d.totals.loaded/Math.max(1,d.totals.size)*100}catch(F){if(d.cancelled){t("Upload cancelled.","warning"),p(y,"error");break}p(y,"error"),t(F.message||`Failed to upload ${x.name}`,"error"),d.totals.loaded+=x.size,d.totals.loaded/Math.max(1,d.totals.size)*100}}return d.uploading=!1,d.files=[],o(),!0}function b(){let u=n("aipkit_vs_global_file_to_submit");u&&(u.dataset.queueBound||(u.addEventListener("change",()=>{if(!u.files||!u.files.length){d.files=[],o();return}let m=document.getElementById("aipkit_vs_global_provider_select")?.value||"openai",k=Array.from(u.files),h=s(),S=a(m),w=[],y=0;k.forEach(x=>{let C=c(x,m);C.length?(y++,C.forEach($=>t($,"warning"))):w.push(x)}),d.files=w,o(),y>0&&t(`Some files were skipped. Allowed types: ${h.join(", ")}. Max per file: ${l(S)}.`,"info")}),u.dataset.queueBound="1"))}function T(){i()&&(b(),o())}window.aipkit_initUploadQueue=T,window.aipkit_runUploadQueue=I})();(function(){"use strict";function d(n){return document.getElementById(n)}function i(){let n=d("aipkit_vs_global_dropzone"),o=d("aipkit_vs_global_file_to_submit"),r=typeof window.aipkit_initUploadQueue=="function";if(!n||!o||n.dataset.ddBound)return;function t(e){n.style.background=e?"#f6f7f7":"#fff",n.style.borderColor=e?"#2271b1":"#c3c4c7"}n.addEventListener("click",()=>o.click()),n.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),o.click())}),n.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),t(!0)}),n.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),t(!1)}),n.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),t(!1);let s=e.dataTransfer?.files;if(!s||!s.length)return;try{let c=new DataTransfer;Array.from(s).forEach(l=>c.items.add(l)),o.files=c.files}catch{}let a=new Event("change",{bubbles:!0});o.dispatchEvent(a),r&&window.aipkit_initUploadQueue()}),n.dataset.ddBound="1"}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i(),window.aipkit_initUploadDragDrop=i})();})();
