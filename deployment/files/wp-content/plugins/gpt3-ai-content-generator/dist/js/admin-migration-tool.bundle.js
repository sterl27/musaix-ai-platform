(()=>{(function(){"use strict";function p(n,o,s="Processing..."){let r=document.querySelector(`#aipkit_migration_row_${n}`);if(!r)return;let l=r.querySelector(".aipkit_spinner"),e=r.querySelector(".aipkit_status-tag"),a=r.querySelectorAll("button");o?(e&&(e.textContent=s,e.className="aipkit_status-tag"),l&&(l.style.display="inline-block"),a.forEach(c=>c.disabled=!0)):l&&(l.style.display="none")}function t(n,o,s){let r=document.querySelector(`#aipkit_migration_row_${n}`);if(!r)return;let l=r.querySelector(".aipkit_spinner"),e=r.querySelector(".aipkit_status-tag"),a=r.querySelectorAll("button");l&&(l.style.display="none"),e&&(e.textContent=o,e.className=`aipkit_status-tag ${s}`),a.forEach(c=>c.disabled=!0)}function i(n,o="info"){let s=document.getElementById("aipkit_migration_messages_area");if(!s)return;let r=o==="success"?"notice-success":o==="error"?"notice-error":"notice-info";s.innerHTML=`<div class="notice ${r} is-dismissible" style="margin: 0 0 15px 0;"><p>${n}</p></div>`}window.aipkitMigrationUI={setCategoryLoadingState:p,updateCategoryStatus:t,showGlobalMessage:i}})();(function(){"use strict";async function p(n){if(typeof window.aipkit_apiRequest!="function")throw new Error("AIPKit API request function is not available.");return window.aipkit_apiRequest("aipkit_analyze_old_data",{_ajax_nonce:n})}async function t(n,o,s){if(typeof window.aipkit_apiRequest!="function")throw new Error("AIPKit API request function is not available.");return window.aipkit_apiRequest(o,{_ajax_nonce:s,category:n})}async function i(n,o,s){if(typeof window.aipkit_apiRequest!="function")throw new Error("AIPKit API request function is not available.");return window.aipkit_apiRequest(o,{_ajax_nonce:s,category:n})}window.aipkitMigrationAjax={executeAnalysisStep:p,executeMigrationStep:t,executeDeleteStep:i}})();(function(){"use strict";function p(){let t=window.aipkitMigrationToolData;if(!t||!t.steps){console.error("AIPKit Migration Tool: Localized data or steps not found.");return}let i=window.aipkitMigrationUI,n=window.aipkitMigrationAjax;if(!i||!n){console.error("AIPKit Migration Tool: UI or AJAX helper modules not found.");return}let o=document.getElementById("aipkit_analyze_data_btn");o&&o.addEventListener("click",async()=>{let e=o.querySelector(".aipkit_btn-text"),a=o.querySelector(".aipkit_spinner");o.disabled=!0,e&&(e.textContent=t.text.analyzing),a&&(a.style.display="inline-block");try{await n.executeAnalysisStep(t.nonce),i.showGlobalMessage("Analysis complete. Reloading page...","success"),setTimeout(()=>window.location.reload(),1500)}catch(c){i.showGlobalMessage(`Analysis failed: ${c.message}`,"error"),o.disabled=!1,e&&(e.textContent="Analyze Legacy Data"),a&&(a.style.display="none")}});let s=document.getElementById("aipkit_analyze_again_btn");s&&s.addEventListener("click",async()=>{let e=s.querySelector(".aipkit_btn-text"),a=s.querySelector(".aipkit_spinner");s.disabled=!0,e&&(e.textContent=t.text.analyzing),a&&(a.style.display="inline-block");try{await n.executeAnalysisStep(t.nonce),i.showGlobalMessage("Re-analysis complete. Reloading page...","success"),setTimeout(()=>window.location.reload(),1500)}catch(c){i.showGlobalMessage(`Analysis failed: ${c.message}`,"error"),s.disabled=!1,e&&(e.textContent=t.text.analyzeAgain||"Analyze Again"),a&&(a.style.display="none")}});let r=document.getElementById("aipkit_migrate_start_fresh_btn");r&&r.addEventListener("click",()=>{if(confirm(t.text.confirmStartFresh)){if(typeof window.aipkit_apiRequest!="function")return;window.aipkit_apiRequest("aipkit_handle_migration_choice",{_ajax_nonce:t.nonce,choice:"start_fresh"}).then(()=>{i.showGlobalMessage("Choice saved. Reloading...","success"),setTimeout(()=>window.location.reload(),1500)}).catch(e=>i.showGlobalMessage(`Error: ${e.message}`,"error"))}});let l=document.getElementById("aipkit_migration_dashboard_tbody");l&&l.addEventListener("click",async e=>{let a=e.target.closest(".aipkit_migrate_category_btn"),c=e.target.closest(".aipkit_delete_category_btn");if(!a&&!c)return;let u=a?a.dataset.category:c.dataset.category,g=t.steps[u];if(!g){console.error("Could not find step info for category:",u);return}if(c){if(!confirm(t.text.confirmDeleteData))return;i.setCategoryLoadingState(u,!0,t.text.deleting);try{let d=await n.executeDeleteStep(u,g.delete_action,t.nonce);i.updateCategoryStatus(u,t.text.statusDeleted,"aipkit_status-success"),i.showGlobalMessage(d.message,"success")}catch(d){i.showGlobalMessage(`Error deleting ${g.label}: ${d.message}`,"error"),i.updateCategoryStatus(u,t.text.statusFailed,"aipkit_status-warning")}}else if(a){i.setCategoryLoadingState(u,!0,t.text.migrating);try{let d=await n.executeMigrationStep(u,g.action,t.nonce);i.updateCategoryStatus(u,t.text.statusMigrated,"aipkit_status-success"),i.showGlobalMessage(d.message,"success")}catch(d){i.showGlobalMessage(`Error migrating ${g.label}: ${d.message}`,"error"),i.updateCategoryStatus(u,t.text.statusFailed,"aipkit_status-warning")}}})}window.aipkit_initMigrationTool=p})();})();
