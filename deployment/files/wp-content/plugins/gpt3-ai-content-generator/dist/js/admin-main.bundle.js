(()=>{(function(){"use strict";function p(o,i){if(!o)return;let e=o.querySelector(".aipkit_btn-text");if(e){e.textContent=i;return}let t=o.querySelector(".aipkit_spinner"),n=Array.from(o.childNodes).find(s=>s.nodeType===Node.TEXT_NODE);n?n.textContent=i+(t?" ":""):o.insertBefore(document.createTextNode(i+(t?" ":"")),o.firstChild),t&&o.appendChild(t)}function r(o,i,e,t=4e3){if(!o)return;let n=o.dataset.baseClass||"aipkit_form-help";o.dataset.baseClass||(o.dataset.baseClass=n),o.messageTimeoutId&&(clearTimeout(o.messageTimeoutId),o.messageTimeoutId=null),o.textContent=e,o.className=n,o.classList.add(`aipkit_form-help-${i}`),o.style.opacity="1",o.style.display="block",o.messageTimeoutId=setTimeout(()=>{o.style.opacity="0",setTimeout(()=>{o.textContent===e&&(o.textContent="",o.className=n,o.style.display="",o.messageTimeoutId=null)},300)},t)}window.aipkit_setButtonText=p,window.aipkit_showTemporaryMessage=r})();(function(){"use strict";function p(o){return o===null||typeof o>"u"?"":String(o).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function r(o){return p(o)}window.aipkit_escapeHtml=p,window.aipkit_escapeAttribute=r})();(function(){"use strict";function p(o){let i=document.createElement("div");if(i.textContent="Copied!",Object.assign(i.style,{position:"absolute",fontSize:"12px",fontWeight:"600",color:"var(--aipkit_status-success, #38A169)",opacity:1,transition:"opacity .4s ease-out, transform .4s ease-out",zIndex:9999,padding:"3px 6px",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"3px",border:"1px solid var(--aipkit_status-success, #38A169)",transform:"translateY(-5px)"}),document.body.appendChild(i),o){let{top:e,left:t,width:n}=o.getBoundingClientRect();i.style.top=`${e+window.scrollY+2}px`,i.style.left=`${t+window.scrollX+n+5}px`}else i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)";requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="translateY(0)"}),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateY(-5px)",i.addEventListener("transitionend",()=>i.remove(),{once:!0}),setTimeout(()=>{i.parentNode&&i.remove()},500)},1e3)}async function r(o,i){if(o)try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(o),p(i);return}throw new Error("Clipboard API not available")}catch(e){console.warn("[AIPKit] Clipboard API failed or unavailable \u2192 falling back to temporary textarea.",e);try{let t=document.createElement("textarea");t.value=o,t.style.position="fixed",t.style.top="-9999px",t.style.left="-9999px",t.style.opacity="0",t.setAttribute("readonly",""),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999);let n=document.execCommand("copy");if(document.body.removeChild(t),n)p(i);else throw new Error('document.execCommand("copy") failed.')}catch(t){console.error("[AIPKit] Fallback copy method also failed. Prompting user.",t),window.prompt("Please copy the shortcode manually:",o)}}}window.aipkit_copyShortcode=r})();(function(){"use strict";function p(i){let e=Number(i);if(!e||isNaN(e))return"";try{let t=new Date(e*1e3);if(isNaN(t.getTime()))return"";let n=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0"),a=String(t.getSeconds()).padStart(2,"0");return`${n}:${s}:${a}`}catch(t){return console.error("Error formatting timestamp:",i,t),""}}function r(i){if(!i)return"";try{let e=new Date(i.replace(" ","T")+"Z");if(isNaN(e.getTime()))return"";let t=new Date,n=(e.getTime()-t.getTime())/1e3;if(n<0)return"In the past";if(n<60)return"in less than a minute";if(n<3600){let l=Math.round(n/60);return`in ${l} minute${l!==1?"s":""}`}let s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1),c=new Date(e.getFullYear(),e.getMonth(),e.getDate());return c.getTime()===s.getTime()?`Today at ${e.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:c.getTime()===a.getTime()?`Tomorrow at ${e.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:`on ${e.toLocaleDateString([],{month:"short",day:"numeric"})}`}catch(e){return console.error("Error formatting relative time:",i,e),i}}function o(i){if(!i)return"N/A";try{let e=new Date(i.replace(" ","T")+"Z");return isNaN(e.getTime())?"Invalid Date":e.toLocaleString()}catch(e){return console.error("Error formatting UTC date string:",i,e),i}}window.aipkit_formatTimestamp=p,window.aipkit_formatFriendlyFutureDate=r,window.aipkit_formatUtcDateTime=o})();(function(){"use strict";function p(r){return!r||typeof r!="string"?"":r.charAt(0).toUpperCase()+r.slice(1)}window.aipkit_ucfirst=p,window.ucfirst=p})();(function(){"use strict";function p(){if(window.aipkit_markdownitInstance)return window.aipkit_markdownitInstance;if(typeof window.markdownit=="function"){let r=window.markdownit({html:!0,xhtmlOut:!1,breaks:!0,linkify:!0,typographer:!0});return typeof window.hljs<"u"&&typeof window.markdownitHighlight=="function"&&r.use(window.markdownitHighlight,{hljs:window.hljs}),window.aipkit_markdownitInstance=r,r}else return console.warn("Markdown Renderer Utility: markdown-it library not found. Markdown rendering will be basic."),null}window.aipkit_getMarkdownRenderer=p})();(function(){"use strict";function p(r){let o=document.querySelector(r);if(!o)return;o.querySelectorAll(".aipkit_form-input.aipkit_range_slider").forEach(e=>{let t=e.id+"_value",n=null,s=e.closest(".aipkit_slider_wrapper");if(s&&(n=s.querySelector(".aipkit_slider_value")),!n)try{n=o.querySelector(`#${CSS.escape(t)}`)}catch{n=o.querySelector("#"+t)}if(n){let a=e.getAttribute("data-suffix")||(e.id.includes("confidence_threshold")?"%":"");n.textContent=e.value+a,e.hasAttribute("data-range-listener-attached")||(e.addEventListener("input",function(){n.textContent=this.value+a}),e.setAttribute("data-range-listener-attached","true"))}})}window.aipkit_attachRangeValueHandlers=p})();(function(){"use strict";function p(r){let o=document.querySelector(r);if(!o)return;let i="data-apikey-toggle-listener-attached";o.getAttribute(i)||(o.addEventListener("click",function(e){let t=e.target.closest(".aipkit_api-key-toggle");if(!t)return;let n=t.closest(".aipkit_api-key-wrapper");if(!n)return;let s=n.querySelector(".aipkit_form-input"),a=t.querySelector(".dashicons");!s||!a||(s.type==="password"?(s.type="text",a.classList.remove("dashicons-visibility"),a.classList.add("dashicons-hidden")):(s.type="password",a.classList.remove("dashicons-hidden"),a.classList.add("dashicons-visibility")))}),o.setAttribute(i,"true"))}window.aipkit_initApiKeyToggles=p})();(function(){"use strict";function p(r){let o=document.querySelector(r);if(!o)return;let i="data-restore-icon-listener-attached";o.getAttribute(i)||(o.addEventListener("click",function(e){let t=e.target.closest(".aipkit_restore-default-icon");if(!t)return;let n=t.getAttribute("data-target-input"),s=t.getAttribute("data-default-value");if(!n||s===null){console.warn("AIPKit Restore Default: Missing target input ID or default value.",t);return}let a=document.getElementById(n);if(a){if(a.value!==s){a.value=s;let l=new Event("change",{bubbles:!0,cancelable:!0}),d=new Event("blur",{bubbles:!0,cancelable:!0});if(a.dispatchEvent(l),a.dispatchEvent(d),a.type==="range"){let u=document.getElementById(`${n}_value`);u&&(u.textContent=s)}}}else console.warn(`AIPKit Restore Default: Target input element #${n} not found.`)}),o.setAttribute(i,"true"))}window.aipkit_initRestoreDefaultIcons=p})();(function(){"use strict";function p(e){!e||!e.parentNode||e.classList.contains("aipkit_message_fadeout")||(e.classList.add("aipkit_message_fadeout"),e.addEventListener("animationend",()=>{e.parentNode&&e.parentNode.removeChild(e)},{once:!0}),setTimeout(()=>{e&&e.parentNode&&e.parentNode.removeChild(e)},500))}function r(e,t,n){let s=document.getElementById(e);if(!s){console.error(`AIPKit Message Handler: Container #${e} not found.`);return}s.querySelectorAll(".aipkit_settings_message").forEach(m=>{m.dataset.timerId&&clearTimeout(parseInt(m.dataset.timerId,10)),m.remove()});let c=s.querySelector(".aipkit_saving-indicator");c&&c.remove();let l=document.createElement("div");l.className=`aipkit_settings_message aipkit_settings_message-${t}`;let d=t==="success"?"dashicons-yes-alt":t==="error"?"dashicons-warning":"dashicons-info-alt",u=document.createElement("span");u.className=`dashicons ${d}`,u.style.marginRight="5px",l.appendChild(u),l.appendChild(document.createTextNode(` ${n}`));let f=document.createElement("span");f.className="dashicons dashicons-dismiss aipkit_settings_message-close",f.setAttribute("aria-label","Dismiss message"),f.title="Dismiss message",l.appendChild(f),s.appendChild(l);let _=setTimeout(()=>{p(l)},5e3);l.dataset.timerId=_}function o(e){let t=document.getElementById(e);if(!t){console.error(`AIPKit Message Handler: Container #${e} not found for close button init.`);return}let n=`data-close-listener-${e}`;t.getAttribute(n)!=="true"&&(t.addEventListener("click",function(s){let a=s.target.closest(".aipkit_settings_message-close");if(a){let c=a.closest(".aipkit_settings_message");c&&(c.dataset.timerId&&clearTimeout(parseInt(c.dataset.timerId,10)),p(c))}}),t.setAttribute(n,"true"))}function i(e){let t=document.getElementById(e);if(t){let n=t.querySelector(".aipkit_saving-indicator");n&&n.remove(),t.querySelectorAll(".aipkit_settings_message").forEach(a=>{a.dataset.timerId&&clearTimeout(parseInt(a.dataset.timerId,10)),a.remove()})}else console.warn(`AIPKit Message Handler: Container #${e} not found for clearing messages.`)}window.aipkit_showMessage=r,window.aipkit_initMessageCloseButtons=o,window.aipkit_clearStatusMessages=i})();(function(){"use strict";function p(i,e){let t=document.getElementById(i);if(!t){console.error(`AIPKit Saving Indicator: Container #${i} not found.`);return}let n=t.querySelector(".aipkit_saving-indicator");if(e)if(!n)typeof window.aipkit_clearStatusMessages=="function"?window.aipkit_clearStatusMessages(i):console.warn("AIPKit Saving Indicator: Cannot clear messages, dependency missing."),n=document.createElement("span"),n.className="aipkit_saving-indicator",n.innerHTML='Saving... <span class="aipkit_spinner" style="display:inline-block;"></span>',t.appendChild(n),requestAnimationFrame(()=>{let s=t.querySelector(".aipkit_saving-indicator");s&&s.classList.add("aipkit_active")});else{n.style.display="inline-flex",n.classList.add("aipkit_active");let s=n.querySelector(".aipkit_spinner");s&&(s.style.display="inline-block")}else n&&(n.classList.remove("aipkit_active"),setTimeout(()=>{n&&n.parentNode&&n.remove()},200))}function r(i){o(i);let e=document.createElement("span");e.className="aipkit-title-spinner aipkit_spinner",e.style.display="inline-block",i.parentNode.insertBefore(e,i.nextSibling)}function o(i){let e=i.parentNode.querySelector(".aipkit-title-spinner");e&&e.remove()}window.aipkit_showSavingIndicator=p,window.aipkit_showLinkSpinner=r,window.aipkit_hideLinkSpinner=o})();(function(){"use strict";function p(i){let e=i.textContent;i.textContent="Copied!",i.classList.add("aipkit-placeholder--copied"),setTimeout(()=>{i&&i.classList.contains("aipkit-placeholder--copied")&&(i.textContent=e,i.classList.remove("aipkit-placeholder--copied"))},1500)}function r(i){let e=i.target;if(!e.matches(".aipkit-placeholder"))return;i.preventDefault(),i.stopPropagation();let t=e.textContent;if(!navigator.clipboard){console.warn("AIPKit Placeholder Copy: Clipboard API not available.");return}navigator.clipboard.writeText(t).then(()=>{p(e)}).catch(n=>{console.error("AIPKit Placeholder Copy: Failed to copy placeholder. Error:",n)})}function o(){let i=document.body;if(i){let e="data-placeholder-copy-listener-attached";i.getAttribute(e)||(i.addEventListener("click",r),i.setAttribute(e,"true"))}else console.warn("AIPKit Placeholder Copy: Could not find document.body to attach delegated listener.")}document.addEventListener("DOMContentLoaded",o)})();window.aipkit_isIndexingStopped=!1;(function(){"use strict";function p(r,o={},i={}){return new Promise((e,t)=>{if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return t(new Error("AIPKit AJAX is not properly initialized (missing aipkit_dashboard object)"));let n=new FormData;n.append("action",r),!Object.prototype.hasOwnProperty.call(o,"_ajax_nonce")&&window.aipkit_dashboard&&window.aipkit_dashboard.nonce&&n.append("_ajax_nonce",window.aipkit_dashboard.nonce);for(let c in o)Object.prototype.hasOwnProperty.call(o,c)&&(Array.isArray(o[c])?o[c].forEach(l=>{n.append(c+"[]",l)}):n.append(c,o[c]));let s=new AbortController,a=setTimeout(()=>{s.abort()},i.timeout||12e4);fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:n,credentials:"same-origin",signal:s.signal}).then(c=>(clearTimeout(a),c.json())).then(c=>{if(c.success)e(c.data);else{let l=c.data||{},d=l.message||"Unknown error",u=new Error(d);l.debug_error&&(u.debug=l.debug_error),t(u)}}).catch(c=>{clearTimeout(a),c.name==="AbortError"?t(new Error("Request timeout")):t(c)})})}window.aipkit_apiRequest=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_modulesMenu");if(r){let n=r.querySelector(".aipkit_dropdown-panel"),s=r.querySelector(".aipkit_menu-trigger");s&&s.addEventListener("click",function(a){a.stopPropagation(),r.classList.toggle("aipkit_show-menu")}),n&&n.addEventListener("click",function(a){a.stopPropagation()})}let o=document.getElementById("aipkit_top_nav"),i=document.querySelector(".aipkit_mobile-nav-toggle"),e=document.getElementById("aipkit_nav_links_container");i&&o&&e&&(i.addEventListener("click",function(n){n.stopPropagation(),o.classList.toggle("aipkit_nav-open");let s=o.classList.contains("aipkit_nav-open");i.setAttribute("aria-expanded",s.toString()),e.style.display=s?"flex":"none"}),e.addEventListener("click",function(n){n.target.closest(".aipkit_nav-item")&&o.classList.contains("aipkit_nav-open")&&(o.classList.remove("aipkit_nav-open"),i.setAttribute("aria-expanded","false"),e.style.display="none")})),document.addEventListener("click",function(n){r&&r.classList.contains("aipkit_show-menu")&&(r.contains(n.target)||r.classList.remove("aipkit_show-menu")),o&&e&&o.classList.contains("aipkit_nav-open")&&(o.contains(n.target)||(o.classList.remove("aipkit_nav-open"),i&&i.setAttribute("aria-expanded","false"),e.style.display="none"))});let t=document.getElementById("aipkit_modulesMenuMobile");if(t){t.addEventListener("click",function(s){s.stopPropagation(),t.classList.toggle("aipkit_show-menu")});let n=t.querySelector(".aipkit_dropdown-menu");n&&n.addEventListener("click",function(s){s.stopPropagation()})}}window.aipkit_initSettingsMenus=p})();(function(){"use strict";let p={settings:"aipkit_initSettings",chatbot:"aipkit_initChatbot",addons:"aipkit_initAddons",logs:"aipkit_initLogs","user-credits":"aipkit_initUserCredits","image-generator":"aipkit_initImageGenerator","ai-training":"aipkit_initAiTraining","ai-forms":"aipkit_initAiForms",autogpt:"aipkit_initAutogpt","content-writer":"aipkit_initContentWriter"};async function r(o,i,e){let t={};if(typeof i=="function"?e=i:typeof i=="object"&&i!==null&&(t=i),o==="chatbot"&&!t.force_active_bot_id&&!t.force_active_tab)try{let d=localStorage.getItem("aipkit_last_selected_chatbot");d&&(t.force_active_bot_id=d)}catch(d){console.warn("AIPKit Loader: Failed to retrieve saved chatbot from localStorage:",d)}document.querySelectorAll(".aipkit_module-link").forEach(d=>d.classList.remove("aipkit_active"));let s=document.querySelector(`.aipkit_module-link[data-module="${o}"]`);s&&s.classList.add("aipkit_active");let a=document.getElementById("aipkit_module-container");if(!a)return console.error("AIPKit Loader: Module container #aipkit_module-container not found."),typeof e=="function"&&e(new Error("Module container not found.")),Promise.reject(new Error("Module container not found."));let c=window.aipkit_dashboard?.text?.loading?window.aipkit_dashboard.text.loading.replace("%s",o):`Loading ${o}...`;if(a.innerHTML=`
            <div class="aipkit_container aipkit_loading-placeholder">
                <div class="aipkit_container-body">
                    <p style="text-align: center; padding: 30px;">
                        <span class="aipkit_spinner"
                            style="display: inline-block; width: 20px; height: 20px; border-width: 3px; vertical-align: middle; margin-right: 10px;">
                        </span>
                        ${c}
                    </p>
                </div>
            </div>
        `,typeof window.aipkit_apiRequest!="function"){let d="Core API function missing. Cannot load module.";return console.error(`AIPKit Loader: aipkit_apiRequest function not found for module '${o}'.`),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(a,o,d),typeof e=="function"&&e(new Error(d)),Promise.reject(new Error(d))}let l={module:o,...t};try{let d=await window.aipkit_apiRequest("aipkit_dashboard_load_module",l);if(!d||typeof d.html!="string")throw new Error('Missing or invalid "html" in response data');a.innerHTML=d.html,o==="chatbot"&&d.openaiVectorStores&&(window.aipkit_chat_config?window.aipkit_chat_config.openaiVectorStores=d.openaiVectorStores:console.warn("AIPKit Loader: window.aipkit_chat_config object not found; cannot update openaiVectorStores.")),typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():console.warn("AIPKit Loader: aipkit_initializeTabs function not found.");let u=p[o];if(u&&typeof window[u]=="function")try{window[u]()}catch(f){let _=`Error initializing ${o} module scripts.`;return console.error(`AIPKit Loader: Error executing initializer '${u}':`,f),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(a,o,_+` (Details: ${f.message})`),typeof e=="function"&&e(new Error(_+` (Details: ${f.message})`)),Promise.reject(new Error(_+` (Details: ${f.message})`))}return typeof e=="function"&&e(),Promise.resolve()}catch(d){return d&&d.debug?console.error(`AIPKit Loader: Module loading error for '${o}':`,d.message,`
Server debug:`,d.debug):console.error(`AIPKit Loader: Module loading error for '${o}':`,d),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(a,o,d.message),typeof e=="function"&&e(d),Promise.reject(d)}}window.aipkit_loadModule=r})();(function(){"use strict";function p(r,o,i){if(!r)return;let e=window.aipkit_dashboard?.text||{},t=e.errorLoadingModuleTitle||"Error Loading Module",n=e.errorLoadingModuleMsg||"An error occurred while loading the '%s' module. Please try again later or check the console.",s=e.errorDetails||"Details:",a=n.replace("%s",o);r.innerHTML=`
            <div class="aipkit_container">
                <div class="aipkit_container-header">
                    <div class="aipkit_container-title" style="color: var(--aipkit_status-warning, red);">${t}</div>
                </div>
                <div class="aipkit_container-body">
                    <p>${a}</p>
                    <p><strong>${s}</strong></p>
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f8f8f8; border: 1px solid #eee; padding: 5px;">${i||"No specific error details available."}</pre>
                </div>
            </div>`}window.aipkit_renderModuleError=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_modulesMenu");if(!r)return;let o=r.querySelector(".aipkit_dropdown-panel");o&&(o.addEventListener("change",function(i){let e=i.target;if(e.matches&&e.matches(".aipkit_module-toggle")){let t=o.querySelectorAll(".aipkit_module-toggle");t.forEach(f=>f.disabled=!0),t.forEach(f=>f.disabled=!0);let n=e.getAttribute("data-module"),s=e.getAttribute("data-option-key"),a=e.getAttribute("data-icon"),c=e.getAttribute("data-label"),l=e.checked,d=document.querySelector(`.aipkit_module-link[data-module="${n}"]`);l?d?d.style.display="":console.log(`Module Toggle: Enabling '${n}'. Nav link will appear on refresh if needed.`):d&&(d.style.display="none");let u={moduleKey:s,enabled:l?"1":"0"};if(typeof window.aipkit_apiRequest!="function"){console.error("Module Toggle: API request function missing."),e.checked=!l,d&&(d.style.display=l?"none":""),t.forEach(f=>f.disabled=!1);return}window.aipkit_apiRequest("aipkit_update_module_setting",u).then(()=>{console.log(`Module Toggle: '${n}' status updated successfully.`)}).catch(f=>{console.error("Error updating module setting:",f.message),alert(`Error updating module setting: ${f.message}`),e.checked=!l,d&&(d.style.display=l?"none":"")}).finally(()=>{t.forEach(f=>f.disabled=!1)})}}),o.addEventListener("click",function(i){let e=i.target.closest(".aipkit_module-item");if(e){let t=e.querySelector(".aipkit_toggle-switch");if(t&&!t.contains(i.target)){let n=e.querySelector(".aipkit_module-toggle");if(n&&!n.disabled){n.checked=!n.checked;let s=new Event("change",{bubbles:!0});n.dispatchEvent(s)}}}}))}window.aipkit_initModuleToggles=p})();(function(){"use strict";function p(){document.querySelectorAll(".aipkit_tabs").forEach(i=>{if(i.dataset.tabGroupListenerAttached==="true")return;let e=i.querySelectorAll(".aipkit_tab"),t=i.nextElementSibling;if(!t||!t.classList.contains("aipkit_tab_content_container")){let n=i.closest(".aipkit_container-body, .aipkit_container"),s=n?n.querySelector(".aipkit_tab_content_container"):null;if(!s)return;let a=s.querySelectorAll(".aipkit_tab-content");r(i,e,a)}else{let n=t.querySelectorAll(".aipkit_tab-content");r(i,e,n)}})}function r(o,i,e){i.forEach(t=>{t.addEventListener("click",function(){i.forEach(a=>a.classList.remove("aipkit_active")),this.classList.add("aipkit_active"),e.forEach(a=>a.classList.remove("aipkit_active"));let n=this.getAttribute("data-tab"),s=Array.from(e).find(a=>a.id===n+"-content");s&&(s.classList.add("aipkit_active"),s.id==="indexing-settings-tab-content"&&typeof window.aipkit_initIndexingSettings=="function"&&window.aipkit_initIndexingSettings())})}),o.dataset.tabGroupListenerAttached="true"}window.aipkit_initializeTabs=p})();(function(){"use strict";function p(){let e=document.getElementById("aipkit_addons_container");if(!e){console.warn("AIPKit Addons: Container #aipkit_addons_container not found for event delegation.");return}let t="data-addon-listeners-attached";if(e.getAttribute(t)){i();return}e.addEventListener("click",function(n){let s=n.target.closest(".aipkit_addon_toggle_btn"),a=n.target.closest(".aipkit_filter_link");s?r(s):a&&o(a)}),e.setAttribute(t,"true"),i()}function r(e){if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Addons: API request function missing."),alert("Error: Cannot update addon status.");return}let t=e.getAttribute("data-addon-key"),n=e.getAttribute("data-active")==="1",s=n?"0":"1",a=e.closest(".aipkit_addon_card, .aipkit_stat-card"),c=a?a.querySelector(".aipkit_addon_status_msg"):null,l=e.querySelector(".aipkit_btn-text"),d=e.querySelector(".aipkit_spinner");if(!t||!a||!c||!l||!d){console.warn("AIPKit Addons: Missing required elements for toggle button:",e);return}e.disabled=!0,d.style.display="inline-block";let u=l.textContent;l.textContent=n?"Deactivating...":"Activating...",c.textContent="",c.className="aipkit_addon_status_msg",window.aipkit_apiRequest("aipkit_update_addon_status",{addonKey:t,active:s}).then(f=>{let _=n;e.setAttribute("data-active",s),a.setAttribute("data-status",s==="1"?"active":"inactive"),e.classList.toggle("aipkit_btn-primary",_),e.classList.toggle("aipkit_btn-secondary",!_),l.textContent=s==="1"?"Deactivate":"Activate",c.textContent=f.message||"Status updated!",c.style.color="green",setTimeout(()=>{c.textContent="",c.style.color=""},3e3),i()}).catch(f=>{console.error("Error updating addon status:",f),l.textContent=u,c.textContent="Error: "+(f.message||"Could not update status."),c.style.color="red",setTimeout(()=>{c.textContent="",c.style.color=""},5e3)}).finally(()=>{e.disabled=!1,d.style.display="none"})}function o(e){if(e.classList.contains("aipkit_active"))return;let t=e.closest(".aipkit_filter_group");t&&(t.querySelectorAll(".aipkit_filter_link").forEach(n=>n.classList.remove("aipkit_active")),e.classList.add("aipkit_active"),i())}function i(){let e=document.getElementById("aipkit_addons_container");if(!e)return;let t=e.querySelector('.aipkit_filter_group[data-filter-group="category"] .aipkit_filter_link.aipkit_active'),n=t?t.getAttribute("data-filter-value"):"all",s=document.getElementById("aipkit_addons_grid"),a=document.getElementById("aipkit_no_addons_message");if(!s||!a)return;let c=s.querySelectorAll(".aipkit_addon_card, .aipkit_stat-card"),l=0;c.forEach(d=>{let u=d.getAttribute("data-category"),f=d.getAttribute("data-categories")||"",_=u?[u]:f.split(" ").filter(g=>g);n==="all"||_.includes(n)?(d.classList.remove("aipkit_hidden"),l++):d.classList.add("aipkit_hidden")}),a.style.display=l===0?"block":"none"}window.aipkit_initAddons=p})();document.addEventListener("DOMContentLoaded",function(){typeof window.aipkit_initSettingsMenus=="function"?window.aipkit_initSettingsMenus():console.error("AIPKit Main: aipkit_initSettingsMenus function not found."),typeof window.aipkit_initModuleToggles=="function"?window.aipkit_initModuleToggles():console.error("AIPKit Main: aipkit_initModuleToggles function not found.");let p=document.getElementById("aipkit_top_nav"),r=document.querySelector(".aipkit_mobile-nav-toggle");r&&p&&r.addEventListener("click",function(){p.classList.toggle("aipkit_nav-open")});let o=document.getElementById("aipkit_migration_notice");if(o){let n=o.querySelector(".aipkit_notification_bar__close");n&&n.addEventListener("click",()=>{o.style.display="none"});let s=document.getElementById("aipkit_dismiss_migration_notice_btn");s&&s.addEventListener("click",()=>{if(typeof window.aipkit_apiRequest!="function"){alert("Error: API function missing.");return}s.disabled=!0,s.textContent="Dismissing...",window.aipkit_apiRequest("aipkit_dismiss_migration_notice").then(()=>{o.style.display="none"}).catch(a=>{alert("Error dismissing notice: "+a.message),s.disabled=!1,s.textContent="Dismiss Forever"})})}let t=new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager";if(t)console.log("AIPKit Main: On Role Manager page, skipping initial module load.");else if(typeof window.aipkit_loadModule=="function"){let n=["settings","chatbot","content-writer","ai-forms","image-generator","ai-training","addons"],s=Array.from(document.querySelectorAll(".aipkit_module-link")),a=null;for(let c=0;c<n.length;c++){let l=n[c];if(s.find(u=>u.getAttribute("data-module")===l&&u.offsetParent!==null)){a=l;break}}if(!a){let c=s.find(l=>l.offsetParent!==null);c&&(a=c.getAttribute("data-module"))}if(a)window.aipkit_loadModule(a);else if(s.find(l=>l.getAttribute("data-module")==="settings"))window.aipkit_loadModule("settings");else{let l=document.getElementById("aipkit_module-container");l&&typeof window.aipkit_renderModuleError=="function"?window.aipkit_renderModuleError(l,"initial","No modules enabled or accessible. Please activate modules via the top-right menu or check permissions."):l&&(l.innerHTML='<p style="text-align:center; padding: 30px;">No modules enabled. Activate modules via the top-right menu.</p>')}}else if(typeof window.aipkit_loadModule!="function"&&!t){console.error("AIPKit Main: Module loader function (aipkit_loadModule) not found.");let n=document.getElementById("aipkit_module-container");n&&(n.innerHTML='<p style="color:red; text-align:center; padding: 30px;">Critical Error: Failed to load dashboard components.</p>')}});(function(){"use strict";function p(){let r={},o=document.getElementById("aipkit_settings_container");return o&&o.querySelectorAll("input[name], select[name], textarea[name]").forEach(e=>{e.type==="checkbox"?r[e.name]=e.checked?"1":"0":e.type==="radio"?e.checked&&(r[e.name]=e.value):r[e.name]=e.value}),r}window.aipkit_getCurrentFormData=p})();(function(){"use strict";window.aipkit_isSaving=!1,window.aipkit_lastSavedData=null;async function p(){if(typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getCurrentFormData!="function"){console.error("AIPKit Auto Save Logic: Missing required UI, API, or data helper functions.");return}let r=window.aipkit_getCurrentFormData();if(JSON.stringify(r)===JSON.stringify(window.aipkit_lastSavedData)||window.aipkit_isSaving)return;window.aipkit_isSaving=!0;let o="aipkit_settings_messages";window.aipkit_showSavingIndicator(o,!0);try{await window.aipkit_apiRequest("aipkit_save_ai_settings",r),window.aipkit_showSavingIndicator(o,!1),window.aipkit_showMessage(o,"success","Settings saved!"),window.aipkit_lastSavedData=r}catch(i){window.aipkit_showSavingIndicator(o,!1),window.aipkit_showMessage(o,"error","Save failed: "+i.message),console.error("AIPKit Auto-Save Error:",i)}finally{window.aipkit_isSaving=!1}}window.aipkit_handleAutoSave=p})();(function(){"use strict";function p(){let o=document.getElementById("aipkit_settings_container");if(!o)return;let i="data-autosave-listener-attached";o.getAttribute(i)||(o.addEventListener("change",function(e){let t=e.target;t.matches(".aipkit_autosave_trigger")&&t.id!=="aipkit_provider"&&(t.tagName.toLowerCase()==="select"||t.type==="checkbox"||t.type==="range")&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}),o.addEventListener("blur",function(e){let t=e.target;if(t.matches(".aipkit_autosave_trigger")&&t.id!=="aipkit_provider"){let n=t.tagName.toLowerCase();(n==="input"||n==="textarea")&&t.type!=="range"&&t.type!=="checkbox"&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}},!0),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.error("Autosave Init: aipkit_updateLastSavedData not found"),o.setAttribute(i,"true"))}function r(){typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_lastSavedData=window.aipkit_getCurrentFormData():console.error("AIPKit Autosave: Cannot update baseline, aipkit_getCurrentFormData not found.")}window.aipkit_attachAutoSaveListeners=p,window.aipkit_updateLastSavedData=r})();(function(){"use strict";function p(o){try{return new Date(o+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return o}}function r(o){return typeof o!="number"?o:o.toLocaleString()}window.aipkit_formatChartDate=p,window.aipkit_formatChartNumber=r})();(function(){"use strict";let p=["#4A6FA5","#61A0FF","#81C784","#FFB74D","#BA68C8","#E57373","#FFF176","#7986CB","#4DB6AC","#F06292","#A1887F","#90A4AE"],r="#B0BEC5",o={};function i(t){o={};let n=0;t.forEach(s=>{if(s==="Other")o[s]=r;else{let a;do a=p[n%p.length],n++;while(a===r&&p.length>1);o[s]=a}})}function e(t){return o[t]||"#cccccc"}window.aipkit_assignModuleColors=i,window.aipkit_getModuleColor=e})();(function(){"use strict";function p(e,t){if(!t||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"){console.error("Tooltip Error: Missing tooltip element or utility/color functions.");return}let n=e.target,s=n.getAttribute("data-date"),a=n.getAttribute("data-module"),c=parseInt(n.getAttribute("data-value"),10),l=parseInt(n.getAttribute("data-daily-total"),10),d=window.aipkit_getModuleColor(a),u=a?r(a.replace(/[-_]/g," ")):"Unknown";t.innerHTML=`
            <span class="aipkit_chart_tooltip_date">${window.aipkit_formatChartDate(s)}:</span><br>
            <span class="aipkit_chart_tooltip_model" style="color: #ffffff; background-color: ${d}; padding: 1px 4px; border-radius: 2px; font-weight: bold;">${u}</span> <?php // Use module name ?>
            <span class="aipkit_chart_tooltip_value">${window.aipkit_formatChartNumber(c)} tokens</span><br>
            <span class="aipkit_chart_tooltip_total">(Total: ${window.aipkit_formatChartNumber(l)} tokens)</span>
        `,t.classList.add("aipkit_active"),o(e,t)}function r(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function o(e,t){if(!t)return;let n=t.parentElement;if(!n)return;let s=n.getBoundingClientRect(),a=e.clientX-s.left,c=e.clientY-s.top,l=t.offsetWidth,d=t.offsetHeight,u=a+15,f=c-d-10;u+l>s.width-5&&(u=a-l-15),u<5&&(u=5),f<5&&(f=c+15),f+d>s.height-5&&(f=s.height-d-5),t.style.left=`${u}px`,t.style.top=`${f}px`,t.style.transform="translate(0, 0)"}function i(e){e&&e.classList.remove("aipkit_active")}window.aipkit_showStackedTooltip=p,window.aipkit_moveChartTooltip=o,window.aipkit_hideChartTooltip=i})();(function(){"use strict";let p="http://www.w3.org/2000/svg";function r(i,e){if(i.innerHTML="",typeof window.aipkit_assignModuleColors!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_showStackedTooltip!="function"||typeof window.aipkit_moveChartTooltip!="function"||typeof window.aipkit_hideChartTooltip!="function"){console.error("AIPKit Chart Renderer: Missing required chart utility/color/tooltip functions."),i.innerHTML='<p style="color:red">Error rendering chart: Dependencies missing.</p>';return}let t=Object.keys(e);if(t.length===0){i.innerHTML='<p style="text-align:center; padding:20px;">No data available for chart.</p>';return}let n=new Set;t.forEach(M=>{Object.keys(e[M]).forEach(x=>n.add(x))});let s=Array.from(n);s.sort((M,x)=>{if(M==="Other")return 1;if(x==="Other")return-1;let L=A=>A?o(A.replace(/[-_]/g," ")):"Unknown";return L(M).localeCompare(L(x))}),window.aipkit_assignModuleColors(s);let a=1;t.forEach(M=>{let x=Object.values(e[M]).reduce((L,A)=>L+A,0);x>a&&(a=x)}),a=a*1.05;let c=t.length,l=250,d=s.length>0?Math.max(40,Math.ceil(s.length/3)*20):0,u={top:20,right:20,bottom:30+d,left:50},f=i.clientWidth-u.left-u.right,_=l-u.top-u.bottom,m=Math.max(1,f/c*.8),g=Math.max(0,f/c*.2),k=document.createElementNS(p,"svg");k.setAttribute("viewBox",`0 0 ${i.clientWidth} ${l}`),k.setAttribute("preserveAspectRatio","xMidYMid meet"),k.setAttribute("class","aipkit_token_usage_chart_svg"),k.setAttribute("aria-label","Token usage per module per day chart");let w=document.createElementNS(p,"g");w.setAttribute("transform",`translate(${u.left}, ${u.top})`),k.appendChild(w);let h=document.createElement("div");h.className="aipkit_chart_tooltip",i.style.position="relative",i.appendChild(h);let y=document.createElementNS(p,"g");y.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_y"),w.appendChild(y);let b=document.createElementNS(p,"line");b.setAttribute("x1",0),b.setAttribute("y1",0),b.setAttribute("x2",0),b.setAttribute("y2",_),y.appendChild(b);let v=5;for(let M=0;M<v;M++){let x=Math.round(a*(M/(v-1))),L=_-_*(M/(v-1)),A=document.createElementNS(p,"text");A.setAttribute("x",-5),A.setAttribute("y",L+3),A.setAttribute("class","aipkit_chart_label aipkit_chart_label_y"),A.textContent=window.aipkit_formatChartNumber(x),y.appendChild(A);let I=document.createElementNS(p,"line");I.setAttribute("x1",0),I.setAttribute("y1",L),I.setAttribute("x2",f),I.setAttribute("y2",L),I.setAttribute("class","aipkit_chart_grid_line"),w.insertBefore(I,w.firstChild)}let S=document.createElementNS(p,"g");S.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_x"),S.setAttribute("transform",`translate(0, ${_})`),w.appendChild(S);let C=document.createElementNS(p,"line");C.setAttribute("x1",0),C.setAttribute("y1",0),C.setAttribute("x2",f),C.setAttribute("y2",0),S.appendChild(C);let T=Math.max(1,Math.ceil(c/(f/60)));t.forEach((M,x)=>{if(x%T===0||x===c-1){let L=x*(m+g)+m/2+g/2,A=document.createElementNS(p,"text");A.setAttribute("x",L),A.setAttribute("y",u.bottom-d-10),A.setAttribute("class","aipkit_chart_label aipkit_chart_label_x"),A.textContent=window.aipkit_formatChartDate(M),S.appendChild(A)}});let E=document.createElementNS(p,"g");if(w.appendChild(E),t.forEach((M,x)=>{let L=e[M],A=_,I=0;s.filter(B=>L[B]>0).forEach(B=>{let F=L[B]||0;I+=F;let O=F/a*_;A-=O;let D=x*(m+g)+g/2,$=document.createElementNS(p,"rect");$.setAttribute("x",D),$.setAttribute("y",A),$.setAttribute("width",m),$.setAttribute("height",Math.max(.1,O)),$.setAttribute("class","aipkit_chart_bar"),$.setAttribute("fill",window.aipkit_getModuleColor(B)),$.setAttribute("data-date",M),$.setAttribute("data-module",B),$.setAttribute("data-value",F),$.setAttribute("data-daily-total",0),$.addEventListener("mouseenter",N=>window.aipkit_showStackedTooltip(N,h)),$.addEventListener("mousemove",N=>window.aipkit_moveChartTooltip(N,h)),$.addEventListener("mouseleave",()=>window.aipkit_hideChartTooltip(h)),E.appendChild($)}),E.querySelectorAll(`rect[data-date="${M}"]`).forEach(B=>B.setAttribute("data-daily-total",I))}),s.length>0){let M=document.createElementNS(p,"g");M.setAttribute("class","aipkit_chart_legend"),M.setAttribute("transform",`translate(0, ${_+u.bottom-d+5})`),w.appendChild(M);let x=0,L=0,A=20,I=f,q=35;s.forEach(P=>{let B=o(P.replace(/[-_]/g," ")),O=B.length*7+25+q;x>0&&x+O>I&&(x=0,L+=A);let D=document.createElementNS(p,"g");D.setAttribute("transform",`translate(${x}, ${L})`);let $=document.createElementNS(p,"rect");$.setAttribute("width",10),$.setAttribute("height",10),$.setAttribute("y",-5),$.setAttribute("fill",window.aipkit_getModuleColor(P)),D.appendChild($);let N=document.createElementNS(p,"text");N.setAttribute("x",15),N.setAttribute("y",0),N.setAttribute("class","aipkit_chart_legend_label"),N.textContent=B,D.appendChild(N),M.appendChild(D),x+=O})}i.appendChild(k)}function o(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}window.aipkit_renderTokenUsageChart=r})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_token_usage_chart_container");if(!o){console.warn("AIPKit Chart Fetcher: Container not found.");return}if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit Chart Fetcher: Missing required API or render functions.");return}let i=o.querySelector(".aipkit_chart_loading_placeholder"),e=o.querySelector(".aipkit_chart_error_placeholder"),t=o.querySelector(".aipkit_chart_nodata_placeholder");e&&(e.style.display="none"),t&&(t.style.display="none"),i&&(i.style.display="flex");let n=[3,7,14,30,90],s=parseInt(r,10);if(!s||isNaN(s)){try{let c=localStorage.getItem("aipkit_stats_period_days"),l=parseInt(c,10);c&&!isNaN(l)&&n.includes(l)&&(s=l)}catch{}let a=document.getElementById("aipkit_stats_period_select");if(a){let c=parseInt(a.value,10);(!s||isNaN(s))&&(s=!isNaN(c)&&n.includes(c)?c:3),n.includes(s)&&String(a.value)!==String(s)&&(a.value=String(s))}else o.dataset.defaultDays?s=parseInt(o.dataset.defaultDays,10)||3:s=3}window.aipkit_apiRequest("aipkit_get_token_usage_chart_data",{days:s}).then(a=>{if(i&&(i.style.display="none"),a&&a.daily_token_data){let c=a.daily_token_data;if(c&&typeof c=="object"&&Object.values(c).some(d=>d&&typeof d=="object"&&Object.values(d).some(u=>Number(u)>0)))window.aipkit_renderTokenUsageChart(o,c);else{let d=a.notice||window.aipkit_dashboard?.text?.chartNoData||"No token usage data found for the selected period.",u=a.manage_logs_url,f=e||t;if(f){f.textContent="";let _=document.createTextNode(d+" ");if(f.appendChild(_),u){let m=document.createElement("a");m.href=u,m.target="_blank",m.rel="noopener noreferrer",m.textContent=window.aipkit_dashboard?.text?.manageLogs||"Manage logs",f.appendChild(m)}f.style.display="flex"}else{let _=document.createElement("div");_.className="aipkit_chart_error_placeholder",_.textContent=d,o.innerHTML="",o.appendChild(_)}}}else throw new Error("Invalid data received for chart.")}).catch(a=>{if(console.error("AIPKit Chart Fetcher: Error loading data:",a),i&&(i.style.display="none"),e)e.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${a.message})`,e.style.display="flex";else{let c=document.createElement("div");c.className="aipkit_chart_error_placeholder",c.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${a.message})`,o.innerHTML="",o.appendChild(c)}})}window.aipkit_loadTokenUsageChart=p,document.addEventListener("change",function(r){let o=r.target;if(o&&o.id==="aipkit_stats_period_select"){let i=parseInt(o.value,10)||7;typeof window.aipkit_loadTokenUsageChart=="function"&&window.aipkit_loadTokenUsageChart(i);try{[3,7,14,30,90].includes(i)&&localStorage.setItem("aipkit_stats_period_days",String(i))}catch{}}})})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_openai_model"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openai_model"]');if(!o&&i.length===0){console.warn("OpenAI Sync: No OpenAI model selects found (#aipkit_openai_model or chat selects).");return}if(!r||Object.keys(r).length===0){o.appendChild(new Option("No models found.",""));return}let e=!1,t=["o1 models","o3 models","o4 models","gpt-3.5 models","gpt-4 models","gpt-5 models","fine-tuned models","others"],n=Object.keys(r),s=t.filter(c=>n.includes(c)).concat(n.filter(c=>!t.includes(c)).sort()),a=(c,l)=>{let d=!1;return s.forEach(u=>{let f=r[u]||[];if(f.length===0)return;let _=document.createElement("optgroup");_.label=u,f.sort((m,g)=>(m.name||m.id||"").localeCompare(g.name||g.id||"")),f.forEach(m=>{let g=new Option(m.name||m.id,m.id);m.id===l&&(g.selected=!0,d=!0),_.appendChild(g)}),c.appendChild(_)}),d};if(o){let c=a(o,o.value);if(!c&&o.value&&!o.querySelector(`option[value="${CSS.escape(o.value)}"]`)){let l=new Option(o.value+" (manual)",o.value,!1,!0),d=o.querySelector('optgroup[label="Other"]');d?d.appendChild(l):o.insertBefore(l,o.firstChild),c=!0}if(!c&&o.options.length>0&&o.selectedIndex===-1){let l=-1;for(let d=0;d<o.options.length;d++)if(!o.options[d].disabled&&o.options[d].value){l=d;break}o.selectedIndex=l!==-1?l:0}}i.forEach(c=>{if(!a(c,c.value)&&c.value&&!c.querySelector(`option[value="${CSS.escape(c.value)}"]`)){let d=new Option(c.value+" (manual)",c.value,!1,!0);c.insertBefore(d,c.firstChild)}c.options.length>0&&c.selectedIndex===-1&&(c.selectedIndex=0)})}window.aipkit_updateOpenAIModels=p})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_openrouter_model"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openrouter_model"]');if(!o&&i.length===0){console.warn("OpenRouter Sync: No OpenRouter model selects found (#aipkit_openrouter_model or chat selects).");return}let e=t=>{let n=t.value;if(t.innerHTML="",!r||!r.length){o.appendChild(new Option("No models found.",""));return}let s=!1,a={};if(r.forEach(l=>{let d=l.id.split("/"),u=(d.length>1?d[0]:"other").toLowerCase();a[u]||(a[u]=[]),a[u].push(l)}),Object.keys(a).sort().forEach(l=>{let d=document.createElement("optgroup");d.label=l.charAt(0).toUpperCase()+l.slice(1),a[l].sort((u,f)=>(u.name||"").localeCompare(f.name||"")),a[l].forEach(u=>{let f=new Option(u.name,u.id);u.id===n&&(f.selected=!0,s=!0),d.appendChild(f)}),t.appendChild(d)}),!s&&t.value&&!t.querySelector(`option[value="${CSS.escape(t.value)}"]`)){let l=new Option(t.value+" (manual)",t.value,!1,!0);t.insertBefore(l,t.firstChild)}if(!s&&t.options.length>0&&t.selectedIndex===-1){let l=-1;for(let d=0;d<t.options.length;d++)if(!t.options[d].disabled&&t.options[d].value){l=d;break}t.selectedIndex=l!==-1?l:0}};o&&e(o),i.forEach(e)}window.aipkit_updateOpenRouterModels=p})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_google_model"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_google_model"]');if(!o&&i.length===0){console.warn("Google Sync: No Google model selects found (#aipkit_google_model or chat selects).");return}let e=Array.isArray(r)?r.slice():[];e.sort((n,s)=>(n.name||n.id||"").localeCompare(s.name||s.id||""));let t=n=>{let s=n.value;if(n.innerHTML="",!e.length){n.appendChild(new Option("No models found.",""));return}let a=!1;if(e.forEach(c=>{let l=c.id||"",d=c.name||l;if(!l)return;let u=new Option(d,l);(l===s||`models/${l}`===s)&&(u.selected=!0,a=!0),n.appendChild(u)}),!a&&s){let c=s.startsWith("models/")?s.substring(7):s;if(!n.querySelector(`option[value="${CSS.escape(c)}"]`)){let l=c,d=new Option(l+" (manual)",s,!1,!0);n.insertBefore(d,n.firstChild),n.value=s}}if(n.options.length>0&&n.selectedIndex===-1){let c=-1;for(let l=0;l<n.options.length;l++)if(!n.options[l].disabled&&n.options[l].value){c=l;break}n.selectedIndex=c!==-1?c:0}};o&&t(o),i.forEach(t)}window.aipkit_updateGoogleModels=p})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_azure_deployment"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_azure_deployment"]');if(!o&&i.length===0){console.warn("Azure Sync: No Azure deployment selects found (#aipkit_azure_deployment or chat selects).");return}let e=t=>{let n=t.value;t.innerHTML="";let s=r&&typeof r=="object"&&!Array.isArray(r)&&(r["Chat Models"]||r["Embedding Models"]||r["Image Models"]);if(!r||Array.isArray(r)&&!r.length||s&&Object.keys(r).length===0){if(o.appendChild(new Option("No deployments found.","")),n){let c=new Option(n+" (manual)",n,!1,!0);o.appendChild(c),o.value=n}return}let a=!1;if(s)Object.keys(r).forEach(c=>{let l=r[c];if(l&&Array.isArray(l)&&l.length>0){let d=document.createElement("optgroup");d.label=c,l.sort((u,f)=>(u.id||"").localeCompare(f.id||"")),l.forEach(u=>{let f=u.id||"",_=u.name||f;if(!f)return;let m=f+(_&&_!==f?` (model: ${_})`:""),g=new Option(m,f);f===n&&(g.selected=!0,a=!0),d.appendChild(g)}),t.appendChild(d)}});else{let c=Array.isArray(r)?r:[];c.sort((l,d)=>(l.id||"").localeCompare(d.id||"")),c.forEach(l=>{let d=l.id||"",u=l.name||d;if(!d)return;let f=d+(u&&u!==d?` (model: ${u})`:""),_=new Option(f,d);d===n&&(_.selected=!0,a=!0),t.appendChild(_)})}if(!a&&t.value&&!t.querySelector(`option[value="${CSS.escape(t.value)}"]`)){let c=new Option(t.value+" (not in synced list)",t.value,!1,!0);t.appendChild(c),a=!0}if(!a&&t.options.length>0&&t.selectedIndex===-1){let c=-1;for(let l=0;l<t.options.length;l++)if(!t.options[l].disabled&&t.options[l].value){c=l;break}t.selectedIndex=c!==-1?c:0}};o&&e(o),i.forEach(e)}window.aipkit_updateAzureDeployments=p})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_deepseek_model"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_deepseek_model"]');if(!o&&i.length===0){console.warn("DeepSeek Sync: No DeepSeek model selects found (#aipkit_deepseek_model or chat selects).");return}let e=t=>{let n=t.value;if(t.innerHTML="",!r||!r.length){o.appendChild(new Option("No models found.",""));return}let s=!1;if(r.sort((a,c)=>(a.name||a.id||"").localeCompare(c.name||c.id||"")),r.forEach(a=>{let c=a.id||"",l=a.name||c;if(!c)return;let d=new Option(l,c);c===n&&(d.selected=!0,s=!0),t.appendChild(d)}),!s&&t.value&&!t.querySelector(`option[value="${CSS.escape(t.value)}"]`)){let a=new Option(t.value+" (manual)",t.value,!1,!0);t.insertBefore(a,t.firstChild)}!s&&t.options.length>0&&t.selectedIndex===-1&&(t.selectedIndex=0)};o&&e(o),i.forEach(e)}window.aipkit_updateDeepSeekModels=p})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_ollama_model"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_ollama_model"]');if(!o&&i.length===0){console.warn("Ollama Sync: No Ollama model selects found (#aipkit_ollama_model or chat selects).");return}let e=t=>{let n=t.value;if(t.innerHTML="",!r||!r.length){o.appendChild(new Option("No models found.",""));return}r.sort((a,c)=>(a.name||a.id||"").localeCompare(c.name||c.id||""));let s=!1;if(r.forEach(a=>{let c=a.id||"",l=a.name||c;if(!c)return;let d=new Option(l,c);c===n&&(d.selected=!0,s=!0),t.appendChild(d)}),!s&&t.value&&!t.querySelector(`option[value="${CSS.escape(t.value)}"]`)){let a=new Option(t.value+" (manual)",t.value,!1,!0);t.insertBefore(a,t.firstChild)}t.options.length>0&&t.selectedIndex===-1&&(t.selectedIndex=0)};o&&e(o),i.forEach(e)}window.aipkit_updateOllamaModels=p})();(function(){"use strict";function p(o,i="aipkit_elevenlabs_voice_id"){let e=document.getElementById(i);if(!e){console.warn(`ElevenLabs Sync (Voices): Select element #${i} not found.`);return}let t=e.value;if(e.innerHTML="",e.appendChild(new Option("-- Select a Voice (Optional) --","")),!o||!o.length){t&&t!==""&&(e.appendChild(new Option(t+" (manual/not synced)",t,!1,!0)),e.value=t);return}let n=!1;if(o.sort((s,a)=>(s.name||s.id||"").localeCompare(a.name||a.id||"")),o.forEach(s=>{let a=s.id||"",c=s.name||a;if(!a)return;let l=new Option(c,a);a===t&&(l.selected=!0,n=!0),e.appendChild(l)}),!n&&t&&t!==""&&!e.querySelector(`option[value="${CSS.escape(t)}"]`)){let s=new Option(t+" (manual/not synced)",t,!1,!0);e.appendChild(s),e.value=t}}function r(o,i="aipkit_elevenlabs_tts_model_id"){let e=document.getElementById(i);if(!e){console.warn(`ElevenLabs Sync (Models): Select element #${i} not found.`);return}let t=e.value;if(e.innerHTML="",e.appendChild(new Option("-- Select a Model (Optional) --","")),!o||!o.length){t&&t!==""&&(e.appendChild(new Option(t+" (manual/not synced)",t,!1,!0)),e.value=t);return}let n=!1;if(o.sort((s,a)=>(s.name||s.id||"").localeCompare(a.name||a.id||"")),o.forEach(s=>{let a=s.id||"",c=s.name||a;if(!a)return;let l=new Option(c,a);a===t&&(l.selected=!0,n=!0),e.appendChild(l)}),!n&&t&&t!==""&&!e.querySelector(`option[value="${CSS.escape(t)}"]`)){let s=new Option(t+" (manual/not synced)",t,!1,!0);e.appendChild(s),e.value=t}}window.aipkit_updateElevenLabsVoices=p,window.aipkit_updateElevenLabsModelsSelect=r})();(function(){"use strict";function p(r,o="aipkit_pinecone_default_index"){let i=document.getElementById(o);if(!i){console.warn(`Pinecone Sync: Select element #${o} not found.`);return}let e=i.value;if(i.innerHTML="",i.appendChild(new Option("-- Select Default Index --","")),!r||!r.length){i.appendChild(new Option("(No indexes found - Sync again)","")),e&&e!==""&&(i.appendChild(new Option(e+" (manual/not synced)",e,!1,!0)),i.value=e);return}let t=!1;if(r.sort((n,s)=>(n.name||n.id||"").localeCompare(s.name||s.id||"")),r.forEach(n=>{let s=n.name||n.id||(typeof n=="string"?n:"");if(!s)return;let a=new Option(s,s);s===e&&(a.selected=!0,t=!0),i.appendChild(a)}),!t&&e&&e!==""&&!i.querySelector(`option[value="${CSS.escape(e)}"]`)){let n=new Option(e+" (manual/not synced)",e,!1,!0);i.appendChild(n),i.value=e}}window.aipkit_updatePineconeIndexes=p})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_qdrant_default_collection");if(!o){console.warn("Qdrant Sync: Select element #aipkit_qdrant_default_collection not found.");return}let i=o.value;if(o.innerHTML="",o.appendChild(new Option("-- Select Collection (Optional) --","")),!r||!r.length){o.appendChild(new Option("(No collections found - Sync again)","")),i&&i!==""&&(o.appendChild(new Option(i+" (manual/not synced)",i,!1,!0)),o.value=i);return}let e=!1;if(r.sort((t,n)=>(t.name||t.id||"").localeCompare(n.name||n.id||"")),r.forEach(t=>{let n=t.name||t.id||"";if(!n)return;let s=new Option(n,n);n===i&&(s.selected=!0,e=!0),o.appendChild(s)}),!e&&i&&i!==""&&!o.querySelector(`option[value="${CSS.escape(i)}"]`)){let t=new Option(i+" (manual/not synced)",i,!1,!0);o.appendChild(t),o.value=i}}window.aipkit_updateQdrantCollections=p})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_replicate_model");if(!o){console.warn("Replicate Sync: Select element #aipkit_replicate_model not found.");return}let i=o.value;if(o.innerHTML="",!r||!r.length){o.appendChild(new Option("(No models found - Sync again)","")),i&&i!==""&&(o.appendChild(new Option(i+" (manual/not synced)",i,!1,!0)),o.value=i);return}let e=!1;if(r.sort((t,n)=>(t.name||t.id||"").localeCompare(n.name||n.id||"")),r.forEach(t=>{let n=t.id||"",s=t.name||n;if(!n)return;let a=new Option(s,n);n===i&&(a.selected=!0,e=!0),o.appendChild(a)}),!e&&i&&i!==""&&!o.querySelector(`option[value="${CSS.escape(i)}"]`)){let t=new Option(i+" (manual)",i,!1,!0);o.insertBefore(t,o.firstChild),o.value=i}if(!o.value&&o.options.length>0){let t=-1;for(let n=0;n<o.options.length;n++)if(!o.options[n].disabled&&o.options[n].value){t=n;break}o.selectedIndex=t!==-1?t:0}}window.aipkit_updateReplicateModels=p})();(function(){"use strict";function p(i,e){if(typeof window.aipkit_clearStatusMessages!="function"||typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Model Sync Init: Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync models/voices, required functions missing.");return}let t={OpenAI:window.aipkit_updateOpenAIModels,OpenRouter:window.aipkit_updateOpenRouterModels,Google:window.aipkit_updateGoogleModels,Azure:window.aipkit_updateAzureDeployments,DeepSeek:window.aipkit_updateDeepSeekModels,Ollama:window.aipkit_updateOllamaModels,ElevenLabs:window.aipkit_updateElevenLabsVoices,ElevenLabsModels:window.aipkit_updateElevenLabsModelsSelect,PineconeIndexes:window.aipkit_updatePineconeIndexes,QdrantCollections:window.aipkit_updateQdrantCollections,Replicate:window.aipkit_updateReplicateModels};if(typeof t[e]!="function"){console.error(`AIPKit Model Sync Init: Missing update function for provider ${e}.`),alert(`AIPKit Error: Cannot update UI for ${e}.`);return}let n="aipkit_settings_messages";document.getElementById(n)&&(window.aipkit_clearStatusMessages(n),window.aipkit_showSavingIndicator(n,!1));let s=i.querySelector(".aipkit_btn-text"),a=i.closest(".aipkit_chatbot_model_field"),c=a?a.querySelector(".aipkit_model_sync_status"):null,l=(f,_)=>{c&&(c.textContent=f||"",c.classList.remove("success","error","loading"),_&&c.classList.add(_))};l("Syncing\u2026","loading");let d=s?s.textContent:e.includes("ElevenLabs")||e.includes("Pinecone")||e.includes("Qdrant")||e.includes("Replicate")?"Sync Items":"Sync Models";s&&(s.textContent="");let u=i.querySelector(".aipkit_spinner");u||(u=document.createElement("span"),u.className="aipkit_spinner",i.appendChild(u)),u.style.display="inline-block",i.classList.add("aipkit_loading"),i.disabled=!0,window.aipkit_apiRequest("aipkit_sync_models",{provider:e}).then(f=>{t[e](f.models),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.warn("Model Sync Init: Cannot update autosave baseline.");let _="models";e==="ElevenLabs"?_="voices":e==="ElevenLabsModels"?_="synthesis models":e==="PineconeIndexes"?_="indexes":e==="QdrantCollections"&&(_="collections"),document.getElementById(n)&&window.aipkit_showMessage(n,"success",`${e.replace(/Indexes|Collections|Models/,"")} ${_} synced!`),l("Updated","success"),c&&setTimeout(()=>l("",null),2500)}).catch(f=>{document.getElementById(n)&&window.aipkit_showMessage(n,"error",`Sync failed: ${f.message}`),console.error(`AIPKit Sync Error (${e}):`,f),l("Failed","error")}).finally(()=>{i.disabled=!1,i.classList.remove("aipkit_loading");let f=i.querySelector(".aipkit_spinner");f&&(f.style.display="none"),s&&(s.textContent=d)})}function r(i){if(!i)return;let e="data-sync-listener-attached";i.getAttribute(e)||(i.addEventListener("click",function(t){let n=t.target.closest(".aipkit_sync_btn");if(!n||n.disabled)return;t.preventDefault();let s=n.getAttribute("data-provider")||"";if(!s){let a=n.closest(".aipkit_chatbot_model_field");a&&a.getAttribute("data-provider")&&(s=a.getAttribute("data-provider"))}s?p(n,s):console.warn("AIPKit Model Sync Init: Sync button missing data-provider attribute:",n)}),i.setAttribute(e,"true"))}function o(){r(document.getElementById("aipkit_module-container")),r(document.getElementById("aipkit_chatbot_main_tab_content_container"))}window.aipkit_initSyncButtons=o})();(function(){"use strict";let p=!1,r=window.aipkit_escapeHtml||(f=>f||""),o={},i={},e=100;function t(f,_){if(!f||typeof f!="string")return"";if(f.length<=_)return f;let m=f.substring(0,_-1);return m.substring(0,m.lastIndexOf(" ")).trim()+"\u2026"}function n(f){let _=document.createElement("tr");_.dataset.actionId=f.id,_.dataset.label=f.label,_.dataset.prompt=f.prompt,_.dataset.insertPosition=f.insert_position||"";let m=`
            <button type="button" class="button button-small aipkit-enhancer-edit-action-btn" aria-label="${r(i.edit_action||"Edit")}"><span class="dashicons dashicons-edit"></span></button>
            <button type="button" class="button button-small button-link-delete aipkit-enhancer-delete-action-btn" aria-label="${r(i.delete_action||"Delete")}"><span class="dashicons dashicons-trash"></span></button>
        `,g=r(f.prompt),k=`<span class="aipkit-enhancer-prompt-text">${g}</span>`;g.length>e&&(k=`
          <span class="aipkit-enhancer-prompt-text">${t(g,e)}</span>
          <button type="button" class="aipkit-enhancer-prompt-toggle">Show more</button>
      `);let w=(f.insert_position||"").trim(),h={default:i.use_default_position||"Use default",replace:i.replace_selection||"Replace selection",after:i.insert_after||"Insert after",before:i.insert_before||"Insert before"},y=w&&h[w]||h.default;return _.innerHTML=`
            <td class="aipkit-action-label-cell"><strong>${r(f.label)}</strong></td>
            <td class="aipkit-action-prompt-cell"><div class="aipkit-enhancer-prompt-text-wrapper">${k}</div></td>
            <td class="aipkit-action-position-cell"><span>${r(y)}</span></td>
            <td class="aipkit_enhancer_action_buttons">${m}</td>
        `,_}function s(f){let _=f.querySelector(".aipkit-action-label-cell"),m=f.querySelector(".aipkit-action-prompt-cell"),g=f.querySelector(".aipkit_enhancer_action_buttons"),k=f.querySelector(".aipkit-action-position-cell");if(!_||!m||!g)return;let w=f.dataset.label,h=f.dataset.prompt,y=(f.dataset.insertPosition||"").trim();_.innerHTML=`<input type="text" class="widefat" value="${r(w)}" maxlength="50">`,m.innerHTML="";let b=document.createElement("textarea");b.className="widefat",b.rows=3,b.value=h,m.appendChild(b);let v=document.createElement("select");v.className="widefat",[{value:"",label:i.use_default_position||"Use default"},{value:"replace",label:i.replace_selection||"Replace selection"},{value:"after",label:i.insert_after||"Insert after"},{value:"before",label:i.insert_before||"Insert before"}].forEach(C=>{let T=document.createElement("option");T.value=C.value,T.textContent=C.label,C.value===y&&(T.selected=!0),v.appendChild(T)}),k.innerHTML="",k.appendChild(v),g.innerHTML=`
            <button type="button" class="button button-primary button-small aipkit-enhancer-save-action-btn">${r("Save")}</button>
            <button type="button" class="button button-secondary button-small aipkit-enhancer-cancel-action-btn">${r("Cancel")}</button>
        `,f.classList.add("is-editing"),_.querySelector("input").focus()}function a(f,_){f.dataset.actionId=_.id,f.dataset.label=_.label,f.dataset.prompt=_.prompt,f.dataset.insertPosition=_.insert_position||"",f.classList.remove("is-editing");let m=n(_);f.innerHTML=m.innerHTML}function c(f){let _="aipkit_enhancer_actions_status";if(f.rows.length>=10){typeof window.aipkit_showMessage=="function"?window.aipkit_showMessage(_,"error","Maximum of 10 actions (3 default + 7 custom) reached."):alert("Maximum of 10 actions reached.");return}if(f.querySelector('tr[data-action-id^="new-"]'))return;let m=document.createElement("tr");m.dataset.actionId=`new-${Date.now()}`,m.classList.add("is-editing"),m.innerHTML=`
            <td class="aipkit-action-label-cell">
                <input type="text" class="widefat" placeholder="New Label" maxlength="50">
            </td>
            <td class="aipkit-action-prompt-cell"><textarea class="widefat" rows="3" placeholder="Enter prompt. Use %s for selected text."></textarea></td>
            <td class="aipkit-action-position-cell">
              <select class="widefat">
                <option value="">${r(i.use_default_position||"Use default")}</option>
                <option value="replace">${r(i.replace_selection||"Replace selection")}</option>
                <option value="after">${r(i.insert_after||"Insert after")}</option>
                <option value="before">${r(i.insert_before||"Insert before")}</option>
              </select>
            </td>
            <td class="aipkit_enhancer_action_buttons">
                <button type="button" class="button button-primary button-small aipkit-enhancer-save-action-btn">${r("Save")}</button>
                <button type="button" class="button button-secondary button-small aipkit-enhancer-cancel-action-btn">${r("Cancel")}</button>
            </td>
        `,f.prepend(m),m.querySelector("input").focus()}async function l(f){if(p)return;let _=f.querySelector(".aipkit-action-label-cell"),m=f.querySelector(".aipkit-action-prompt-cell"),g=_.querySelector("input"),k=m.querySelector("textarea"),w=f.querySelector(".aipkit-action-position-cell select"),h="aipkit_enhancer_actions_status";if(!g||!k)return;_.querySelectorAll(".aipkit_form-help-error").forEach(E=>E.remove()),m.querySelectorAll(".aipkit_form-help-error").forEach(E=>E.remove()),g.style.borderColor="",k.style.borderColor="";let y=g.value.trim(),b=k.value.trim(),v=w?w.value:"",S=f.dataset.actionId,C=!1;if(!y){g.style.borderColor="red";let E=document.createElement("div");E.className="aipkit_form-help aipkit_form-help-error",E.textContent="Label cannot be empty.",_.appendChild(E),C=!0}if(!b){k.style.borderColor="red";let E=document.createElement("div");E.className="aipkit_form-help aipkit_form-help-error",E.textContent="Prompt cannot be empty.",m.appendChild(E),C=!0}if(C)return;p=!0;let T=f.querySelector(".aipkit-enhancer-save-action-btn");T&&(T.textContent=i.saving_action||"Saving...",T.disabled=!0);try{let E=await window.aipkit_apiRequest("aipkit_save_enhancer_action",{id:S,label:y,prompt:b,insert_position:v,_ajax_nonce:o.nonce_manage_actions});a(f,E.action),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(h,"success",i.action_saved||"Action saved.")}catch(E){typeof window.aipkit_showMessage=="function"?window.aipkit_showMessage(h,"error",`Error: ${E.message}`):alert(`Error saving action: ${E.message}`),T&&(T.textContent="Save")}finally{T&&(T.disabled=!1),p=!1}}async function d(f){let _=f.querySelector("#aipkit_enhancer_actions_list"),m=f.querySelector("#aipkit_enhancer_actions_status");_.innerHTML=`<tr><td colspan="4" style="text-align:center;">${r(i.loading_actions||"Loading...")}</td></tr>`;try{let g=await window.aipkit_apiRequest("aipkit_get_enhancer_actions",{_ajax_nonce:o.nonce_manage_actions});_.innerHTML="",(g.actions||[]).forEach(k=>{_.appendChild(n(k))})}catch(g){m.innerHTML=`<span class="error">${r(g.message||"Failed to load actions.")}</span>`}}function u(){let f=document.getElementById("aipkit_enhancer_actions_container");if(!f||f.dataset.listenerAttached)return;f.dataset.listenerAttached="true",o=window.aipkit_post_enhancer||{},i=o.text||{};let _=f.querySelector("#aipkit_enhancer_actions_list");f.addEventListener("click",async m=>{let g=m.target.closest(".aipkit-enhancer-add-new-btn"),k=m.target.closest(".aipkit-enhancer-reset-actions-btn"),w=m.target.closest(".aipkit-enhancer-edit-action-btn"),h=m.target.closest(".aipkit-enhancer-delete-action-btn"),y=m.target.closest(".aipkit-enhancer-save-action-btn"),b=m.target.closest(".aipkit-enhancer-cancel-action-btn"),v=m.target.closest(".aipkit-enhancer-prompt-toggle");if(g)c(_);else if(k){if(!confirm(i.confirm_reset_actions||"Reset all actions to defaults?"))return;try{await window.aipkit_apiRequest("aipkit_reset_enhancer_actions",{_ajax_nonce:o.nonce_manage_actions}),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage("aipkit_enhancer_actions_status","success",i.actions_reset||"Actions reset."),d(f)}catch(S){typeof window.aipkit_showMessage=="function"?window.aipkit_showMessage("aipkit_enhancer_actions_status","error",`Error: ${S.message}`):alert(`Error: ${S.message}`)}}else if(v){let C=v.closest(".aipkit-enhancer-prompt-text-wrapper").querySelector(".aipkit-enhancer-prompt-text"),T=v.closest("tr").dataset.prompt;v.textContent.toLowerCase().includes("more")?(C.textContent=r(T),v.textContent="Show less"):(C.textContent=t(r(T),e),v.textContent="Show more")}else if(w)s(w.closest("tr"));else if(y)await l(y.closest("tr"));else if(b){let S=b.closest("tr");S.dataset.actionId.startsWith("new-")?S.remove():a(S,{id:S.dataset.actionId,label:S.dataset.label,prompt:S.dataset.prompt,is_default:!1})}else if(h){if(p)return;let S=h.closest("tr"),C=S.dataset.actionId,T="aipkit_enhancer_actions_status";if(!confirm(i.confirm_delete_action||"Are you sure you want to delete this action? This cannot be undone."))return;p=!0,h.disabled=!0;try{await window.aipkit_apiRequest("aipkit_delete_enhancer_action",{id:C,_ajax_nonce:o.nonce_manage_actions}),S.remove(),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(T,"success",i.action_deleted||"Action deleted.")}catch(E){typeof window.aipkit_showMessage=="function"?window.aipkit_showMessage(T,"error",`Error: ${E.message}`):alert(`Error deleting: ${E.message}`),h.disabled=!1}finally{p=!1}}}),f.addEventListener("keydown",m=>{if(m.key==="Enter"&&m.target.matches("input[type=text]")&&!m.target.matches("textarea")){m.preventDefault();let g=m.target.closest("tr.is-editing");g&&l(g)}}),window.aipkit_enhancer_reload_actions=()=>d(f),d(f)}window.aipkit_initEnhancerActionsUI=u})();(function(){"use strict";let p=[],r=[];function o(t){let n=document.getElementById("aipkit_semantic_search_target_id");if(!n)return;let s=n.value;n.innerHTML='<option value="">-- Select --</option>';let a=[];t==="pinecone"?a=p:t==="qdrant"&&(a=r),Array.isArray(a)&&a.forEach(c=>{let l=c.name||c.id||(typeof c=="string"?c:null);if(l){let d=document.createElement("option");d.value=l,d.textContent=l,n.appendChild(d)}}),n.querySelector(`option[value="${CSS.escape(s)}"]`)&&(n.value=s)}function i(t){let n=document.getElementById("aipkit_semantic_search_embedding_provider");if(!n||!t)return;let s=t.options[t.selectedIndex];s&&s.dataset.provider&&(n.value=s.dataset.provider)}function e(){let t=document.getElementById("aipkit_settings_container");if(!t)return;let n="data-semantic-search-listener-attached";if(t.getAttribute(n))return;let s=document.getElementById("aipkit_semantic_search_vector_provider"),a=document.getElementById("aipkit_pinecone_indexes_json_main"),c=document.getElementById("aipkit_qdrant_collections_json_main"),l=document.getElementById("aipkit_semantic_search_embedding_model");if(s){if(a&&a.dataset.indexes)try{p=JSON.parse(a.dataset.indexes)||[]}catch(d){console.error("Error parsing Pinecone indexes JSON:",d)}if(c&&c.dataset.collections)try{r=JSON.parse(c.dataset.collections)||[]}catch(d){console.error("Error parsing Qdrant collections JSON:",d)}s&&(s.addEventListener("change",d=>{if(o(d.target.value),typeof window.aipkit_handleAutoSave=="function"){let u=document.getElementById("aipkit_semantic_search_target_id");u&&(u.value=""),window.aipkit_handleAutoSave()}}),o(s.value)),l&&(l.addEventListener("change",d=>{i(d.target)}),i(l)),t.setAttribute(n,"true")}}window.aipkit_initSemanticSearchUI=e})();(function(){"use strict";function p(){let o=document.getElementById("aipkit_settings_container");if(!o)return;let i=o.querySelector("#aipkit_provider");if(!i)return;let e=i.value,t=e.toLowerCase(),n=o.querySelectorAll(".aipkit_api_key_field"),s=o.querySelectorAll(".aipkit_model_field"),a=o.querySelectorAll(".aipkit_advanced_settings_provider"),c=o.querySelector("#aipkit_safety_settings_accordion"),l=o.querySelector(".aipkit_openai_store_field"),d=o.querySelectorAll(".aipkit_param_not_openai");n.forEach(m=>m.style.display="none"),s.forEach(m=>m.style.display="none"),a.forEach(m=>m.style.display="none"),c&&(c.style.display="none"),l&&(l.style.display="none"),o.querySelectorAll(`.aipkit_api_key_field[data-provider="${e}"]`).forEach(m=>m.style.display="block"),o.querySelectorAll(`.aipkit_model_field[data-provider="${e}"]`).forEach(m=>m.style.display="block");let _=o.querySelector(`.aipkit_advanced_settings_provider[data-provider-setting="${e}"]`);_&&(_.style.display="block"),e==="Google"?c&&(c.style.display="block"):e==="OpenAI"&&l&&(l.style.display="block"),e==="OpenAI"||e==="Google"?d.forEach(m=>m.style.display="none"):d.forEach(m=>m.style.display="block")}function r(){let o=document.getElementById("aipkit_provider");if(o){let i="data-provider-listener-attached";if(o.getAttribute(i)==="true")return;o.addEventListener("change",function(){p(),typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.warn("Provider Toggle: Autosave function not found.")}),o.setAttribute(i,"true"),p()}}window.aipkit_toggleProviderFields=p,window.aipkit_initProviderSelectListener=r})();(function(){"use strict";function p(){typeof window.aipkit_initMessageCloseButtons=="function"?window.aipkit_initMessageCloseButtons("aipkit_settings_messages"):console.error("Settings Init: aipkit_initMessageCloseButtons not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_settings_container"):console.error("Settings Init: aipkit_attachRangeValueHandlers not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_settings_container"):console.error("Settings Init: aipkit_initApiKeyToggles not found."),typeof window.aipkit_initRestoreDefaultIcons=="function"?window.aipkit_initRestoreDefaultIcons("#aipkit_settings_container"):console.error("Settings Init: aipkit_initRestoreDefaultIcons not found."),typeof window.aipkit_initProviderSelectListener=="function"?window.aipkit_initProviderSelectListener():console.error("Settings Init: aipkit_initProviderSelectListener not found."),document.querySelectorAll("#aipkit_settings_container .aipkit_accordion-header").forEach(n=>{n.dataset.accordionListenerAttached!=="true"&&(n.addEventListener("click",function(){let s=this.nextElementSibling;if(s){this.classList.toggle("aipkit_active"),s.classList.toggle("aipkit_active");let a=this.closest(".aipkit_accordion");a?.id==="aipkit_safety_settings_accordion"&&document.getElementById("aipkit_provider")?.value==="Google"&&(a.style.display="block")}}),n.dataset.accordionListenerAttached="true")}),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("Settings Init: aipkit_initSyncButtons not found."),typeof window.aipkit_attachAutoSaveListeners=="function"?window.aipkit_attachAutoSaveListeners():console.error("Settings Init: aipkit_attachAutoSaveListeners not found."),typeof window.aipkit_loadTokenUsageChart=="function"?window.aipkit_loadTokenUsageChart():console.error("Settings Init: aipkit_loadTokenUsageChart function not found.");let o=document.getElementById("aipkit_elevenlabs_voice_id"),i=document.getElementById("aipkit_elevenlabs_voices_json_main");if(o&&i&&typeof window.aipkit_updateElevenLabsVoices=="function")try{let n=JSON.parse(i.dataset.voices||"[]"),s=o.value||"";window.aipkit_updateElevenLabsVoices(n,o.id)}catch(n){console.error("AIPKit Settings Init: Failed to parse initial ElevenLabs voices JSON from main settings.",n)}let e=document.getElementById("aipkit_elevenlabs_tts_model_id"),t=document.getElementById("aipkit_elevenlabs_models_json_main");if(e&&t&&typeof window.aipkit_updateElevenLabsModelsSelect=="function")try{let n=JSON.parse(t.dataset.models||"[]");window.aipkit_updateElevenLabsModelsSelect(n,e.id)}catch(n){console.error("AIPKit Settings Init: Failed to parse initial ElevenLabs models JSON from main settings.",n)}typeof window.aipkit_initEnhancerActionsUI=="function"?window.aipkit_initEnhancerActionsUI():console.error("Settings Init: aipkit_initEnhancerActionsUI not found."),typeof window.aipkit_initSemanticSearchUI=="function"?window.aipkit_initSemanticSearchUI():console.error("Settings Init: aipkit_initSemanticSearchUI not found.")}window.aipkit_initSettings=p})();(function(){"use strict";function p(r,o,i){let e=document.getElementById("aipkit_user_credits_table_body");if(!e)return;let t=wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;if(e.innerHTML="",!r||r.length===0)return;let n=window.aipkit_escapeHtml||function(s){return s};r.forEach(s=>{let a=e.insertRow();a.dataset.userId=s.id,a.insertCell().textContent=`${s.display_name} (${s.email})`;let c=a.insertCell(),l=document.createElement("input");l.type="number",l.className="aipkit_form-input aipkit_user_credits_balance_input",l.value=s.token_balance||0,l.dataset.userId=s.id,l.dataset.originalValue=s.token_balance||0,l.setAttribute("min","0"),l.setAttribute("step","1"),l.title=t("Press Enter or blur to save changes","gpt3-ai-content-generator"),c.appendChild(l);let d=document.createElement("span");d.className="aipkit_user_credits_balance_status",c.appendChild(d);let u=s.total_used_all_bots||0;a.insertCell().textContent=u.toLocaleString();let f=a.insertCell(),_=[],m=s.tokens_used||{},g=s.image_usage||{used:0},k=t("Image Generator","gpt3-ai-content-generator");g.used>0&&_.push(`<li><strong>${n(k)}:</strong> ${g.used.toLocaleString()}</li>`),Object.keys(m).length>0&&Object.keys(m).sort((x,L)=>x-L).forEach(x=>{let L=i[x]||`Bot #${x}`,A=m[x]||0;_.push(`<li><strong>${n(L)}:</strong> ${A.toLocaleString()}</li>`)});let w='<ul class="aipkit_usage_detail_list">';_.length===0?w+="<li>-</li>":_.forEach((x,L)=>{L>=2?w+=x.replace("<li",'<li class="aipkit_usage_detail_extra" style="display: none;"'):w+=x}),w+="</ul>",_.length>2&&(w+=`<button type="button" class="aipkit_btn-as-link aipkit-show-more-details-btn">${t("Show more","gpt3-ai-content-generator")}...</button>`),f.innerHTML=w;let h=a.insertCell(),y=[],b=s.last_reset||{},v=g.last_reset||0,S=t("N/A","gpt3-ai-content-generator");if(g.used>0){let M=v>0?new Date(v*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):S;y.push(`<li><strong>${n(k)}:</strong> ${M}</li>`)}let C=new Set([...Object.keys(s.tokens_used||{}),...Object.keys(s.last_reset||{})]);C.size>0&&Array.from(C).sort((x,L)=>x-L).forEach(x=>{if((s.tokens_used||{})[x]>0){let L=i[x]||`Bot #${x}`,A=(s.last_reset||{})[x]||0,I=A>0?new Date(A*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):S;y.push(`<li><strong>${n(L)}:</strong> ${I}</li>`)}});let T='<ul class="aipkit_usage_detail_list">';y.length===0?_.length>0?T+=`<li>${S}</li>`:T+="<li>-</li>":y.forEach((x,L)=>{L>=2?T+=x.replace("<li",'<li class="aipkit_usage_detail_extra" style="display: none;"'):T+=x}),T+="</ul>",y.length>2&&(T+=`<button type="button" class="aipkit_btn-as-link aipkit-show-more-details-btn">${t("Show more","gpt3-ai-content-generator")}...</button>`),h.innerHTML=T;let E=a.insertCell();if(E.className="aipkit-user-credits-actions-cell",s.purchase_history&&s.purchase_history.length>0){let M=document.createElement("button");M.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit-view-purchase-history-btn",M.title=t("View Purchase History","gpt3-ai-content-generator"),M.innerHTML='<span class="dashicons dashicons-cart"></span>',M.dataset.userId=s.id,M.dataset.userName=s.display_name,M.dataset.history=JSON.stringify(s.purchase_history),E.appendChild(M)}else E.innerHTML="\u2013"})}window.aipkit_renderUserCreditsTable=p})();(function(){"use strict";function p(r,o,i){let e=document.getElementById("aipkit_user_credits_pagination");if(!e)return;e.innerHTML="";let{total_pages:t,total_users:n}=r;if(!t||t<=0||!n||n<=0){n===0&&i!==""?e.innerHTML=`<span class="aipkit_pagination-count">${n.toLocaleString()} user(s) found for search.</span>`:n===0&&(e.innerHTML='<span class="aipkit_pagination-count">No users found.</span>');return}let s=document.createElement("span");if(s.className="aipkit_pagination-count",s.textContent=`${n.toLocaleString()} user(s)`,e.appendChild(s),t>1){let a=document.createElement("span");a.className="aipkit_pagination-links";let c=document.createElement("button");c.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",c.innerHTML="\xAB Previous",c.disabled=o<=1,c.disabled||c.addEventListener("click",u=>{u.preventDefault(),typeof window.aipkit_fetchUserCreditsData=="function"?window.aipkit_fetchUserCreditsData(o-1,i):console.error("Pagination: Fetch function not found.")}),a.appendChild(c);let l=document.createElement("span");l.className="aipkit_pagination-current",l.textContent=`Page ${o} of ${t}`,a.appendChild(l);let d=document.createElement("button");d.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",d.innerHTML="Next \xBB",d.disabled=o>=t,d.disabled||d.addEventListener("click",u=>{u.preventDefault(),typeof window.aipkit_fetchUserCreditsData=="function"?window.aipkit_fetchUserCreditsData(o+1,i):console.error("Pagination: Fetch function not found.")}),a.appendChild(d),e.appendChild(a)}}window.aipkit_renderUserCreditsPagination=p})();(function(){"use strict";function p(r,o){let i=document.getElementById("aipkit_user_credits_stats_grid");if(!i)return;let e=i.querySelector("#aipkit_stat_total_users"),t=i.querySelector("#aipkit_stat_total_tokens"),n=i.querySelector("#aipkit_stat_avg_tokens"),s=o?.total_users??0,a=o?.per_page??r.length,c=r.length,l=0;r.forEach(m=>{l+=m.total_used_all_bots||0});let d=c>0?c:1,u=Math.round(l/d);e&&(e.textContent=s.toLocaleString());let f=s>a;t&&(t.textContent=l.toLocaleString()+(f?"*":"")),n&&(n.textContent=u.toLocaleString()+(f?"*":""));let _=i.querySelector(".aipkit_stats_note");f?(_||(_=document.createElement("p"),_.className="aipkit_form-help aipkit_stats_note",_.style.gridColumn="1 / -1",_.style.textAlign="center",_.style.marginTop="-10px",_.style.marginBottom="10px",i.appendChild(_)),_.textContent="* Token stats based on currently displayed users."):_&&_.remove()}window.aipkit_updateUserCreditsStats=p})();(function(){"use strict";let p=1,r="",o={};function i(e=1,t=""){if(typeof window.aipkit_renderUserCreditsTable!="function"||typeof window.aipkit_renderUserCreditsPagination!="function"||typeof window.aipkit_updateUserCreditsStats!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit User Credits Fetch: Missing required render, pagination, stats, or API functions.");return}let n=document.getElementById("aipkit_user_credits_table_body"),s=document.getElementById("aipkit_user_credits_pagination"),a=document.querySelector("#aipkit_user_credits_table tfoot"),c=document.getElementById("aipkit_user_credits_no_results"),l=document.getElementById("aipkit_user_credits_stats_grid"),d=window.aipkit_dashboard?.text||{},u=d.userCreditsLoading||"Loading user credits...";if(n&&(n.innerHTML=`<tr><td colspan="6" style="text-align: center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> ${u}</td></tr>`),c&&(c.style.display="none"),s&&(s.innerHTML=""),a&&(a.style.display="none"),l){l.querySelectorAll(".aipkit_stat-value").forEach(m=>m.textContent="-");let _=l.querySelector(".aipkit_stats_note");_&&_.remove()}p=e,r=t;let f={page:e,search:t};window.aipkit_apiRequest("aipkit_get_user_credits_data",f).then(_=>{o=_.bot_titles||{},n&&window.aipkit_renderUserCreditsTable(_.users_data||[],d,o),s&&a&&(window.aipkit_renderUserCreditsPagination(_.pagination||{},p,r),a.style.display=_.pagination&&_.pagination.total_pages>1?"":"table-footer-group"),c&&(c.style.display=!_.users_data||_.users_data.length===0?"block":"none",c.textContent=d.userCreditsNoUsers||"No user token data found."),window.aipkit_updateUserCreditsStats(_.users_data||[],_.pagination||{})}).catch(_=>{console.error("AIPKit User Credits: Error fetching data:",_);let m=_?.message||d.userCreditsError||"Error loading user credits.",g=(d.userCreditsError||"Error loading user credits.")+` (${m})`;n&&(n.innerHTML=`<tr><td colspan="6" style="text-align: center; padding: 20px; color: red;">${g}</td></tr>`),c&&(c.textContent=g,c.style.display="block")})}window.aipkit_fetchUserCreditsData=i,window.aipkit_getCurrentCreditsPage=()=>p,window.aipkit_getCurrentCreditsSearch=()=>r})();(function(){"use strict";let p;function r(){let o=document.getElementById("aipkit_user_search"),i=document.getElementById("aipkit_user_search_btn"),e=document.getElementById("aipkit_user_reset_search_btn");if(!o||!i||!e){console.warn("AIPKit User Credits Search: Missing search elements.");return}let t=()=>{clearTimeout(p);let n=o.value.trim();p=setTimeout(()=>{typeof window.aipkit_fetchUserCreditsData=="function"?(window.aipkit_fetchUserCreditsData(1,n),e.style.display=n?"inline-block":"none"):console.error("Credits Search: Fetch function not found.")},350)};i.addEventListener("click",()=>{clearTimeout(p);let n=o.value.trim();typeof window.aipkit_fetchUserCreditsData=="function"?(window.aipkit_fetchUserCreditsData(1,n),e.style.display=n?"inline-block":"none"):console.error("Credits Search: Fetch function not found.")}),o.addEventListener("input",t),o.addEventListener("keypress",n=>{if(n.key==="Enter"){clearTimeout(p),n.preventDefault();let s=o.value.trim();typeof window.aipkit_fetchUserCreditsData=="function"?(window.aipkit_fetchUserCreditsData(1,s),e.style.display=s?"inline-block":"none"):console.error("Credits Search: Fetch function not found.")}}),e.addEventListener("click",()=>{clearTimeout(p),o.value="",typeof window.aipkit_fetchUserCreditsData=="function"?window.aipkit_fetchUserCreditsData(1,""):console.error("Credits Search: Fetch function not found."),e.style.display="none"}),e.style.display=o.value.trim()?"inline-block":"none"}window.aipkit_initUserCreditsSearch=r})();(function(){"use strict";let p;function r(t,n,s){if(!t||t.length===0)return`<p>${n("No purchase history found for this user.","gpt3-ai-content-generator")}</p>`;let a="";return t.forEach(c=>{let d=new Date(c.date.date).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}),u=(c.products||[]).map(f=>`
        <div class="aipkit_purchase_product">
          <span class="aipkit_product_name">${s(f.name)}</span>
          <span class="aipkit_product_details">
            ${f.quantity>1?`${f.quantity}x `:""}
            ${parseInt(f.tokens_per_item,10).toLocaleString()} tokens = 
            ${parseInt(f.total_tokens,10).toLocaleString()} tokens
          </span>
        </div>
      `).join("");a+=`
        <div class="aipkit_purchase_item">
          <div class="aipkit_purchase_header">
            <div class="aipkit_purchase_date"><strong>${d}</strong></div>
            <div class="aipkit_purchase_summary_info">
              <span class="aipkit_purchase_tokens">+${parseInt(c.tokens_granted,10).toLocaleString()} ${n("tokens","gpt3-ai-content-generator")}</span>
              <span class="aipkit_purchase_amount">${c.total_amount} ${c.currency}</span>
            </div>
          </div>
          <div class="aipkit_purchase_details">
            <div class="aipkit_purchase_order_info">
              <span class="aipkit_purchase_order_id">${n("Order #","gpt3-ai-content-generator")}${c.order_id}</span>
            </div>
            ${u?`<div class="aipkit_purchase_products">${u}</div>`:""}
          </div>
        </div>
      `}),a}function o(t){let n=JSON.parse(t.dataset.history),s=t.dataset.userName,a=wp.i18n&&wp.i18n.__?wp.i18n.__:_=>_,c=window.aipkit_escapeHtml||(_=>_||""),l=document.createElement("div");l.className="aipkit-modal-overlay aipkit-active";let d=r(n,a,c),u=`
          <div class="aipkit-modal-content aipkit_purchase_history_modal_content">
              <div class="aipkit-modal-header">
                  <h3 class="aipkit-modal-title">${c(a("Purchase History for","gpt3-ai-content-generator"))} ${c(s)}</h3>
                  <button class="aipkit-modal-close-btn">\xD7</button>
              </div>
              <div class="aipkit-modal-body">
                  <div class="aipkit_purchase_history_list">${d}</div>
              </div>
          </div>
      `;l.innerHTML=u,document.body.appendChild(l);let f=()=>{l.classList.remove("aipkit-active"),setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l)},200)};l.querySelector(".aipkit-modal-close-btn").addEventListener("click",f),l.addEventListener("click",_=>{_.target===l&&f()})}function i(t){let n=t.target,s=n.dataset.userId,a=n.parentElement.querySelector(".aipkit_user_credits_balance_status"),c=n.dataset.originalValue||n.defaultValue,l=n.value;if(l===c)return;a&&(a.innerHTML='<span class="aipkit_spinner" style="display:inline-block; width:14px; height:14px; border-width:2px; vertical-align:middle;"></span>');let d=document.getElementById("aipkit_user_credits_nonce_field")?.value;if(!d){console.error("User Credits Actions: Nonce field not found."),a&&(a.innerHTML="\u274C");return}let u={_ajax_nonce:d,user_id:s,balance:l};clearTimeout(p),p=setTimeout(()=>{window.aipkit_apiRequest("aipkit_admin_update_token_balance",u).then(f=>{a&&(a.innerHTML="\u2714",n.dataset.originalValue=f.new_balance),setTimeout(()=>{a&&(a.innerHTML="")},2e3)}).catch(f=>{console.error("Error updating token balance:",f),a&&(a.innerHTML="\u274C",n.value=c,setTimeout(()=>{a&&(a.innerHTML="")},4e3))})},500)}function e(){let t=document.getElementById("aipkit_refresh_credits_btn"),n=document.getElementById("aipkit_user_credits_table_body");if(t&&t.addEventListener("click",()=>{if(typeof window.aipkit_fetchUserCreditsData=="function"&&typeof window.aipkit_getCurrentCreditsPage=="function"&&typeof window.aipkit_getCurrentCreditsSearch=="function"){let s=window.aipkit_getCurrentCreditsPage(),a=window.aipkit_getCurrentCreditsSearch();window.aipkit_fetchUserCreditsData(s,a)}else console.error("Credits Actions: Fetch or state getter function not found for refresh.")}),n){let s="data-credits-action-listener-attached";n.getAttribute(s)||(n.addEventListener("change",a=>{a.target.matches(".aipkit_user_credits_balance_input")&&i(a)}),n.addEventListener("keypress",a=>{a.key==="Enter"&&a.target.matches(".aipkit_user_credits_balance_input")&&(a.preventDefault(),a.target.blur())}),n.addEventListener("click",a=>{let c=a.target.closest(".aipkit-show-more-details-btn"),l=a.target.closest(".aipkit-view-purchase-history-btn");if(c){a.preventDefault();let d=wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f,u=c.closest("td");if(u){let f=u.querySelectorAll(".aipkit_usage_detail_extra");if(f.length>0){let _=f[0].style.display==="none";f.forEach(m=>{m.style.display=_?"list-item":"none"}),c.textContent=_?d("Show less","gpt3-ai-content-generator"):d("Show more","gpt3-ai-content-generator")+"..."}}}else l&&(a.preventDefault(),o(l))}),n.setAttribute(s,"true"))}else console.warn("AIPKit Credits Actions: Table body not found for attaching delegated listeners.")}window.aipkit_initUserCreditsActions=e})();(function(){"use strict";function p(){let o=document.getElementById("aipkit_token_usage_shortcode_configurator"),i=document.getElementById("aipkit_token_usage_shortcode_snippet");if(!o||!i)return;let e=o.querySelector('input[name="cfg_show_chatbot"]').checked,t=o.querySelector('input[name="cfg_show_aiforms"]').checked,n=o.querySelector('input[name="cfg_show_imagegenerator"]').checked,s=[];e||s.push('chatbot="false"'),t||s.push('aiforms="false"'),n||s.push('imagegenerator="false"');let a="[aipkit_token_usage";s.length>0&&(a+=" "+s.join(" ")),a+="]",i.textContent=a}function r(){let o=document.querySelector(".aipkit_user_credits_shortcode_config_wrapper");if(!o)return;let i=o.querySelector("#aipkit_token_usage_shortcode_settings_toggle"),e=o.querySelector("#aipkit_token_usage_shortcode_configurator"),t=o.querySelector("#aipkit_token_usage_shortcode_snippet"),n=e.querySelectorAll(".aipkit_config_input");if(!i||!e||!t||!n.length){console.warn("User Credits Shortcode Config: Missing one or more UI elements.");return}i.dataset.listenerAttached!=="true"&&(i.addEventListener("click",s=>{s.stopPropagation();let a=e.style.display==="none"||!e.style.display;e.style.display=a?"block":"none",i.classList.toggle("aipkit_active",a),i.setAttribute("aria-expanded",a)}),document.addEventListener("click",s=>{o.contains(s.target)||(e.style.display="none",i.classList.remove("aipkit_active"),i.setAttribute("aria-expanded","false"))}),n.forEach(s=>{s.addEventListener("change",p)}),t.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(t.textContent,t):console.error("aipkit_copyShortcode function not found.")}),p(),i.dataset.listenerAttached="true")}window.aipkit_initUserCreditsShortcodeConfig=r})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_token_usage_chart_container_credits");if(!o)return;if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit User Credits Chart: Missing required API or render functions."),o.innerHTML='<p style="color:red">Error: Chart components failed to load.</p>';return}let i=o.querySelector(".aipkit_chart_loading_placeholder"),e=o.querySelector(".aipkit_chart_error_placeholder"),t=o.querySelector(".aipkit_chart_nodata_placeholder");e&&(e.style.display="none"),t&&(t.style.display="none"),i&&(i.style.display="flex");let n=[3,7,14,30,90],s=parseInt(r,10);if(!s||isNaN(s)){try{let l=localStorage.getItem("aipkit_stats_period_days"),d=parseInt(l,10);l&&!isNaN(d)&&n.includes(d)&&(s=d)}catch{}let a=document.getElementById("aipkit_credits_stats_period_select"),c=a?parseInt(a.value,10):NaN;(!s||isNaN(s))&&(s=!isNaN(c)&&n.includes(c)?c:3),a&&n.includes(s)&&String(a.value)!==String(s)&&(a.value=String(s))}window.aipkit_apiRequest("aipkit_get_token_usage_chart_data",{days:s}).then(a=>{if(i&&(i.style.display="none"),a&&a.daily_token_data){let c=a.daily_token_data;if(c&&typeof c=="object"&&Object.values(c).some(d=>d&&typeof d=="object"&&Object.values(d).some(u=>Number(u)>0)))window.aipkit_renderTokenUsageChart(o,c);else{let d=a.notice||window.aipkit_dashboard?.text?.chartNoData||"No token usage data found for the selected period.",u=a.manage_logs_url,f=e||t;if(f){f.textContent="";let _=document.createTextNode(d+" ");if(f.appendChild(_),u){let m=document.createElement("a");m.href=u,m.target="_blank",m.rel="noopener noreferrer",m.textContent=window.aipkit_dashboard?.text?.manageLogs||"Manage logs",f.appendChild(m)}f.style.display="flex"}}}else throw new Error("Invalid data received for chart.")}).catch(a=>{console.error("AIPKit User Credits Chart: Error loading data:",a),i&&(i.style.display="none"),e&&(e.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${a.message})`,e.style.display="flex")})}window.aipkit_loadUserCreditsChart=p,document.addEventListener("change",function(r){let o=r.target;if(o&&o.id==="aipkit_credits_stats_period_select"){let i=parseInt(o.value,10);try{let e=[3,7,14,30,90];!isNaN(i)&&e.includes(i)&&localStorage.setItem("aipkit_stats_period_days",String(i))}catch{}}})})();(function(){"use strict";function p(){if(typeof window.aipkit_fetchUserCreditsData=="function")window.aipkit_fetchUserCreditsData(1);else{console.error("AIPKit User Credits Init: fetchUserCreditsData function not found.");let r=document.getElementById("aipkit_user_credits_table_body");r&&(r.innerHTML='<tr><td colspan="5" style="color:red;">Error: Could not load user data script.</td></tr>')}typeof window.aipkit_initUserCreditsSearch=="function"?window.aipkit_initUserCreditsSearch():console.error("AIPKit User Credits Init: initUserCreditsSearch function not found."),typeof window.aipkit_initUserCreditsActions=="function"?window.aipkit_initUserCreditsActions():console.error("AIPKit User Credits Init: initUserCreditsActions function not found."),typeof window.aipkit_initUserCreditsShortcodeConfig=="function"?window.aipkit_initUserCreditsShortcodeConfig():console.error("AIPKit User Credits Init: initUserCreditsShortcodeConfig function not found."),typeof window.aipkit_loadUserCreditsChart=="function"?window.aipkit_loadUserCreditsChart():console.error("AIPKit User Credits Init: aipkit_loadUserCreditsChart function not found.")}window.aipkit_initUserCredits=p})();(function(){"use strict";let p=!1;function r(){let o=document.getElementById("aipkit_role_manager_container");if(!o){console.error("AIPKit Role Manager: Container #aipkit_role_manager_container not found, even on Role Manager page. Check view file.");return}let i=o.querySelector("#aipkit_save_roles_btn"),e=o.querySelector("#aipkit_role_manager_form"),t=o.querySelector("#aipkit_role_manager_messages");if(typeof window.aipkit_role_manager_config>"u"){console.error("AIPKit Role Manager Error: Configuration object (aipkit_role_manager_config) not found."),t&&(t.innerHTML='<div class="aipkit_settings_message aipkit_settings_message-error"><span class="dashicons dashicons-warning"></span> Error: Script configuration missing.</div>');return}let n=window.aipkit_role_manager_config,s=n.text||{};if(!i||!e||!t){console.warn("AIPKit Role Manager: Missing required elements (save button, form, or messages container).");return}let a="data-role-save-listener";i.getAttribute(a)||(i.addEventListener("click",function(c){if(c.preventDefault(),p)return;p=!0;let l=i.querySelector(".aipkit_btn-text"),d=i.querySelector(".aipkit_spinner");i.disabled=!0,d&&(d.style.display="inline-block"),l&&(l.textContent=s.saving||"Saving..."),t.innerHTML="",t.className="aipkit_settings_messages";let u=new FormData(e);u.append("action","aipkit_save_role_permissions"),fetch(n.ajaxurl,{method:"POST",body:u,credentials:"same-origin"}).then(f=>f.ok?f.json():f.json().then(_=>{throw new Error(_.data.message||`HTTP error! status: ${f.status}`)}).catch(()=>{throw new Error(`HTTP error! status: ${f.status}`)})).then(f=>{if(!f.success){let _=f.data&&f.data.message?f.data.message:"An unknown error occurred.";throw new Error(_)}return f.data}).then(f=>{let _=document.createElement("div");_.className="aipkit_settings_message aipkit_settings_message-success",_.innerHTML=`<span class="dashicons dashicons-yes-alt"></span> ${f.message||s.success||"Permissions saved!"}`,t.appendChild(_),setTimeout(()=>{_.remove()},4e3)}).catch(f=>{console.error("AIPKit Role Manager Save Error:",f);let _=document.createElement("div");_.className="aipkit_settings_message aipkit_settings_message-error",_.innerHTML=`<span class="dashicons dashicons-warning"></span> ${f.message||s.fail||"Failed to save permissions."}`,t.appendChild(_),setTimeout(()=>{_.remove()},6e3)}).finally(()=>{p=!1,i.disabled=!1,d&&(d.style.display="none"),l&&(l.textContent=s.saveButton||"Save Permissions")})}),i.setAttribute(a,"true"))}document.addEventListener("DOMContentLoaded",function(){new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager"&&r()}),window.aipkit_initRoleManager=r})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Chat AI Settings Toggle: Main content container not found.");return}let o="data-cb-ai-settings-toggle-listener-attached";r.getAttribute(o)||(r.addEventListener("click",function(i){let e=i.target.closest(".aipkit_cb_ai_settings_toggle");if(!e)return;let n=e.closest("form.aipkit_chatbot_settings_form")?.dataset?.botId;if(!n)return;let s=`aipkit_bot_${n}_ai_params_modal`;typeof window.aipkit_openChatbotSettingsModalById=="function"&&window.aipkit_openChatbotSettingsModalById(s);let a=document.getElementById(s),c=a?a.querySelector(".aipkit_modal_body"):null;c&&(typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(c),typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(c),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(c))}),r.setAttribute(o,"true"))}window.aipkit_initChatAiSettingsToggle=p})();(function(){"use strict";function p(o){let i=o.querySelector(".aipkit_cb_web_search_toggle");if(!i||i.style.display==="none")return;let e=o.querySelector(".aipkit_chatbot_provider_select")?.value,t;e==="OpenAI"?t=o.querySelector(".aipkit_openai_web_search_enable_toggle"):e==="Google"&&(t=o.querySelector(".aipkit_google_search_grounding_enable_toggle")),t&&i.classList.toggle("aipkit_active",t.checked)}function r(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o)return;let i="data-websearch-toggle-listener";o.getAttribute(i)||(o.addEventListener("click",function(e){let t=e.target.closest(".aipkit_cb_web_search_toggle");if(!t)return;let n=t.closest(".aipkit_chatbot-settings-area");if(!n)return;let s=n.querySelector(".aipkit_chatbot_provider_select")?.value,a;if(s==="OpenAI")a=n.querySelector(".aipkit_openai_web_search_enable_toggle");else if(s==="Google")a=n.querySelector(".aipkit_google_search_grounding_enable_toggle");else return;a&&(a.checked=!a.checked,t.classList.toggle("aipkit_active",a.checked),a.dispatchEvent(new Event("change",{bubbles:!0})))}),o.setAttribute(i,"true"))}window.aipkit_initWebSearchToggle=r,window.aipkit_setInitialWebSearchToggleState=p})();(function(){"use strict";function p(o){let i=o.querySelector(".aipkit_cb_stream_mode_toggle");if(!i)return;let e=o.querySelector(".aipkit_stream_enable_toggle");if(e){let t=e.checked;i.classList.toggle("aipkit_active",t),i.setAttribute("aria-pressed",t)}}function r(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o)return;let i="data-stream-toggle-listener";o.getAttribute(i)||(o.addEventListener("click",function(e){let t=e.target.closest(".aipkit_cb_stream_mode_toggle");if(!t)return;let n=t.closest(".aipkit_chatbot-settings-area");if(!n)return;let s=n.querySelector(".aipkit_stream_enable_toggle");s&&(s.checked=!s.checked,t.classList.toggle("aipkit_active",s.checked),t.setAttribute("aria-pressed",s.checked),s.dispatchEvent(new Event("change",{bubbles:!0})))}),o.setAttribute(i,"true"))}window.aipkit_initStreamModeToggle=r,window.aipkit_setInitialStreamToggleState=p})();(function(){"use strict";function p(o){let i=o.querySelector(".aipkit_cb_stateful_conv_toggle");if(!i)return;let e=o.querySelector(".aipkit_openai_conversation_state_enable_toggle");if(e){let t=e.checked;i.classList.toggle("aipkit_active",t),i.setAttribute("aria-pressed",t)}}function r(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o)return;let i="data-stateful-toggle-listener";o.getAttribute(i)||(o.addEventListener("click",function(e){let t=e.target.closest(".aipkit_cb_stateful_conv_toggle");if(!t)return;let n=t.closest(".aipkit_chatbot-settings-area");if(!n)return;let s=n.querySelector(".aipkit_openai_conversation_state_enable_toggle");s&&(s.checked=!s.checked,t.classList.toggle("aipkit_active",s.checked),t.setAttribute("aria-pressed",s.checked),s.dispatchEvent(new Event("change",{bubbles:!0})))}),o.setAttribute(i,"true"))}window.aipkit_initStatefulConvToggle=r,window.aipkit_setInitialStatefulConvState=p})();(function(){"use strict";function p(o){let i=o.querySelector(".aipkit_cb_image_upload_toggle");if(!i)return;let e=o.querySelector(".aipkit_image_upload_enable_toggle");if(e){let t=e.checked;i.classList.toggle("aipkit_active",t),i.setAttribute("aria-pressed",t)}}function r(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o)return;let i="data-image-upload-toggle-listener";o.getAttribute(i)||(o.addEventListener("click",function(e){let t=e.target.closest(".aipkit_cb_image_upload_toggle");if(!t)return;let n=t.closest(".aipkit_chatbot-settings-area");if(!n)return;let s=n.querySelector(".aipkit_image_upload_enable_toggle");s&&(s.checked=!s.checked,t.classList.toggle("aipkit_active",s.checked),t.setAttribute("aria-pressed",s.checked),s.dispatchEvent(new Event("change",{bubbles:!0})))}),o.setAttribute(i,"true"))}window.aipkit_initImageUploadToggle=r,window.aipkit_setInitialImageUploadToggleState=p})();(function(){"use strict";function p(o){let i=o.querySelector(".aipkit_cb_voice_input_toggle");if(!i)return;let e=o.querySelector(".aipkit_voice_input_enable_toggle");if(e){let t=e.checked;i.classList.toggle("aipkit_active",t),i.setAttribute("aria-pressed",t)}}function r(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o)return;let i="data-voice-input-toggle-listener";o.getAttribute(i)||(o.addEventListener("click",function(e){let t=e.target.closest(".aipkit_cb_voice_input_toggle");if(!t)return;let n=t.closest(".aipkit_chatbot-settings-area");if(!n)return;let s=n.querySelector(".aipkit_voice_input_enable_toggle");s&&(s.checked=!s.checked,t.classList.toggle("aipkit_active",s.checked),t.setAttribute("aria-pressed",s.checked),s.dispatchEvent(new Event("change",{bubbles:!0})))}),o.setAttribute(i,"true"))}window.aipkit_initVoiceInputToggle=r,window.aipkit_setInitialVoiceInputToggleState=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Chat Fields: Main content container (#aipkit_chatbot_main_tab_content_container) not found for delegation.");return}typeof window.aipkit_initChatAiSettingsToggle=="function"?window.aipkit_initChatAiSettingsToggle():console.error("AIPKit Chat Fields: aipkit_initChatAiSettingsToggle function not found."),typeof window.aipkit_initWebSearchToggle=="function"?window.aipkit_initWebSearchToggle():console.error("AIPKit Chat Fields: aipkit_initWebSearchToggle function not found."),typeof window.aipkit_initStreamModeToggle=="function"?window.aipkit_initStreamModeToggle():console.error("AIPKit Chat Fields: aipkit_initStreamModeToggle function not found."),typeof window.aipkit_initStatefulConvToggle=="function"?window.aipkit_initStatefulConvToggle():console.error("AIPKit Chat Fields: aipkit_initStatefulConvToggle function not found."),typeof window.aipkit_initImageUploadToggle=="function"?window.aipkit_initImageUploadToggle():console.error("AIPKit Chat Fields: aipkit_initImageUploadToggle function not found."),typeof window.aipkit_initVoiceInputToggle=="function"?window.aipkit_initVoiceInputToggle():console.error("AIPKit Chat Fields: aipkit_initVoiceInputToggle function not found."),r.addEventListener("change",function(i){let e=i.target,t=e.closest(".aipkit_chatbot-settings-area");if(!t)return;if(e.matches(".aipkit_chatbot_provider_select")){window.aipkit_toggleChatbotModelFields(t),window.aipkit_toggleOpenAISpecificSettingsVisibility(t),window.aipkit_toggleGoogleSpecificSettingsVisibility(t);return}if(e.matches('select[name$="_model"]')||e.matches('select[name$="_deployment"]')){typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(t);return}let n=e.closest(".aipkit_stt_provider_select");if(n){let _=n.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");_?window.aipkit_toggleSttModelFields(_):console.warn("AIPKit Chat Fields: Could not find parent settings area for STT provider select:",n);return}let s=e.closest(".aipkit_vector_store_toggle_switch");if(s){let _=s.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");if(_){window.aipkit_toggleVectorStoreSettingsVisibility(_),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(_);let m=_.querySelector('.aipkit_feature_config_btn[data-feature="vector_store"]');m&&(m.disabled=!s.checked,m.title=s.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let a=e.closest(".aipkit_vector_store_provider_select");if(a){let _=a.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");_&&window.aipkit_toggleVectorStoreProviderFields(_);return}let c=e.closest(".aipkit_vector_embedding_provider_select");if(c){let _=c.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");_&&window.aipkit_populateVectorEmbeddingModelSelect(_);return}let l=e.closest(".aipkit_openai_web_search_enable_toggle");if(l){let _=l.closest(".aipkit_chatbot-settings-area");if(_){window.aipkit_toggleOpenAIWebSearchSubSettings(_);let m=_.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');m&&(m.disabled=!l.checked)}return}let d=e.closest(".aipkit_openai_web_search_loc_type_select");if(d){let _=d.closest(".aipkit_chatbot-settings-area");_&&window.aipkit_toggleOpenAIWebSearchLocationDetails(_);return}let u=e.closest(".aipkit_google_search_grounding_enable_toggle");if(u){let _=u.closest(".aipkit_chatbot-settings-area");if(_){window.aipkit_toggleGoogleSearchGroundingSubSettings(_);let m=_.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');m&&(m.disabled=!u.checked)}return}let f=e.closest(".aipkit_google_grounding_mode_select");if(f){let _=f.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");_&&window.aipkit_toggleGoogleGroundingDynamicThreshold(_);return}}),r.querySelectorAll(".aipkit_chatbot-settings-area").forEach(i=>{i.querySelector(".aipkit_chatbot_provider_select")&&(window.aipkit_toggleChatbotModelFields(i),window.aipkit_toggleOpenAISpecificSettingsVisibility(i),window.aipkit_toggleGoogleSpecificSettingsVisibility(i)),i.querySelector(".aipkit_stt_provider_select")&&window.aipkit_toggleSttModelFields(i),i.querySelector(".aipkit_vector_store_toggle_switch")&&(window.aipkit_toggleVectorStoreSettingsVisibility(i),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(i));let e=i.querySelector(".aipkit_openai_web_search_enable_toggle"),t=i.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');t&&e&&(t.disabled=!e.checked,t.title=e.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure");let n=i.querySelector(".aipkit_google_search_grounding_enable_toggle"),s=i.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');s&&n&&(s.disabled=!n.checked,s.title=n.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")})}window.aipkit_initProviderSelectToggles=p})();(function(){"use strict";function p(r){if(!r){console.warn("AIPKit Chat Fields: No settings area provided to toggle model fields.");return}let o=r.querySelector(".aipkit_chatbot_provider_select");if(!o){console.warn("AIPKit Chat Fields: Provider select not found in the given settings area.");return}let i=o.value,e=["OpenAI","OpenRouter","Google","Azure","DeepSeek","Ollama"];r.querySelectorAll(".aipkit_chatbot_model_field").forEach(s=>{s.style.display="none";let a=s.querySelector(".aipkit_cb_web_search_toggle");a&&(a.style.display="none");let c=s.querySelector(".aipkit_cb_stateful_conv_toggle");c&&(c.style.display="none");let l=s.querySelector(".aipkit_cb_image_upload_toggle");l&&(l.style.display="none");let d=s.querySelector(".aipkit_cb_voice_input_toggle");d&&(d.style.display="none")});let n=r.querySelector(`.aipkit_chatbot_model_field[data-provider="${i}"]`);if(n){n.style.display="block",r.querySelectorAll(".aipkit_feature_toggle_item").forEach(u=>{let f=(u.dataset.providers||"").trim();if(!f||f==="*"){u.style.display="";return}let _=f.split(/\s+/);u.style.display=_.includes(i)?"":"none"}),typeof window.aipkit_setInitialStreamToggleState=="function"&&window.aipkit_setInitialStreamToggleState(r),typeof window.aipkit_setInitialStatefulConvState=="function"&&window.aipkit_setInitialStatefulConvState(r);let a=n.querySelector(".aipkit_cb_web_search_toggle");a&&(a.dataset.provider||"").split(" ").includes(i)&&(a.style.display="inline-flex",typeof window.aipkit_setInitialWebSearchToggleState=="function"&&window.aipkit_setInitialWebSearchToggleState(r));let c=n.querySelector(".aipkit_cb_stateful_conv_toggle");c&&i==="OpenAI"&&(c.style.display="inline-flex");let l=n.querySelector(".aipkit_cb_image_upload_toggle");l&&(i==="OpenAI"?(l.style.display="inline-flex",typeof window.aipkit_setInitialImageUploadToggleState=="function"&&window.aipkit_setInitialImageUploadToggleState(r)):l.style.display="none");let d=n.querySelector(".aipkit_cb_voice_input_toggle");d&&(d.style.display="inline-flex",typeof window.aipkit_setInitialVoiceInputToggleState=="function"&&window.aipkit_setInitialVoiceInputToggleState(r)),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(r)}}window.aipkit_toggleChatbotModelFields=p})();(function(){"use strict";function p(r){r&&typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(r)}window.aipkit_toggleOpenAISpecificSettingsVisibility=p})();(function(){"use strict";function p(r){if(!r)return;let o=r.querySelector(".aipkit_chatbot_provider_select");o||(o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let i=o?.value==="OpenAI",e=r.querySelector(".aipkit_openai_web_search_enable_toggle");e||(e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let t=r.querySelector(".aipkit_openai_web_search_conditional_settings");if(!e||!t)return;let n=e.checked;if(t.style.display=i&&n?"block":"none",i&&n)typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(r);else{let s=r.querySelector(".aipkit_openai_web_search_location_details");s&&(s.style.display="none")}}window.aipkit_toggleOpenAIWebSearchSubSettings=p})();(function(){"use strict";function p(r){if(!r)return;let o=r.querySelector(".aipkit_openai_web_search_enable_toggle");o||(o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let i=r.querySelector(".aipkit_openai_web_search_loc_type_select"),e=r.querySelector(".aipkit_openai_web_search_location_details");if(!i||!e){e&&(e.style.display="none");return}let t=o?o.checked:!1,n=(i.value||"")==="approximate";e.style.display=t&&n?"block":"none"}window.aipkit_toggleOpenAIWebSearchLocationDetails=p})();(function(){"use strict";function p(r){r&&typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(r)}window.aipkit_toggleGoogleSpecificSettingsVisibility=p})();(function(){"use strict";function p(r){if(!r)return;let o=r.querySelector(".aipkit_chatbot_provider_select");o||(o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let i=o?.value==="Google",e=r.querySelector(".aipkit_google_search_grounding_enable_toggle");e||(e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let t=r.querySelector(".aipkit_google_search_grounding_conditional_settings");if(!e||!t)return;let n=e.checked,s=i&&n;t.style.display=s?"block":"none",s?typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(r):typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(r,!1)}window.aipkit_toggleGoogleSearchGroundingSubSettings=p})();(function(){"use strict";function p(r,o=null){if(!r)return;let i=r.querySelector(".aipkit_google_grounding_mode_select"),e=r.querySelector(".aipkit_google_grounding_dynamic_threshold_container"),t=r.querySelector(".aipkit_google_search_grounding_enable_toggle");t||(t=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let n=r.querySelector(".aipkit_google_search_grounding_conditional_settings"),s=n&&n.style.display==="none";if(!i||!e||!t){e&&(e.style.display="none");return}if(s){e.style.display="none";return}let a=o!==null?o:t.checked&&i.value==="MODE_DYNAMIC";e.style.display=a?"block":"none"}window.aipkit_toggleGoogleGroundingDynamicThreshold=p})();(function(){"use strict";function p(r){if(!r)return;let o=r.querySelector(".aipkit_stt_provider_select");if(!o)return;let i=o.value;r.querySelectorAll(".aipkit_stt_model_field").forEach(t=>{t.style.display=t.getAttribute("data-stt-provider")===i?"block":"none"})}window.aipkit_toggleSttModelFields=p})();(function(){"use strict";function p(r){if(!r)return;let o=r.querySelector(".aipkit_vector_store_toggle_switch"),i=r.querySelector(".aipkit_vector_store_settings_conditional_row"),e=r.querySelector(".aipkit_vector_store_top_k_field"),t=r.querySelector(".aipkit_vector_store_confidence_field");if(!o||!i)return;let n=o.checked;i.style.display=n?"block":"none",e&&(e.style.display=n?"block":"none"),t&&(t.style.display=n?"block":"none"),n?typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(r):r.querySelectorAll(".aipkit_vector_store_openai_field, .aipkit_vector_store_pinecone_field, .aipkit_vector_store_qdrant_field, .aipkit_vector_store_embedding_config_row").forEach(s=>s.style.display="none")}window.aipkit_toggleVectorStoreSettingsVisibility=p})();(function(){"use strict";function p(r){if(!r)return;let o=r.querySelector(".aipkit_vector_store_provider_select"),i=r.querySelector(".aipkit_vector_store_toggle_switch");if(!o||!i)return;let e=o.value,t=i.checked,n=r.querySelector(".aipkit_vector_store_openai_field"),s=r.querySelector(".aipkit_vector_store_pinecone_field"),a=r.querySelector(".aipkit_vector_store_qdrant_field"),c=r.querySelector(".aipkit_vector_store_embedding_config_row"),l=r.querySelector(".aipkit_vector_store_top_k_field");n&&(n.style.display=t&&e==="openai"?"block":"none"),s&&(s.style.display=t&&e==="pinecone"?"block":"none"),a&&(a.style.display=t&&e==="qdrant"?"block":"none"),c&&(c.style.display=t&&(e==="pinecone"||e==="qdrant")?"block":"none"),l&&(l.style.display=t?"block":"none"),t&&e==="openai"?typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"&&window.aipkit_populateOpenAIVectorStoresMultiSelect(r):t&&e==="pinecone"&&(typeof window.aipkit_populatePineconeIndexSelect=="function"&&window.aipkit_populatePineconeIndexSelect(r),typeof window.aipkit_populateVectorEmbeddingProviderSelect=="function"&&window.aipkit_populateVectorEmbeddingProviderSelect(r),typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(r))}window.aipkit_toggleVectorStoreProviderFields=p})();(function(){"use strict";function p(r){let o=r.querySelector('select[name="openai_vector_store_ids[]"]'),i=window.aipkit_escapeHtml||function(n){return n};if(!o)return;let e=window.aipkit_chat_config?.openaiVectorStores||[],t=Array.from(o.options).filter(n=>n.selected).map(n=>n.value);o.innerHTML="",e.length>0&&e.forEach(n=>{if(n&&n.id){let s="(Files: N/A)";n.file_counts&&typeof n.file_counts.total=="number"?s=`(${n.file_counts.total} ${n.file_counts.total===1?"File":"Files"})`:n.file_counts&&(s="(Files: ?)");let a=`${i(n.name||n.id)} ${s}`,c=document.createElement("option");c.value=n.id,c.textContent=a+` (ID: ${i(n.id.substring(0,15))}...)`,t.includes(n.id)&&(c.selected=!0),o.appendChild(c)}}),t.forEach(n=>{if(!e.some(a=>a.id===n)&&!o.querySelector(`option[value="${CSS.escape(n)}"]`)){let a=document.createElement("option");a.value=n,a.textContent=`${i(n)} (Manual/Not Synced)`,a.selected=!0,o.appendChild(a)}}),o.options.length===0&&(o.innerHTML='<option value="" disabled>-- No Stores Found (Sync in AI Training) --</option>')}window.aipkit_populateOpenAIVectorStoresMultiSelect=p})();(function(){"use strict";function p(r){let o=r.querySelector('select[name="pinecone_index_name"]'),i=window.aipkit_escapeHtml||function(n){return n};if(!o)return;let e=window.aipkit_chat_config?.pineconeIndexes||[],t=o.value;if(o.innerHTML="",o.appendChild(new Option(i("-- Select Index --"),"")),e.length>0&&e.forEach(n=>{let s=n.name||n.id||"",a=n.name||s,c=n.total_vector_count!==void 0&&n.total_vector_count!==null&&n.total_vector_count!=="Error"&&n.total_vector_count!=="No Host"?` (Vectors: ${Number(n.total_vector_count).toLocaleString()})`:(n.total_vector_count||"")==="Error"||(n.total_vector_count||"")==="No Host"?" (Stats Err)":" (Vectors: ?)",l=i(a+c),d=new Option(l,s);s===t&&(d.selected=!0),o.appendChild(d)}),t&&!o.querySelector(`option[value="${CSS.escape(t)}"]`)){let n=new Option(i(t)+" (Manual/Not Synced)",t,!1,!0);o.appendChild(n),o.value=t}o.options.length<=1&&(o.innerHTML='<option value="" disabled>-- No Indexes Found (Sync in AI Settings) --</option>')}window.aipkit_populatePineconeIndexSelect=p})();(function(){"use strict";function p(r){let o=r.querySelector('select[name="vector_embedding_provider"]');o&&(o.value===""&&(o.value="openai"),o.dispatchEvent(new Event("change")))}window.aipkit_populateVectorEmbeddingProviderSelect=p})();(function(){"use strict";function p(r){let o=r.querySelector('select[name="vector_embedding_provider"]'),i=r.querySelector('select[name="vector_embedding_model"]'),e=window.aipkit_escapeHtml||function(a){return a};if(!o||!i)return;let t=o.value,n=i.value;i.innerHTML="",i.appendChild(new Option(e("-- Select Model --"),""));let s=[];if(t==="openai"&&window.aipkit_chat_config?.openaiEmbeddingModels?s=window.aipkit_chat_config.openaiEmbeddingModels:t==="google"&&window.aipkit_chat_config?.googleEmbeddingModels?s=window.aipkit_chat_config.googleEmbeddingModels:t==="azure"&&window.aipkit_chat_config?.azureEmbeddingModels&&(s=window.aipkit_chat_config.azureEmbeddingModels),s.length>0&&s.forEach(a=>{if(a&&a.id){let c=new Option(e(a.name||a.id),a.id);a.id===n&&(c.selected=!0),i.appendChild(c)}}),n&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let a=new Option(e(n)+" (Manual/Not Synced)",n,!1,!0);i.appendChild(a),i.value=n}i.options.length<=1&&(i.innerHTML='<option value="" disabled>-- Select Provider or Sync Models --</option>')}window.aipkit_populateVectorEmbeddingModelSelect=p})();(function(){"use strict";function p(r){if(!r)return;let o=r.querySelector(".aipkit_vector_store_toggle_switch"),i=r.querySelector('input[name="enable_file_upload"].aipkit_file_upload_toggle_switch'),e=r.querySelector(".aipkit_file_upload_field_group");if(!o||!i||!e)return;let t=o.checked,n=i.dataset.isProPlan==="true",s=i.dataset.addonActive==="true",c=n&&s&&t,l="";n?s?t||(l='File upload requires "Enable Vector Store" to be active for this bot.'):l='The "File Upload" addon is not active. Please activate it in Add-ons.':l="File upload is a Pro feature. Please upgrade.",c?(i.disabled=!1,e.classList.remove("aipkit_dimmed_row"),e.style&&(e.style.opacity=""),e.removeAttribute("title")):(i.checked&&(i.checked=!1,i.dispatchEvent(new Event("change",{bubbles:!0}))),i.disabled=!0,e.classList.add("aipkit_dimmed_row"),e.style&&e.style.opacity&&(e.style.opacity=""),e.setAttribute("title",l))}window.aipkit_toggleFileUploadAvailability=p})();(function(){"use strict";function p(o){if(!o)return;let i=o.querySelector('select[name="theme"]'),e=o.querySelector('input[name="theme"]:checked'),t=()=>i?i.value:e?e.value:"",n=o.querySelector(".aipkit_open_custom_theme_modal_btn"),s=t()==="custom";n&&(n.style.display=s?"inline-flex":"none")}function r(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o){console.warn("AIPKit Theme Toggle: Main content container not found.");return}o.dataset.themeSettingsListenerAttached||(o.addEventListener("click",function(i){i.target.closest(".aipkit_reset_custom_theme_btn")&&(typeof window.aipkit_handleResetCustomTheme=="function"?window.aipkit_handleResetCustomTheme(i):console.error("AIPKit Theme Toggle: aipkit_handleResetCustomTheme function not found."))}),o.addEventListener("change",function(i){let e=i.target;if(e.matches&&e.matches('select[name="theme"]')||e.matches&&e.matches('input[name="theme"]')){let t=e.closest(".aipkit_chatbot-settings-area");if(t){p(t);let n=t.querySelector(".aipkit_open_custom_theme_modal_btn");if(n&&e.value==="custom"&&typeof window.aipkit_openChatbotSettingsModalById=="function"){let s=n.getAttribute("data-modal-target");s&&window.aipkit_openChatbotSettingsModalById(s)}}}}),o.dataset.themeSettingsListenerAttached="true"),document.documentElement.dataset.aipkitResetListenerAttached||(document.addEventListener("click",function(i){i.target.closest(".aipkit_chatbot_settings_modal .aipkit_reset_custom_theme_btn")&&typeof window.aipkit_handleResetCustomTheme=="function"&&window.aipkit_handleResetCustomTheme(i)}),document.documentElement.dataset.aipkitResetListenerAttached="true"),o.querySelectorAll(".aipkit_chatbot-settings-area").forEach(i=>{p(i)})}window.aipkit_initChatThemeSettingsToggle=r})();(function(){"use strict";let p=0;function r(s){return p+=1,`${s||"aipkit_modal_"}${Date.now()}_${p}`}function o(s){let a=document.getElementById(s);if(a){try{a.__aipkitOpenerEl=document.activeElement instanceof HTMLElement?document.activeElement:null}catch{}a.parentElement!==document.body&&document.body.appendChild(a),a.classList.add("aipkit_active"),a.style.display="flex",a.setAttribute("aria-hidden","false");try{let c=window.innerWidth-document.documentElement.clientWidth;c>0&&(document.body.style.setProperty("--aipkit-scrollbar-width",c+"px"),document.body.classList.contains("aipkit_modal_open")||(document.body.style.paddingRight=c+"px"))}catch{}document.body.classList.add("aipkit_modal_open");try{let c=a.querySelector(".aipkit_modal");c&&(c.hasAttribute("tabindex")||c.setAttribute("tabindex","-1"),c.focus({preventScroll:!0}))}catch{}try{let c=document.getElementById("aipkit_chatbot_main_tab_content_container");c&&c.setAttribute("inert","")}catch{}typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${s}`);try{typeof window.aipkit_toggleVectorStoreSettingsVisibility=="function"&&window.aipkit_toggleVectorStoreSettingsVisibility(a),typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(a)}catch{}try{let c=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form"),l=c?c.querySelector(".aipkit_chatbot_provider_select"):null,d=l?l.value:"",u=a.querySelector(".aipkit_web_modal_section_openai"),f=a.querySelector(".aipkit_web_modal_section_google");u&&u.classList.remove("aipkit_hidden"),f&&f.classList.remove("aipkit_hidden"),d==="OpenAI"?(u&&(u.style.display=""),f&&(f.style.display="none")):d==="Google"?(f&&(f.style.display=""),u&&(u.style.display="none")):(u&&(u.style.display="none"),f&&(f.style.display="none"));let _=a.querySelector(".aipkit_stateful_convo_checkbox");if(_){_.disabled=d!=="OpenAI";let g=_.closest(".aipkit_stateful_convo_group");g&&(d!=="OpenAI"?(g.setAttribute("title",window.aipkit_dashboard?.text?.openaiOnly||"Available for OpenAI only"),g.style.opacity="0.6"):(g.removeAttribute("title"),g.style.opacity=""))}try{let g=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form"),k=g?g.querySelector(".aipkit_chatbot_provider_select"):null,w=g?g.querySelector('.aipkit_chatbot_model_field[data-provider="OpenAI"] select'):null,h=k?k.value:"",y=w?(w.value||"").toLowerCase():"",b=y.startsWith("o1")||y.startsWith("o3")||y.startsWith("o4"),v=y.includes("gpt-5"),S=h==="OpenAI"&&(b||v),C=a.querySelector(".aipkit_reasoning_effort_field");if(C){C.classList.remove("aipkit_hidden");let T=C.closest('section[data-section="reasoning"], .aipkit_reasoning_section');T&&T.classList.remove("aipkit_hidden");let E=C.querySelector('select[name="reasoning_effort"]');E&&(E.disabled=!S),C.style.opacity=S?"":"0.6",C.setAttribute("title",S?"":window.aipkit_dashboard?.text?.openaiOnly||"Available for OpenAI reasoning models only")}}catch{}let m=a.querySelector(".aipkit_image_analysis_checkbox");if(m){m.disabled=d!=="OpenAI";let g=m.closest(".aipkit_image_analysis_group");g&&(d!=="OpenAI"?(g.setAttribute("title",window.aipkit_dashboard?.text?.openaiOnly||"Available for OpenAI only"),g.style.opacity="0.6"):(g.removeAttribute("title"),g.style.opacity=""))}}catch{}try{let c=a.querySelector(".aipkit_openai_web_search_conditional_settings"),l=a.querySelector(".aipkit_openai_web_search_location_details");c&&c.classList.remove("aipkit_hidden"),l&&l.classList.remove("aipkit_hidden"),typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(a),typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(a),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(a)}catch{}try{let c=a.querySelector(".aipkit_google_search_grounding_conditional_settings");c&&c.classList.remove("aipkit_hidden");let l=a.querySelector(".aipkit_google_grounding_dynamic_threshold_container");l&&l.classList.remove("aipkit_hidden"),typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(a),typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(a)}catch{}try{let c=a.querySelector('select[name="popup_icon_type"]');if(c&&typeof window.aipkit_togglePopupIconValueInputs=="function")window.aipkit_togglePopupIconValueInputs(a,c.value);else{let d=a.querySelector('input[name="popup_icon_type"]:checked');d&&typeof window.aipkit_togglePopupIconValueInputs=="function"&&window.aipkit_togglePopupIconValueInputs(a,d.value)}let l=a.querySelector(".aipkit_popup_hint_toggle_switch");l&&typeof window.aipkit_togglePopupHintSettingsVisibility=="function"&&window.aipkit_togglePopupHintSettingsVisibility(a,l.checked)}catch{}try{let c=a.querySelector(".aipkit_starters_conditional_row");if(c){let l=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_starters_toggle_switch"),d=l?l.checked:!0;c.style.display=d?"block":"none"}}catch{}try{typeof window.aipkit_toggleSttModelFields=="function"&&a.querySelector(".aipkit_stt_provider_select")&&window.aipkit_toggleSttModelFields(a);let c=a.querySelector(".aipkit_voice_input_toggle_switch"),l=a.querySelector(".aipkit_stt_provider_conditional_row");l&&c&&(l.style.display=c.checked?"contents":"none")}catch{}try{a.querySelectorAll('.aipkit_accordion[data-section="tts-settings"] .aipkit_accordion-content').forEach(l=>{let d=l.querySelector(".aipkit_tts_toggle_switch"),u=l.querySelector(".aipkit_tts_conditional_settings"),f=l.querySelector(".aipkit_tts_auto_play_container");u&&d&&(u.style.display=d.checked?"block":"none"),f&&d&&(f.style.display=d.checked?"block":"none");let _=l.querySelector(".aipkit_tts_provider_select");if(_){let h=_.value;if(l.querySelectorAll(".aipkit_tts_provider_settings").forEach(y=>{y.style.display=y.getAttribute("data-provider")===h?"block":"none"}),h==="OpenAI"){let y=l.querySelector('.aipkit_tts_provider_settings[data-provider="OpenAI"] .aipkit_form-group:has(select[name="tts_openai_model_id"])');y&&(y.style.display="block")}}let m=l.querySelector('select[name="tts_openai_model_id"]');m&&m.options.length<=1&&(m.innerHTML='<option value="">(Sync models in Main Settings)</option>');let g=l.querySelector('select[name="tts_google_voice_id"]');g&&g.options.length<=1&&(g.innerHTML='<option value="">(Sync in Main Settings)</option>');let k=l.querySelector('select[name="tts_elevenlabs_model_id"]');k&&k.options.length<=1&&(k.innerHTML='<option value="">(Sync in Main Settings)</option>');let w=l.querySelector('select[name="tts_elevenlabs_voice_id"]');w&&w.options.length<=1&&(w.innerHTML='<option value="">(Sync in Main Settings)</option>')})}catch{}try{let c=a.querySelector(".aipkit_tts_toggle_switch");if(c){let d=a.querySelector(".aipkit_tts_conditional_settings"),u=a.querySelector(".aipkit_tts_auto_play_container");d&&(d.style.display=c.checked?"block":"none"),u&&(u.style.display=c.checked?"block":"none")}let l=a.querySelector(".aipkit_tts_provider_select");if(l){let d=l.value;a.querySelectorAll(".aipkit_tts_provider_settings").forEach(u=>{u.style.display=u.getAttribute("data-provider")===d?"block":"none"}),a.querySelectorAll(".aipkit_tts_field").forEach(u=>{u.style.display=u.getAttribute("data-provider")===d?"block":"none"})}}catch{}try{let c=a.querySelector(".aipkit_enable_realtime_voice_toggle"),l=a.querySelector(".aipkit_realtime_voice_settings_container"),d=l&&l.getAttribute("data-force-visible")==="1";if(l){let u=d||c&&c.checked;l.style.display=u?"block":"none"}a.querySelectorAll(".aipkit_rt_dependent").forEach(u=>{let f=d||c&&c.checked;u.style.display=f?"":"none"})}catch{}}}function i(s){if(s){try{let a=document.getElementById("aipkit_chatbot_main_tab_content_container");a&&a.removeAttribute("inert")}catch{}try{let a=null;if(s.__aipkitOpenerEl&&document.contains(s.__aipkitOpenerEl)&&(a=s.__aipkitOpenerEl),a||(a=document.querySelector(`[data-modal-target="${s.id}"]`)),a&&typeof a.focus=="function")try{a.focus({preventScroll:!0})}catch{a.focus()}else{let l=(document.getElementById("aipkit_chatbot_main_tab_content_container")||document.body).querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(l&&typeof l.focus=="function")try{l.focus({preventScroll:!0})}catch{l.focus()}}}catch{}s.classList.remove("aipkit_active"),s.style.display="none",s.setAttribute("aria-hidden","true"),document.body.classList.remove("aipkit_modal_open");try{document.body.style.removeProperty("--aipkit-scrollbar-width"),document.body.style.paddingRight=""}catch{}try{s.__aipkitOpenerEl=null}catch{}}}function e(s){let a=s&&s.id||r("aipkit_chatmodal_"),c=document.getElementById(a);c||(c=document.createElement("div"),c.id=a,c.className="aipkit_chatbot_settings_modal",c.setAttribute("aria-hidden","true"),c.style.display="none",c.innerHTML=`
        <div class="aipkit_modal_backdrop"></div>
        <div class="aipkit_modal" role="dialog" aria-modal="true" aria-labelledby="${a}_title">
          <div class="aipkit_modal_header">
            <h4 id="${a}_title" class="aipkit_modal_title"></h4>
            <button type="button" class="aipkit_modal_close" aria-label="Close">&times;</button>
          </div>
          <div class="aipkit_modal_body"></div>
          <div class="aipkit_modal_footer"></div>
        </div>`,document.body.appendChild(c));let l=c.querySelector(".aipkit_modal_title");l&&(l.textContent=s&&s.title||"");let d=c.querySelector(".aipkit_modal_body");d&&(s&&s.bodyNode instanceof HTMLElement?(d.innerHTML="",d.appendChild(s.bodyNode)):s&&typeof s.bodyHTML=="string"?d.innerHTML=s.bodyHTML:d.innerHTML);let u=c.querySelector(".aipkit_modal_footer");if(u&&(u.innerHTML="",(s&&Array.isArray(s.footerButtons)?s.footerButtons:[]).forEach(_=>{let m=document.createElement("button"),g=_.variant||"secondary";m.type="button",m.className=`aipkit_btn aipkit_btn-${g}`+(_.className?` ${_.className}`:""),_.attrs&&typeof _.attrs=="object"&&Object.entries(_.attrs).forEach(([k,w])=>{w!=null&&m.setAttribute(k,String(w))}),m.textContent=_.label||"Action",typeof _.onClick=="function"&&m.addEventListener("click",k=>_.onClick(k,{modal:c})),u.appendChild(m)}),!(s&&s.hideDefaultClose))){let _=document.createElement("button");_.type="button",_.className="aipkit_btn aipkit_btn-secondary aipkit_modal_close_btn",_.textContent=s&&s.closeLabel||"Close",u.appendChild(_)}return c.parentElement!==document.body&&document.body.appendChild(c),c}function t(s){let a=e(s||{});return o(a.id),a}function n(){let s=document.getElementById("aipkit_chatbot_main_tab_content_container");s&&(s.querySelectorAll(".aipkit_chatbot_settings_modal").forEach(a=>{a.parentElement!==document.body&&document.body.appendChild(a)}),s.addEventListener("click",function(a){let c=a.target.closest("[data-modal-target], .aipkit_open_custom_theme_modal_btn");if(!c)return;let l=c.getAttribute("data-modal-target");l&&(o(l),a.preventDefault())}),document.addEventListener("click",function(a){let c=a.target.closest(".aipkit_chatbot_settings_modal .aipkit_modal_close, .aipkit_chatbot_settings_modal .aipkit_modal_close_btn");if(c){let d=c.closest(".aipkit_chatbot_settings_modal");d&&i(d)}let l=a.target.closest(".aipkit_chatbot_settings_modal .aipkit_sync_tts_voices_btn");l&&l.getAttribute("data-provider")==="Google"&&typeof window.aipkit_handleSyncGoogleVoices=="function"&&window.aipkit_handleSyncGoogleVoices(l)}),document.addEventListener("change",function(a){let c=a.target.closest(".aipkit_chatbot_settings_modal");if(!c)return;let l=c.querySelector(".aipkit_modal_body")||c;a.target.closest(".aipkit_openai_web_search_loc_type_select")&&typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(l),a.target.closest(".aipkit_google_grounding_mode_select")&&typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(l),a.target.closest(".aipkit_vector_store_provider_select")&&typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(l),a.target.closest(".aipkit_vector_embedding_provider_select")&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(l);let d=a.target.closest(".aipkit_chatbot_settings_modal .aipkit_vector_store_toggle_switch");if(d){let v=d.closest(".aipkit_chatbot_settings_modal");v&&typeof window.aipkit_toggleVectorStoreSettingsVisibility=="function"&&window.aipkit_toggleVectorStoreSettingsVisibility(v),v&&typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(v)}let u=a.target.closest('select[name="popup_icon_type"]');if(u&&typeof window.aipkit_togglePopupIconValueInputs=="function")window.aipkit_togglePopupIconValueInputs(l,u.value);else{let v=a.target.closest('input[name="popup_icon_type"]');v&&typeof window.aipkit_togglePopupIconValueInputs=="function"&&window.aipkit_togglePopupIconValueInputs(l,v.value)}let f=a.target.closest(".aipkit_popup_hint_toggle_switch");f&&typeof window.aipkit_togglePopupHintSettingsVisibility=="function"&&window.aipkit_togglePopupHintSettingsVisibility(l,f.checked);let _=a.target.closest(".aipkit_token_limit_mode_select");if(_){let v=l.querySelector(".aipkit_token_general_user_limit_field"),S=l.querySelector(".aipkit_token_role_limits_container");if(v&&S){let C=_.value;v.style.display=C==="general"?"block":"none",S.style.display=C==="role_based"?"block":"none"}}let m=a.target.closest(".aipkit_chatbot_settings_modal .aipkit_stt_provider_select");if(m){let v=m.closest(".aipkit_chatbot_settings_modal");v&&typeof window.aipkit_toggleSttModelFields=="function"&&window.aipkit_toggleSttModelFields(v)}let g=a.target.closest(".aipkit_chatbot_settings_modal .aipkit_voice_input_toggle_switch");if(g){let v=g.closest(".aipkit_chatbot_settings_modal");if(v){let S=v.querySelector(".aipkit_stt_provider_conditional_row");S&&(S.style.display=g.checked?"contents":"none")}}let k=a.target.closest(".aipkit_chatbot_settings_modal .aipkit_tts_toggle_switch");if(k){let v=k.closest(".aipkit_accordion-content")||k.closest(".aipkit_chatbot_settings_modal");if(v){let S=v.querySelector(".aipkit_tts_conditional_settings"),C=v.querySelector(".aipkit_tts_auto_play_container");S&&(S.style.display=k.checked?"block":"none"),C&&(C.style.display=k.checked?"block":"none")}}let w=a.target.closest(".aipkit_chatbot_settings_modal .aipkit_tts_provider_select");if(w){let v=w.closest(".aipkit_accordion-content")||w.closest(".aipkit_chatbot_settings_modal");if(v){let S=w.value;if(v.querySelectorAll(".aipkit_tts_provider_settings").forEach(C=>{C.style.display=C.getAttribute("data-provider")===S?"block":"none"}),v.querySelectorAll(".aipkit_tts_field").forEach(C=>{C.style.display=C.getAttribute("data-provider")===S?"block":"none"}),S==="OpenAI"){let C=v.querySelector('.aipkit_tts_provider_settings[data-provider="OpenAI"] .aipkit_form-group:has(select[name="tts_openai_model_id"])');C&&(C.style.display="block")}}}let h=a.target.closest(".aipkit_chatbot_provider_select");if(h){let v=h.value,S=document.querySelector(".aipkit_chatbot_settings_modal.aipkit_active");if(S){let C=S.querySelector(".aipkit_stateful_convo_checkbox");if(C){C.disabled=v!=="OpenAI";let E=C.closest(".aipkit_stateful_convo_group");E&&(v!=="OpenAI"?(E.setAttribute("title",window.aipkit_dashboard?.text?.openaiOnly||"Available for OpenAI only"),E.style.opacity="0.6"):(E.removeAttribute("title"),E.style.opacity=""))}let T=S.querySelector(".aipkit_image_analysis_checkbox");if(T){T.disabled=v!=="OpenAI";let E=T.closest(".aipkit_image_analysis_group");E&&(v!=="OpenAI"?(E.setAttribute("title",window.aipkit_dashboard?.text?.openaiOnly||"Available for OpenAI only"),E.style.opacity="0.6"):(E.removeAttribute("title"),E.style.opacity=""))}try{let E=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form"),M=E?E.querySelector('.aipkit_chatbot_model_field[data-provider="OpenAI"] select'):null,x=M?(M.value||"").toLowerCase():"",L=x.startsWith("o1")||x.startsWith("o3")||x.startsWith("o4"),A=x.includes("gpt-5"),I=v==="OpenAI"&&(L||A),q=S.querySelector(".aipkit_reasoning_effort_field");if(q){q.classList.remove("aipkit_hidden");let P=q.closest('section[data-section="reasoning"], .aipkit_reasoning_section');P&&P.classList.remove("aipkit_hidden");let B=q.querySelector('select[name="reasoning_effort"]');B&&(B.disabled=!I),q.style.opacity=I?"":"0.6",q.setAttribute("title",I?"":window.aipkit_dashboard?.text?.openaiOnly||"Available for OpenAI reasoning models only")}}catch{}}}let y=a.target.closest('.aipkit_chatbot_model_field[data-provider="OpenAI"] select');if(y){let v=document.querySelector(".aipkit_chatbot_settings_modal.aipkit_active");if(v){let S=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"),C=S?S.value:"",T=(y.value||"").toLowerCase(),E=T.startsWith("o1")||T.startsWith("o3")||T.startsWith("o4"),M=T.includes("gpt-5"),x=C==="OpenAI"&&(E||M),L=v.querySelector(".aipkit_reasoning_effort_field");if(L){L.classList.remove("aipkit_hidden");let A=L.closest('section[data-section="reasoning"], .aipkit_reasoning_section');A&&A.classList.remove("aipkit_hidden");let I=L.querySelector('select[name="reasoning_effort"]');I&&(I.disabled=!x),L.style.opacity=x?"":"0.6",L.setAttribute("title",x?"":window.aipkit_dashboard?.text?.openaiOnly||"Available for OpenAI reasoning models only")}}}let b=a.target.closest(".aipkit_chatbot_settings_modal .aipkit_enable_realtime_voice_toggle");if(b){let v=b.closest(".aipkit_chatbot_settings_modal"),S=v?v.querySelector(".aipkit_realtime_voice_settings_container"):null;S&&(S.style.display=b.checked?"block":"none"),v?.querySelectorAll(".aipkit_rt_dependent")?.forEach(C=>{C.style.display=b.checked?"":"none"})}}),document.addEventListener("keydown",function(a){if(a.key==="Escape"){let c=document.querySelector(".aipkit_chatbot_settings_modal.aipkit_active");c&&i(c)}}))}window.aipkit_openChatbotSettingsModalById=o,window.aipkit_initChatbotSettingsModal=n,window.aipkit_createChatbotSettingsModal=e,window.aipkit_openChatbotSettingsModal=t,window.aipkit_closeChatbotSettingsModalById=function(s){let a=document.getElementById(s);a&&i(a)}})();(function(){"use strict";function p(o,i){let t=(o.closest(".aipkit_chatbot-list-column")||o.closest(".aipkit_settings_section")||o.closest(".aipkit_settings_sections")||o.parentElement||document).querySelector(".aipkit_segmented_container");if(!t)return;t.querySelectorAll(":scope > .aipkit_settings_section").forEach(s=>{s.classList.toggle("is-active-segment",s.getAttribute("data-segment")===i)})}function r(){document.addEventListener("click",function(o){let i=o.target.closest(".aipkit_segmented_controls .aipkit_segmented_btn");if(!i)return;let e=i.getAttribute("data-segment");if(!e)return;let t=i.closest(".aipkit_segmented_controls");if(t&&(t.querySelectorAll(".aipkit_segmented_btn").forEach(n=>{let s=n===i;n.classList.toggle("is-active",s),n.setAttribute("aria-selected",s?"true":"false")}),p(t,e),window.AIPKIT_DEBUG===!0))try{let s=(t.closest(".aipkit_chatbot-list-column")||t.closest(".aipkit_settings_section")||t.closest(".aipkit_settings_sections")||t.parentElement||document).querySelector(".aipkit_segmented_container"),a=s?Array.from(s.querySelectorAll(":scope > .aipkit_settings_section")).map(c=>c.getAttribute("data-segment")):[];console.log("[AIPKit] Segmented click:",{segment:e,sections:a,hasContainer:!!s})}catch(n){console.warn("[AIPKit] Segmented debug error:",n)}}),document.querySelectorAll(".aipkit_segmented_controls").forEach(o=>{let i=o.querySelector(".aipkit_segmented_btn.is-active")||o.querySelector(".aipkit_segmented_btn");if(i){i.classList.add("is-active"),i.setAttribute("aria-selected","true");let e=i.getAttribute("data-segment");if(p(o,e),window.AIPKIT_DEBUG===!0){let n=(o.closest(".aipkit_chatbot-list-column")||o.closest(".aipkit_settings_section")||o.closest(".aipkit_settings_sections")||o.parentElement||document).querySelector(".aipkit_segmented_container"),s=n?Array.from(n.querySelectorAll(":scope > .aipkit_settings_section")).map(a=>a.getAttribute("data-segment")):[];console.log("[AIPKit] Segmented init:",{defaultSegment:e,sections:s,hasContainer:!!n})}}})}window.aipkit_initSegmentedTabs=r,window.aipkit_initCustomThemeModalTabs=r})();(function(){"use strict";function p(r){let o=r.target.closest(".aipkit_reset_custom_theme_btn");if(!o)return;let i=o.dataset.botId,e=document.getElementById("aipkit_chatbot_main_tab_content_container"),t=document.getElementById(`aipkit_bot_${i}_custom_theme_settings_container`)||(e?e.querySelector(`#aipkit_bot_${i}_custom_theme_settings_container`):null),n=document.getElementById(`aipkit_reset_theme_status_${i}`)||(e?e.querySelector(`#aipkit_reset_theme_status_${i}`):null);if(!t||!n){console.error("AIPKit Theme Reset: Could not find theme settings container or status span for bot",i);return}let s=t.dataset.defaults;if(!s){console.error("AIPKit Theme Reset: No default values found in data-defaults attribute."),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(n,"error","Error: Defaults not found.",2e3);return}try{let a=JSON.parse(s);t.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(l=>{let u=l.getAttribute("name").match(/custom_theme_settings\[(.*?)\]/);if(u&&u[1]){let f=u[1];if(Object.prototype.hasOwnProperty.call(a,f)){l.value=a[f]!==null?String(a[f]):"";let _=new Event("change",{bubbles:!0,cancelable:!0});l.dispatchEvent(_)}else if(Object.prototype.hasOwnProperty.call(a,f+"_placeholder")){l.value=a[f+"_placeholder"]!==null?String(a[f+"_placeholder"]):"";let _=new Event("change",{bubbles:!0,cancelable:!0});l.dispatchEvent(_)}}}),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(n,"success","\u2714 Reverted.",2e3)}catch(a){console.error("AIPKit Theme Reset: Error parsing default values JSON or applying defaults.",a),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(n,"error","Error resetting.",2e3)}}window.aipkit_handleResetCustomTheme=p})();(function(){"use strict";function p(r){if(!r)return;let o=r.querySelector(".aipkit_chatbot_provider_select");o||(o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let i=r.querySelector('.aipkit_chatbot_model_field[data-provider="OpenAI"] select');i||(i=document.querySelector('#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_model_field[data-provider="OpenAI"] select'));let e=r.querySelector(".aipkit_reasoning_effort_field"),t=null;if(e?t=e.closest('section[data-section="reasoning"], .aipkit_reasoning_section'):t=r.querySelector(".aipkit_reasoning_section"),!e)return;if(!o||!i){e.classList.remove("aipkit_hidden"),t&&t.classList.remove("aipkit_hidden");let f=e.querySelector('select[name="reasoning_effort"]');f&&(f.disabled=!0),e.style.opacity="0.6",e.setAttribute("title",window.aipkit_dashboard?.text?.openaiOnly||"Available for OpenAI reasoning models only");return}let n=o.value,a=(i.value||"").toLowerCase(),c=a.startsWith("o1")||a.startsWith("o3")||a.startsWith("o4"),l=a.includes("gpt-5"),d=n==="OpenAI"&&(c||l);e.classList.remove("aipkit_hidden"),t&&t.classList.remove("aipkit_hidden");let u=e.querySelector('select[name="reasoning_effort"]');u&&(u.disabled=!d),e.style.opacity=d?"":"0.6",d?e.removeAttribute("title"):e.setAttribute("title",window.aipkit_dashboard?.text?.openaiOnly||"Available for OpenAI reasoning models only")}window.aipkit_toggleReasoningEffort=p})();(function(){"use strict";function p(o,i,e){let t=document.getElementById(o);if(!t)return;if(t.innerHTML="",!i||i.length===0){t.appendChild(new Option("(No voices found - Sync again)",""));return}t.appendChild(new Option("-- Select Voice --",""));let n={};i.forEach(a=>{let c=a.languageCodes[0]||"und";n[c]||(n[c]=[]),n[c].push(a)}),Object.keys(n).sort().forEach(a=>{let c=document.createElement("optgroup");try{let l=new Intl.DisplayNames(["en"],{type:"language"}).of(a.split("-")[0]);c.label=`${l} (${a})`}catch{c.label=a}n[a].sort((l,d)=>l.name.localeCompare(d.name)),n[a].forEach(l=>{let d=new Option(l.name,l.id);l.id===e&&(d.selected=!0),c.appendChild(d)}),t.appendChild(c)}),e&&!t.value&&(Array.from(t.options).some(c=>c.value===e)?t.value=e:console.warn(`AIPKit TTS: Saved Google voice ID "${e}" not found in synced list for ${o}.`))}function r(o){let i=o.getAttribute("data-target-select"),e=o.querySelector(".aipkit_spinner"),t=o.closest(".aipkit_form-group"),n=t?t.querySelector(".aipkit_form-help"):null;if(!i){console.error("AIPKit TTS Sync (Google): Missing target select ID from button attribute.");return}if(n||console.error("AIPKit TTS Sync (Google): Could not find message container (.aipkit_form-help) for button:",o),typeof window.aipkit_showTemporaryMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_setButtonText!="function"){console.error("AIPKit TTS Sync (Google): Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync voices, required functions missing.");return}o.disabled=!0,e&&(e.style.display="inline-block"),window.aipkit_setButtonText(o,"Syncing..."),n&&(n.textContent="",n.className="aipkit_form-help"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(a=>{if(a&&a.voices){let c=document.getElementById(i),l=c?c.value:"";p(i,a.voices,l);let d=document.getElementById("aipkit_google_tts_voices_json_main");d&&(d.dataset.voices=JSON.stringify(a.voices)),n&&window.aipkit_showTemporaryMessage(n,"success",a.message||"Sync successful!")}else throw new Error("Invalid response received from voice sync.")}).catch(a=>{console.error("AIPKit TTS Sync Error (Google):",a),n&&window.aipkit_showTemporaryMessage(n,"error",`Sync failed: ${a.message||"Unknown error"}`)}).finally(()=>{o.disabled=!1,e&&(e.style.display="none"),window.aipkit_setButtonText(o,"Sync Voices")})}window.aipkit_updateGoogleVoiceSelect=p,window.aipkit_handleSyncGoogleVoices=r})();(function(){"use strict";function p(o,i,e){let t=document.getElementById(o);if(!t){console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Select element #${o} not found.`);return}if(t.innerHTML="",!i||i.length===0){if(t.appendChild(new Option("(No voices found - Sync in Main Settings)","")),e){let s=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(s),t.value=e}return}t.appendChild(new Option("-- Select Voice --","")),i.sort((s,a)=>(s.name||s.id||"").localeCompare(a.name||a.id||""));let n=!1;if(i.forEach(s=>{let a=new Option(s.name,s.id);s.id===e&&(a.selected=!0,n=!0),t.appendChild(a)}),e&&!n){let s=!1;for(let a=0;a<t.options.length;a++)if(t.options[a].value===e){s=!0,t.value=e;break}if(!s){let a=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(a),t.value=e,console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Saved voice ID "${e}" not found in synced list for #${o}, added as manual.`)}}else!e&&t.options.length>0&&(t.value="")}function r(o,i,e){let t=document.getElementById(o);if(!t){console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Select element #${o} not found.`);return}if(t.innerHTML="",!i||i.length===0){if(t.appendChild(new Option("(No models found - Sync in Main Settings)","")),e){let s=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(s),t.value=e}return}t.appendChild(new Option("-- Select Model --","")),i.sort((s,a)=>(s.name||s.id||"").localeCompare(a.name||a.id||""));let n=!1;if(i.forEach(s=>{let a=s.id||"",c=s.name||a;if(!a)return;let l=new Option(c,a);a===e&&(l.selected=!0,n=!0),t.appendChild(l)}),e&&!n){let s=!1;for(let a=0;a<t.options.length;a++)if(t.options[a].value===e){s=!0,t.value=e;break}if(!s){let a=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(a),t.value=e,console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Saved model ID "${e}" not found in synced list for #${o}, added as manual.`)}}else!e&&t.options.length>0&&(t.value="")}window.aipkit_chatTts_updateElevenLabsVoiceSelect=p,window.aipkit_chatTts_updateElevenLabsModelsSelect=r})();(function(){"use strict";function p(i,e){let t=i.querySelector(".aipkit_tts_conditional_settings"),n=i.querySelector(".aipkit_tts_auto_play_container");t&&(t.style.display=e?"block":"none"),n&&(n.style.display=e?"block":"none")}function r(i){let e=i.querySelector(".aipkit_tts_provider_select");if(!e)return;let t=e.value;i.querySelectorAll(".aipkit_tts_provider_settings").forEach(s=>{if(s.getAttribute("data-provider")===t){if(s.style.display="block",t==="OpenAI"){let a=s.querySelector('.aipkit_form-group:has(select[name="tts_openai_model_id"])');a&&(a.style.display="block")}}else s.style.display="none"})}function o(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i){console.warn("AIPKit TTS Settings: Main content container not found.");return}let e=typeof window.aipkit_updateGoogleVoiceSelect=="function",t=typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function",n=typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function",s=typeof window.aipkit_handleSyncGoogleVoices=="function";e||console.error("AIPKit TTS Settings: Google voice update function missing."),t||console.error("AIPKit TTS Settings: ElevenLabs CHAT voice update function missing."),n||console.error("AIPKit TTS Settings: ElevenLabs CHAT model update function missing."),s||console.error("AIPKit TTS Settings: Google voice sync handler function missing."),i.addEventListener("change",function(c){let l=c.target.closest(".aipkit_tts_toggle_switch"),d=c.target.closest(".aipkit_tts_provider_select");if(l){let u=l.closest(".aipkit_accordion-content");u&&(p(u,l.checked),l.checked&&r(u))}else if(d){let u=d.closest(".aipkit_accordion-content");u&&r(u)}}),i.addEventListener("click",function(c){let l=c.target.closest(".aipkit_sync_tts_voices_btn");l&&l.getAttribute("data-provider")==="Google"&&s&&window.aipkit_handleSyncGoogleVoices(l)}),i.querySelectorAll('.aipkit_accordion[data-section="tts-settings"] .aipkit_accordion-content').forEach(c=>{let l=c.querySelector(".aipkit_tts_toggle_switch");l&&(p(c,l.checked),l.checked&&r(c));let d=c.querySelector('select[name="tts_google_voice_id"]');d&&!e&&console.error("AIPKit TTS Settings Init (Google): Google voice update function (aipkit_updateGoogleVoiceSelect) is missing, but select element exists."),d&&d.options.length<=1&&(d.innerHTML='<option value="">(Sync in Main Settings)</option>');let u=c.querySelector('select[name="tts_elevenlabs_voice_id"]');if(u&&t){let m="";if(u&&u.id){let w=u.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_voice_id/);w&&w[1]&&(m=w[1])}let g=m?document.getElementById(`aipkit_elevenlabs_voices_json_${m}`):null,k=g?g.dataset.voices:null;try{let w=k?JSON.parse(k):[],h=u.value||"";window.aipkit_chatTts_updateElevenLabsVoiceSelect(u.id,w,h)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Voices): Failed to parse initial voices JSON.",w),u.options.length<=1&&(u.innerHTML='<option value="">(Sync in Main Settings)</option>')}}else u&&u.options.length<=1&&(u.innerHTML='<option value="">(Sync in Main Settings)</option>');let f=c.querySelector('select[name="tts_elevenlabs_model_id"]');if(f&&n){let m="";if(f&&f.id){let w=f.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_model_id/);w&&w[1]&&(m=w[1])}let g=m?document.getElementById(`aipkit_elevenlabs_models_json_${m}`):null,k=g?g.dataset.models:null;try{let w=k?JSON.parse(k):[],h=f.value||"";window.aipkit_chatTts_updateElevenLabsModelsSelect(f.id,w,h)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Models): Failed to parse initial models JSON.",w),f.options.length<=1&&(f.innerHTML='<option value="">(Sync in Main Settings)</option>')}}else f&&f.options.length<=1&&(f.innerHTML='<option value="">(Sync in Main Settings)</option>');let _=c.querySelector('select[name="tts_openai_model_id"]');_&&_.options.length<=1&&(_.innerHTML='<option value="">(Sync models in Main Settings)</option>')})}window.aipkit_initTtsSettingsUI=o})();(function(){"use strict";function p(r,o,i,e){let t=e||function(s){return s},n=`debug-pre-${t(i)}`;return`
            <div class="aipkit_log_debug_info" style="margin-top: 5px; border-top: 1px dashed #eee; padding-top: 4px;">
                <a href="#" class="aipkit_log_debug_toggle" aria-controls="${n}" aria-expanded="false" style="font-size: 0.9em; color: #555; text-decoration: none;">
                    <span class="dashicons dashicons-arrow-right-alt2"></span> ${t(r)}
                </a>
                <div id="${n}" style="display: none; margin-top: 3px; max-height: 150px; overflow: auto; background: #f0f0f0; padding: 5px; border-radius: 3px;">
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; border: 1px solid #eee; padding: 5px; font-size: 0.85em; max-height: 120px; overflow-y: auto;">${t(o)}</pre>
                </div>
            </div>`}window.aipkit_createExpandableDetail=p})();(function(){"use strict";function p(r,o,i,e){let t=r.trigger_log_details||{},n=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(r.timestamp||null):r.timestamp||"N/A",s=`${r.message_id||"trigger"}-${Date.now()}-${Math.random().toString(16).slice(2)}`,a='<div class="aipkit_single_trigger_log_entry">';if(a+=`<div class="aipkit_message_header">
                        <strong class="aipkit_trigger_log_main_title"><span class="dashicons dashicons-admin-generic"></span>Trigger Event</strong>`,n&&(a+=`<span class="aipkit_message_timestamp">${n}</span>`),a+="</div>",a+=`<div class="aipkit_trigger_log_summary">${e(r.content||"Trigger activity logged.")}</div>`,a+='<div class="aipkit_trigger_log_basic_details">',t.log_subtype!=="trigger_processing_start"&&(a+=`<div><strong>Trigger:</strong> ${e(t.trigger_name||"N/A")} (ID: ${e(t.trigger_id||"N/A")})</div>`),a+=`<div><strong>Processed Event:</strong> ${e(t.event_name_processed||"N/A")}</div>`,t.log_subtype==="trigger_evaluation")a+=`<div><strong>Conditions Met:</strong> ${t.conditions_met?"Yes":"No"}</div>`,t.conditions_summary&&typeof window.aipkit_createExpandableDetail=="function"?a+=window.aipkit_createExpandableDetail("Evaluation Summary",t.conditions_summary,`eval-${s}`,e):t.conditions_summary&&(a+=`<div><strong>Evaluation Summary:</strong> ${e(t.conditions_summary)}</div>`);else if(t.log_subtype==="action_execution_start"){let c=t.action_type?typeof window.aipkit_ucfirst=="function"?window.aipkit_ucfirst(t.action_type.replace(/_/g," ")):t.action_type:"N/A";if(a+=`<div><strong>Action Started:</strong> ${e(c)}</div>`,t.action_payload_summary&&typeof window.aipkit_createExpandableDetail=="function"){let l="";typeof t.action_payload_summary=="object"?l=JSON.stringify(t.action_payload_summary,null,2):l=String(t.action_payload_summary),a+=window.aipkit_createExpandableDetail("Payload Summary",l,`payload-${s}`,e)}else t.action_payload_summary&&(a+=`<div><strong>Payload Summary:</strong> <pre>${e(JSON.stringify(t.action_payload_summary,null,2))}</pre></div>`)}else if(t.log_subtype==="action_execution_result"){let c=t.action_type?typeof window.aipkit_ucfirst=="function"?window.aipkit_ucfirst(t.action_type.replace(/_/g," ")):t.action_type:"N/A",l=t.status?typeof window.aipkit_ucfirst=="function"?window.aipkit_ucfirst(t.status):t.status:"N/A";a+=`<div><strong>Action Result:</strong> ${e(c)} - <strong>Status:</strong> ${e(l)}</div>`,t.result_summary&&typeof window.aipkit_createExpandableDetail=="function"?a+=window.aipkit_createExpandableDetail("Outcome Details",t.result_summary,`outcome-${s}`,e):t.result_summary&&(a+=`<div><strong>Outcome:</strong> ${e(t.result_summary)}</div>`),t.error_details&&(a+=`<div style="color: red;"><strong>Error Details:</strong> ${e(t.error_details)}</div>`)}else if(t.log_subtype==="form_submission_stored"&&(a+=`<div><strong>Form ID:</strong> ${e(t.form_id||"N/A")}</div>`,t.submitted_data_snapshot&&typeof window.aipkit_createExpandableDetail=="function")){let c="";typeof t.submitted_data_snapshot=="object"?c=JSON.stringify(t.submitted_data_snapshot,null,2):c=String(t.submitted_data_snapshot),a+=window.aipkit_createExpandableDetail("Submitted Form Data",c,`formdata-${s}`,e)}return a+="</div>",a+="</div>",a}window.aipkit_renderTriggerLogEntryHTML=p})();(function(){"use strict";function p(o){return o?o.charAt(0).toUpperCase()+o.slice(1):""}function r(o,i,e,t,n,s){let a=n||function(w){return w},c=s||p,l=window.aipkit_chat_config||{},d=l.isProPlan&&l.isTriggersAddonActive,u=null;if(typeof i=="object"&&i!==null&&Array.isArray(i.messages)?u=i.messages:Array.isArray(i)&&(u=i),!u||u.length===0){o.innerHTML=`<p style="text-align:center;padding:20px;font-style:italic;">${t.noLogsFound||"No conversation history found."}</p>`;return}let f=null;window.markdownit&&(f=window.markdownit({html:!1,linkify:!0,typographer:!0}),window.hljs&&typeof window.markdownitHighlight=="function"&&f.use(window.markdownitHighlight,{hljs:window.hljs}));let _="";for(let w=0;w<u.length;w++){let h=u[w],y=h.role==="assistant"||h.role==="model"?"bot":h.role||"unknown",b=h.message_id||"msg-"+Math.random().toString(16).slice(2)+w;if(y==="user"||y==="bot"){let v=h.content||"",S=h.provider||"",C=h.model||"",T=h.timestamp||null,E=h.feedback||null,M=h.usage||null,x=M?M.total_tokens??M.totalTokenCount??null:null,L=y==="bot"&&(h.request_payload||null),A=y==="bot"&&v.toLowerCase().startsWith("error:"),I="";y==="bot"?I=e.bot_name||t.logBotLabel||"Bot":y==="user"?I=e.user_display_name||t.logUserLabel||"User":I=c(y);let q=y==="bot"?"aipkit_message_bot":"aipkit_message_user";A&&(q+=" aipkit_message_error");let P=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(T):T||"",B=f?f.render(v):a(v).replace(/\n/g,"<br>");_+=`<div class="aipkit_message ${q}" id="${a(b)}">`,_+=`<div class="aipkit_message_header"><strong>${a(I)}:</strong>`,P&&(_+=`<span class="aipkit_message_timestamp">${P}</span>`),_+="</div>",_+=`<div class="aipkit_message_content">${B}</div>`;let F=!1,O="",D="",$=null,N=null;if(y==="user"){let U=u.find((V,Y)=>Y>w&&(V.role==="assistant"||V.role==="model"||V.role==="bot"));if(U){O=U.provider||"",D=U.model||"";let V=U.usage||null;$=V?V.total_tokens??V.totalTokenCount??null:null,N=U.request_payload||null,F=O||D||$!==null||N}}else if(y==="bot"){let U=h.vector_search_scores&&Array.isArray(h.vector_search_scores)&&h.vector_search_scores.length>0,V=e&&Array.isArray(e.vector_search_scores)&&e.vector_search_scores.length>0;F=!!E||U||V}if(F=F||E,F){let U=a(h.message_id||"msg-"+Math.random().toString(16).slice(2)),V=[];y==="user"&&(O&&V.push(`${O}`),D&&V.push(`${D}`),$!==null&&$>0&&V.push(`${Number($).toLocaleString()} tokens`));let Y="",X=0,Z=y==="bot"&&h.vector_search_scores&&Array.isArray(h.vector_search_scores)&&h.vector_search_scores.length>0?h.vector_search_scores:e&&Array.isArray(e.vector_search_scores)&&e.vector_search_scores.length>0?e.vector_search_scores:null;if(y==="bot"&&Z){let W=Z.reduce((j,G)=>{let Q=G.score!==void 0?Number(G.score):0,J=j.score!==void 0?Number(j.score):0;return Q>J?G:j},Z[0]);X=W.score!==void 0?Math.round(Number(W.score)*100):0;let H="score-poor";X>=85?H="score-excellent":X>=70?H="score-good":X>=50&&(H="score-fair");let K=`vector_scores_${U}`;Y=`<span class="aipkit_vector_score_percentage aipkit_vector_expand ${H}" data-target="${K}" aria-expanded="false" title="Click to view vector search details">Score ${X}%</span>`}if(_+='<div class="aipkit_metadata_container">',y==="user"&&V.length>0)if(N){let W=`payload_${U}`;_+=`<div class="aipkit_metadata_info aipkit_payload_expand" data-target="${W}" aria-expanded="false" title="Click to view request payload">${a(V.join(" / "))} <span class="aipkit_expand_arrow">\u203A</span></div>`}else _+=`<div class="aipkit_metadata_info">${a(V.join(" / "))}</div>`;else y==="user"&&(_+='<div class="aipkit_metadata_info"></div>');if(_+='<div class="aipkit_metadata_actions">',Y&&(_+=Y),_+="</div>",_+='<div class="aipkit_metadata_feedback">',E&&(_+=`<span class="dashicons ${E==="up"?"dashicons-thumbs-up":"dashicons-thumbs-down"} aipkit_log_detail_feedback_indicator ${E==="up"?"aipkit_feedback_up":"aipkit_feedback_down"}" title="${a(E==="up"?"Liked":"Disliked")}"></span>`),_+="</div>",_+="</div>",y==="user"&&N){let W=`payload_${U}`;_+=`<div class="aipkit_expandable_section" id="${W}" style="display:none;">`,_+='<div class="aipkit_expandable_header">Request Payload</div>',_+='<div class="aipkit_expandable_content">',_+=`<pre class="aipkit_payload_pre">${a(JSON.stringify(N,null,2))}</pre>`,_+="</div></div>"}else if(y==="bot"&&Z){let W=`vector_scores_${U}`;_+=`<div class="aipkit_expandable_section" id="${W}" style="display:none;">`,_+='<div class="aipkit_expandable_header">Vector Search Results</div>',_+='<div class="aipkit_expandable_content">',Z.forEach((H,K)=>{let j=a(H.provider||"Unknown"),G=H.score!==void 0?Math.round(Number(H.score)*100):"N/A",Q=a(H.content_preview||"No preview"),J="";H.provider==="OpenAI"&&H.store_name?J=` (Store: ${a(H.store_name)})`:H.provider==="OpenAI"&&H.store_id?J=` (Store: ${a(H.store_id)})`:H.provider==="Pinecone"&&H.index_name?(J=` (Index: ${a(H.index_name)}`,H.namespace&&(J+=`, NS: ${a(H.namespace)}`),J+=")"):H.provider==="Qdrant"&&H.collection_name&&(J=` (Collection: ${a(H.collection_name)})`);let te="score-poor";if(G!=="N/A"){let ie=Number(G);ie>=85?te="score-excellent":ie>=70?te="score-good":ie>=50&&(te="score-fair")}_+='<div class="aipkit_vector_score_item">',_+=`<div class="aipkit_vector_score_provider">${j}${J}</div>`,_+=`<div class="aipkit_vector_score_value ${te}">${G}${G!=="N/A"?"%":""}</div>`,_+=`<div class="aipkit_vector_score_preview">${Q}</div>`,_+="</div>"}),_+="</div></div>"}}_+="</div>";let R="",z=0;for(let U=w+1;U<u.length;U++){let V=u[U];if(V.role==="system"&&V.event_sub_type==="trigger_log"&&V.trigger_log_details&&typeof window.aipkit_renderTriggerLogEntryHTML=="function")R+=window.aipkit_renderTriggerLogEntryHTML(V,e,t,a),z++;else break}if(z>0&&d){let U=`trigger_details_for_${a(b)}`;_+='<div class="aipkit_message_related_triggers">',_+=`<a href="#" class="aipkit_trigger_activity_toggle" aria-controls="${U}" aria-expanded="false">
<span class="dashicons dashicons-arrow-right-alt2"></span>
${a(z===1?"Show Trigger Log":`Show ${z} Trigger Logs`)}
</a>`,_+=`<div class="aipkit_trigger_activity_details" id="${U}" style="display:none;">${R}</div>`,_+="</div>",w+=z}else z>0&&!d&&(w+=z)}else h.role==="system"&&h.event_sub_type==="trigger_log"&&h.trigger_log_details&&typeof window.aipkit_renderTriggerLogEntryHTML=="function"&&(_+=window.aipkit_renderTriggerLogEntryHTML(h,e,t,a))}o.innerHTML=_,o.querySelectorAll(".aipkit_expand_btn").forEach(w=>{w.addEventListener("click",function(h){h.preventDefault();let y=this.getAttribute("data-target"),b=document.getElementById(y),v=this.getAttribute("aria-expanded")==="true";b&&(v?(b.style.display="none",this.setAttribute("aria-expanded","false"),this.classList.remove("expanded")):(b.style.display="block",this.setAttribute("aria-expanded","true"),this.classList.add("expanded")))})}),o.querySelectorAll(".aipkit_vector_expand").forEach(w=>{w.addEventListener("click",function(h){h.preventDefault();let y=this.getAttribute("data-target"),b=document.getElementById(y),v=this.getAttribute("aria-expanded")==="true";b&&(v?(b.style.display="none",this.setAttribute("aria-expanded","false"),this.classList.remove("expanded")):(b.style.display="block",this.setAttribute("aria-expanded","true"),this.classList.add("expanded")))})}),o.querySelectorAll(".aipkit_metadata_info.aipkit_payload_expand").forEach(w=>{w.addEventListener("click",function(h){h.preventDefault();let y=this.getAttribute("data-target"),b=document.getElementById(y),v=this.querySelector(".aipkit_expand_arrow"),S=this.getAttribute("aria-expanded")==="true";b&&(S?(b.style.display="none",this.setAttribute("aria-expanded","false"),this.classList.remove("expanded"),v&&(v.style.transform="rotate(0deg)")):(b.style.display="block",this.setAttribute("aria-expanded","true"),this.classList.add("expanded"),v&&(v.style.transform="rotate(90deg)")))})})}window.aipkit_renderChatConversation=r})();(function(){"use strict";function p(r,o,i,e,t,n){let s=t||function(x){return x},a=window.aipkit_escapeAttribute||s,c=n||function(x){return x?x.charAt(0).toUpperCase()+x.slice(1):""},l=null;if(typeof o=="object"&&o!==null&&Array.isArray(o.messages)&&o.messages.length>0)l=o.messages[0];else{r.innerHTML='<p style="text-align:center;padding:20px;font-style:italic;">Invalid log data format for Image Generator.</p>';return}let d=l.request_payload||{},u=l.response_data||{},f=l.content||"",_=l.provider||"N/A",m=l.model||"N/A",g=l.timestamp||i.created_at,k=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(g):g||"N/A",w=f.toLowerCase().startsWith("error:"),h=d.prompt||"N/A",y="",b="",v=l.message_id||"imglog-"+Math.random().toString(16).slice(2);y+='<div class="aipkit_message aipkit_message_user">',y+=`<div class="aipkit_message_header"><strong>Image Generation Request</strong><span class="aipkit_message_timestamp">${k}</span></div>`,y+=`<div class="aipkit_message_content">${s(h)}</div>`;let S=[];_&&S.push(`${s(_)}`),m&&S.push(`${s(m)}`);let C=l.usage||null,T=C?C.total_tokens??C.totalTokenCount??null:null;T!==null&&S.push(`${Number(T).toLocaleString()} tokens`),(S.length>0||d)&&(y+='<div class="aipkit_metadata_container">',y+=`<div class="aipkit_metadata_info aipkit_payload_expand" data-target="payload_${v}" aria-expanded="false" title="Click to view request payload">${S.join(" / ")} <span class="aipkit_expand_arrow">\u203A</span></div>`,y+='<div class="aipkit_metadata_actions"></div>',y+='<div class="aipkit_metadata_feedback"></div>',y+="</div>",y+=`<div class="aipkit_expandable_section" id="payload_${v}" style="display:none;">`,y+='<div class="aipkit_expandable_header">Request Payload</div>',y+='<div class="aipkit_expandable_content">',y+=`<pre class="aipkit_payload_pre">${s(JSON.stringify(d,null,2))}</pre>`,y+="</div></div>"),y+="</div>",b+=`<div class="aipkit_message aipkit_message_bot ${w?"aipkit_message_error":""}">`,b+=`<div class="aipkit_message_header"><strong>AI Response</strong><span class="aipkit_message_timestamp">${k}</span></div>`;let E="";if(w)E=`<p style="color: red;">${s(f)}</p>`,u.error_code&&(E+=`<p><strong>Error Code:</strong> ${s(u.error_code)}</p>`);else{let x=u.images&&u.images[0]&&u.images[0].revised_prompt?u.images[0].revised_prompt:null;x&&(E+=`<p class="aipkit_image_revised_prompt"><strong>Revised Prompt:</strong><br><em style="font-size: 0.95em;">${s(x)}</em></p>`),u.images&&u.images.length>0?(E+='<div class="aipkit_image_gen_results_grid">',u.images.forEach((L,A)=>{let I=L.media_library_url||L.url;E+='<div class="aipkit_image_gen_result_item">',I?E+=`<a href="${a(I)}" target="_blank" rel="noopener noreferrer" title="View full image"><img src="${a(I)}" alt="Generated Image ${A+1}"></a>`:L.has_b64?E+="<span>(Base64 Image)</span>":E+="<span>(No URL)</span>",E+="</div>"}),E+="</div>"):E+=`<p><em>${s(f)}</em></p>`}b+=`<div class="aipkit_message_content">${E}</div>`,b+="</div>",r.innerHTML=y+b,r.querySelectorAll(".aipkit_metadata_info.aipkit_payload_expand").forEach(x=>{x.addEventListener("click",function(L){L.preventDefault();let A=this.getAttribute("data-target"),I=document.getElementById(A),q=this.querySelector(".aipkit_expand_arrow"),P=this.getAttribute("aria-expanded")==="true";I&&(P?(I.style.display="none",this.setAttribute("aria-expanded","false"),this.classList.remove("expanded"),q&&(q.style.transform="rotate(0deg)")):(I.style.display="block",this.setAttribute("aria-expanded","true"),this.classList.add("expanded"),q&&(q.style.transform="rotate(90deg)")))})})}window.aipkit_renderImageGeneratorLog=p})();(function(){"use strict";function p(o){try{let i=o&&o.payload_sent;if(!i)return null;let e=Array.isArray(i.messages)?i.messages:Array.isArray(i.input)?i.input:null;if(Array.isArray(e)){let t=e.find(n=>n&&n.role==="user"&&typeof n.content=="string"&&n.content.trim());return t&&t.content?String(t.content):null}}catch{}return null}function r(o,i,e,t,n,s){let a=n||function(d){return d};if(typeof i!="object"||i===null||!Array.isArray(i.messages)||i.messages.length===0){o.innerHTML=`<p style="text-align:center;padding:20px;font-style:italic;">${t&&t.noLogsFound||"No log data found."}</p>`;return}let c=i.messages,l=[];for(let d=0;d<c.length;d++){let u=c[d]||{},f=u.content||"",_=u.provider||"",m=u.model||"",g=u.timestamp||e.created_at||null,k=u.usage||null,w=u.request_payload||null,h=p(w);if(!h){let v=f.match(/Prompt Snippet: (.*?)\.\.\./s);h=v?v[1]:""}if(!h){let v=f.indexOf(`Result:
`);h=v>0?f.slice(0,v).trim():f.trim()}let y="",b=f.match(/Result:\n([\s\S]*)$/);y=b?b[1].trim():f,l.push({role:"user",content:h||"(Prompt not available)",timestamp:g}),l.push({role:"assistant",content:y||"",provider:_,model:m,timestamp:g,usage:k,request_payload:w,message_id:u.message_id||"enhancer-"+Math.random().toString(16).slice(2)+"-"+d})}typeof window.aipkit_renderChatConversation=="function"?window.aipkit_renderChatConversation(o,{messages:l},e,t,n,s):o.innerHTML='<p style="color:red;text-align:center;padding:15px;">Error: Chat renderer missing.</p>'}window.aipkit_renderPostEnhancerLog=r})();(function(){"use strict";function p(r,o,i,e,t,n){let s=t||function(m){return m},a=null;window.markdownit&&(a=window.markdownit({html:!1,linkify:!0,typographer:!0}),window.hljs&&typeof window.markdownitHighlight=="function"&&a.use(window.markdownitHighlight,{hljs:window.hljs}));let c=null;if(typeof o=="object"&&o!==null&&Array.isArray(o.messages)&&(c=o.messages),!c||c.length===0){r.innerHTML='<p style="text-align:center;padding:20px;font-style:italic;">No log data found.</p>';return}let l=c.find(m=>m.role==="user"),d=c.find(m=>m.role==="bot"),u="";if(l){let m=l.request_payload||{},g=l.content?l.content.replace("AI Form Submission (ID: "+(m.form_id||"")+"): ",""):"AI Form Submission",k=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(l.timestamp):l.timestamp||"",w=l.message_id||"user_msg";if(u+='<div class="aipkit_message aipkit_message_user">',u+=`<div class="aipkit_message_header"><strong>${s(g)}</strong>`,k&&(u+=`<span class="aipkit_message_timestamp">${k}</span>`),u+="</div>",u+='<div class="aipkit_message_content">',m.constructed_prompt)u+=s(m.constructed_prompt);else if(m.inputs&&Object.keys(m.inputs).length>0){u+='<div style="margin-bottom: 12px;"><strong>Submitted Data:</strong></div>',u+='<div style="background: #f8f9fa; padding: 8px 12px; border-radius: 4px; border-left: 3px solid #1976d2;">';for(let E in m.inputs)if(Object.hasOwnProperty.call(m.inputs,E)){let M=m.inputs[E];u+=`<div style="margin-bottom: 4px;"><span style="font-weight: 500; color: #1976d2;">${s(E)}:</span> ${s(M)}</div>`}u+="</div>"}else u+="<em>No input data available</em>";u+="</div>";let h=!1,y="",b="",v=null,S=null;if(d){y=d.provider||"",b=d.model||"";let E=d.usage||null;v=E?E.total_tokens??E.totalTokenCount??null:null,S=d.request_payload||null,h=y||b||v!==null||S||m.inputs&&Object.keys(m.inputs).length>0}if(h){u+='<div class="aipkit_metadata_container">';let E=[];y&&E.push(`${y}`),b&&E.push(`${b}`),v!==null&&v>0&&E.push(`${Number(v).toLocaleString()} tokens`);let M=m.inputs&&Object.keys(m.inputs).length>0,x=S;if(E.length>0&&(M||x)){let L=`payload_${w}`;u+=`<div class="aipkit_metadata_info aipkit_payload_expand" data-target="${L}" aria-expanded="false" title="Click to view details">${s(E.join(" / "))} <span class="aipkit_expand_arrow">\u203A</span></div>`}else if(E.length>0)u+=`<div class="aipkit_metadata_info">${s(E.join(" / "))}</div>`;else if(M){let L=`payload_${w}`;u+=`<div class="aipkit_metadata_info aipkit_payload_expand" data-target="${L}" aria-expanded="false" title="Click to view form data">Form Submission <span class="aipkit_expand_arrow">\u203A</span></div>`}else u+='<div class="aipkit_metadata_info"></div>';u+='<div class="aipkit_metadata_actions"></div>',u+='<div class="aipkit_metadata_feedback"></div>',u+="</div>"}let C=m.inputs&&Object.keys(m.inputs).length>0,T=d&&d.request_payload;if(C||T){let E=`payload_${w}`;if(u+=`<div class="aipkit_expandable_section" id="${E}" style="display:none;">`,C){u+='<div class="aipkit_expandable_header">Form Submission Data</div>',u+='<div class="aipkit_expandable_content">',u+='<div style="background: #f8f9fa; padding: 8px 12px; border-radius: 4px;">';for(let M in m.inputs)if(Object.hasOwnProperty.call(m.inputs,M)){let x=m.inputs[M];u+=`<div style="margin-bottom: 8px;"><span style="font-weight: 500; color: #1976d2;">${s(M)}:</span> ${s(x)}</div>`}u+="</div>",u+="</div>"}T&&(u+='<div class="aipkit_expandable_header">Request Payload</div>',u+='<div class="aipkit_expandable_content">',u+=`<pre class="aipkit_payload_pre">${s(JSON.stringify(d.request_payload,null,2))}</pre>`,u+="</div>"),u+="</div>"}u+="</div>"}if(d){let m=d.provider||"N/A",g=d.model||"N/A",k=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(d.timestamp):d.timestamp||"",w=d.usage||null,h=w?w.total_tokens??w.totalTokenCount??null:null,y=d.content||"",b=y.toLowerCase().startsWith("error:"),v=a?a.render(y):s(y).replace(/\n/g,"<br>"),S=b?"aipkit_message_error":"",C=d.message_id||"bot_msg",T=d.feedback||null;if(u+=`<div class="aipkit_message aipkit_message_bot ${S}">`,u+='<div class="aipkit_message_header"><strong>AI Response</strong>',k&&(u+=`<span class="aipkit_message_timestamp">${k}</span>`),u+="</div>",u+='<div class="aipkit_message_content">',u+=v,u+="</div>",T||d.vector_search_scores&&Array.isArray(d.vector_search_scores)&&d.vector_search_scores.length>0){if(u+='<div class="aipkit_metadata_container">',u+='<div class="aipkit_metadata_actions">',d.vector_search_scores&&Array.isArray(d.vector_search_scores)&&d.vector_search_scores.length>0){let M=d.vector_search_scores.reduce((I,q)=>{let P=q.score!==void 0?Number(q.score):0,B=I.score!==void 0?Number(I.score):0;return P>B?q:I},d.vector_search_scores[0]),x=M.score!==void 0?Math.round(Number(M.score)*100):0,L="score-poor";x>=85?L="score-excellent":x>=70?L="score-good":x>=50&&(L="score-fair");let A=`vector_scores_${C}`;u+=`<span class="aipkit_vector_score_percentage aipkit_vector_expand ${L}" data-target="${A}" aria-expanded="false" title="Click to view vector search details">Score ${x}%</span>`}u+="</div>",u+='<div class="aipkit_metadata_feedback">',T&&(u+=`<span class="dashicons ${T==="up"?"dashicons-thumbs-up":"dashicons-thumbs-down"} aipkit_log_detail_feedback_indicator ${T==="up"?"aipkit_feedback_up":"aipkit_feedback_down"}" title="${s(T==="up"?"Liked":"Disliked")}"></span>`),u+="</div>",u+="</div>"}if(d.vector_search_scores&&Array.isArray(d.vector_search_scores)&&d.vector_search_scores.length>0){let M=`vector_scores_${C}`;u+=`<div class="aipkit_expandable_section" id="${M}" style="display:none;">`,u+='<div class="aipkit_expandable_header">Vector Search Results</div>',u+='<div class="aipkit_expandable_content">',d.vector_search_scores.forEach((x,L)=>{let A=s(x.provider||"Unknown"),I=x.score!==void 0?Math.round(Number(x.score)*100):"N/A",q=s(x.content_preview||"No preview"),P="";if(x.provider==="OpenAI"&&(x.store_name||x.store_id)){let F=x.store_name||x.store_id;P=` (Store: ${s(F)})`}else x.provider==="Pinecone"&&x.index_name?(P=` (Index: ${s(x.index_name)}`,x.namespace&&(P+=`, NS: ${s(x.namespace)}`),P+=")"):x.provider==="Qdrant"&&x.collection_name&&(P=` (Collection: ${s(x.collection_name)})`);let B="score-poor";if(I!=="N/A"){let F=Number(I);F>=85?B="score-excellent":F>=70?B="score-good":F>=50&&(B="score-fair")}u+='<div class="aipkit_vector_score_item">',u+=`<div class="aipkit_vector_score_provider">${A}${P}</div>`,u+=`<div class="aipkit_vector_score_value ${B}">${I}${I!=="N/A"?"%":""}</div>`,u+=`<div class="aipkit_vector_score_preview">${q}</div>`,u+="</div>"}),u+="</div></div>"}u+="</div>"}r.innerHTML=u,r.querySelectorAll(".aipkit_metadata_info.aipkit_payload_expand").forEach(m=>{m.addEventListener("click",function(g){g.preventDefault();let k=this.getAttribute("data-target"),w=document.getElementById(k),h=this.querySelector(".aipkit_expand_arrow"),y=this.getAttribute("aria-expanded")==="true";w&&(y?(w.style.display="none",this.setAttribute("aria-expanded","false"),this.classList.remove("expanded"),h&&(h.style.transform="rotate(0deg)")):(w.style.display="block",this.setAttribute("aria-expanded","true"),this.classList.add("expanded"),h&&(h.style.transform="rotate(90deg)")))})}),r.querySelectorAll(".aipkit_vector_expand").forEach(m=>{m.addEventListener("click",function(g){g.preventDefault();let k=this.getAttribute("data-target"),w=document.getElementById(k),h=this.getAttribute("aria-expanded")==="true";w&&(h?(w.style.display="none",this.setAttribute("aria-expanded","false"),this.classList.remove("expanded")):(w.style.display="block",this.setAttribute("aria-expanded","true"),this.classList.add("expanded")))})})}window.aipkit_renderAiFormsLog=p})();(function(){"use strict";function p(r,o,i,e,t,n){let s=t||function(w){return w},a=n||function(w){return w?w.charAt(0).toUpperCase()+w.slice(1):""},c=null;if(typeof o=="object"&&o!==null&&Array.isArray(o.messages)&&o.messages.length>0)c=o.messages[0];else if(Array.isArray(o)&&o.length>0)c=o[0];else{r.innerHTML='<p style="text-align:center;padding:20px;font-style:italic;">Unknown log data format.</p>';return}let l=c.content||"(No Content)",d=c.provider||"N/A",u=c.model||"N/A",f=c.timestamp||i.created_at,_=c.usage||null,m=_?_.total_tokens??_.totalTokenCount??null:null,g=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(f):f||"N/A",k='<div class="aipkit_log_generic_details">';k+=`<p><strong>Time:</strong> ${s(g)}</p>`,k+=`<p><strong>Provider:</strong> ${s(d)}</p>`,k+=`<p><strong>Model:</strong> ${s(u)}</p>`,m!==null&&(k+=`<p><strong>Tokens Used:</strong> ${Number(m).toLocaleString()}</p>`),k+=`<h5>Log Content:</h5><pre style="white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; border: 1px solid #eee; padding: 5px;">${s(l)}</pre>`,k+="</div>",r.innerHTML=k}window.aipkit_renderGenericLog=p})();(function(){"use strict";function p(r){r.querySelectorAll(".aipkit_log_debug_toggle").forEach(o=>{let i=o.cloneNode(!0),e=o.parentNode;e&&e.replaceChild(i,o),i.addEventListener("click",t=>{t.preventDefault();let n=i.getAttribute("aria-controls"),s=document.getElementById(n);if(s){let a=s.style.display==="block";s.style.display=a?"none":"block",i.setAttribute("aria-expanded",!a);let c=i.querySelector(".dashicons");c&&(c.className=a?"dashicons dashicons-arrow-right-alt2":"dashicons dashicons-arrow-down-alt2")}})})}window.aipkit_attachDebugToggleListeners=p})();(function(){"use strict";function p(o){return o?o.charAt(0).toUpperCase()+o.slice(1):""}function r(o){let i=document.getElementById("aipkit_log_detail_view");if(!i)return;let e=i.querySelector("#aipkit_log_detail_title"),t=i.querySelector("#aipkit_log_detail_ip"),n=i.querySelector("#aipkit_log_detail_conversation"),s=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(g){return g},c=window.aipkit_ucfirst||p,l=o.user_display_name||(o.is_guest?s.guestLabel||"Guest":s.unknownUserLabel||"Unknown User"),d=o.bot_name;!d&&o.module?d=c(o.module.replace(/_/g," ")):d||(d="(Unknown Source)"),e&&(e.textContent=`${l} with ${d}`);let u=s.logIpLabel||"IP";if(t){let g=o.ip_address;if(g&&g!=="127.0.0.1"&&g!=="::1"){let w=(window.aipkit_chat_config.banned_ips||"").split(",").map(v=>v.trim()).filter(Boolean).includes(g),h=w?"\u{1F513}":"\u{1F6AB}",y=w?"Unblock this IP":"Block this IP",b=`
                <button class="aipkit_ip_block_toggle ${w?"is-banned":""}" data-ip="${a(g)}" data-is-banned="${w?"true":"false"}" title="${a(y)}">
        <span class="aipkit_ip_toggle_icon" aria-hidden="true">${h}</span>
                </button>
                <span class="aipkit_ip_block_status"></span>
            `;t.innerHTML=`<strong>${a(u)}:</strong> ${a(g)} ${b}`}else g?t.innerHTML=`<strong>${a(u)}:</strong> ${a(g)}`:t.innerHTML=""}if(!n)return;let f=o.messages||"[]",_;try{_=JSON.parse(f)}catch(g){console.error("AIPKit Log Detail Renderer: Failed to parse messages JSON.",g),n.innerHTML='<p style="color:red;text-align:center;padding:15px;">Error parsing log data.</p>';return}let m=o.module||"chat";if(m==="content_writer"&&_&&Array.isArray(_.messages)){let k=function(h){try{let y=h&&h.payload_sent;if(!y)return null;let b=Array.isArray(y.messages)?y.messages:Array.isArray(y.input)?y.input:null;if(Array.isArray(b)){let v=b.find(S=>S&&S.role==="user"&&typeof S.content=="string"&&S.content.trim());return v&&v.content?String(v.content):null}}catch{}return null},g={"generate excerpt":"custom_excerpt_prompt","generate tags":"custom_tags_prompt","generate meta description":"custom_meta_prompt","generate focus keyword":"custom_keyword_prompt","generate image prompt":"image_prompt","generate featured image":"featured_image_prompt","generate title":"custom_title_prompt"},w=_.messages;for(let h=0;h<w.length;h++){let y=w[h];if(!y||y.role!=="user"||!y.content||typeof y.content!="string")continue;let b=y.content.trim(),v=b.toLowerCase(),S=null,C=/^generate\s/i.test(b),T=/^content\s+writer\s+request/i.test(b),E=y.request_payload||{};if((C||T)&&h+1<w.length){let x=w[h+1];x&&x.request_payload&&(S=k(x.request_payload)||null)}!S&&(C||T)&&(S=k(E));let M=g[v];if(!S&&M&&typeof E[M]=="string"&&E[M].trim()&&(S=E[M].trim()),!S&&(C||T)&&E&&typeof E=="object")for(let x in E){if(!Object.prototype.hasOwnProperty.call(E,x))continue;let L=E[x];if(/_prompt$/i.test(x)&&typeof L=="string"&&L.trim()){S=L.trim();break}}S&&(y.original_content=y.content,y.content=S)}}m==="image_generator"&&typeof window.aipkit_renderImageGeneratorLog=="function"?window.aipkit_renderImageGeneratorLog(n,_,o,s,a,c):m==="ai_forms"&&typeof window.aipkit_renderAiFormsLog=="function"?window.aipkit_renderAiFormsLog(n,_,o,s,a,c):(m==="chat"||m==="chat_trigger_system"||m==="content_writer")&&typeof window.aipkit_renderChatConversation=="function"?window.aipkit_renderChatConversation(n,_,o,s,a,c):m==="ai_post_enhancer"&&typeof window.aipkit_renderPostEnhancerLog=="function"?window.aipkit_renderPostEnhancerLog(n,_,o,s,a,c):typeof window.aipkit_renderGenericLog=="function"?window.aipkit_renderGenericLog(n,_,o,s,a,c):n.innerHTML=`<p style="color:red;text-align:center;padding:15px;">Error: Log rendering function missing for module type '${m}'.</p>`,n.scrollTop=0,typeof window.aipkit_attachDebugToggleListeners=="function"&&window.aipkit_attachDebugToggleListeners(n),n.querySelectorAll(".aipkit_trigger_activity_toggle").forEach(g=>{let k=g.cloneNode(!0),w=g.parentNode;w&&w.replaceChild(k,g),k.addEventListener("click",h=>{h.preventDefault();let y=k.getAttribute("aria-controls"),b=document.getElementById(y);if(b){let v=b.style.display==="block";b.style.display=v?"none":"block",k.setAttribute("aria-expanded",!v);let S=k.querySelector(".dashicons"),C=k.childNodes[k.childNodes.length-1];if(S&&(S.className=v?"dashicons dashicons-arrow-right-alt2":"dashicons dashicons-arrow-down-alt2"),C&&C.nodeType===Node.TEXT_NODE){let T=C.textContent.trim();v?C.textContent=T.replace("Hide","Show"):C.textContent=T.replace("Show","Hide")}}})})}window.aipkit_displayLogDetails=r})();(function(){"use strict";function p(){let o=document.getElementById("aipkit_log_table_view"),i=document.getElementById("aipkit_log_detail_view");if(!o||!i){console.warn("AIPKit Log Row Handler: Missing containers for logs or detail view.");return}let e="data-log-row-listener-attached";o.getAttribute(e)||(o.addEventListener("click",r),o.setAttribute(e,"true"))}function r(o){let i=o.target.closest(".aipkit_log_row");if(!i)return;let e=i.getAttribute("data-conversation-uuid"),t=i.getAttribute("data-bot-id"),n=i.getAttribute("data-user-id"),s=i.getAttribute("data-session-id");if(!e){console.error("AIPKit Log Row Handler: Missing conversation UUID from clicked row.");return}if(!n&&!s){console.error("AIPKit Log Row Handler: Missing User ID and Session ID from clicked row data.");return}let a=document.getElementById("aipkit_log_table_view");if(a){let m=a.querySelector(".aipkit_log_row.aipkit_selected");m&&m.classList.remove("aipkit_selected"),i.classList.add("aipkit_selected")}let c=document.getElementById("aipkit_log_detail_view");if(!c)return;let l=c.querySelector("#aipkit_log_detail_title"),d=c.querySelector("#aipkit_log_detail_ip"),u=c.querySelector("#aipkit_log_detail_conversation"),f=window.aipkit_dashboard?.text||{};l&&(l.textContent=f.logLoading||"Loading..."),d&&(d.innerHTML=""),u&&(u.innerHTML='<div class="aipkit_detail_spinner"></div>');let _={bot_id:t||null,conversation_uuid:e,user_id:n||null,session_id:s||null};if(typeof window.aipkit_displayLogDetails!="function"){console.error("AIPKit Log Row Handler: aipkit_displayLogDetails function is not defined globally."),u&&(u.innerHTML='<p style="color:red;">Error: Detail rendering function missing.</p>');return}aipkit_apiRequest("aipkit_admin_get_conversation_history",_).then(m=>{if(m&&m.log_data)window.aipkit_displayLogDetails(m.log_data);else throw new Error("Received invalid data for log details.")}).catch(m=>{console.error("AIPKit Log Row Handler: Error fetching log details:",m),l&&(l.textContent=f.logErrorLoading||"Error"),d&&(d.innerHTML=""),u&&(u.innerHTML=`<p style="color:red;text-align:center;padding:15px;">${f.logErrorLoading||"Failed to load details:"} ${window.aipkit_escapeHtml(m.message||"Unknown error")}</p>`)})}window.aipkit_initLogRowClickListener=p})();(function(){"use strict";let p=!1,r=!1,o={updateContainerVisibility(s){let a=document.querySelector('.aipkit_value_chip[data-setting="retention_period_days"]')?.closest(".aipkit_setting_container"),c=document.querySelector(".aipkit_cron_status_panel"),l=s?"flex":"none";a&&(a.style.display=l),c&&(c.style.display=l)},refreshCronStatus(){let s=document.querySelector(".aipkit_cron_status_panel");s&&(s.style.opacity="0.7",window.aipkit_apiRequest("aipkit_get_log_cron_status",{}).then(a=>{a.html&&(s.outerHTML=a.html)}).catch(a=>{console.warn("Failed to refresh cron status:",a)}).finally(()=>{let a=document.querySelector(".aipkit_cron_status_panel");a&&(a.style.opacity="1")}))}},i={init(){this.bindChipClicks(),this.bindPopoverOptions(),this.bindOutsideClicks(),this.bindKeyboardNavigation()},bindChipClicks(){document.querySelectorAll(".aipkit_value_chip").forEach(s=>{s.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation(),!this.disabled&&(i.closeAllPopovers(),i.openPopover(this))})})},bindPopoverOptions(){document.querySelectorAll(".aipkit_popover_option").forEach(s=>{s.addEventListener("click",function(a){a.preventDefault(),i.selectOption(this)})})},bindOutsideClicks(){document.addEventListener("click",function(s){!s.target.closest(".aipkit_value_chip")&&!s.target.closest(".aipkit_chip_popover")&&i.closeAllPopovers()})},bindKeyboardNavigation(){document.querySelectorAll(".aipkit_popover_option").forEach(s=>{s.addEventListener("keydown",function(a){let l=this.closest(".aipkit_chip_popover").querySelectorAll(".aipkit_popover_option"),d=Array.from(l).indexOf(this);switch(a.key){case"ArrowDown":a.preventDefault(),l[(d+1)%l.length].focus();break;case"ArrowUp":a.preventDefault(),l[d===0?l.length-1:d-1].focus();break;case"Enter":case" ":a.preventDefault(),this.click();break;case"Escape":a.preventDefault(),i.closeAllPopovers();break}})})},closeAllPopovers(){document.querySelectorAll(".aipkit_chip_popover").forEach(s=>s.style.display="none")},openPopover(s){let a=s.getAttribute("data-setting"),c=document.querySelector(`.aipkit_chip_popover[data-setting="${a}"]`);if(c){c.style.display="block";let l=c.querySelector(".aipkit_popover_option");l&&l.focus()}},selectOption(s){let a=s.getAttribute("data-value"),c=s.textContent,l=s.closest(".aipkit_chip_popover"),d=l.getAttribute("data-setting"),u=document.querySelector(`.aipkit_value_chip[data-setting="${d}"]`);if(u.textContent=c,u.setAttribute("data-value",a),d==="enable_pruning"){let f=a==="1";u.classList.remove("chip-on","chip-off"),u.classList.add(f?"chip-on":"chip-off"),o.updateContainerVisibility(f)}l.style.display="none",document.getElementById("aipkit_log_settings_form").dispatchEvent(new Event("submit"))}},e={create(s,a,c){this.remove(s);let l=document.createElement("div");l.className="aipkit_log_inline_confirmation",l.innerHTML=`
                <div class="aipkit_log_confirmation_content">
                    <div class="aipkit_log_confirmation_message">
                        <strong>Are you sure?</strong><br>
                        This will permanently delete all log entries older than <strong>${a}</strong>. This action cannot be undone.
                    </div>
                    <div class="aipkit_log_confirmation_buttons">
                        <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_log_btn_small aipkit_log_confirm_delete">Yes, Delete</button>
                        <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_log_btn_small aipkit_log_cancel_delete">Cancel</button>
                    </div>
                </div>
            `,s.querySelector(".aipkit_log_prune_actions").insertAdjacentElement("afterend",l);let u=l.querySelector(".aipkit_log_confirm_delete");l.querySelector(".aipkit_log_cancel_delete").addEventListener("click",()=>this.remove(s)),u.addEventListener("click",()=>{this.remove(s),c()})},remove(s){let a=s.querySelector(".aipkit_log_inline_confirmation");a&&a.remove()}};function t(){let s=document.querySelector('.aipkit_value_chip[data-setting="enable_pruning"]'),a=document.querySelector('.aipkit_value_chip[data-setting="retention_period_days"]');return{enable_pruning:s?s.getAttribute("data-value"):"0",retention_period_days:a?a.getAttribute("data-value"):"90",_ajax_nonce:document.querySelector('input[name="_wpnonce"]')?.value||""}}function n(){let s=document.getElementById("aipkit_log_settings_container");if(!s)return;let a=s.querySelector(".aipkit_chip_settings_panel");a&&(a.style.display="block");let c=s.querySelector(".aipkit_chip_row_combined");c&&(c.style.display="flex");let l=s.querySelector("#aipkit_log_settings_form"),d=s.querySelector("#aipkit_save_log_settings_btn"),u=s.querySelector("#aipkit_prune_logs_now_btn");if(!l||!d||!u){console.warn("AIPKit Log Settings: Missing required form elements.");return}i.init();let f=s.querySelector('.aipkit_value_chip[data-setting="enable_pruning"]');if(f){let _=f.getAttribute("data-value")==="1";o.updateContainerVisibility(_)}l.addEventListener("submit",function(_){if(_.preventDefault(),p||r)return;p=!0;let m=s.querySelector("#aipkit_log_settings_status"),g=d.querySelector(".aipkit_btn-text"),k=d.querySelector(".aipkit_spinner"),w=g?g.textContent:"Save";d.disabled=!0,g&&(g.textContent="Saving..."),k&&(k.style.display="inline-block"),m&&(m.textContent="",m.className="aipkit_save_status_container");let h=t();window.aipkit_apiRequest("aipkit_save_log_settings",h).then(y=>{m&&(m.textContent=y.message||"Settings saved!",m.classList.add("success")),setTimeout(o.refreshCronStatus,500)}).catch(y=>{m&&(m.textContent="Error: "+y.message,m.classList.add("error"))}).finally(()=>{p=!1,d.disabled=!1,g&&(g.textContent=w),k&&(k.style.display="none"),setTimeout(()=>{m&&(m.textContent="",m.className="aipkit_save_status_container")},4e3)})}),u.addEventListener("click",function(){if(p||r)return;let _=s.querySelector('.aipkit_value_chip[data-setting="retention_period_days"]'),m=_?_.getAttribute("data-value"):"90",g=_?_.textContent:"90 Days";e.create(s,g,function(){r=!0;let k=s.querySelector("#aipkit_log_settings_status"),w=u.querySelector(".aipkit_btn-text"),h=u.querySelector(".aipkit_spinner"),y=w?w.textContent:"Delete Logs Now";u.disabled=!0,w&&(w.textContent="Deleting..."),h&&(h.style.display="inline-block"),k&&(k.textContent="",k.className="aipkit_save_status_container");let b={retention_period_days:m,_ajax_nonce:document.querySelector('input[name="_wpnonce"]')?.value||""};window.aipkit_apiRequest("aipkit_prune_logs_now",b).then(v=>{k&&(k.textContent=v.message||"Logs pruned successfully!",k.classList.add("success")),setTimeout(o.refreshCronStatus,500)}).catch(v=>{k&&(k.textContent="Error: "+v.message,k.classList.add("error"))}).finally(()=>{r=!1,u.disabled=!1,w&&(w.textContent=y),h&&(h.style.display="none"),setTimeout(()=>{k&&(k.textContent="",k.className="aipkit_save_status_container")},4e3)})})})}window.aipkit_initLogSettings=n})();(function(){"use strict";function p(o){let i=o.target.closest(".aipkit_ip_block_toggle");if(!i)return;let e=i.dataset.ip,t=i.dataset.isBanned==="true",n=i.querySelector(".aipkit_ip_toggle_icon"),s=i.nextElementSibling;if(!e||!n)return;i.disabled=!0;let a=n.textContent;n.dataset.originalEmoji=a,n.textContent="\u23F3";let c={ip:e,is_banned:t,_ajax_nonce:window.aipkit_chat_config.nonce_toggle_ip_block};window.aipkit_apiRequest("aipkit_toggle_ip_block_status",c).then(l=>{let d=!t;i.dataset.isBanned=d,i.classList.toggle("is-banned",d),n.textContent=d?"\u{1F513}":"\u{1F6AB}",i.title=d?"Unblock this IP":"Block this IP",window.aipkit_chat_config.banned_ips=l.new_banned_ips_list||"",s&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(s,"success",l.message||"Updated!",2e3)}).catch(l=>{console.error("Error toggling IP block status:",l),n.textContent=n.dataset.originalEmoji||(t?"\u{1F513}":"\u{1F6AB}"),s&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(s,"error",l.message||"Error!",3e3)}).finally(()=>{i.disabled=!1})}function r(){let o=document.getElementById("aipkit_log_detail_view");o&&!o.dataset.ipBlockerListener&&(o.addEventListener("click",p),o.dataset.ipBlockerListener="true")}window.aipkit_initIpBlocker=r})();(function(){"use strict";function p(o=1){let i=document.getElementById("aipkit_logs_container");if(!i){console.error("AIPKit Chat Logs Fetch: Main logs module container (#aipkit_logs_container) not found.");return}let e=i.querySelector("#aipkit_log_table_view"),t=i.querySelector("#aipkit_log_detail_view"),n=window.aipkit_dashboard?.text||{};if(!e||!t){console.error("AIPKit Chat Logs Fetch: Required log containers (#aipkit_log_table_view or #aipkit_log_detail_view) not found inside #aipkit_logs_container.");return}e.innerHTML=`
          <p style="text-align:center; padding:30px;">
            <span class="aipkit_spinner"
                  style="display:inline-block;width:20px;height:20px;border-width:3px;vertical-align:middle;margin-right:10px;"
            ></span>
            ${n.logLoading||"Loading logs..."}
          </p>`;let s=t.querySelector("#aipkit_log_detail_title"),a=t.querySelector("#aipkit_log_detail_ip"),c=t.querySelector("#aipkit_log_detail_conversation"),l=n.logViewTitle||"Chat Log Details";s&&(s.textContent=l),a&&(a.innerHTML=""),c&&(c.innerHTML='<div class="aipkit_detail_spinner"></div>');let d=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{},u={log_page:o,filter_user_name:d.user_name||"",filter_chatbot_id:d.chatbot_id||"",filter_message_like:d.message_like||""};aipkit_apiRequest("aipkit_get_chat_logs_html",u).then(f=>{if(f&&f.html){e.innerHTML=f.html,r(),typeof window.aipkit_initLogRowClickListener=="function"?window.aipkit_initLogRowClickListener():console.error("AIPKit Logs Fetch: Cannot initialize row click listener."),typeof window.aipkit_initLogFiltersUI=="function"?window.aipkit_initLogFiltersUI():console.error("AIPKit Logs Fetch: Cannot initialize filter UI.");let _=e.querySelector(".aipkit_log_row");_?setTimeout(()=>{let m=e.querySelector(".aipkit_log_row");m&&m===_&&!e.querySelector(".aipkit_log_row.aipkit_selected")&&_.click()},100):(s&&(s.textContent=l),a&&(a.innerHTML=""),c&&(c.innerHTML=`<p style="text-align:center; padding:20px; font-style:italic;">${n.noLogsFound||"No logs found matching your criteria."}</p>`))}else throw new Error("Invalid HTML content for logs.")}).catch(f=>{console.error("AIPKit Chat Logs Fetch: Error fetching logs:",f),e.innerHTML=`<p style="color:red; text-align:center; padding:20px;">${n.logErrorLoading||"Failed to load logs:"} ${aipkit_escapeHtml(f.message||"Unknown error")}</p>`,s&&(s.textContent=l),a&&(a.innerHTML=""),c&&(c.innerHTML=`<p style="color:red; text-align:center; padding:15px;">${n.logErrorLoading||"Error loading logs."}</p>`)})}function r(){let o=document.getElementById("aipkit_log_table_view");if(!o)return;let i="data-pagination-listener-attached";o.getAttribute(i)||(o.addEventListener("click",function(e){let t=e.target.closest(".aipkit-log-footer .aipkit_pagination-links a");if(!(!t||!t.href)){e.preventDefault();try{let s=new URL(t.href).searchParams.get("log_page")||1;p(parseInt(s,10))}catch(n){console.error("AIPKit Logs Fetch: Error parsing pagination URL:",n)}}}),o.setAttribute(i,"true"))}window.aipkit_fetchAndDisplayLogs=p,window.aipkit_initLogPagination=r})();(function(){"use strict";let p={user_name:"",chatbot_id:"",message_like:""};function r(){return{...p}}function o(){return!!(p.user_name||p.chatbot_id||p.message_like)}function i(){let c=document.getElementById("aipkit_log_table_view");if(!c)return;s(c),a(c);let l={chatbot:"chatbot_id",user:"user_name",message:"message_like"};c.querySelectorAll(".aipkit_log_filter_btn").forEach(u=>{let f=u.getAttribute("data-filter-type");if(f==="module")return;let _=l[f];_&&p[_]?u.querySelector(".dashicons").className="dashicons dashicons-image-rotate":u.querySelector(".dashicons").className="dashicons dashicons-filter"});let d="data-log-filter-outside-click";document.body.getAttribute(d)||(document.addEventListener("click",function(u){let f=document.querySelector('.aipkit_log_filter_box[style*="display: block"]');if(!f)return;let _=f.getAttribute("data-filter-box"),m=document.querySelector(`.aipkit_log_filter_btn[data-filter-type="${_}"]`);!f.contains(u.target)&&(!m||!m.contains(u.target))&&(f.style.display="none")},!0),document.body.setAttribute(d,"true"))}function e(){let c=document.getElementById("aipkit_log_table_view");if(!c)return;let l="data-log-filter-delegate-listener";if(c.getAttribute(l))return;let d={chatbot:"chatbot_id",user:"user_name",message:"message_like"};c.addEventListener("click",function(u){let f=u.target.closest(".aipkit_log_filter_btn");if(!f)return;let _=f.getAttribute("data-filter-type");if(!_||_==="module")return;let m=d[_];if(m)if(p[m])p[m]="",typeof window.aipkit_fetchAndDisplayLogs=="function"&&window.aipkit_fetchAndDisplayLogs(1);else{let g=c.querySelector(`.aipkit_log_filter_box[data-filter-box="${_}"]`);if(!g)return;c.querySelectorAll(".aipkit_log_filter_box").forEach(w=>{w!==g&&w.style.display==="block"&&(w.style.display="none")});let k=g.style.display==="none"||!g.style.display;if(g.style.display=k?"block":"none",k){let w=g.querySelector(".aipkit_log_filter_input, .aipkit_log_filter_select");w&&w.focus()}}}),c.addEventListener("change",t),c.addEventListener("keydown",t),c.setAttribute(l,"true")}function t(c){let l=c.target;l.matches(".aipkit_log_filter_select")&&c.type==="change"?n(l):l.matches(".aipkit_log_filter_input")&&c.type==="keydown"&&c.key==="Enter"&&(c.preventDefault(),n(l))}function n(c){let l=c.getAttribute("data-filter-field");if(!l)return;let d=c.value.trim();p[l]!==d&&(p[l]=d,typeof window.aipkit_fetchAndDisplayLogs=="function"&&window.aipkit_fetchAndDisplayLogs(1));let u=c.closest(".aipkit_log_filter_box");u&&(u.style.display="none")}function s(c){let l=document.getElementById("aipkit_available_bots_json");if(!l)return;let d=l.getAttribute("data-bots")||"[]",u=[];try{u=JSON.parse(d)}catch(_){console.error("AIPKit Logs Filters: Failed to parse chatbot JSON for filter",_);return}let f=c.querySelector('select[data-filter-field="chatbot_id"]');if(f){for(;f.options.length>1;)f.remove(1);Array.isArray(u)&&u.forEach(_=>{let m=document.createElement("option");m.value=_.id,m.textContent=_.title,f.appendChild(m)})}}function a(c){c.querySelectorAll(".aipkit_log_filter_input, .aipkit_log_filter_select").forEach(d=>{let u=d.getAttribute("data-filter-field");u&&p.hasOwnProperty(u)&&(d.value=p[u])})}window.aipkit_initLogFiltersUI=i,window.aipkit_attachLogFilterDelegatedListeners=e,window.aipkit_getCurrentLogFilters=r})();(function(){"use strict";let p=!1,r=!1;function o(){let k=document.getElementById("aipkit_log_table_view"),w=document.getElementById("aipkit_logs_container");if(!w){console.warn("AIPKit Log Actions: Main Logs container (#aipkit_logs_container) not found.");return}let h="data-log-bulk-action-listener-attached";w.getAttribute(h)||(w.addEventListener("click",i),document.addEventListener("click",n,!0),w.setAttribute(h,"true"))}function i(k){let w=k.target.closest("#aipkit_log_bulk_actions_btn"),h=k.target.closest('.aipkit_log_action_menu_item[data-action="export-all"]'),y=k.target.closest('.aipkit_log_action_menu_item[data-action="delete-all"]'),b=k.target.closest(".aipkit_log_export_confirm_btn"),v=k.target.closest(".aipkit_log_delete_confirm_btn"),S=k.target.closest(".aipkit_log_action_cancel_btn");if(w)k.stopPropagation(),e();else if(h){if(k.stopPropagation(),t(),p||r){console.warn("AIPKit Log Actions: Another bulk action is already in progress.");return}s(!1)}else if(y){if(k.stopPropagation(),t(),p||r){console.warn("AIPKit Log Actions: Another bulk action is already in progress.");return}a(!1)}else b?(c(),u()):v?(c(),m()):S&&c()}function e(){let k=document.getElementById("aipkit_log_bulk_action_menu"),w=document.getElementById("aipkit_log_bulk_actions_btn");if(k&&w){let h=w.getBoundingClientRect();k.style.display=k.style.display==="block"?"none":"block",k.style.display==="block"&&(k.style.top=`${h.bottom+window.scrollY+2}px`,k.style.left=`${h.left+window.scrollX}px`)}}function t(){let k=document.getElementById("aipkit_log_bulk_action_menu");k&&(k.style.display="none")}function n(k){let w=document.getElementById("aipkit_log_bulk_action_menu"),h=document.getElementById("aipkit_log_bulk_actions_btn");w&&w.style.display==="block"&&!w.contains(k.target)&&(!h||!h.contains(k.target))&&t();let y=document.getElementById("aipkit_log_bulk_action_confirmation_area");if(y&&y.style.display==="block"&&!y.contains(k.target)){let b=document.querySelector(".aipkit_log_action_menu_item");(!b||!b.contains(k.target))&&c()}}function s(k){let w=window.aipkit_dashboard?.text||{},h=document.getElementById("aipkit_log_bulk_action_confirmation_area"),y=document.getElementById("aipkit_log_bulk_actions_btn");if(!h||!y)return;let b=!1;if(k){let C=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{};b=Object.values(C).some(T=>T&&T!=="")}let v=k&&b?w.logExportFilteredConfirmMsg||"Export all messages matching current filters?":w.logExportAllConfirmMsg||"Export all messages? This might take a while for large datasets.";h.innerHTML=`
            <p>${v}</p>
            <div class="aipkit_log_bulk_action_confirmation_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_log_action_cancel_btn">${w.cancel||"Cancel"}</button>
                <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_log_export_confirm_btn">${w.confirm||"Confirm"}</button>
            </div>`,h.style.display="block",h.setAttribute("data-action-type","export");let S=y.getBoundingClientRect();h.style.top=`${S.bottom+window.scrollY+2}px`,h.style.right="auto",h.style.left=`${S.left+window.scrollX}px`,d()}function a(k){let w=window.aipkit_dashboard?.text||{},h=document.getElementById("aipkit_log_bulk_action_confirmation_area"),y=document.getElementById("aipkit_log_bulk_actions_btn");if(!h||!y)return;let b=!1;if(k){let T=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{};b=Object.values(T).some(E=>E&&E!=="")}let v=k&&b?w.logDeleteFilteredConfirmMsg||"Delete all messages matching current filters? This cannot be undone.":w.logDeleteAllConfirmMsg||"Delete ALL messages? This will remove ALL chat history and cannot be undone.",S=k&&b?w.confirmDeleteFiltered||"Confirm Delete Filtered":w.confirmDeleteAll||"Confirm Delete ALL";h.innerHTML=`
            <p style="color:#c53030;font-weight:bold;">${v}</p>
            <div class="aipkit_log_bulk_action_confirmation_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_log_action_cancel_btn">${w.cancel||"Cancel"}</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_log_delete_confirm_btn">${S}</button>
            </div>`,h.style.display="block",h.setAttribute("data-action-type","delete");let C=y.getBoundingClientRect();h.style.top=`${C.bottom+window.scrollY+2}px`,h.style.right="auto",h.style.left=`${C.left+window.scrollX}px`,d()}function c(){let k=document.getElementById("aipkit_log_bulk_action_confirmation_area");k&&(k.style.display="none")}function l(k,w,h="info"){let y=document.getElementById("aipkit_log_bulk_action_status_area"),b=y?.querySelector(".aipkit_log_bulk_action_spinner"),v=y?.querySelector(".aipkit_log_bulk_action_message");!y||!b||!v||(v.textContent=k,b.style.display=w?"inline-block":"none",y.style.display="inline-flex",y.className=`aipkit_log_bulk_action_status_area aipkit_status-${h}`)}function d(){let k=document.getElementById("aipkit_log_bulk_action_status_area");k&&(k.style.display="none")}function u(){if(p||r)return;p=!0;let k=window.aipkit_dashboard?.text||{};l(k.logExportStarting||"Starting...",!0);let w=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{};f(0,w,"",-1)}function f(k,w,h,y){let b=window.aipkit_dashboard?.text||{},v={page:k,total_count:y,filter_user_name:w.user_name||"",filter_chatbot_id:w.chatbot_id??"",filter_message_like:w.message_like||""},S=y>0?(b.logExportProgress||"Exporting conversation %d / %d...").replace("%d",k*50).replace("%d",y):b.logExportStarting||"Starting...";l(S,!0),aipkit_apiRequest("aipkit_export_chat_logs",v).then(C=>{let T=C.total_count??-1;if(T===0&&k===0){l(b.logExportNoLogs||"No messages found to export.",!1,"info"),setTimeout(d,3e3),p=!1;return}let E=C.csv_chunk||"",M=h+E,x=C.exported_count||0,L=C.is_last_batch||!1,A=T>0?T:x,I=(b.logExportProgress||"Exporting conversation %d / %d...").replace("%d",x).replace("%d",A);l(I,!0),L?(_(M),l(b.logExportComplete||"Done!",!1,"success"),setTimeout(d,4e3),p=!1):setTimeout(()=>{f(k+1,w,M,T)},100)}).catch(C=>{console.error("AIPKit Log Export: Error fetching export batch:",C),l(`${b.logExportError||"Export failed:"} ${C.message}`,!1,"error"),setTimeout(d,6e3),p=!1})}function _(k){if(!k)return;let w="\uFEFF",h=new Blob([w+k],{type:"text/csv;charset=utf-8;"}),y=document.createElement("a"),b=URL.createObjectURL(h),S=new Date().toISOString().slice(0,10);y.setAttribute("href",b),y.setAttribute("download",`aipkit-chat-logs-${S}.csv`),y.style.visibility="hidden",document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(b)}function m(){if(p||r)return;r=!0;let k=window.aipkit_dashboard?.text||{};l(k.logDeleteStarting||"Starting...",!0,"info");let w=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{};g(0,w,0,-1)}function g(k,w,h,y){let b=window.aipkit_dashboard?.text||{},v={page:k,deleted_count:h,total_count:y,filter_user_name:w.user_name||"",filter_chatbot_id:w.chatbot_id??"",filter_message_like:w.message_like||""},S=y>0?(b.logDeleteProgress||"Deleting conversation %d / %d...").replace("%d",h).replace("%d",y):b.logDeleteStarting||"Starting...";l(S,!0,"info"),aipkit_apiRequest("aipkit_delete_chat_logs",v).then(C=>{let T=C.total_count??-1;if(T===0&&k===0){l(b.logDeleteNoLogs||"No messages found to delete.",!1,"info"),setTimeout(d,3e3),r=!1;return}let E=C.deleted_total||h,M=C.is_last_batch||!1,x=T>0?T:E,L=(b.logDeleteProgress||"Deleting conversation %d / %d...").replace("%d",E).replace("%d",x);l(L,!0,"info"),M?(l(b.logDeleteComplete||"Done!",!1,"success"),setTimeout(()=>{d(),typeof window.aipkit_fetchAndDisplayLogs=="function"&&window.aipkit_fetchAndDisplayLogs(1)},3e3),r=!1):setTimeout(()=>{g(k+1,w,E,T)},200)}).catch(C=>{console.error("AIPKit Log Delete: Error processing delete batch:",C),l(`${b.logDeleteError||"Deletion failed:"} ${C.message}`,!1,"error"),setTimeout(d,6e3),r=!1})}window.aipkit_initLogBulkActions=o})();(function(){"use strict";function p(){if(typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():console.error("AIPKit Logs Main: aipkit_initializeTabs function not found."),typeof window.aipkit_attachLogFilterDelegatedListeners=="function"?window.aipkit_attachLogFilterDelegatedListeners():console.error("AIPKit Logs Main: aipkit_attachLogFilterDelegatedListeners function not found."),typeof window.aipkit_fetchAndDisplayLogs=="function")window.aipkit_fetchAndDisplayLogs(1);else{console.error("AIPKit Logs Main: aipkit_fetchAndDisplayLogs function not found. Cannot fetch logs.");let r=document.getElementById("aipkit_log_table_view");r&&(r.innerHTML='<p style="color:red;">Error: Log fetching script failed to load.</p>')}typeof window.aipkit_initLogRowClickListener=="function"?window.aipkit_initLogRowClickListener():console.error("AIPKit Logs Main: aipkit_initLogRowClickListener function not found."),typeof window.aipkit_initLogBulkActions=="function"?window.aipkit_initLogBulkActions():console.error("AIPKit Logs Main: aipkit_initLogBulkActions function not found."),typeof window.aipkit_initLogSettings=="function"?window.aipkit_initLogSettings():console.error("AIPKit Logs Main: aipkit_initLogSettings function not found."),typeof window.aipkit_initIpBlocker=="function"?window.aipkit_initIpBlocker():console.error("AIPKit Logs Main: aipkit_initIpBlocker function not found.")}window.aipkit_initLogs=p})();(function(){"use strict";function p(){let r=document.getElementById("chatbot-create-new-content");if(!r)return;let o=r.querySelector("#aipkit_create_new_bot_btn"),i=r.querySelector("#aipkit_new_bot_name"),e=r.querySelector("#aipkit_create_bot_message");if(!o||!i||!e)return;let t=o.querySelector(".aipkit_spinner");o.addEventListener("click",function(){let n=i.value.trim();if(!n){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Please enter a name for the chatbot."):(e.textContent="Please enter a name for the chatbot.",e.style.color="red",setTimeout(()=>{e.textContent="",e.style.color=""},4e3)),i.focus();return}o.disabled=!0,t&&(t.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(o,"Creating..."):o.textContent="Creating...",e.textContent="",e.className="aipkit_form-help",aipkit_apiRequest("aipkit_create_chatbot",{bot_name:n}).then(s=>{let a=s.message||"Chatbot created!";typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"success",a):(e.textContent=a,e.style.color="green",setTimeout(()=>{e.textContent="",e.style.color=""},4e3)),i.value="";let c=s.bot_id;if(!c){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Creation succeeded but failed to get bot ID. Please reload."):(e.textContent="Creation succeeded but failed to get bot ID. Please reload.",e.style.color="red");return}aipkit_loadModule("chatbot",{force_active_bot_id:c},function(l){if(l){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Bot created, but UI failed to refresh. Please reload."):(e.textContent="Bot created, but UI failed to refresh. Please reload.",e.style.color="red");return}setTimeout(()=>{typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(c)},50)})}).catch(s=>{let a="Error: "+(s.message||"Unknown error during creation.");typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error",a):(e.textContent=a,e.style.color="red",setTimeout(()=>{e.textContent="",e.style.color=""},4e3))}).finally(()=>{o.disabled=!1,t&&(t.style.display="none"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(o,"Start Creating"):(o.textContent="Start Creating",t&&o.appendChild(t))})})}window.aipkit_initCreateNewBot=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Chat Saver: Main content container (#aipkit_chatbot_main_tab_content_container) not found.");return}r.addEventListener("submit",function(o){let i=o.target.closest(".aipkit_chatbot_settings_form");if(!i)return;o.preventDefault();let e=i.getAttribute("data-bot-id"),t=i.querySelector(".aipkit_save_bot_settings_btn");t||(t=document.getElementById("aipkit_chatbot_header_save_btn"));let n=document.getElementById("aipkit_chatbot_global_save_status_container"),s=i.querySelector(`#aipkit_action_feedback_${e}`);if(!e||!t||!n){console.warn("AIPKit Chat Saver: Missing elements for save (botId, button, or global save status span). Form:",i),n||console.warn("AIPKit Chat Saver: Could not find global save status span with ID 'aipkit_chatbot_global_save_status_container'.");return}s&&(s.innerHTML=""),n.textContent="",n.className="aipkit_save_status_container",t.disabled=!0,t.classList.add("aipkit_loading");let a=t.querySelector(".aipkit_spinner");a||(a=document.createElement("span"),a.className="aipkit_spinner",t.appendChild(a)),a.style.display="inline-block";let c=new FormData(i),l={};for(let[u,f]of c.entries())if(u.endsWith("[]")){let _=u.slice(0,-2);l[_]=c.getAll(u)}else l.hasOwnProperty(u)||(l[u]=f);l.bot_id=e,function(){let f=document.getElementById(`aipkit_bot_${e}_custom_theme_modal`);if(!f)return;f.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["], textarea[name^="custom_theme_settings["]').forEach(m=>{let g=m.getAttribute("name");if(!g)return;let k=!0;(m.type==="checkbox"||m.type==="radio")&&(k=m.checked),k?l[g]=m.value:m.type==="checkbox"&&(l[g]="0")})}(),function(){let f=document.getElementById(`aipkit_bot_${e}_ai_params_modal`);if(!f)return;let _=f.querySelector(".aipkit_modal_body")||f;["temperature","max_completion_tokens","reasoning_effort"].forEach(g=>{let k=_.querySelector(`[name="${g}"]`);k&&(l[g]=k.value)})}(),function(){let f=document.getElementById(`aipkit_bot_${e}_web_settings_modal`);if(!f)return;let _=f.querySelector(".aipkit_modal_body")||f,m=g=>_.querySelector(`[name="${g}"]`);["openai_web_search_context_size","openai_web_search_loc_type","openai_web_search_loc_country","openai_web_search_loc_city","openai_web_search_loc_region","openai_web_search_loc_timezone"].forEach(g=>{let k=m(g);k&&(l[g]=k.value)}),["google_grounding_mode","google_grounding_dynamic_threshold"].forEach(g=>{let k=m(g);k&&(l[g]=k.value)})}(),function(){let f=document.getElementById(`aipkit_bot_${e}_vector_store_modal`);if(!f)return;let _=b=>f.querySelector(b),m=f.querySelector(".aipkit_modal_body")||f,g=m.querySelector('input[name="enable_vector_store"]');g&&(l.enable_vector_store=g.checked?"1":"0");let k=_('select[name="vector_store_provider"]');if(k&&(l.vector_store_provider=k.value),l.vector_store_provider==="openai"){let b=_('select[name="openai_vector_store_ids[]"]');b?l.openai_vector_store_ids=Array.from(b.selectedOptions).map(v=>v.value):l.openai_vector_store_ids=[]}else delete l.openai_vector_store_ids;if(l.vector_store_provider==="pinecone"){let b=_('select[name="pinecone_index_name"]');b&&(l.pinecone_index_name=b.value)}else delete l.pinecone_index_name;if(l.vector_store_provider==="qdrant"){let b=_('select[name="qdrant_collection_names[]"]');if(b){let v=Array.from(b.selectedOptions).map(S=>S.value);l.qdrant_collection_names=v,l.qdrant_collection_name=v[0]||""}else l.qdrant_collection_names=[],l.qdrant_collection_name=""}else delete l.qdrant_collection_names,delete l.qdrant_collection_name;if(l.vector_store_provider==="pinecone"||l.vector_store_provider==="qdrant"){let b=_('select[name="vector_embedding_provider"]'),v=_('select[name="vector_embedding_model"]');b&&(l.vector_embedding_provider=b.value),v&&(l.vector_embedding_model=v.value)}else delete l.vector_embedding_provider,delete l.vector_embedding_model;let w=_('input[name="vector_store_top_k"]');w&&(l.vector_store_top_k=w.value);let h=_('input[name="vector_store_confidence_threshold"]');h&&(l.vector_store_confidence_threshold=h.value);let y=m.querySelector('input[name="content_aware_enabled"]');y&&(l.content_aware_enabled=y.checked?"1":"0")}(),function(){let f=document.getElementById(`aipkit_bot_${e}_conversations_modal`);if(!f)return;let _=f.querySelector(".aipkit_modal_body")||f,m=_.querySelector('input[name="stream_enabled"]');m&&(l.stream_enabled=m.checked?"1":"0");let g=_.querySelector('input[name="openai_conversation_state_enabled"]');g&&(l.openai_conversation_state_enabled=g.checked?"1":"0");let k=_.querySelector('input[name="max_messages"]');k&&(l.max_messages=k.value)}(),function(){let f=document.getElementById(`aipkit_bot_${e}_images_modal`);if(!f)return;let _=f.querySelector(".aipkit_modal_body")||f,m=_.querySelector('select[name="chat_image_model_id"]'),g=_.querySelector('input[name="image_triggers"]');m&&(l.chat_image_model_id=m.value),g&&(l.image_triggers=g.value);let k=_.querySelector('input[name="enable_image_upload"]');k&&(l.enable_image_upload=k.checked?"1":"0")}(),function(){let f=document.getElementById(`aipkit_bot_${e}_audio_settings_modal`);if(!f)return;let _=f.querySelector(".aipkit_modal_body")||f,m=w=>_.querySelector(`[name="${w}"]`);function g(w){let h=m(w);h&&(l[w]=h.checked?"1":"0")}function k(w){let h=m(w);h&&(l[w]=h.value)}g("enable_voice_input"),k("stt_provider"),k("stt_openai_model_id"),g("tts_enabled"),k("tts_provider"),k("tts_google_voice_id"),k("tts_openai_voice_id"),k("tts_openai_model_id"),k("tts_elevenlabs_voice_id"),k("tts_elevenlabs_model_id"),g("tts_auto_play"),g("enable_realtime_voice"),g("direct_voice_mode"),g("input_audio_noise_reduction"),k("realtime_model"),k("realtime_voice"),k("turn_detection"),k("input_audio_format"),k("output_audio_format"),k("speed")}(),function(){let f=document.getElementById(`aipkit_bot_${e}_token_mgmt_modal`);if(!f)return;let _=f.querySelector(".aipkit_modal_body")||f,m=_.querySelector('input[name="token_guest_limit"]'),g=_.querySelector('input[name="token_user_limit"]'),k=_.querySelector('select[name="token_limit_mode"]'),w=_.querySelector('select[name="token_reset_period"]'),h=_.querySelector('input[name="token_limit_message"]');m&&(l.token_guest_limit=m.value),g&&(l.token_user_limit=g.value),k&&(l.token_limit_mode=k.value),w&&(l.token_reset_period=w.value),h&&(l.token_limit_message=h.value),_.querySelectorAll('input[name^="token_role_limits["]').forEach(b=>{let v=b.getAttribute("name");v&&(l[v]=b.value)})}(),function(){let f=document.getElementById(`aipkit_bot_${e}_starters_modal`);if(!f)return;let m=(f.querySelector(".aipkit_modal_body")||f).querySelector('textarea[name="conversation_starters"]');m&&(l.conversation_starters=m.value)}(),function(){let f=document.getElementById(`aipkit_bot_${e}_popup_settings_modal`);if(!f)return;let _=f.querySelector(".aipkit_modal_body")||f;function m(D){return _.querySelector(`[name="${D}"]`)}function g(D){return _.querySelector(`[name="${D}"]:checked`)}function k(D,$){typeof $<"u"&&$!==null&&(l[D]=$)}let w=m("popup_position");w&&k("popup_position",w.value);let h=m("popup_delay");h&&k("popup_delay",h.value);let y=m("site_wide_enabled");y&&k("site_wide_enabled",y.checked?"1":"0");let b=m("popup_icon_style");if(b)k("popup_icon_style",b.value);else{let D=g("popup_icon_style");D&&k("popup_icon_style",D.value)}let v=m("popup_icon_size");v&&k("popup_icon_size",v.value);let S=m("popup_icon_type");if(S)k("popup_icon_type",S.value);else{let D=g("popup_icon_type");D&&k("popup_icon_type",D.value)}let C=g("popup_icon_default");C&&k("popup_icon_default",C.value);let T=m("popup_icon_custom_url");T&&k("popup_icon_custom_url",T.value);let E=m("popup_label_enabled");E&&k("popup_label_enabled",E.checked?"1":"0");let M=m("popup_label_text");M&&k("popup_label_text",M.value);let x=m("popup_label_mode");x&&k("popup_label_mode",x.value);let L=m("popup_label_size");L&&k("popup_label_size",L.value);let A=m("popup_label_delay_seconds");A&&k("popup_label_delay_seconds",A.value);let I=m("popup_label_auto_hide_seconds");I&&k("popup_label_auto_hide_seconds",I.value);let q=m("popup_label_dismissible");q&&k("popup_label_dismissible",q.checked?"1":"0");let P=m("popup_label_show_on_desktop");P&&k("popup_label_show_on_desktop",P.checked?"1":"0");let B=m("popup_label_show_on_mobile");B&&k("popup_label_show_on_mobile",B.checked?"1":"0");let F=m("popup_label_frequency");F&&k("popup_label_frequency",F.value);let O=m("popup_label_version");O&&k("popup_label_version",O.value)}();let d=l.provider;if(d==="OpenAI")l.model=l.openai_model;else if(d==="OpenRouter")l.model=l.openrouter_model;else if(d==="Google")l.model=l.google_model;else if(d==="Azure")l.model=l.azure_deployment;else if(d==="DeepSeek")l.model=l.deepseek_model;else if(d==="Ollama"){let u=i.querySelector('select[name="ollama_model"]'),f=typeof l.ollama_model<"u"?l.ollama_model:u?u.value:"";l.model=f||""}else l.model="";delete l.openai_model,delete l.openrouter_model,delete l.google_model,delete l.azure_deployment,delete l.deepseek_model,delete l.ollama_model,function(){let f=document.getElementById(`aipkit_bot_${e}_vector_store_modal`),_=g=>f?f.querySelector(g):null,m=g=>i.querySelector(g);if(l.vector_store_provider==="openai"){let g=_('select[name="openai_vector_store_ids[]"]')||m('select[name="openai_vector_store_ids[]"]');g?l.openai_vector_store_ids=Array.from(g.selectedOptions).map(k=>k.value):l.openai_vector_store_ids=[]}else l.hasOwnProperty("openai_vector_store_ids")&&delete l.openai_vector_store_ids;if(l.vector_store_provider==="pinecone"||l.vector_store_provider==="qdrant"){if(l.vector_store_provider==="qdrant"){let w=_('select[name="qdrant_collection_names[]"]')||m('select[name="qdrant_collection_names[]"]');if(w){let h=Array.from(w.selectedOptions).map(y=>y.value);l.qdrant_collection_names=h,l.qdrant_collection_name=h[0]||""}else l.qdrant_collection_names=[],l.qdrant_collection_name=""}else if(l.vector_store_provider==="pinecone"){let w=_('select[name="pinecone_index_name"]')||m('select[name="pinecone_index_name"]');w&&(l.pinecone_index_name=w.value)}let g=_('select[name="vector_embedding_provider"]')||m('select[name="vector_embedding_provider"]');g&&(l.vector_embedding_provider=g.value);let k=_('select[name="vector_embedding_model"]')||m('select[name="vector_embedding_model"]');k&&(l.vector_embedding_model=k.value)}else delete l.pinecone_index_name,delete l.qdrant_collection_name,delete l.qdrant_collection_names,delete l.vector_embedding_provider,delete l.vector_embedding_model}(),aipkit_apiRequest("aipkit_save_chatbot_settings",l).then(u=>{n.textContent=u.message||"Settings Saved!",n.classList.add("success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(e)}).catch(u=>{n.textContent="Error: "+u.message,n.classList.add("error")}).finally(()=>{t.disabled=!1,t.classList.remove("aipkit_loading");let u=t.querySelector(".aipkit_spinner");if(u&&(u.style.display="none"),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(t,"Save");else{let f=Array.from(t.childNodes).find(_=>_.nodeType===Node.TEXT_NODE);f?f.textContent="Save":t.insertBefore(document.createTextNode("Save"),t.firstChild),u&&t.appendChild(u)}setTimeout(()=>{n&&(n.textContent="",n.className="aipkit_save_status_container")},3e3)})})}window.aipkit_initSaveBotSettings=p})();(function(){"use strict";function p(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");i||console.warn("AIPKit Chat Deleter: Main content container not found."),i&&i.querySelectorAll(".aipkit_delete_bot_btn").forEach(t=>{t.getAttribute("data-is-default")==="1"&&(t.disabled=!0)}),i&&i.addEventListener("click",function(t){let n=t.target.closest(".aipkit_delete_bot_btn");if(!n||n.disabled)return;let s=n.getAttribute("data-bot-id"),a=n.getAttribute("data-bot-name"),c=n.closest(".aipkit_chatbot_settings_form"),d=document.getElementById("aipkit_header_action_feedback")||(c?c.querySelector(`#aipkit_action_feedback_${s}`):null),u=document.getElementById("aipkit_chatbot_global_save_status_container");if(!s||!d){console.error("AIPKit Chat Deleter: Missing required elements (botId, actionFeedbackArea) for:",n);return}let f=`aipkit_delete_confirmation_${s}`,_=d.querySelector(`#${f}`);_||(_=document.createElement("div"),_.id=f,_.className="aipkit_confirmation_message aipkit_delete_confirmation",_.style.display="none",d.insertBefore(_,d.firstChild));let m=`aipkit_action_status_${s}`,g=d.querySelector(`#${m}`);if(g||(g=document.createElement("div"),g.id=m,g.className="aipkit_action_status_message",d.appendChild(g)),_.style.display!=="none"&&_.innerHTML!=="")return;u&&(u.textContent="",u.className="aipkit_save_status_container");let k=d.querySelector(".aipkit_reset_confirmation");k&&(k.style.display="none"),g.textContent="",g.className="aipkit_action_status_message",_.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
                </div>
            `,_.style.display="block";let w=_.querySelector(".aipkit_delete_confirm_btn"),h=_.querySelector(".aipkit_delete_cancel_btn"),y=()=>{_.innerHTML="",_.style.display="none",r(n,s,g,u)},b=()=>{_.innerHTML="",_.style.display="none"};w.addEventListener("click",y,{once:!0}),h.addEventListener("click",b,{once:!0})});let e=document.querySelector(".aipkit_chatbot_module_container");e&&e.addEventListener("click",function(t){let n=t.target.closest(".aipkit_header_delete_btn");if(!n)return;let s=n.closest(".aipkit_tab_dropdown_menu");s&&(s.style.display="none");let a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),c=a?.dataset?.botId,l=a?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",u=document.getElementById("aipkit_header_action_feedback")||(a?a.querySelector(`#aipkit_action_feedback_${c}`):null),f=document.getElementById("aipkit_chatbot_global_save_status_container");if(!c||!u)return;if(l){u.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{u.innerHTML=""},3e3);return}let _=`aipkit_delete_confirmation_${c}`,m=u.querySelector(`#${_}`);m||(m=document.createElement("div"),m.id=_,m.className="aipkit_confirmation_message aipkit_delete_confirmation",m.style.display="none",u.insertBefore(m,u.firstChild));let g=`aipkit_action_status_${c}`,k=u.querySelector(`#${g}`);k||(k=document.createElement("div"),k.id=g,k.className="aipkit_action_status_message",u.appendChild(k)),f&&(f.textContent="",f.className="aipkit_save_status_container");let w=u.querySelector(".aipkit_reset_confirmation");w&&(w.style.display="none"),k.textContent="",k.className="aipkit_action_status_message",m.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
          </div>`,m.style.display="block";let h=m.querySelector(".aipkit_delete_confirm_btn"),y=m.querySelector(".aipkit_delete_cancel_btn");h?.addEventListener("click",()=>{m.innerHTML="",m.style.display="none",r(n,c,k,f)},{once:!0}),y?.addEventListener("click",()=>{m.innerHTML="",m.style.display="none"},{once:!0})})}function r(i,e,t,n){let s=i.querySelector(".aipkit_spinner"),a=document.getElementById("aipkit_chatbot_main_selector_container");n&&(n.textContent="",n.className="aipkit_save_status_container"),t.textContent="",t.className="aipkit_action_status_message",i.disabled=!0,i.classList.add("aipkit_loading"),s&&(s.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Deleting..."):i.textContent="Deleting...",aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:e}).then(c=>{t.textContent=c.message||"Chatbot deleted successfully.",t.classList.add("success");let l=!1;if(a){let u=a.querySelector(`.aipkit_tab_button[data-bot-id="${e}"]`),f=a.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${e}"]`);if(u)l=u.classList.contains("aipkit_active"),u.remove();else if(f){l=f.classList.contains("aipkit_active"),f.remove();let _=a.querySelector(".aipkit_tab_dropdown_menu");if(_&&_.querySelectorAll(".aipkit_tab_dropdown_item").length===0){let g=_.closest(".aipkit_tab_dropdown_container");g&&g.remove()}}}let d=document.getElementById(`chatbot-${e}-content`);if(d&&d.remove(),setTimeout(()=>{let u=document.getElementById(`aipkit_action_status_${e}`);u&&(u.textContent="",u.className="aipkit_action_status_message")},4e3),l){let u=a?.querySelector(".aipkit_tab_button_default");if(u)u.click();else{let f=a?.querySelector('.aipkit_tab_button[data-tab-type="bot"]');if(f)f.click();else{let _=a?.querySelector(".aipkit_tab_dropdown_item");if(_)_.click();else{let m=a?.querySelector(".aipkit_create-new-button");if(m)m.click();else{let g=document.getElementById("aipkit_admin_chat_preview_container");g&&(g.innerHTML='<p class="aipkit_preview_placeholder">Chatbot deleted. Select another option.</p>')}}}}}}).catch(c=>{t.textContent="Error: "+(c.message||"Failed to delete chatbot."),t.classList.add("error"),i.disabled=!1,i.classList.remove("aipkit_loading"),s&&(s.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(i,"Delete"),setTimeout(()=>{t&&(t.textContent="",t.className="aipkit_action_status_message")},5e3)})}function o(i){if(!i)return"";let e=document.createElement("div");return e.textContent=i,e.innerHTML}window.aipkit_initDeleteBot=p})();(function(){"use strict";function p(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");i||console.warn("AIPKit Chat Resetter: Main content container not found."),i&&i.addEventListener("click",function(t){let n=t.target.closest(".aipkit_reset_bot_btn");if(!n||n.disabled)return;let s=n.getAttribute("data-bot-id"),a=n.getAttribute("data-bot-name"),c=n.closest(".aipkit_chatbot_settings_form"),d=document.getElementById("aipkit_header_action_feedback")||(c?c.querySelector(`#aipkit_action_feedback_${s}`):null),u=document.getElementById("aipkit_chatbot_global_save_status_container");if(!s||!d){console.error("AIPKit Chat Resetter: Missing required elements (botId, actionFeedbackArea) for:",n);return}let f=`aipkit_reset_confirmation_${s}`,_=d.querySelector(`#${f}`);_||(_=document.createElement("div"),_.id=f,_.className="aipkit_confirmation_message aipkit_reset_confirmation",_.style.display="none",d.insertBefore(_,d.firstChild));let m=`aipkit_action_status_${s}`,g=d.querySelector(`#${m}`);if(g||(g=document.createElement("div"),g.id=m,g.className="aipkit_action_status_message",d.appendChild(g)),_.style.display!=="none"&&_.innerHTML!=="")return;u&&(u.textContent="",u.className="aipkit_save_status_container");let k=d.querySelector(".aipkit_delete_confirmation");k&&(k.style.display="none"),g.textContent="",g.className="aipkit_action_status_message",_.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Confirm</button>
                </div>
            `,_.style.display="block";let w=_.querySelector(".aipkit_reset_confirm_btn"),h=_.querySelector(".aipkit_reset_cancel_btn"),y=()=>{_.innerHTML="",_.style.display="none",r(n,s,g,u)},b=()=>{_.innerHTML="",_.style.display="none"};w.addEventListener("click",y,{once:!0}),h.addEventListener("click",b,{once:!0})});let e=document.querySelector(".aipkit_chatbot_module_container");e&&e.addEventListener("click",function(t){let n=t.target.closest(".aipkit_header_reset_btn");if(!n)return;let s=n.closest(".aipkit_tab_dropdown_menu");s&&(s.style.display="none");let a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),c=a?.dataset?.botId,d=document.getElementById("aipkit_header_action_feedback")||(a?a.querySelector(`#aipkit_action_feedback_${c}`):null),u=document.getElementById("aipkit_chatbot_global_save_status_container");if(!c||!d)return;let f=`aipkit_reset_confirmation_${c}`,_=d.querySelector(`#${f}`);_||(_=document.createElement("div"),_.id=f,_.className="aipkit_confirmation_message aipkit_reset_confirmation",_.style.display="none",d.insertBefore(_,d.firstChild));let m=`aipkit_action_status_${c}`,g=d.querySelector(`#${m}`);g||(g=document.createElement("div"),g.id=m,g.className="aipkit_action_status_message",d.appendChild(g)),u&&(u.textContent="",u.className="aipkit_save_status_container");let k=d.querySelector(".aipkit_delete_confirmation");k&&(k.style.display="none"),g.textContent="",g.className="aipkit_action_status_message",_.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Reset</button>
          </div>`,_.style.display="block";let w=_.querySelector(".aipkit_reset_confirm_btn"),h=_.querySelector(".aipkit_reset_cancel_btn");w?.addEventListener("click",()=>{_.innerHTML="",_.style.display="none",r(n,c,g,u)},{once:!0}),h?.addEventListener("click",()=>{_.innerHTML="",_.style.display="none"},{once:!0})})}function r(i,e,t,n){let s=i.querySelector(".aipkit_spinner");n&&(n.textContent="",n.className="aipkit_save_status_container"),t.textContent="",t.className="aipkit_action_status_message",i.disabled=!0,i.classList.add("aipkit_loading"),s&&(s.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Resetting..."):i.textContent="Resetting...",aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:e}).then(a=>{t.textContent=a.message||"Chatbot reset successfully!",t.classList.add("success"),aipkit_loadModule("chatbot",{force_active_bot_id:e},function(c){c&&(console.error("AIPKit Chat Resetter: Error reloading module after reset:",c),t.textContent="Reset OK, but UI refresh failed. Reload page.",t.classList.add("error"))}),setTimeout(()=>{let c=document.getElementById(`aipkit_action_status_${e}`);c&&(c.textContent="",c.className="aipkit_action_status_message")},4e3)}).catch(a=>{t.textContent="Error: "+(a.message||"Failed to reset chatbot."),t.classList.add("error"),i.disabled=!1,i.classList.remove("aipkit_loading"),s&&(s.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(i,"Reset"),setTimeout(()=>{t&&(t.textContent="",t.className="aipkit_action_status_message")},5e3)})}function o(i){if(!i)return"";let e=document.createElement("div");return e.textContent=i,e.innerHTML}window.aipkit_initResetBot=p})();(function(){"use strict";function p(i,e=5,t=100){if(typeof window.aipkit_initializeChatInstance=="function")try{window.aipkit_initializeChatInstance(i)}catch(n){console.error("AIPKit Chat Preview: Error during chat initialization.",n),i.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error initializing preview.</p>'}else e>0?(console.warn(`AIPKit Chat Preview: Initializer not ready, retrying in ${t}ms... (${e} retries left)`),setTimeout(()=>{p(i,e-1,t)},t)):(console.error("AIPKit Chat Preview: window.aipkit_initializeChatInstance function not found after retries. Ensure chat-init.js is loaded and executed correctly."),i.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview function.</p>')}function r(){let i=document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_tab_button.aipkit_active, #aipkit_chatbot_main_selector_container .aipkit_tab_dropdown_item.aipkit_active"),e=document.getElementById("aipkit_admin_chat_preview_container"),t=document.querySelector(".aipkit_chatbot-preview-column"),n=window.aipkit_dashboard?.text||{};if(!e||!t){console.warn("AIPKit Chat Preview: Preview container or column not found.");return}if(e.innerHTML="",t.classList.remove("aipkit_loading"),i){let s=i.getAttribute("data-tab-type"),a=i.getAttribute("data-bot-id");s==="bot"&&a?o(a):s==="create"?e.innerHTML=`<p class="aipkit_preview_placeholder">${n.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:s==="settings"?e.innerHTML=`<p class="aipkit_preview_placeholder">${n.previewPlaceholderSettings||"Preview is not applicable for Chat Settings."}</p>`:e.innerHTML=`<p class="aipkit_preview_placeholder">${n.previewPlaceholderSelect||"Select a bot to see the preview."}</p>`}else document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_create-new-button")?e.innerHTML=`<p class="aipkit_preview_placeholder">${n.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:e.innerHTML=`<p class="aipkit_preview_placeholder">${n.noBotsPlaceholder||"No chatbots found. Create one to get started!"}</p>`}function o(i){let e=document.getElementById("aipkit_admin_chat_preview_container"),t=document.querySelector(".aipkit_chatbot-preview-column");if(!e||!t){console.warn("AIPKit Chat Preview: Cannot refresh, container or column not found.");return}t.classList.add("aipkit_loading"),e.innerHTML="";let n=new URL(window.aipkit_dashboard.ajaxurl);n.searchParams.append("action","aipkit_get_chatbot_shortcode"),n.searchParams.append("bot_id",i),n.searchParams.append("_ajax_nonce",window.aipkit_dashboard.nonce),fetch(n).then(s=>s.json()).then(s=>{if(s.success&&s.data&&s.data.html){e.innerHTML=s.data.html;let a=e.querySelector(".aipkit_chat_container, .aipkit_popup_wrapper");a?p(a):(console.error(`AIPKit Chat Preview: Shortcode HTML for bot ${i} didn't contain expected wrapper (.aipkit_chat_container or .aipkit_popup_wrapper). HTML:`,s.data.html),e.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview wrapper element.</p>')}else{let a=s.data&&s.data.message?s.data.message:"Invalid response received for shortcode preview.";throw new Error(a)}}).catch(s=>{console.error(`AIPKit Chat Preview: Error refreshing chat preview for bot ${i}:`,s),e.innerHTML=`<p class="aipkit_preview_placeholder" style="color: red;">Failed to load preview: ${s.message}</p>`}).finally(()=>{t.classList.remove("aipkit_loading")})}window.aipkit_loadInitialChatPreview=r,window.aipkit_refreshChatPreview=o})();(function(){"use strict";function p(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");n&&(n.addEventListener("change",function(s){let a=s.target.closest(".aipkit_popup_toggle_switch");if(a){let _=a.closest(".aipkit_chatbot-settings-area");if(_){r(_,a.checked),i(_,a);let m=_.querySelector(".aipkit_popup_config_btn_placeholder");m&&(m.disabled=!a.checked,m.title=a.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let c=s.target.closest('select[name="popup_icon_type"]');if(c){let _=c.closest(".aipkit_chatbot-settings-area");_&&o(_,c.value);return}let l=s.target.closest('input[name="popup_icon_type"]');if(l){let _=l.closest(".aipkit_chatbot-settings-area");_&&o(_,l.value);return}let d=s.target.closest(".aipkit_popup_hint_toggle_switch");if(d){let _=d.closest(".aipkit_chatbot-settings-area");_&&t(_,d.checked);return}let u=s.target.closest(".aipkit_starters_toggle_switch");if(u){let _=u.closest(".aipkit_chatbot-settings-area");if(_){let m=_.querySelector(".aipkit_starters_config_btn");m&&(m.disabled=!u.checked,m.title=u.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let f=s.target.closest(".aipkit_voice_input_toggle_switch");if(f){let _=f.closest(".aipkit_chatbot-settings-area");_&&e(_,f.checked);return}}),n.querySelectorAll(".aipkit_chatbot-settings-area").forEach(s=>{let a=s.querySelector(".aipkit_popup_toggle_switch");if(a){r(s,a.checked),i(s,a);let _=s.querySelector(".aipkit_popup_config_btn_placeholder");_&&(_.disabled=!a.checked,_.title=a.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}let c=s.querySelector('select[name="popup_icon_type"]');if(c)o(s,c.value);else{let _=s.querySelector('input[name="popup_icon_type"]:checked');_?o(s,_.value):s.querySelector('input[name="popup_icon_type"][value="default"]')&&o(s,"default")}let l=s.querySelector(".aipkit_voice_input_toggle_switch");l&&e(s,l.checked);let d=s.querySelector(".aipkit_popup_hint_toggle_switch");d&&t(s,d.checked);let u=s.querySelector(".aipkit_starters_toggle_switch"),f=s.querySelector(".aipkit_starters_config_btn");if(f){let _=u?u.checked:!1;f.disabled=!_,f.title=_?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure"}}))}function r(n,s){let a=n.querySelector(".aipkit_popup_settings_accordion");if(a&&(a.style.display=s?"block":"none",!s)){let l=a.querySelector(".aipkit_accordion-header"),d=a.querySelector(".aipkit_accordion-content");l&&l.classList.remove("aipkit_active"),d&&d.classList.remove("aipkit_active")}let c=n.querySelector(".aipkit_popup_icon_options_container");c&&(c.style.display=s?"block":"none")}function o(n,s){let a=n.querySelector(".aipkit_popup_icon_default_selector_container"),c=n.querySelector(".aipkit_popup_icon_custom_input_container");a&&(a.style.display=s==="default"?"block":"none"),c&&(c.style.display=s==="custom"?"block":"none")}function i(n,s){let a=s.checked,c=s.getAttribute("data-sidebar-target"),l=n.querySelector("#"+c);if(!l)return;let d=l.querySelector(".aipkit_sidebar_toggle_switch"),u=l.querySelector("label");if(!d||!u)return;let f=l.getAttribute("data-tooltip-disabled")||"";a?(d.getAttribute("data-original-state")===null&&d.setAttribute("data-original-state",d.checked?"checked":"unchecked"),d.checked=!1,d.disabled=!0,l.setAttribute("title",f),l.classList.add("aipkit-disabled-tooltip"),u.style.opacity="0.6"):(d.disabled=!1,l.removeAttribute("title"),l.classList.remove("aipkit-disabled-tooltip"),u.style.opacity="1",d.getAttribute("data-original-state")==="checked"&&(d.checked=!0),d.removeAttribute("data-original-state"))}function e(n,s){let a=n.querySelector(".aipkit_stt_provider_conditional_row");a&&(a.style.display=s?"block":"none")}function t(n,s){let a=n.querySelector(".aipkit_popup_hint_conditional_row");a&&(a.style.display=s?"block":"none");let c=n.querySelectorAll(".aipkit_popup_hint_extra");c&&c.length&&c.forEach(l=>{l.style.display=s?"":"none"})}window.aipkit_initAppearanceToggles=p,window.aipkit_togglePopupDependentSettingsVisibility=r,window.aipkit_toggleSidebarCheckboxState=i,window.aipkit_togglePopupIconValueInputs=o,window.aipkit_toggleSttSettingsVisibility=e,window.aipkit_togglePopupHintSettingsVisibility=t})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");r&&(r.addEventListener("change",function(o){let i=o.target.closest(".aipkit_starters_toggle_switch");if(!i)return;let e=i.closest(".aipkit_chatbot-settings-area");if(!e)return;let t=e.querySelector(".aipkit_starters_conditional_row");t&&(t.style.display=i.checked?"block":"none")}),r.querySelectorAll(".aipkit_chatbot-settings-area").forEach(o=>{let i=o.querySelector(".aipkit_starters_toggle_switch"),e=o.querySelector(".aipkit_starters_conditional_row");i&&e&&(e.style.display=i.checked?"block":"none")}))}window.aipkit_initConversationStartersToggle=p})();(function(){"use strict";function p(o){let i=o.closest(".aipkit_tab_dropdown_container");if(!i)return;let e=i.querySelector(".aipkit_tab_dropdown_menu");if(!e)return;let t=document.querySelector(".aipkit_chatbot_module_container");t&&t.querySelectorAll('.aipkit_tab_dropdown_menu[style*="display: block"]').forEach(a=>{a!==e&&(a.style.display="none")});let n=e.style.display==="none"||!e.style.display;e.style.display=n?"block":"none"}function r(){let o=document.querySelector(".aipkit_chatbot_module_container");if(!o)return;let i="data-dropdown-outside-click-listener";document.body.getAttribute(i)||(document.addEventListener("click",function(e){let t=o.querySelectorAll('.aipkit_tab_dropdown_menu[style*="display: block"]');t.length&&t.forEach(n=>{let s=n.closest(".aipkit_tab_dropdown_container"),a=s?s.querySelector(".aipkit_tab_dropdown_trigger"):null;!n.contains(e.target)&&(!a||!a.contains(e.target))&&(n.style.display="none")})},!0),document.body.setAttribute(i,"true"))}window.aipkit_chatTabs_toggleMoreBotsDropdown=p,window.aipkit_chatTabs_initDropdownOutsideClickListener=r})();(function(){"use strict";function p(e){let t=e.target.closest(".aipkit_tab_button, .aipkit_tab_dropdown_item");t&&(e.key==="Enter"?(e.preventDefault(),window.aipkit_chatTabs_saveNewName(t)):e.key==="Escape"&&(e.preventDefault(),window.aipkit_chatTabs_exitEditMode(t)))}function r(e){let t=e.querySelector(".aipkit_tab_name_display"),n=e.querySelector(".aipkit_tab_edit_container"),s=e.querySelector(".aipkit_tab_edit_btn"),a=e.querySelector(".aipkit_tab_icon");if(!t||!n){console.error("AIPKit Edit Mode Error: nameDisplay or editContainer not found!");return}let c=t.textContent.trim(),l=window.aipkit_escapeHtml||(f=>f),d=window.aipkit_escapeAttribute||(f=>f);n.innerHTML=`
            <input type="text" class="aipkit_tab_name_input" value="${l(c)}" aria-label="${d("New chatbot name")}">
            <button type="button" class="aipkit_btn-save-name" title="${d("Save name")}"><span class="dashicons dashicons-yes-alt"></span></button>
            <button type="button" class="aipkit_btn-cancel-name" title="${d("Cancel rename")}"><span class="dashicons dashicons-no"></span></button>
        `,e.classList.add("aipkit_tab-editing"),t.style.display="none",s&&(s.style.display="none"),a&&(a.style.display="none");let u=n.querySelector(".aipkit_tab_name_input");u?(n.style.display="inline-flex",setTimeout(()=>{u.focus(),u.select()},0),u.removeEventListener("keydown",p),u.addEventListener("keydown",p)):console.error("AIPKit Edit Mode Error: Input field could not be found after creation.")}function o(e,t=null){let n=e.querySelector(".aipkit_tab_name_display"),s=e.querySelector(".aipkit_tab_edit_container"),a=s?s.querySelector(".aipkit_tab_name_input"):null,c=e.querySelector(".aipkit_tab_edit_btn"),l=e.querySelector(".aipkit_tab_icon");if(a&&a.removeEventListener("keydown",p),s&&(s.innerHTML="",s.style.display="none"),e.classList.remove("aipkit_tab-editing"),n&&(n.style.display=""),c&&(c.style.display=""),l&&(l.style.display=""),t!==null&&n&&(n.textContent=t,e.classList.contains("aipkit_active"))){let f=document.getElementById("aipkit_chatbot_main_selector_container")?.querySelector(".aipkit_active_bot_name_display");f&&(f.textContent=t)}let d=e.querySelector(".aipkit_tab_rename_status");d&&d.textContent!==""&&setTimeout(()=>{d&&(d.textContent=""),d.className="aipkit_tab_rename_status"},3e3)}function i(e){let t=e.querySelector(".aipkit_tab_name_input"),n=e.querySelector(".aipkit_tab_rename_status");if(!t||!n)return;let s=e.getAttribute("data-bot-id"),a=t.value.trim(),c=e.querySelector(".aipkit_tab_name_display"),l=c?c.textContent.trim():"";if(!s||!a||a===l){o(e);return}t.disabled=!0,n.textContent="Saving...",n.className="aipkit_tab_rename_status",window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:s,new_name:a}).then(d=>{n.textContent=d.message||"Renamed!",n.classList.add("success"),o(e,d.new_name||a)}).catch(d=>{console.error("AIPKit Debug: Rename error:",d),n.textContent="Error: "+(d.message||"Could not rename"),n.classList.add("error"),t.disabled=!1,t.focus(),setTimeout(()=>{n&&(n.textContent=""),n.className="aipkit_tab_rename_status"},4e3)})}window.aipkit_chatTabs_enterEditMode=r,window.aipkit_chatTabs_exitEditMode=o,window.aipkit_chatTabs_saveNewName=i})();(function(){"use strict";let p="aipkit_last_selected_chatbot";function r(s){try{localStorage.setItem(p,s)}catch(a){console.warn("AIPKit Chat: Failed to save chatbot to localStorage:",a)}}function o(){try{return localStorage.getItem(p)}catch(s){return console.warn("AIPKit Chat: Failed to retrieve chatbot from localStorage:",s),null}}function i(){try{localStorage.removeItem(p)}catch(s){console.warn("AIPKit Chat: Failed to clear chatbot from localStorage:",s)}}function e(){let s=o();s&&setTimeout(()=>{let a=document.querySelector(`[data-bot-id="${s}"]`);if(!a){localStorage.removeItem(p);return}if(!a.classList.contains("aipkit_active")&&typeof window.aipkit_loadModule=="function"){let c={force_active_bot_id:s};window.aipkit_loadModule("chatbot",c)}},200)}function t(){let s=document.getElementById("aipkit_chatbot_main_selector_container");if(!s){console.warn("AIPKit Chat Main Tabs: Container not found.");return}typeof window.aipkit_chatTabs_initDropdownOutsideClickListener=="function"&&window.aipkit_chatTabs_initDropdownOutsideClickListener(),s.addEventListener("click",function(a){let c=a.target,l=c.closest(".aipkit_tab_button, .aipkit_tab_dropdown_item");if(c.closest(".aipkit_tab_dropdown_trigger")){a.stopPropagation(),typeof window.aipkit_chatTabs_toggleMoreBotsDropdown=="function"&&window.aipkit_chatTabs_toggleMoreBotsDropdown(c.closest(".aipkit_tab_dropdown_trigger"));return}let d=c.closest(".aipkit_tab_dropdown_item");if(d){if(c.matches(".aipkit_tab_edit_btn")||c.closest(".aipkit_tab_edit_btn")){if(a.stopPropagation(),!d.classList.contains("aipkit_tab-editing")&&typeof window.aipkit_chatTabs_enterEditMode=="function"){let m=s.querySelector(".aipkit_tab_dropdown_item.aipkit_tab-editing");m&&m!==d&&window.aipkit_chatTabs_exitEditMode(m),window.aipkit_chatTabs_enterEditMode(d)}return}if(c.matches(".aipkit_btn-save-name")||c.closest(".aipkit_btn-save-name")){a.stopPropagation(),typeof window.aipkit_chatTabs_saveNewName=="function"&&window.aipkit_chatTabs_saveNewName(d);return}if(c.matches(".aipkit_btn-cancel-name")||c.closest(".aipkit_btn-cancel-name")){a.stopPropagation(),typeof window.aipkit_chatTabs_exitEditMode=="function"&&window.aipkit_chatTabs_exitEditMode(d);return}if(c.closest(".aipkit_tab_edit_container"))return}if(!l)return;if(l.classList.contains("aipkit_active")){if(l.classList.contains("aipkit_tab_dropdown_item")){let m=l.closest(".aipkit_tab_dropdown_menu");m&&(m.style.display="none")}return}let u=l.getAttribute("data-tab-type"),f=l.getAttribute("data-bot-id")||"";if(typeof window.aipkit_loadModule!="function"){console.error("AIPKit Tabs: aipkit_loadModule function is not available."),alert("Error: Cannot switch chatbot view.");return}if(l.classList.contains("aipkit_tab_dropdown_item")){let m=l.closest(".aipkit_tab_dropdown_menu");m&&(m.style.display="none")}let _={};u==="bot"&&f?(_={force_active_bot_id:f},r(f)):u==="create"&&(_={force_active_tab:"create"}),window.aipkit_loadModule("chatbot",_)})}function n(){e()}window.aipkit_initChatbotMainTabs=t,window.aipkit_loadLastSelectedChatbot=n,window.aipkit_clearLastSelectedChatbot=i})();(function(){"use strict";function p(o){if(!o)return;let i=o.querySelector(".aipkit_token_limit_mode_select"),e=o.querySelector(".aipkit_token_general_user_limit_field"),t=o.querySelector(".aipkit_token_role_limits_container");if(!i||!e||!t){console.warn("AIPKit Token Management JS: Could not find required elements for toggling limit fields.");return}let n=i.value;e.style.display=n==="general"?"block":"none",t.style.display=n==="role_based"?"block":"none"}function r(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o){console.warn("AIPKit Token Management JS: Main content container not found.");return}o.addEventListener("change",function(e){let t=e.target.closest(".aipkit_token_limit_mode_select");if(!t)return;let n=t.closest(".aipkit_accordion-content");n?p(n):console.warn("AIPKit Token Management JS: Could not find parent accordion content for mode select:",t)}),o.querySelectorAll('.aipkit_accordion[data-section="token-management"]').forEach(e=>{let t=e.querySelector(".aipkit_accordion-content");t&&p(t)})}window.aipkit_initTokenManagementUI=r})();(function(){"use strict";window.aipkitIndexingIntervals=window.aipkitIndexingIntervals||{};let r=window.aipkit_escapeHtml||(I=>I||"");function o(){return window.aipkit_index_content_nonce||window.aipkit_dashboard&&window.aipkit_dashboard.nonce||""}function i(I,q){return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("API request function is not available.")):window.aipkit_apiRequest(I,{...q,_ajax_nonce:o()})}function e(I,q){I&&(I.innerHTML=`
            <div class="aipkit_indexing_error">
                <h4>\u274C Setup Failed</h4>
                <div>${r(q)}</div>
                <button type="button" class="aipkit_btn aipkit_btn-outline" data-action="close-setup">Close</button>
            </div>`)}function t(I,q,P="info"){let B=document.getElementById(`aipkit_indexing_status_${I}`);if(B){let F=new Date().toLocaleTimeString(),O=document.createElement("div");O.className=`aipkit_status_message_${P}`,O.innerHTML=`<span class="aipkit_message_timestamp">[${F}]</span> ${r(q)}`,B.appendChild(O),B.scrollTop=B.scrollHeight}}function n(I,q,P,B=null,F=null){let O=document.getElementById(`aipkit_progress_bar_${I}`),D=document.getElementById(`aipkit_progress_text_${I}`);if(O&&(O.style.width=`${Math.max(0,Math.min(100,q))}%`),D){let $=P||"Processing...";B!==null&&F!==null&&F>0&&($=`Indexing post ${B} of ${F}`),D.innerHTML=r($)}}function s(I){if(!I)return;let q=I.id.match(/(\d+)/);if(q){let P=q[1];window.aipkitIndexingIntervals[P]&&(clearInterval(window.aipkitIndexingIntervals[P]),delete window.aipkitIndexingIntervals[P])}I.style.display="none",I.innerHTML=""}function a(I){return`
            <div class="aipkit_indexing_progress">
                <div><h4 id="aipkit_progress_text_${I}">Initializing...</h4></div>
                <div class="aipkit_progress_bar_container"><div id="aipkit_progress_bar_${I}" class="aipkit_progress_bar"></div></div>
                <div class="aipkit_control_buttons">
                    <button type="button" id="aipkit_stop_indexing_${I}" class="aipkit_btn aipkit_btn-danger" data-action="stop-indexing">Stop</button>
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_details_toggle" data-action="toggle-details">Details</button>
                </div>
                <div id="aipkit_indexing_details_${I}" class="aipkit_indexing_details" style="display: none;">
                    <div id="aipkit_indexing_status_${I}" class="aipkit_indexing_status"><div>Starting process...</div></div>
                </div>
            </div>`}function c(I){return Array.from(document.querySelectorAll(`input[name="post_types_${I}"]:checked`)).map(q=>q.value)}function l(I,q){let P=q.querySelector(".aipkit_config_summary");if(!!!q.querySelector("select[data-is-inline-edit]"))return JSON.parse(P.dataset.config||"{}");let F=document.getElementById(`aipkit_inline_provider_${I}`);if(!F)return console.error("Could not find provider select in edit mode."),JSON.parse(P.dataset.config||"{}");let O=JSON.parse(P.dataset.config||"{}"),D=F.value!==O.provider,$={provider:F.value},N=document.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${I}"] .aipkit_tab_name_display, .aipkit_tab_button[data-bot-id="${I}"] .aipkit_tab_name_display`),R=N?N.textContent.trim().toLowerCase().replace(/[^a-z0-9]/g,"-"):"bot",z=new Date().toISOString().slice(0,19).replace(/[-T:]/g,"");if(D?$.provider==="openai"?$.store_name=`chatbot-${R}-${I}-${z}`:$.provider==="pinecone"?$.index_name=`chatbot-${I}-${z}`:$.provider==="qdrant"&&($.collection_name=`chatbot_${R}_${I}_${z}`):$.provider==="openai"&&O.store_name?$.store_name=O.store_name:$.provider==="pinecone"&&O.index_name?$.index_name=O.index_name:$.provider==="qdrant"&&O.collection_name&&($.collection_name=O.collection_name),$.provider!=="openai"){let U=document.getElementById(`aipkit_inline_embedding_provider_${I}`),V=document.getElementById(`aipkit_inline_embedding_model_${I}`);U&&V&&($.embedding_provider=U.value,$.embedding_model=V.value)}return $}function d(I,q,P){let{content_types:B,display_info:F}=P,O=`
            <div class="aipkit_content_selection">
                <h5>Content to Index:</h5>
                <div class="aipkit_checkbox_group">
                    ${B.map($=>`<label><input type="checkbox" name="post_types_${I}" value="${r($.slug)}" checked> ${r($.label)} (${$.count})</label>`).join("")}
                </div>
            </div>`,D=b(I,F);q.innerHTML=`
            <div class="aipkit_config_summary" data-config='${r(JSON.stringify(P.config))}'>
                <div class="aipkit_config_summary_header">${D}</div>
                ${O}
            </div>
            <div class="aipkit_setup_actions">
                <button type="button" class="aipkit_btn aipkit_btn-outline aipkit_btn-small" data-action="close-setup">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-success aipkit_btn-small" data-action="start-indexing">Proceed</button>
            </div>`}function u(I,q){let P=document.getElementById(`aipkit_progress_text_${I}`),F={completed:{icon:"yes-alt",text:"Completed",log:`\u{1F389} Indexing completed! Indexed ${q.indexed_posts} of ${q.total_posts} items.`,type:"success",reload:!0,delay:2e3},failed:{icon:"dismiss",text:"Failed",log:`\u274C Indexing failed: ${q.error_message}`,type:"error",reload:!1,delay:3e3},cancelled:{icon:"controls-pause",text:"Cancelled",log:"\u23F9\uFE0F Indexing process was cancelled.",type:"info",reload:!1,delay:2e3}}[q.status];F&&(P&&(P.innerHTML=`<span class="dashicons dashicons-${F.icon} aipkit_status_${q.status}"></span> ${F.text}`),t(I,F.log,F.type),setTimeout(()=>{if(F.reload)location.reload();else{let O=document.getElementById(`aipkit_bot_${I}_index_setup_container`);O&&s(O)}},F.delay)),window.aipkitIndexingIntervals[I]&&(clearInterval(window.aipkitIndexingIntervals[I]),delete window.aipkitIndexingIntervals[I])}function f(I,q){let P=async()=>{try{let B=await i("aipkit_get_indexing_progress",{process_id:q});if(n(I,B.percentage,B.current_task,B.indexed_posts,B.total_posts),B.messages?.length){let F=document.getElementById(`aipkit_indexing_status_${I}`);F&&(F.innerHTML=""),B.messages.forEach(O=>t(I,O.text,O.type))}["completed","failed","cancelled"].includes(B.status)&&u(I,B)}catch(B){u(I,{status:"failed",error_message:B.message})}};window.aipkitIndexingIntervals[I]=setInterval(P,2e3)}async function _(I,q){try{let P=await i("aipkit_get_indexing_progress",{process_id:q});if(n(I,P.percentage,P.current_task||"Resuming...",P.indexed_posts,P.total_posts),P.messages?.length){let B=document.getElementById(`aipkit_indexing_status_${I}`);B&&(B.innerHTML=""),P.messages.forEach(F=>t(I,F.text,F.type))}["completed","failed","cancelled"].includes(P.status)&&u(I,P)}catch(P){console.warn(`Failed to get current progress for bot ${I}:`,P),t(I,"\u26A0\uFE0F Failed to resume progress display.","warning")}}function m(I,q,P){P.innerHTML=a(I),P.style.display="block";let B=document.getElementById(`aipkit_stop_indexing_${I}`);B&&(B.dataset.processId=q),t(I,"\u{1F504} Resuming process...","info"),f(I,q),_(I,q)}async function g(I,q){try{let P=await i("aipkit_check_indexing_status",{bot_id:I});if(P.active_process&&P.process_id)return m(I,P.process_id,q),!0}catch(P){console.warn(`Failed to check indexing status for bot ${I}:`,P)}return!1}async function k(I,q){q.innerHTML='<div class="aipkit_indexing_loading"><span class="aipkit_spinner"></span> Analyzing configuration...</div>',q.style.display="block";try{let P=await i("aipkit_analyze_express_setup",{bot_id:I});d(I,q,P)}catch(P){e(q,P.message)}}async function w(I,q){let P=c(I),B=l(I,q);q.innerHTML=a(I);try{let F=await i("aipkit_start_content_indexing",{bot_id:I,mode:"express",content_types:JSON.stringify(P),config:JSON.stringify(B)}),O=document.getElementById(`aipkit_stop_indexing_${I}`);O&&(O.dataset.processId=F.process_id),f(I,F.process_id)}catch(F){e(q,F.message)}}async function h(I){let q=document.getElementById(`aipkit_stop_indexing_${I}`),P=q?.dataset.processId;if(!P){console.error("Stop Error: Process ID is missing."),t(I,"\u26A0\uFE0F Error: Process ID not found.","error");return}q.disabled=!0,q.textContent="Stopping...",window.aipkitIndexingIntervals[I]&&(clearInterval(window.aipkitIndexingIntervals[I]),delete window.aipkitIndexingIntervals[I]);try{await i("aipkit_cancel_content_indexing",{process_id:P}),t(I,"\u23F9\uFE0F Stop signal sent. Process will halt shortly.","info")}catch(B){t(I,`\u26A0\uFE0F Could not send stop signal: ${B.message}`,"error")}finally{let B=document.getElementById(`aipkit_progress_text_${I}`);B&&(B.innerHTML='<span class="dashicons dashicons-controls-pause aipkit_status_stopped"></span> Stopped'),setTimeout(()=>{let F=document.getElementById(`aipkit_bot_${I}_index_setup_container`);F&&s(F)},2e3)}}function y(I){let q={openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant"},P={openai:"OpenAI",google:"Google",azure:"Azure"},B={provider_name:q[I.provider]||A(I.provider),provider_key:I.provider};return I.provider==="openai"?(B.store_label="Vector Store",B.store_name=I.store_name):(B.store_label=I.provider==="pinecone"?"Index":"Collection",B.store_name=I.provider==="pinecone"?I.index_name:I.collection_name,B.embedding_provider=P[I.embedding_provider]||A(I.embedding_provider),B.embedding_model=I.embedding_model),B}function b(I,q){let P=`
            <div class="aipkit_provider_info_item"><strong>Vector DB:</strong> ${r(q.provider_name)} <a href="#" data-action="edit-setup" class="aipkit_edit_setup_link">- Change</a></div>
            <div class="aipkit_provider_info_item"><strong>${r(q.store_label)}:</strong> ${r(q.store_name)}</div>`;return q.embedding_provider&&(P+=`<div class="aipkit_provider_info_item"><strong>Embedding Provider:</strong> ${r(q.embedding_provider)}</div>`),q.embedding_model&&(P+=`<div class="aipkit_provider_info_item"><strong>Embedding Model:</strong> ${r(q.embedding_model)}</div>`),`<div>${P}</div>`}function v(I,q){let P=q.provider==="pinecone"?"Index":q.provider==="qdrant"?"Collection":"Vector Store",B=q.provider==="pinecone"?q.index_name:q.provider==="qdrant"?q.collection_name:q.store_name,F=`
            <div class="aipkit_provider_info_item"><strong>Vector DB:</strong>
                <select id="aipkit_inline_provider_${I}" class="aipkit_form-input" data-is-inline-edit="true" style="display: inline-block; width: auto; margin-left: 5px;">
                    <option value="openai" ${q.provider==="openai"?"selected":""}>OpenAI</option>
                    <option value="pinecone" ${q.provider==="pinecone"?"selected":""}>Pinecone</option>
                    <option value="qdrant" ${q.provider==="qdrant"?"selected":""}>Qdrant</option>
                </select>
                <a href="#" data-action="edit-setup" class="aipkit_edit_setup_link">- Hide</a>
            </div>
            <div class="aipkit_provider_info_item"><strong>${r(P)}:</strong> <span>${r(B)}</span></div>`;return q.provider!=="openai"&&(F+=`
                <div class="aipkit_provider_info_item"><strong>Embedding Provider:</strong>
                    <select id="aipkit_inline_embedding_provider_${I}" class="aipkit_form-input" data-is-inline-edit="true" style="display: inline-block; width: auto; margin-left: 5px;">
                        <option value="openai" ${q.embedding_provider==="openai"?"selected":""}>OpenAI</option>
                        <option value="google" ${q.embedding_provider==="google"?"selected":""}>Google</option>
                        <option value="azure" ${q.embedding_provider==="azure"?"selected":""}>Azure</option>
                    </select>
                </div>
                <div class="aipkit_provider_info_item"><strong>Embedding Model:</strong>
                    <select id="aipkit_inline_embedding_model_${I}" class="aipkit_form-input" data-is-inline-edit="true" style="display: inline-block; width: auto; margin-left: 5px;"></select>
                </div>`),`<div>${F}</div>`}function S(I,q=null){let P=document.getElementById(`aipkit_inline_embedding_provider_${I}`),B=document.getElementById(`aipkit_inline_embedding_model_${I}`);if(!P||!B)return;let F=P.value;B.innerHTML="";let O=(F==="openai"?window.aipkit_chat_config.openaiEmbeddingModels:F==="google"?window.aipkit_chat_config.googleEmbeddingModels:F==="azure"?window.aipkit_chat_config.azureEmbeddingModels:[])||[];O.length>0?O.forEach(D=>{let $=new Option(r(D.name||D.id),D.id);q&&D.id===q&&($.selected=!0),B.appendChild($)}):B.innerHTML='<option value="">(Sync in AI Settings)</option>'}function C(I,q){let P=document.getElementById(`aipkit_inline_provider_${I}`),B=document.getElementById(`aipkit_inline_embedding_provider_${I}`);P&&P.addEventListener("change",()=>T(I,q)),B&&B.addEventListener("change",()=>S(I))}function T(I,q){let P=document.getElementById(`aipkit_inline_provider_${I}`).value,B={provider:P,embedding_provider:"openai"},F=document.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${I}"] .aipkit_tab_name_display, .aipkit_tab_button[data-bot-id="${I}"] .aipkit_tab_name_display`),O=F?F.textContent.trim().toLowerCase().replace(/[^a-z0-9]/g,"-"):"bot",D=new Date().toISOString().slice(0,19).replace(/[-T:]/g,"");P==="openai"?B.store_name=`chatbot-${O}-${I}-${D}`:P==="pinecone"?B.index_name=`chatbot-${I}-${D}`:P==="qdrant"&&(B.collection_name=`chatbot_${O}_${I}_${D}`);let $=q.querySelector(".aipkit_config_summary_header");$.innerHTML=v(I,B),S(I),C(I,q)}function E(I,q){let P=q.querySelector(".aipkit_config_summary"),B=q.querySelector(".aipkit_config_summary_header");if(!!q.querySelector("select[data-is-inline-edit]")){let O=JSON.parse(P.dataset.config||"{}"),D=l(I,q),$=JSON.stringify(D)!==JSON.stringify(O),N=y($?D:O);B.innerHTML=b(I,N),$&&(P.dataset.config=JSON.stringify(D))}else{let O=JSON.parse(P.dataset.config||"{}");B.innerHTML=v(I,O),S(I,O.embedding_model),C(I,q)}}async function M(I){I.preventDefault();let P=I.currentTarget.dataset.botId,B=document.getElementById(`aipkit_bot_${P}_index_setup_container`);if(!B)return;let F=typeof window.getComputedStyle=="function"?window.getComputedStyle(B).display!=="none":B.offsetParent!==null,O=(B.textContent||"").trim()!==""||B.querySelector("*")!==null;if(F&&O){s(B);return}await g(P,B)||await k(P,B)}function x(){document.querySelectorAll(".aipkit_index_content_trigger").forEach(async I=>{let q=I.dataset.botId,P=document.getElementById(`aipkit_bot_${q}_index_setup_container`);P&&await g(q,P)})}function L(){document.querySelectorAll(".aipkit_index_content_trigger").forEach(q=>{q.addEventListener("click",M)});let I=document.getElementById("aipkit_chatbot_main_tab_content_container");I&&I.addEventListener("click",function(q){let P=q.target.closest("button, a");if(!P)return;let B=P.dataset.action,F=P.closest(".aipkit_index_setup_container"),O=P.closest(".aipkit_indexing_progress"),D=F?.id.match(/(\d+)/)?.[1]||O?.closest(".aipkit_index_setup_container")?.id.match(/(\d+)/)?.[1];if(!D)return;let $=document.getElementById(`aipkit_bot_${D}_index_setup_container`);switch(B){case"close-setup":$&&s($);break;case"start-indexing":$&&w(D,$);break;case"stop-indexing":h(D);break;case"edit-setup":q.preventDefault(),$&&E(D,$);break;case"toggle-details":let N=document.getElementById(`aipkit_indexing_details_${D}`);if(N){let R=N.style.display==="none";N.style.display=R?"block":"none",P.textContent=R?"Hide":"Details",P.classList.toggle("aipkit_active",R)}break}}),x()}function A(I){return I?I.charAt(0).toUpperCase()+I.slice(1):""}window.aipkitIndexContent={hideSetup:I=>s(document.getElementById(`aipkit_bot_${I}_index_setup_container`))},window.aipkit_initChatbotIndexContent=L})();(function(){"use strict";function p(){if(typeof window.aipkit_setButtonText!="function"||typeof window.aipkit_copyShortcode!="function"){console.error("AIPKit Chat Admin Main: Essential NEW utility functions not found (e.g., aipkit_setButtonText, aipkit_copyShortcode). Check utils/");let o=document.querySelector(".aipkit_chatbot_module_container");o&&(o.innerHTML='<p style="color:red; padding:20px;">Critical Error: UI utility scripts failed to load correctly.</p>');return}typeof window.aipkit_escapeHtml!="function"&&console.error("AIPKit Chat Admin Main: Essential log utility functions (like aipkit_escapeHtml) not found. Check utils/html-escaper.js."),typeof window.aipkit_initProviderSelectToggles=="function"?window.aipkit_initProviderSelectToggles():console.error("AIPKit Chat Admin Main: aipkit_initProviderSelectToggles function not found."),typeof window.aipkit_initChatThemeSettingsToggle=="function"?window.aipkit_initChatThemeSettingsToggle():console.error("AIPKit Chat Admin Main: aipkit_initChatThemeSettingsToggle function not found."),typeof window.aipkit_initCreateNewBot=="function"?window.aipkit_initCreateNewBot():console.error("AIPKit Chat Admin Main: aipkit_initCreateNewBot function not found."),typeof window.aipkit_initSaveBotSettings=="function"?window.aipkit_initSaveBotSettings():console.error("AIPKit Chat Admin Main: aipkit_initSaveBotSettings function not found."),typeof window.aipkit_initDeleteBot=="function"?window.aipkit_initDeleteBot():console.error("AIPKit Chat Admin Main: aipkit_initDeleteBot function not found."),typeof window.aipkit_initResetBot=="function"?window.aipkit_initResetBot():console.error("AIPKit Chat Admin Main: aipkit_initResetBot function not found."),typeof window.aipkit_initAppearanceToggles=="function"?window.aipkit_initAppearanceToggles():console.error("AIPKit Chat Admin Main: aipkit_initAppearanceToggles function not found."),typeof window.aipkit_initChatbotSettingsModal=="function"?window.aipkit_initChatbotSettingsModal():console.error("AIPKit Chat Admin Main: aipkit_initChatbotSettingsModal function not found."),typeof window.aipkit_initCustomThemeModalTabs=="function"?window.aipkit_initCustomThemeModalTabs():typeof window.aipkit_initSegmentedTabs=="function"?window.aipkit_initSegmentedTabs():console.error("AIPKit Chat Admin Main: Segmented tabs initializer not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_chatbot_main_tab_content_container"):console.error("AIPKit Chat Admin Main: aipkit_attachRangeValueHandlers function not found."),typeof window.aipkit_initConversationStartersToggle=="function"?window.aipkit_initConversationStartersToggle():console.error("AIPKit Chat Admin Main: aipkit_initConversationStartersToggle function not found."),typeof window.aipkit_initTokenManagementUI=="function"?document.querySelector('.aipkit_accordion[data-section="token-management"]')&&window.aipkit_initTokenManagementUI():console.error("AIPKit Chat Admin Main: aipkit_initTokenManagementUI function not found."),typeof window.aipkit_initChatbotMainTabs=="function"?window.aipkit_initChatbotMainTabs():console.error("AIPKit Chat Admin Main: aipkit_initChatbotMainTabs function not found."),typeof window.aipkit_loadInitialChatPreview=="function"?window.aipkit_loadInitialChatPreview():console.error("AIPKit Chat Admin Main: aipkit_loadInitialChatPreview function not found."),typeof window.aipkit_initTtsSettingsUI=="function"?document.querySelector('.aipkit_accordion[data-section="tts-settings"]')&&window.aipkit_initTtsSettingsUI():console.error("AIPKit Chat Admin Main: aipkit_initTtsSettingsUI function not found."),typeof window.aipkit_initChatbotIndexContent=="function"?window.aipkit_initChatbotIndexContent():console.error("AIPKit Chat Admin Main: aipkit_initChatbotIndexContent function not found.");let r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");if(r){let o=r.dataset.botId,i=document.getElementById(`aipkit_trigger_builder_${o}`);o&&i&&typeof window.aipkit_initTriggerBuilderUI=="function"?window.aipkit_initTriggerBuilderUI(o):o&&i&&console.error(`AIPKit Chat Admin Main: aipkit_initTriggerBuilderUI function not found, cannot init Triggers for bot ${o}.`)}typeof window.aipkit_initRealtimeVoiceAgentUI=="function"&&window.aipkit_initRealtimeVoiceAgentUI(),typeof window.aipkit_initEmbedCodeCopy=="function"&&window.aipkit_initEmbedCodeCopy(),function(){let i=document.querySelector(".aipkit_chatbot_module_container");i&&i.addEventListener("click",function(e){if(e.target.closest(".aipkit_header_reset_btn, .aipkit_header_delete_btn, .aipkit_actions_dropdown_container .aipkit_tab_dropdown_trigger"))return;if(e.target.closest("#aipkit_chatbot_header_save_btn")){let a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");a&&(typeof a.requestSubmit=="function"?a.requestSubmit():a.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0})));return}if(e.target.closest(".aipkit_header_reset_btn")){let a=i.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");a&&(a.style.display="none");let l=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form")?.dataset.botId,d=i.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",u=i.querySelector("#aipkit_header_action_feedback");if(!l||!u)return;u.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_reset_confirmation" id="aipkit_reset_confirmation_${l}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_inline">Confirm</button>
              </div>
            </div>`,u.querySelector(".aipkit_reset_cancel_inline")?.addEventListener("click",()=>{u.innerHTML=""},{once:!0}),u.querySelector(".aipkit_reset_confirm_inline")?.addEventListener("click",()=>{u.innerHTML='<span class="aipkit_action_status_message">Resetting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:l}).then(f=>{u.innerHTML=`<span class="aipkit_action_status_message success">${f.message||"Chatbot reset successfully!"}</span>`,typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("chatbot",{force_active_bot_id:l}),setTimeout(()=>{u.innerHTML=""},3e3)}).catch(f=>{u.innerHTML=`<span class="aipkit_action_status_message error">Error: ${f.message||"Failed to reset chatbot."}</span>`,setTimeout(()=>{u.innerHTML=""},4e3)})},{once:!0});return}if(e.target.closest(".aipkit_header_delete_btn")){let a=i.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");a&&(a.style.display="none");let c=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),l=c?.dataset.botId,d=c?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",u=i.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",f=i.querySelector("#aipkit_header_action_feedback");if(!l||!f)return;if(d){f.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{f.innerHTML=""},3e3);return}f.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_delete_confirmation" id="aipkit_delete_confirmation_${l}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_inline">Confirm</button>
              </div>
            </div>`,f.querySelector(".aipkit_delete_cancel_inline")?.addEventListener("click",()=>{f.innerHTML=""},{once:!0}),f.querySelector(".aipkit_delete_confirm_inline")?.addEventListener("click",()=>{f.innerHTML='<span class="aipkit_action_status_message">Deleting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:l}).then(_=>{f.innerHTML=`<span class="aipkit_action_status_message success">${_.message||"Chatbot deleted successfully."}</span>`;let m=null,g=document.getElementById("aipkit_chatbot_main_selector_container");if(g){let k=g.querySelector(".aipkit_tab_dropdown_item .dashicons-star-filled"),w=k?k.closest(".aipkit_tab_dropdown_item"):null;if(w)m=w.getAttribute("data-bot-id");else{let h=g.querySelector(`.aipkit_tab_dropdown_item[data-bot-id]:not([data-bot-id="${l}"])`);h&&(m=h.getAttribute("data-bot-id"))}}if(typeof window.aipkit_loadModule=="function"){let k=m?{force_active_bot_id:m}:{};window.aipkit_loadModule("chatbot",k)}setTimeout(()=>{f.innerHTML=""},3e3)}).catch(_=>{f.innerHTML=`<span class="aipkit_action_status_message error">Error: ${_.message||"Failed to delete chatbot."}</span>`,setTimeout(()=>{f.innerHTML=""},4e3)})},{once:!0});return}})}()}window.aipkit_initChatbot=p})();(function(){"use strict";window.aipkitAIFormsState={currentFormId:null,draggedElementType:null,draggedLayoutType:null,draggedElement:null,droppedElementCounter:0,formStructure:[],selectedDesignerElementId:null}})();(function(){"use strict";window.aipkitAIFormsListState={currentPage:1,searchQuery:"",sortColumn:"title",sortDirection:"asc",filterProvider:"all",isLoading:!1}})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_ai_forms_list_tbody"),i=window.aipkit_escapeHtml||(t=>t),e=wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t;o&&(o.innerHTML="",!(!r||r.length===0)&&r.forEach(t=>{let n=window.aipkit_dashboard?.isProPlan??!1,a=(window.aipkit_dashboard?.addons??{}).pdf_download??!1,c="";if(n&&a)c=`
              <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="pdf_download" value="true">
                  <span>${e("Save as PDF","gpt3-ai-content-generator")}</span>
              </label>`;else{let f=e(n?"Activate the 'PDF Download' addon to use this feature.":"This is a Pro feature. Please upgrade.","gpt3-ai-content-generator"),_=n?`<span class="aipkit_status-tag">${e("Addon inactive","gpt3-ai-content-generator")}</span>`:`<a href="${window.aipkit_dashboard.upgradeUrl}" target="_blank" class="aipkit_status-tag" style="background-color: #fef3c7; color: #92400e; border: 1px solid #fde68a;">${e("Pro","gpt3-ai-content-generator")}</a>`;c=`
              <div class="aipkit_config_item_locked" title="${i(f)}">
                  <label class="aipkit_config_item" style="opacity: 0.5; cursor: not-allowed;">
                      <input type="checkbox" disabled>
                      <span>${e("Save as PDF","gpt3-ai-content-generator")}</span>
                  </label>
                  ${_}
              </div>`}let l=o.insertRow();l.insertCell().textContent=t.id,l.insertCell().textContent=i(t.title),l.insertCell().innerHTML=`<span class="aipkit_status-tag">${i(t.provider||"Default")}</span>`,l.insertCell().textContent=i(t.model||"Default");let d=l.insertCell();d.classList.add("aipkit_shortcode_cell"),d.innerHTML=`
        <div class="aipkit_shortcode_display_wrapper">
            <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" id="aif-shortcode-input-${t.id}" readonly value="${i(t.shortcode)}">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn aipkit_btn-icon aipkit_aiform_settings_toggle" data-form-id="${t.id}" title="${e("Configure Shortcode","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-admin-settings"></span>
            </button>
        </div>
        <div class="aipkit_shortcode_configurator" id="aif-configurator-${t.id}" style="display: none;">
            <div class="aipkit_config_section">
                <h6>${e("Display Options","gpt3-ai-content-generator")}</h6>
                <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="show_provider" value="true">
                  <span>${e("Show Provider Select","gpt3-ai-content-generator")}</span>
                </label>
                <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="show_model" value="true">
                  <span>${e("Show Model Select","gpt3-ai-content-generator")}</span>
                </label>
            </div>
            <div class="aipkit_config_section">
                <h6>${e("Functionality","gpt3-ai-content-generator")}</h6>
                 <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="copy_button" value="true">
                  <span>${e("Copy Button","gpt3-ai-content-generator")}</span>
                </label>
                 <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="save_button" value="true">
                  <span>${e("Save as Post","gpt3-ai-content-generator")}</span>
                </label>
                ${c}
            </div>
            <div class="aipkit_config_section">
                <h6>${e("Theme","gpt3-ai-content-generator")}</h6>
                <select class="aipkit-aiform-config-input aipkit_form-input" data-form-id="${t.id}" data-attr-name="theme">
                    <option value="light">${e("Light (default)","gpt3-ai-content-generator")}</option>
                    <option value="dark">${e("Dark","gpt3-ai-content-generator")}</option>
                    <option value="custom">${e("Custom","gpt3-ai-content-generator")}</option>
                </select>
            </div>
        </div>
      `;let u=l.insertCell();u.classList.add("aipkit_form_actions_cell"),u.innerHTML=`
        <button class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn aipkit_edit_ai_form_btn" data-form-id="${t.id}" title="${e("Edit","gpt3-ai-content-generator")}"><span class="dashicons dashicons-edit"></span></button>
        <button class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn aipkit_duplicate_ai_form_btn" data-form-id="${t.id}" title="${e("Duplicate","gpt3-ai-content-generator")}"><span class="dashicons dashicons-admin-page"></span></button>
        <button class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn aipkit_export_ai_form_btn" data-form-id="${t.id}" title="${e("Export","gpt3-ai-content-generator")}"><span class="dashicons dashicons-download"></span></button>
        <button class="aipkit_btn aipkit_btn-danger aipkit_icon_btn aipkit_delete_ai_form_btn" data-form-id="${t.id}" data-form-title="${i(t.title)}" title="${e("Delete","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
      `}))}window.aipkitForms_renderTable=p})();(function(){"use strict";function p(r){let o=window.aipkitAIFormsListState,i=document.getElementById("aipkit_ai_forms_pagination");if(!i||!r||!o)return;i.innerHTML="";let{total_forms:e,total_pages:t}=r,n=o.currentPage;if(e<=0)return;let s=document.createElement("span");if(s.className="aipkit_pagination-count",s.textContent=`${e.toLocaleString()} form(s) found`,i.appendChild(s),t>1){let a=document.createElement("span");a.className="aipkit_pagination-links";let c=document.createElement("button");c.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",c.innerHTML="\xAB Previous",c.disabled=n<=1,a.appendChild(c);let l=document.createElement("span");l.className="aipkit_pagination-current",l.textContent=`Page ${n} of ${t}`,a.appendChild(l);let d=document.createElement("button");d.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",d.innerHTML="Next \xBB",d.disabled=n>=t,a.appendChild(d),i.appendChild(a)}}window.aipkitForms_renderPagination=p})();(function(){"use strict";function p(){let r=window.aipkitAIFormsListState;if(!r||r.isLoading)return;r.isLoading=!0;let o=document.getElementById("aipkit_ai_forms_list_tbody"),i=document.getElementById("aipkit_no_ai_forms_message"),e=document.getElementById("aipkit_ai_forms_pagination");o&&(o.innerHTML='<tr><td colspan="6" style="text-align:center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> Loading...</td></tr>'),i&&(i.style.display="none"),e&&(e.innerHTML="");let n={_ajax_nonce:(window.aipkit_ai_forms_config||{}).nonce_manage_forms,page:r.currentPage,search:r.searchQuery,sort_by:r.sortColumn,sort_order:r.sortDirection,filter_provider:r.filterProvider};window.aipkit_apiRequest("aipkit_list_ai_forms",n).then(s=>{typeof window.aipkitForms_renderTable=="function"&&window.aipkitForms_renderTable(s.forms||[]),typeof window.aipkitForms_renderPagination=="function"&&window.aipkitForms_renderPagination(s.pagination||{}),i&&(!s.forms||s.forms.length===0)&&(i.style.display="block",i.textContent=r.searchQuery?"No forms found matching your search.":"No AI Forms have been created yet.")}).catch(s=>{o&&(o.innerHTML=`<tr><td colspan="6" style="color:red;text-align:center;">Error loading forms: ${s.message}</td></tr>`)}).finally(()=>{r.isLoading=!1})}window.aipkitForms_fetchForms=p})();(function(){"use strict";let p;function r(){let o=document.getElementById("aipkit_ai_forms_list_container");if(!o||o.dataset.listListenersAttached)return;o.dataset.listListenersAttached="true";let i=window.aipkitAIFormsListState;if(!i){console.error("AI Forms Events: List state object is not available.");return}o.addEventListener("click",function(n){let s=n.target,a=wp.i18n&&wp.i18n.__?wp.i18n.__:l=>l,c=s.closest(".aipkit-sortable-col");if(c){let l=c.dataset.sortKey;i.sortColumn===l?i.sortDirection=i.sortDirection==="asc"?"desc":"asc":(i.sortColumn=l,i.sortDirection="asc"),i.currentPage=1,o.querySelectorAll(".aipkit-sortable-col").forEach(d=>d.removeAttribute("data-sort-direction")),c.setAttribute("data-sort-direction",i.sortDirection),window.aipkitForms_fetchForms();return}if(s.matches(".aipkit_pagination_prev")){i.currentPage>1&&(i.currentPage--,window.aipkitForms_fetchForms());return}if(s.matches(".aipkit_pagination_next")){i.currentPage++,window.aipkitForms_fetchForms();return}});let e=o.querySelector("#aipkit_ai_forms_search_input");e&&e.addEventListener("input",function(){clearTimeout(p),p=setTimeout(()=>{i.searchQuery=this.value,i.currentPage=1,window.aipkitForms_fetchForms()},400)});let t=o.querySelector("#aipkit_ai_forms_provider_filter");t&&t.addEventListener("change",function(){i.filterProvider=this.value,i.currentPage=1,window.aipkitForms_fetchForms()})}window.aipkitForms_attachListEventListeners=r})();(function(){"use strict";function p(){typeof window.aipkitForms_attachListEventListeners!="function"||typeof window.aipkitForms_fetchForms!="function"||(window.aipkitForms_attachListEventListeners(),window.aipkitForms_fetchForms())}window.aipkitForms_initListView=p})();(function(){"use strict";function p(r){let o=window.aipkitAIFormsState;if(!r){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let i=r.querySelector("#aipkit_ai_form_elements_palette"),e=r.querySelector("#aipkit_ai_form_designer_area"),t=r.querySelector("#aipkit_form_designer_placeholder");if(!i||!e){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(i.dataset.dragListenersAttached==="true"&&e.dataset.dragListenersAttached==="true")return;i.querySelectorAll(".aipkit_form_element_item").forEach(s=>{s.dataset.dragStartListenerAttached!=="true"&&(s.addEventListener("dragstart",a=>{o.draggedElementType=a.target.dataset.elementType,a.dataTransfer.setData("text/plain",o.draggedElementType),a.dataTransfer.effectAllowed="copy",a.target.classList.add("aipkit-dragging"),o.draggedElement=null}),s.addEventListener("dragend",a=>{a.target.classList.remove("aipkit-dragging"),o.draggedElementType=null}),s.dataset.dragStartListenerAttached="true")}),i.dataset.dragListenersAttached="true",e.dataset.dragListenersAttached!=="true"&&(e.addEventListener("dragstart",s=>{s.target.classList.contains("aipkit_dropped_element")&&(o.draggedElement=s.target,s.dataTransfer.setData("text/element-id",s.target.id),s.dataTransfer.effectAllowed="move",setTimeout(()=>{o.draggedElement&&(o.draggedElement.style.opacity="0.5")},0),o.draggedElementType=null)}),e.addEventListener("dragend",s=>{o.draggedElement&&(o.draggedElement.style.opacity="1",o.draggedElement=null)}),e.addEventListener("dragover",s=>{s.preventDefault();let a=s.target.closest(".aipkit_dropped_element");e.classList.add("aipkit-drag-over"),o.draggedElement&&a&&o.draggedElement!==a?s.dataTransfer.dropEffect="move":s.dataTransfer.dropEffect="copy"}),e.addEventListener("dragleave",s=>{e.contains(s.relatedTarget)||e.classList.remove("aipkit-drag-over")}),e.addEventListener("drop",s=>{s.preventDefault(),e.classList.remove("aipkit-drag-over");let a=s.dataTransfer.getData("text/element-id");if(o.draggedElement&&a===o.draggedElement.id){let c=s.target.closest(".aipkit_dropped_element"),l=null;if(c&&c!==o.draggedElement){let d=c.getBoundingClientRect();l=s.clientY>d.top+d.height/2?c.nextSibling:c}e.insertBefore(o.draggedElement,l),o.draggedElement.style.opacity="1",typeof window.aipkitForms_updateFormStructureOrder=="function"&&window.aipkitForms_updateFormStructureOrder()}else if(o.draggedElementType){if(t&&t.style.display!=="none"&&(t.style.display="none"),typeof window.aipkitForms_createNewFormElementData!="function"||typeof window.aipkitForms_renderDroppedElement!="function"){console.error("AI Forms Drag&Drop: Helper functions for creating/rendering element not found.");return}let c=window.aipkitForms_createNewFormElementData(o.draggedElementType);o.formStructure.push(c),window.aipkitForms_renderDroppedElement(e,c,null)}o.draggedElementType=null,o.draggedElement=null}),e.dataset.dragListenersAttached="true")}window.aipkitForms_initDragAndDrop=p})();(function(){"use strict";function p(){let r=window.aipkitAIFormsState,o=document.getElementById("aipkit_ai_form_designer_area");if(!o)return;let i=[];o.querySelectorAll(".aipkit_layout_row").forEach(t=>{let n=t.id,s=r.formStructure.find(l=>l.internalId===n);if(!s)return;let a={internalId:n,type:"layout-row",columns:[]};t.querySelectorAll(".aipkit_layout_column").forEach(l=>{let d=l.id,u=s.columns.find(m=>m.internalId===d);if(!u)return;let f={internalId:d,width:u.width,elements:[]};l.querySelectorAll(".aipkit_dropped_element").forEach(m=>{let g=m.id,k=null;r.formStructure.forEach(w=>{w.columns.forEach(h=>{let y=h.elements.find(b=>b.internalId===g);y&&(k=y)})}),k&&f.elements.push(k)}),a.columns.push(f)}),i.push(a)}),r.formStructure=i}window.aipkitForms_updateFormStructureOrder=p})();(function(){"use strict";function p(o){let i=window.aipkitAIFormsState;i.droppedElementCounter++;let e=`field_${o.replace(/-/g,"_")}_${i.droppedElementCounter}`;switch(o){case"text-input":case"textarea":return{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:o,label:`New ${o.replace(/-/g," ").replace(/\b\w/g,s=>s.toUpperCase())}`,placeholder:"Enter placeholder...",fieldId:e,required:!1,helpText:""};case"checkbox":case"select":case"radio-button":let t,n;return o==="select"?(t="New Dropdown",n="select"):o==="radio-button"?(t="New Radio Buttons",n="radio"):(t="New Checkbox Group",n="checkbox"),{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:o,label:t,fieldId:`${n}_${i.droppedElementCounter}`,required:!1,options:[{value:"option1",text:"Option 1"},{value:"option2",text:"Option 2"}],helpText:""};case"file-upload":return{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:"file-upload",label:"File Upload",fieldId:`file_upload_${i.droppedElementCounter}`,required:!1,helpText:"Upload a file (txt, pdf)."};default:return null}}function r(o){let i=Date.now(),e=[];switch(o){case"1-col":e=[{internalId:`col-${i}-1`,width:"100%",elements:[]}];break;case"2-col-50-50":e=[{internalId:`col-${i}-1`,width:"50%",elements:[]},{internalId:`col-${i}-2`,width:"50%",elements:[]}];break;case"3-col-33-33-33":e=[{internalId:`col-${i}-1`,width:"33.33%",elements:[]},{internalId:`col-${i}-2`,width:"33.33%",elements:[]},{internalId:`col-${i}-3`,width:"33.33%",elements:[]}];break;case"2-col-30-70":e=[{internalId:`col-${i}-1`,width:"30%",elements:[]},{internalId:`col-${i}-2`,width:"70%",elements:[]}];break;case"2-col-70-30":e=[{internalId:`col-${i}-1`,width:"70%",elements:[]},{internalId:`col-${i}-2`,width:"30%",elements:[]}];break;default:e=[{internalId:`col-${i}-1`,width:"100%",elements:[]}]}return{internalId:`row-${i}`,type:"layout-row",columns:e}}window.aipkitForms_createNewFormElementData=p,window.aipkitForms_createNewLayoutData=r})();(function(){"use strict";function p(r,o,i=null){let e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f,t=window.aipkit_escapeHtml||function(f){return f},n=document.createElement("div");n.className="aipkit_dropped_element",n.id=o.internalId,n.dataset.elementType=o.type;let s=`<span class="aipkit_dropped_element_drag_handle dashicons dashicons-move" draggable="true" title="${e("Drag to reorder","gpt3-ai-content-generator")}"></span>`,a="",c=`${o.internalId}-field`,l="";switch(o.helpText&&(l=`<p class="aipkit_dropped_element_help_text">${t(o.helpText)}</p>`),o.type){case"text-input":a=`<label class="aipkit_dropped_element_label" for="${c}">${t(o.label)} ${o.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="text" id="${c}" class="aipkit_form-input aipkit_dropped_element_field" placeholder="${t(o.placeholder)}" readonly>
                    ${l}`;break;case"textarea":a=`<label class="aipkit_dropped_element_label" for="${c}">${t(o.label)} ${o.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <textarea id="${c}" class="aipkit_form-input aipkit_dropped_element_field" rows="2" placeholder="${t(o.placeholder)}" readonly></textarea>
                    ${l}`;break;case"select":let f="";o.options&&o.options.length>0?o.options.forEach(g=>{f+=`<option value="${t(g.value)}">${t(g.text)}</option>`}):f=`<option>${e("No options configured","gpt3-ai-content-generator")}</option>`,a=`<label class="aipkit_dropped_element_label" for="${c}">${t(o.label)} ${o.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <select id="${c}" class="aipkit_form-input aipkit_dropped_element_field" disabled>${f}</select>
                    ${l}`;break;case"radio-button":let _="";o.options&&o.options.length>0?o.options.forEach((g,k)=>{let w=`${c}-${k}`;_+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="radio" id="${w}" class="aipkit_dropped_element_field" name="preview-${o.internalId}" disabled>
                                    <label for="${w}">${t(g.text)}</label>
                                </div>`}):_=`<p class="aipkit-no-options-note">${e("No options configured","gpt3-ai-content-generator")}</p>`,a=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${t(o.label)} ${o.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${_}
                    </fieldset>
                    ${l}`;break;case"checkbox":let m="";o.options&&o.options.length>0?o.options.forEach((g,k)=>{let w=`${c}-${k}`;m+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="checkbox" id="${w}" class="aipkit_dropped_element_field" name="preview-${o.internalId}-${k}" disabled>
                                    <label for="${w}">${t(g.text)}</label>
                                </div>`}):m=`<p class="aipkit-no-options-note">${e("No options configured","gpt3-ai-content-generator")}</p>`,a=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${t(o.label)} ${o.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${m}
                    </fieldset>
                    ${l}`;break;case"file-upload":a=`<label class="aipkit_dropped_element_label" for="${c}">${t(o.label)} ${o.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="file" id="${c}" class="aipkit_form-input aipkit_dropped_element_field" disabled>
                    ${l}`;break;default:a=`<p>${t(o.label)}</p>${l}`}let d=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_settings_btn" title="${e("Settings","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-admin-generic"></span>
                            </button>`,u=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_delete_btn" title="${e("Delete","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-trash"></span>
                            </button>`;n.innerHTML=`
        <div class="aipkit_dropped_element_content">
            ${a}
        </div>
        <div class="aipkit_dropped_element_actions_hover">
            ${s}
            ${d}
            ${u}
        </div>
    `,i?r.insertBefore(n,i):r.appendChild(n)}window.aipkitForms_renderFieldInColumn=p,window.aipkitForms_renderDroppedElement=p})();(function(){"use strict";function p(r,o){let i=window.aipkitAIFormsState,e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;if(!o){console.error("AI Forms deleteDroppedElement: formsContainerElement not provided.");return}let t=o.querySelector("#aipkit_ai_form_designer_area");if(!t){console.warn("AI Forms deleteDroppedElement: Designer area not found in provided container.");return}let n=t.querySelector(`#${CSS.escape(r)}`);if(n&&(n.remove(),i.formStructure.forEach(s=>{s.columns.forEach(a=>{a.elements=a.elements.filter(c=>c.internalId!==r)})}),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(o),i.selectedDesignerElementId===r&&(typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(o):console.error("AI Forms deleteDroppedElement: hideSettingsPanel function missing.")),t.querySelectorAll(".aipkit_dropped_element").length===0&&t.querySelectorAll(".aipkit_layout_row").length===0)){let s=t.querySelector("#aipkit_form_designer_placeholder");s||(s=document.createElement("div"),s.className="aipkit_form_designer_placeholder",s.id="aipkit_form_designer_placeholder",s.innerHTML=`<span class="dashicons dashicons-layout"></span>${e("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,t.appendChild(s)),s.style.display="flex"}}window.aipkitForms_deleteDroppedElement=p})();(function(){"use strict";function p(){let r=window.aipkitAIFormsState,o=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,i=document.getElementById("aipkit_form_editor_container");if(!i)return;let e=i.querySelector("#aipkit_ai_form_prompt_template"),t=i.querySelector("#aipkit_prompt_validation_results");if(!e||!t)return;let n=e.value,s=[],a=[],c=new Set;r.formStructure.forEach(m=>{m.columns.forEach(g=>{g.elements.forEach(k=>{k.fieldId&&c.add(k.fieldId)})})});let l=/{[a-zA-Z0-9_]+}/g,d=(n.match(l)||[]).map(m=>m.slice(1,-1)),u=new Set(d);d.forEach(m=>{c.has(m)||s.push(`Variable <code>{${m}}</code> is used in the prompt but not defined as a form field.`)}),c.forEach(m=>{u.has(m)||a.push(`Field <code>{${m}}</code> is defined but not used in the prompt.`)});let f=n;if(d.forEach(m=>{let g=new RegExp(`\\{${m}\\}`,"g");f=f.replace(g,"")}),/[{}]/.test(f)&&s.push("Malformed variable detected. Check for mismatched or empty curly braces like '{}', or lone '{' or '}'."),t.className="aipkit_form-help",t.innerHTML="",s.length>0){t.classList.add("aipkit-validation-error");let m=`<strong>${o("Validation Issues Found:","gpt3-ai-content-generator")}</strong><ul>`;s.forEach(g=>{m+=`<li>${g}</li>`}),m+="</ul>",t.innerHTML=m}else{t.classList.add("aipkit-validation-success");let m=`<strong>${o("Validation Passed!","gpt3-ai-content-generator")}</strong> (${d.length} of ${c.size} fields used).`;a.length>0&&(m+=`<br><strong>${o("Suggestions:","gpt3-ai-content-generator")}</strong><ul>`,a.forEach(g=>{m+=`<li>${g}</li>`}),m+="</ul>"),t.innerHTML=m}t.style.display="block",t.dismissTimer&&clearTimeout(t.dismissTimer);let _=s.length>0?8e3:5e3;t.dismissTimer=setTimeout(()=>{t.style.display="none",t.innerHTML=""},_)}window.aipkitForms_validatePrompt=p})();(function(){"use strict";function p(r,o){let i=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f,n=window.aipkit_escapeHtml||function(f){return f};if(!o){console.error("AI Forms showSettingsPanel: formsContainerElement not provided.");return}o.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(f=>f.classList.remove("aipkit-element-selected"));let s=o.querySelector(`#${CSS.escape(r)}`);s&&s.classList.add("aipkit-element-selected"),i.selectedDesignerElementId=r;let a=null;for(let f of i.formStructure){for(let _ of f.columns){let m=_.elements.find(g=>g.internalId===r);if(m){a=m;break}}if(a)break}if(!a){console.error(`showSettingsPanel: Could not find element data for ID ${r} in state.`,i.formStructure);return}let c=o.querySelector("#aipkit_ai_form_elements_palette"),l=o.querySelector("#aipkit_ai_form_element_settings_panel"),d=l?l.querySelector("#aipkit_settings_panel_fields"):null,u=l?l.querySelector("#aipkit_settings_panel_element_type"):null;if(!c||!l||!d||!u){console.warn("AI Forms showSettingsPanel: Palette, settings panel, fields container, or type display not found in formsContainerElement.");return}if(u.textContent=`(${a.type.replace(/-/g," ").replace(/\b\w/g,f=>f.toUpperCase())})`,d.innerHTML="",d.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-label-${a.internalId}">${t(e.text.settingsLabel||"Label Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-label-${a.internalId}" class="aipkit_form-input aipkit-setting-field" data-setting="label" value="${n(a.label)}">
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-field-id-${a.internalId}">${t(e.text.settingsFieldId||"Field Variable Name (for prompt)","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-field-id-${a.internalId}" class="aipkit_form-input aipkit-setting-field" data-setting="fieldId" value="${n(a.fieldId)}" pattern="[a-zA-Z0-9_]+" title="${t("Only letters, numbers, and underscores allowed. No spaces.","gpt3-ai-content-generator")}">
                <p class="aipkit_form-help">${t(e.text.settingsFieldIdHelp||"Use as {your_variable_name} in the Prompt Template. Must be unique and contain only letters, numbers, underscores.","gpt3-ai-content-generator")}</p>
            </div>
        `,(a.type==="text-input"||a.type==="textarea")&&(d.innerHTML+=`
                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="setting-placeholder-${a.internalId}">${t(e.text.settingsPlaceholder||"Placeholder Text","gpt3-ai-content-generator")}</label>
                    <input type="text" id="setting-placeholder-${a.internalId}" class="aipkit_form-input aipkit-setting-field" data-setting="placeholder" value="${n(a.placeholder||"")}">
                </div>`),d.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label aipkit_checkbox-label" for="setting-required-${a.internalId}">
                    <input type="checkbox" id="setting-required-${a.internalId}" class="aipkit-setting-field" data-setting="required" ${a.required?"checked":""}>
                    ${t(e.text.settingsRequired||"Required Field","gpt3-ai-content-generator")}
                </label>
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-help-text-${a.internalId}">${t("Help Text (Optional)","gpt3-ai-content-generator")}</label>
                <textarea id="setting-help-text-${a.internalId}" class="aipkit_form-input aipkit-setting-field" data-setting="helpText" rows="3" placeholder="${n(t("This text will appear under the field.","gpt3-ai-content-generator"))}">${n(a.helpText||"")}</textarea>
            </div>
        `,a.type==="select"||a.type==="radio-button"||a.type==="checkbox"){let f=`<hr class="aipkit_hr"><div class="aipkit_form-group"><label class="aipkit_form-label">${t(e.text.settingsSelectOptions||"Options (Value|Text)","gpt3-ai-content-generator")}</label><div id="aipkit_select_options_container">`;(a.options||[]).forEach((_,m)=>{f+=`
                    <div class="aipkit_select_option_row">
                        <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${m}" value="${n(_.value)}" placeholder="${t(e.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
                        <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${m}" value="${n(_.text)}" placeholder="${t(e.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
                        <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${t(e.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
                    </div>`}),f+=`</div><button type="button" id="aipkit_add_select_option_btn" class="aipkit_btn aipkit_btn-small aipkit_btn-secondary">${t(e.text.settingsAddOption||"Add Option","gpt3-ai-content-generator")}</button></div>`,d.innerHTML+=f}c.style.display="none",l.style.display="block"}window.aipkitForms_showSettingsPanel=p})();(function(){"use strict";function p(r){let o=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a;if(!r){console.error("AI Forms addSelectOptionRow: formsContainerElement not provided.");return}let e=r.querySelector("#aipkit_ai_form_element_settings_panel");if(!e){console.warn("AI Forms addSelectOptionRow: Settings panel not found in provided container.");return}let t=e.querySelector("#aipkit_select_options_container");if(!t){console.warn("AI Forms addSelectOptionRow: Options container not found in settings panel.");return}let n=t.querySelectorAll(".aipkit_select_option_row").length,s=document.createElement("div");s.className="aipkit_select_option_row",s.innerHTML=`
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${n}" placeholder="${i(o.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${n}" placeholder="${i(o.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
            <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${i(o.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
        `,t.appendChild(s)}window.aipkitForms_addSelectOptionRow=p})();(function(){"use strict";function p(r){let o=window.aipkitAIFormsState;if(!r){console.error("AI Forms hideSettingsPanel: formsContainerElement not provided.");return}r.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(t=>t.classList.remove("aipkit-element-selected")),o.selectedDesignerElementId=null;let i=r.querySelector("#aipkit_ai_form_elements_palette"),e=r.querySelector("#aipkit_ai_form_element_settings_panel");i&&(i.style.display="block"),e&&(e.style.display="none")}window.aipkitForms_hideSettingsPanel=p})();(function(){"use strict";function p(r,o){let i=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:_=>_;if(!o){console.error("AI Forms updateElementFromSettingsPanel: formsContainerElement not provided.");return}let n=null;for(let _ of i.formStructure){for(let m of _.columns){let g=m.elements.find(k=>k.internalId===r);if(g){n=g;break}}if(n)break}if(!n){console.error(`updateElementFromSettingsPanel: Element data for ID ${r} not found.`);return}let s=o.querySelector("#aipkit_ai_form_element_settings_panel");if(!s){console.warn("AI Forms updateElementFromSettingsPanel: Settings panel not found in provided container.");return}let a=s.querySelector('input[data-setting="label"]');a&&(n.label=a.value);let c=s.querySelector('input[data-setting="fieldId"]');if(c){let _=c.value.trim().replace(/[^a-zA-Z0-9_]/g,"");if(!_){let g=n.label.toLowerCase().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"");g||(g=n.type.replace(/-/g,"_")),_=`${g}_${r.split("-").pop()}`}let m=!0;e:for(let g of i.formStructure)for(let k of g.columns)if(k.elements.some(w=>w.internalId!==r&&w.fieldId===_)){m=!1;break e}m&&_.length>0?(n.fieldId=_,c.value=_,c.classList.remove("aipkit_input_error")):_.length>0&&c.classList.add("aipkit_input_error")}let l=s.querySelector('input[data-setting="required"]');l&&(n.required=l.checked);let d=s.querySelector('textarea[data-setting="helpText"]');if(d&&(n.helpText=d.value),n.type==="text-input"||n.type==="textarea"){let _=s.querySelector('input[data-setting="placeholder"]');_&&(n.placeholder=_.value)}(n.type==="select"||n.type==="radio-button"||n.type==="checkbox")&&(n.options=[],s.querySelectorAll(".aipkit_select_option_row").forEach(m=>{let g=m.querySelector('input[data-setting="option-value"]'),k=m.querySelector('input[data-setting="option-text"]');g&&k&&g.value.trim()!==""?n.options.push({value:g.value,text:k.value}):g&&k&&g.value.trim()===""&&k.value.trim()!==""&&n.options.push({value:k.value,text:k.value})}));let u=o.querySelector("#aipkit_ai_form_designer_area"),f=u?u.querySelector(`#${CSS.escape(r)}`):null;if(f&&u){let _=f.parentElement,m=u.scrollTop,g=f.classList.contains("aipkit-element-selected"),k=f.nextElementSibling;if(f.remove(),typeof window.aipkitForms_renderFieldInColumn=="function"?window.aipkitForms_renderFieldInColumn(_,n,k):console.error("AI Forms updateElement: renderFieldInColumn function missing."),g){let w=u.querySelector(`#${CSS.escape(r)}`);w&&w.classList.add("aipkit-element-selected")}u.scrollTop=m}else console.warn("AI Forms updateElement: Designer element or area not found in provided container for re-render.");typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(o)}window.aipkitForms_updateElementFromSettingsPanel=p})();(function(){"use strict";function p(i){let e=window.aipkitAIFormsState;if(!i)return;let t=i.querySelector("#aipkit_prompt_snippets_container");if(!t)return;t.innerHTML="";let n=new Set;if(e.formStructure.forEach(s=>{s.columns.forEach(a=>{a.elements.forEach(c=>{c.fieldId&&n.add(c.fieldId)})})}),n.size>0){let s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a;n.forEach(a=>{let c=document.createElement("button");c.type="button",c.className="aipkit_prompt_snippet",c.dataset.fieldId=a,c.title=s("Click to copy","gpt3-ai-content-generator"),c.innerHTML=`<span class="dashicons dashicons-clipboard"></span> {${a}}`,t.appendChild(c)})}}function r(i){if(!i)return;let e=i.querySelector("#aipkit_form_editor_container");if(!e){console.warn("AI Forms: Editor container not found for prompt snippets init.");return}let t=e.querySelector("#aipkit_prompt_snippets_container");if(!t){console.warn("AI Forms: Prompt snippets container not found for init.");return}t.dataset.listenerAttached!=="true"&&(t.addEventListener("click",function(n){let s=n.target.closest(".aipkit_prompt_snippet");if(!s)return;let a=s.dataset.fieldId;a&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(`{${a}}`,s)}),t.dataset.listenerAttached="true")}function o(i=null,e){let t=window.aipkitAIFormsState,n=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:d=>d,a=window.aipkit_escapeHtml||function(d){return d};if(!e){console.error("AI Forms Admin (showFormEditor): formsContainerElement not provided.");return}t.currentFormId=i,t.droppedElementCounter=0,t.formStructure=[],t.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(e):console.error("AI Forms showFormEditor: hideSettingsPanel function missing.");let c=e.querySelector("#aipkit_form_editor_container"),l=e.querySelector("#aipkit_ai_forms_list_container");l.style.display="none",c.style.display="block",requestAnimationFrame(()=>{let d=c.querySelector("#aipkit_ai_form_title"),u=c.querySelector("#aipkit_ai_form_prompt_template"),f=c.querySelector("#aipkit_ai_form_id"),_=c.querySelector("#aipkit_ai_form_designer_area"),m=c.querySelector("#aipkit_ai_form_ai_provider"),g=c.querySelector("#aipkit_ai_form_ai_model"),k=c.querySelector("#aipkit_ai_form_temperature"),w=c.querySelector("#aipkit_ai_form_temperature_value"),h=c.querySelector("#aipkit_ai_form_max_tokens"),y=c.querySelector("#aipkit_ai_form_max_tokens_value"),b=c.querySelector("#aipkit_ai_form_top_p"),v=c.querySelector("#aipkit_ai_form_top_p_value"),S=c.querySelector("#aipkit_ai_form_frequency_penalty"),C=c.querySelector("#aipkit_ai_form_frequency_penalty_value"),T=c.querySelector("#aipkit_ai_form_presence_penalty"),E=c.querySelector("#aipkit_ai_form_presence_penalty_value"),M=c.querySelector("#aipkit_preview_ai_form_btn"),x=()=>{let A=document.createElement("div");return A.className="aipkit_form_designer_placeholder",A.id="aipkit_form_designer_placeholder",A.innerHTML=`<span class="dashicons dashicons-layout"></span>${s("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,A};if(!c||!l||!d||!u||!f||!_||!m||!g||!k||!h||!M||!w||!y||!b||!v||!S||!C||!T||!E){console.error("AI Forms Admin (showFormEditor): One or more editor child elements not found within the provided container.",{containerHTML:e.innerHTML.substring(0,500)});return}d.value="",u.value="",f.value="",_.innerHTML="",_.appendChild(x()),p(e);let L={generate_button:"Generate",stop_button:"Stop",download_button:"Download",save_button:"Save",copy_button:"Copy",provider_label:"Provider",model_label:"Model"};if(c.querySelectorAll('input[name^="labels["]').forEach(A=>{let I=A.name.match(/labels\[(.+)\]/),q=I?I[1]:null;q&&L[q]!==void 0?A.value=L[q]:A.value=""}),!i){if(m.value="OpenAI",k&&w){let A=window.aipkit_dashboard?.ai_params?.temperature||1;k.value=A,w.textContent=A}if(h&&y){let A=window.aipkit_dashboard?.ai_params?.max_completion_tokens||2e3;h.value=A,y.textContent=A}if(b&&v){let A=window.aipkit_dashboard?.ai_params?.top_p||1;b.value=A,v.textContent=A}if(S&&C){let A=window.aipkit_dashboard?.ai_params?.frequency_penalty||0;S.value=A,C.textContent=A}if(T&&E){let A=window.aipkit_dashboard?.ai_params?.presence_penalty||0;T.value=A,E.textContent=A}typeof window.aipkitForms_populateAiModels=="function"&&(window.aipkitForms_populateAiModels("OpenAI","gpt-4o-mini"),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(c))}i?(M.disabled=!1,f.value=i,_.innerHTML=`<p style="text-align:center; padding:20px;"><span class="aipkit_spinner" style="display:inline-block; width:16px; height:16px;"></span> ${s("Loading form details...","gpt3-ai-content-generator")}</p>`,window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:i,_ajax_nonce:n.nonce_manage_forms}).then(A=>{if(A.form){d.value=A.form.title||"",u.value=A.form.prompt_template||"",m.value=A.form.ai_provider||"OpenAI",k&&w&&(k.value=A.form.temperature,w.textContent=A.form.temperature),h&&y&&(h.value=A.form.max_tokens,y.textContent=A.form.max_tokens),b&&v&&(b.value=A.form.top_p,v.textContent=A.form.top_p),S&&C&&(S.value=A.form.frequency_penalty,C.textContent=A.form.frequency_penalty),T&&E&&(T.value=A.form.presence_penalty,E.textContent=A.form.presence_penalty);let I=A.form.labels||{};["generate_button","stop_button","download_button","save_button","copy_button","provider_label","model_label"].forEach(W=>{let H=c.querySelector(`input[name="labels[${W}]"]`);H&&(H.value=I[W]||"")}),typeof window.aipkitForms_populateAiModels=="function"&&window.aipkitForms_populateAiModels(m.value,A.form.ai_model);let P=c.querySelector("#aipkit_ai_form_reasoning_effort");P&&(P.value=A.form.reasoning_effort||"low"),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(c);let B=c.querySelector('input[name="enable_vector_store"]'),F=B?B.closest(".aipkit_accordion-content"):null;if(F){let W=F.querySelector('select[name="vector_store_provider"]'),H=F.querySelector('select[name="openai_vector_store_ids[]"]'),K=F.querySelector('select[name="pinecone_index_name"]'),j=F.querySelector('select[name="qdrant_collection_name"]'),G=F.querySelector('select[name="vector_embedding_provider"]'),Q=F.querySelector('select[name="vector_embedding_model"]'),J=F.querySelector('input[name="vector_store_top_k"]'),te=F.querySelector("#aipkit_ai_form_vector_store_top_k_value"),ie=F.querySelector('input[name="vector_store_confidence_threshold"]'),ne=F.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");if(B.checked=A.form.enable_vector_store==="1",W&&(W.value=A.form.vector_store_provider||"openai"),K&&(K.value=A.form.pinecone_index_name||""),j&&(j.value=A.form.qdrant_collection_name||""),G&&(G.value=A.form.vector_embedding_provider||"openai"),J&&te){let ee=A.form.vector_store_top_k||3;J.value=ee,te.textContent=ee}if(ie&&ne){let ee=A.form.vector_store_confidence_threshold||20;ie.value=ee,ne.textContent=ee+"%"}H&&A.form.openai_vector_store_ids&&Array.isArray(A.form.openai_vector_store_ids)&&Array.from(H.options).forEach(ee=>{ee.selected=A.form.openai_vector_store_ids.includes(ee.value)}),typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(F),Q&&(Q.value=A.form.vector_embedding_model||""),B.dispatchEvent(new Event("change",{bubbles:!0}))}let O=c.querySelector('input[name="openai_web_search_enabled"]'),D=c.querySelector('input[name="google_search_grounding_enabled"]');O&&(O.checked=A.form.openai_web_search_enabled==="1"),D&&(D.checked=A.form.google_search_grounding_enabled==="1");let $=c.querySelector('select[name="openai_web_search_context_size"]'),N=c.querySelector('select[name="openai_web_search_loc_type"]'),R=c.querySelector('input[name="openai_web_search_loc_country"]'),z=c.querySelector('input[name="openai_web_search_loc_city"]'),U=c.querySelector('input[name="openai_web_search_loc_region"]'),V=c.querySelector('input[name="openai_web_search_loc_timezone"]');$&&($.value=A.form.openai_web_search_context_size||"medium"),N&&(N.value=A.form.openai_web_search_loc_type||"none"),R&&(R.value=A.form.openai_web_search_loc_country||""),z&&(z.value=A.form.openai_web_search_loc_city||""),U&&(U.value=A.form.openai_web_search_loc_region||""),V&&(V.value=A.form.openai_web_search_loc_timezone||"");let Y=c.querySelector('select[name="google_grounding_mode"]'),X=c.querySelector('input[name="google_grounding_dynamic_threshold"]'),Z=c.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");if(Y&&(Y.value=A.form.google_grounding_mode||"DEFAULT_MODE"),X){let W=A.form.google_grounding_dynamic_threshold||.3;X.value=W,Z&&(Z.textContent=W)}if(typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(m.value),O&&O.dispatchEvent(new Event("change",{bubbles:!0})),D&&D.dispatchEvent(new Event("change",{bubbles:!0})),A.form.structure&&Array.isArray(A.form.structure))if(t.formStructure=A.form.structure,_.innerHTML="",t.formStructure.length===0)_.appendChild(x());else{t.formStructure.forEach(H=>{window.aipkitForms_renderLayoutRow(_,H,null,e)});let W=0;t.formStructure.forEach(H=>{H.columns.forEach(K=>{K.elements.forEach(j=>{let G=j.internalId.split("-"),Q=parseInt(G[G.length-1],10)||0;Q>W&&(W=Q)})})}),t.droppedElementCounter=W}else _.innerHTML="",_.appendChild(x());p(e)}else throw new Error(A.message||s("Could not load form data.","gpt3-ai-content-generator"))}).catch(A=>{typeof window.aipkitForms_displayMessage=="function"?window.aipkitForms_displayMessage(e,"error",A.message):console.error("AI Forms showFormEditor: displayMessage function missing."),typeof window.aipkitForms_hideFormEditor=="function"?window.aipkitForms_hideFormEditor(e):console.error("AI Forms showFormEditor: hideFormEditor function missing.")})):M.disabled=!0})}window.aipkitForms_showFormEditor=o,window.aipkitForms_updatePromptSnippets=p,window.aipkitForms_initPromptSnippets=r})();(function(){"use strict";function p(r){let o=window.aipkitAIFormsState,i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;if(!r){console.error("AI Forms hideFormEditor: formsContainerElement not provided.");return}o.currentFormId=null,o.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(r):console.error("AI Forms hideFormEditor: hideSettingsPanel function missing.");let e=r.querySelector("#aipkit_form_editor_container"),t=r.querySelector("#aipkit_ai_forms_list_container");if(e&&(e.style.display="none"),t&&(t.style.display="block"),e){let s=e.querySelector("#aipkit_ai_form_preview_container");s&&(s.style.display="none",s.innerHTML="");let a=e.querySelector("#aipkit_preview_ai_form_btn");if(a&&a.classList.contains("aipkit-preview-active")){a.classList.remove("aipkit-preview-active");let c=a.querySelector(".aipkit_btn-text");c&&(c.textContent=i("Preview","gpt3-ai-content-generator"))}}let n=r.querySelector("#aipkit_ai_forms_messages");n&&(n.innerHTML="")}window.aipkitForms_hideFormEditor=p})();(function(){"use strict";function p(r,o){let i=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:K=>K;if(!o){console.error("AI Forms saveForm: formsContainerElement not provided.");return}let n=o.querySelector("#aipkit_form_editor_container");if(!n){console.error("AI Forms saveForm: editorContainer not found in provided formsContainerElement.");return}let s=n.querySelector("#aipkit_ai_form_title"),a=n.querySelector("#aipkit_ai_form_prompt_template"),c=n.querySelector("#aipkit_ai_form_id"),l=n.querySelector("#aipkit_ai_form_ai_provider"),d=n.querySelector("#aipkit_ai_form_ai_model"),u=n.querySelector("#aipkit_ai_form_temperature"),f=n.querySelector("#aipkit_ai_form_max_tokens"),_=n.querySelector("#aipkit_ai_form_top_p"),m=n.querySelector("#aipkit_ai_form_frequency_penalty"),g=n.querySelector("#aipkit_ai_form_presence_penalty"),k=n.querySelector("#aipkit_ai_form_reasoning_effort"),w=n.querySelector('input[name="enable_vector_store"]'),h=n.querySelector('select[name="vector_store_provider"]'),y=n.querySelector('select[name="openai_vector_store_ids[]"]'),b=n.querySelector('select[name="pinecone_index_name"]'),v=n.querySelector('select[name="qdrant_collection_name"]'),S=n.querySelector('select[name="vector_embedding_provider"]'),C=n.querySelector('select[name="vector_embedding_model"]'),T=n.querySelector('input[name="vector_store_top_k"]'),E=n.querySelector('input[name="vector_store_confidence_threshold"]'),M=n.querySelector('input[name="openai_web_search_enabled"]'),x=n.querySelector('input[name="google_search_grounding_enabled"]'),L=n.querySelector('select[name="openai_web_search_context_size"]'),A=n.querySelector('select[name="openai_web_search_loc_type"]'),I=n.querySelector('input[name="openai_web_search_loc_country"]'),q=n.querySelector('input[name="openai_web_search_loc_city"]'),P=n.querySelector('input[name="openai_web_search_loc_region"]'),B=n.querySelector('input[name="openai_web_search_loc_timezone"]'),F=n.querySelector('select[name="google_grounding_mode"]'),O=n.querySelector('input[name="google_grounding_dynamic_threshold"]');if(!s||!a||!c||!l||!d||!u||!f||!_||!m||!g){console.error("AI Forms saveForm: One or more critical form editor inputs not found in editorContainer.");return}let D=s.value.trim(),$=a.value.trim(),N=c.value;if(!D){alert(t(e.text.formTitleRequired||"Form title is required.","gpt3-ai-content-generator"));return}if(!$){alert(t(e.text.promptTemplateRequired||"Prompt template is required.","gpt3-ai-content-generator"));return}let R=new Set,z=!0;e:for(let K of i.formStructure)for(let j of K.columns)for(let G of j.elements){if(!G.fieldId||!/^[a-zA-Z0-9_]+$/.test(G.fieldId)){alert(t(`Invalid Field Variable Name: "${G.fieldId||""}" for element "${G.label}". Only letters, numbers, and underscores allowed, and it cannot be empty.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(G.internalId,o);let Q=n.querySelector(`#setting-field-id-${G.internalId}`);Q&&Q.focus(),z=!1;break e}if(R.has(G.fieldId)){alert(t(`Duplicate Field Variable Name: "${G.fieldId}". Each field variable name must be unique.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(G.internalId,o);let Q=n.querySelector(`#setting-field-id-${G.internalId}`);Q&&Q.focus(),z=!1;break e}R.add(G.fieldId)}if(!z)return;let U=y?Array.from(y.selectedOptions).map(K=>K.value):[],V=n.querySelectorAll('input[name^="labels["]'),Y={};V.forEach(K=>{let j=K.name.match(/\[(.*?)\]/);if(j&&j[1]){let G=j[1];Y[G]=K.value}});let X=JSON.stringify(Y),Z={_ajax_nonce:e.nonce_manage_forms,form_id:N||null,title:D,prompt_template:$,form_structure:JSON.stringify(i.formStructure),ai_provider:l.value,ai_model:d.value,temperature:u.value,max_tokens:f.value,top_p:_.value,frequency_penalty:m.value,presence_penalty:g.value,reasoning_effort:k?.value,enable_vector_store:w?.checked?"1":"0",vector_store_provider:h?.value,openai_vector_store_ids:U,pinecone_index_name:b?.value||"",qdrant_collection_name:v?.value||"",vector_embedding_provider:S?.value,vector_embedding_model:C?.value||"",vector_store_top_k:T?.value||3,vector_store_confidence_threshold:E?.value||20,openai_web_search_enabled:M?.checked?"1":"0",google_search_grounding_enabled:x?.checked?"1":"0",openai_web_search_context_size:L?.value||"medium",openai_web_search_loc_type:A?.value||"none",openai_web_search_loc_country:I?.value||"",openai_web_search_loc_city:q?.value||"",openai_web_search_loc_region:P?.value||"",openai_web_search_loc_timezone:B?.value||"",google_grounding_mode:F?.value||"DEFAULT_MODE",google_grounding_dynamic_threshold:O?.value||"0.30",labels:X},W=r.querySelector(".aipkit_btn-text")?r.querySelector(".aipkit_btn-text").textContent:r.textContent,H=r.querySelector(".aipkit_spinner");r.disabled=!0,H&&(H.style.display="inline-block"),r.querySelector(".aipkit_btn-text")?r.querySelector(".aipkit_btn-text").textContent=t(e.text.savingForm||"Saving...","gpt3-ai-content-generator"):r.firstChild.textContent=t(e.text.savingForm||"Saving...","gpt3-ai-content-generator")+" ",window.aipkit_apiRequest("aipkit_save_ai_form",Z).then(K=>{if(!N&&K.form_id){c&&(c.value=K.form_id),i.currentFormId=K.form_id;let j=n.querySelector("#aipkit_preview_ai_form_btn");j&&(j.disabled=!1)}typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(o,"success",K.message||t(e.text.formSaved||"Form saved!","gpt3-ai-content-generator")),typeof window.aipkitForms_hideFormEditor=="function"&&window.aipkitForms_hideFormEditor(o),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(K=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(o,"error",K.message||t(e.text.errorSavingForm||"Error saving form.","gpt3-ai-content-generator"))}).finally(()=>{r.disabled=!1,H&&(H.style.display="none"),r.querySelector(".aipkit_btn-text")?r.querySelector(".aipkit_btn-text").textContent=W:r.firstChild.textContent=W})}window.aipkitForms_saveForm=p})();(function(){"use strict";function p(r,o,i){let e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a;if(!i){console.error("AI Forms deleteForm: formsContainerElement not provided.");return}let n={_ajax_nonce:e.nonce_manage_forms,form_id:r},s=o.textContent;o.disabled=!0,o.textContent=t(e.text.deletingForm||"Deleting...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_delete_ai_form",n).then(a=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",a.message||t(e.text.formDeleted||"Form deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(a=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",a.message||t(e.text.errorDeletingForm||"Error deleting form.","gpt3-ai-content-generator"));let c=i.querySelector(`.aipkit_delete_ai_form_btn[data-form-id="${r}"]`);c&&(c.disabled=!1,c.textContent=s)})}window.aipkitForms_deleteForm=p})();(function(){"use strict";function p(r,o){let i=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a;if(!o){console.error("AI Forms deleteAllForms: formsContainerElement not provided.");return}let t={_ajax_nonce:i.nonce_manage_forms},n=r.querySelector(".aipkit_btn-text")?.textContent||e("Delete All Forms","gpt3-ai-content-generator"),s=r.querySelector(".aipkit_spinner");r.disabled=!0,r.querySelector(".aipkit_btn-text")&&(r.querySelector(".aipkit_btn-text").innerHTML=`<span class="aipkit_spinner" style="display:inline-block; margin-right: 5px;"></span> ${e(i.text.deletingAllForms||"Deleting...","gpt3-ai-content-generator")}`),window.aipkit_apiRequest("aipkit_delete_all_ai_forms",t).then(a=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(o,"success",a.message||e(i.text.allFormsDeleted||"All forms deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(a=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(o,"error",a.message||e(i.text.errorDeletingAllForms||"Error deleting all forms.","gpt3-ai-content-generator"))}).finally(()=>{r.querySelector(".aipkit_btn-text")&&(r.querySelector(".aipkit_btn-text").textContent=n),s&&(s.style.display="none"),r.disabled=!1})}window.aipkitForms_deleteAllForms=p})();(function(){"use strict";function p(r,o,i){let e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a;if(!i){console.error("AI Forms duplicateForm: formsContainerElement not provided.");return}let n={_ajax_nonce:e.nonce_manage_forms,form_id:r},s=o.textContent;o.disabled=!0,o.textContent=t(e.text.duplicatingForm||"Duplicating...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_duplicate_ai_form",n).then(a=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",a.message||t("Form duplicated successfully.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(a=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",a.message||t(e.text.errorDuplicatingForm||"Error duplicating form.","gpt3-ai-content-generator"))}).finally(()=>{let a=i.querySelector(`.aipkit_duplicate_ai_form_btn[data-form-id="${r}"]`);a&&(a.disabled=!1,a.textContent=s)})}window.aipkitForms_duplicateForm=p})();(function(){"use strict";async function p(r){let o=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t,e=r.textContent;r.disabled=!0,r.textContent=i("Exporting...","gpt3-ai-content-generator");try{let t=await window.aipkit_apiRequest("aipkit_export_all_ai_forms",{_ajax_nonce:o.nonce_manage_forms});if(t.forms&&Array.isArray(t.forms)&&t.forms.length>0){let n=t.forms.map(f=>(delete f.id,delete f.status,f)),a=`aipkit-forms-export-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,c=JSON.stringify(n,null,2),l=new Blob([c],{type:"application/json"}),d=URL.createObjectURL(l),u=document.createElement("a");u.href=d,u.download=a,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(d)}else throw new Error(i("No forms to export or data not found in response.","gpt3-ai-content-generator"))}catch(t){alert(i("Error exporting forms: ","gpt3-ai-content-generator")+t.message)}finally{r.disabled=!1,r.textContent=e}}window.aipkitForms_exportAllForms=p})();(function(){"use strict";async function p(r,o){let i=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:n=>n,t=o.textContent;o.disabled=!0,o.textContent=e("Exporting...","gpt3-ai-content-generator");try{let n=await window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:r,_ajax_nonce:i.nonce_manage_forms});if(n.form){let s=n.form,a=s.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),c=`aipkit-form-${r}-${a}.json`;delete s.id,delete s.status;let l=JSON.stringify(s,null,2),d=new Blob([l],{type:"application/json"}),u=URL.createObjectURL(d),f=document.createElement("a");f.href=u,f.download=c,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(u)}else throw new Error(e("Form data not found in response.","gpt3-ai-content-generator"))}catch(n){alert(e("Error exporting form: ","gpt3-ai-content-generator")+n.message)}finally{o.disabled=!1,o.textContent=t}}window.aipkitForms_exportForm=p})();(function(){"use strict";let p=document.getElementById("aipkit_ai_forms_import_messages"),r;function o(t,n){if(!p)return;let s=window.aipkit_escapeHtml||(a=>a);p.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${t}">${s(n)}</div>`,r&&clearTimeout(r),r=setTimeout(()=>{p.innerHTML=""},8e3)}function i(){p&&(p.innerHTML=""),r&&clearTimeout(r)}async function e(t){let n=window.aipkit_ai_forms_config||{text:{}},s=window.wp?.i18n?.__||(d=>d),a=t.files;if(!a.length)return;let c=a[0];i(),o("info",s("Reading file...","gpt3-ai-content-generator"));let l=new FileReader;l.onload=async function(d){try{let u=d.target.result,f=JSON.parse(u);if(typeof f=="object"&&f!==null&&!Array.isArray(f)&&(f=[f]),!Array.isArray(f))throw new Error(s("Import file is not a valid JSON array.","gpt3-ai-content-generator"));if(f.length===0){o("warning",s("File contains no forms to import.","gpt3-ai-content-generator"));return}o("info",s("Importing...","gpt3-ai-content-generator"));let _=await window.aipkit_apiRequest("aipkit_import_ai_forms",{_ajax_nonce:n.nonce_manage_forms,forms_json:JSON.stringify(f)});o(_.failed_count>0?"warning":"success",_.message),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}catch(u){o("error",s("Error processing import file: ","gpt3-ai-content-generator")+u.message)}},l.onerror=function(){o("error",s("Error reading the selected file.","gpt3-ai-content-generator"))},l.readAsText(c)}window.aipkitForms_importForms=e})();(function(){"use strict";function p(r){let o=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:l=>l,e=document.getElementById("aipkit_ai_forms_settings_form");if(!e){console.error("AI Forms Save Settings: Settings form not found.");return}let t="aipkit_aiforms_settings_save_status";window.aipkit_showSavingIndicator(t,!1);let n=r.querySelector(".aipkit_btn-text")?.textContent||i("Save AI Forms Settings","gpt3-ai-content-generator"),s=r.querySelector(".aipkit_spinner");r.disabled=!0,s&&(s.style.display="inline-block"),r.querySelector(".aipkit_btn-text")&&(r.querySelector(".aipkit_btn-text").textContent=i("Saving...","gpt3-ai-content-generator"));let a=new FormData(e),c=Object.fromEntries(a.entries());window.aipkit_apiRequest("aipkit_save_ai_forms_settings",c).then(l=>{window.aipkit_showMessage(t,"success",l.message||i("Settings saved!","gpt3-ai-content-generator"))}).catch(l=>{window.aipkit_showMessage(t,"error",l.message||i("Failed to save settings.","gpt3-ai-content-generator")),console.error("AI Forms Save Settings Error:",l)}).finally(()=>{r.disabled=!1,s&&(s.style.display="none"),r.querySelector(".aipkit_btn-text")&&(r.querySelector(".aipkit_btn-text").textContent=n)})}window.aipkitForms_saveAiFormsSettings=p})();(function(){"use strict";function p(r,o,i){let e=window.aipkit_escapeHtml||function(n){return n};if(!r){console.error("AI Forms displayMessage: formsContainerElement not provided.");return}let t=r.querySelector("#aipkit_ai_forms_messages");t?(t.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${o}">${e(i)}</div>`,setTimeout(()=>{t.innerHTML=""},5e3)):console.warn("AI Forms displayMessage: Message container #aipkit_ai_forms_messages not found in provided container.")}window.aipkitForms_displayMessage=p})();(function(){"use strict";function p(o){if(!o){console.warn("AI Forms Token UI: Settings container not provided for toggling fields.");return}let i=o.querySelector(".aipkit_token_limit_mode_select"),e=o.querySelector(".aipkit_token_general_user_limit_field"),t=o.querySelector(".aipkit_token_role_limits_container");if(!i||!e||!t){console.warn("AI Forms Token UI: Could not find required elements for toggling limit fields.");return}let n=i.value;e.style.display=n==="general"?"block":"none",t.style.display=n==="role_based"?"block":"none"}function r(o){if(!o){console.error("AI Forms Token UI: Initialization failed, settings container not provided.");return}let i="data-token-listener-attached";o.getAttribute(i)!=="true"&&(o.addEventListener("change",function(e){e.target.closest(".aipkit_token_limit_mode_select")&&p(o)}),p(o),o.setAttribute(i,"true"))}window.aipkit_initAIFormsTokenManagementUI=r})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_ai_forms_container");return r||(console.error("[AI Forms Init] CRITICAL: Main container (#aipkit_ai_forms_container) not found. Initialization aborted."),null)}window.aipkitForms_validateContainer=p})();(function(){"use strict";function p(r){let o=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t,e=window.aipkit_escapeHtml||function(t){return t};r.dataset.clickListenerAttached!=="true"&&(r.addEventListener("click",function(t){let n=t.target,s=c=>n.closest(c),a=r.querySelector("#aipkit_form_editor_container");if(n.matches("#aipkit_create_new_ai_form_btn")||s("#aipkit_create_new_ai_form_btn")){t.preventDefault();let c=r.querySelector('.aipkit_tab[data-tab="forms-main"]');c&&!c.classList.contains("aipkit_active")&&c.click(),typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(null,r)}else if(s(".aipkit_actions_menu_toggle")){t.preventDefault(),t.stopPropagation();let c=n.closest(".aipkit_actions_menu");if(!c)return;let l=c.querySelector(".aipkit_actions_dropdown_menu");if(!l)return;let d=l.style.display==="block";if(document.querySelectorAll(".aipkit_actions_dropdown_menu").forEach(u=>{u!==l&&(u.style.display="none")}),l.style.display=d?"none":"block",!d){let u=f=>{c.contains(f.target)||(l.style.display="none")};document.addEventListener("click",u,{once:!0,capture:!0})}}else if(s("#aipkit_import_ai_forms_btn")){t.preventDefault();let c=r.querySelector("#aipkit_ai_forms_import_file_input");c&&c.click()}else if(n.matches(".aipkit_edit_ai_form_btn")||s(".aipkit_edit_ai_form_btn")){t.preventDefault();let l=s(".aipkit_edit_ai_form_btn").dataset.formId;typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(l,r)}else if(n.matches(".aipkit_duplicate_ai_form_btn")||s(".aipkit_duplicate_ai_form_btn")){t.preventDefault();let c=s(".aipkit_duplicate_ai_form_btn"),l=c.dataset.formId;typeof aipkitForms_duplicateForm=="function"&&aipkitForms_duplicateForm(l,c,r)}else if(n.matches("#aipkit_export_all_ai_forms_btn")||s("#aipkit_export_all_ai_forms_btn")){t.preventDefault();let c=s("#aipkit_export_all_ai_forms_btn");typeof window.aipkitForms_exportAllForms=="function"&&window.aipkitForms_exportAllForms(c)}else if(n.matches(".aipkit_export_ai_form_btn")||s(".aipkit_export_ai_form_btn")){t.preventDefault();let c=s(".aipkit_export_ai_form_btn"),l=c.dataset.formId;typeof window.aipkitForms_exportForm=="function"&&window.aipkitForms_exportForm(l,c)}else if(n.matches(".aipkit_delete_ai_form_btn")||s(".aipkit_delete_ai_form_btn")){t.preventDefault();let c=s(".aipkit_delete_ai_form_btn"),l=c.dataset.formId,d=c.dataset.formTitle||`Form ID ${l}`;confirm(`${i(o.text.confirmDeleteForm||"Are you sure you want to delete this form? This action cannot be undone.","gpt3-ai-content-generator")}

${d}`)&&typeof aipkitForms_deleteForm=="function"&&aipkitForms_deleteForm(l,c,r)}else if(n.matches("#aipkit_delete_all_ai_forms_btn")||s("#aipkit_delete_all_ai_forms_btn")){t.preventDefault();let c=s("#aipkit_delete_all_ai_forms_btn");confirm(i(o.text.confirmDeleteAllForms||"Are you sure you want to delete ALL forms? This action cannot be undone.","gpt3-ai-content-generator"))&&typeof window.aipkitForms_deleteAllForms=="function"&&window.aipkitForms_deleteAllForms(c,r)}else if(n.matches(".aipkit_form_shortcode_input"))t.preventDefault(),typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(n.value,n);else if(s(".aipkit_aiform_settings_toggle")){t.preventDefault();let c=s(".aipkit_aiform_settings_toggle"),l=c.dataset.formId,d=r.querySelector(`#aif-configurator-${l}`);if(!d)return;r.querySelectorAll(".aipkit_shortcode_configurator").forEach(_=>{_!==d&&(_.style.display="none")});let f=d.style.display==="block";if(d.style.display=f?"none":"block",!f){let _=m=>{!d.contains(m.target)&&!c.contains(m.target)&&(d.style.display="none",document.removeEventListener("click",_,!0))};setTimeout(()=>{document.addEventListener("click",_,{capture:!0,once:!0})},0)}}else if(n.matches("#aipkit_validate_prompt_btn")||s("#aipkit_validate_prompt_btn"))t.preventDefault(),typeof window.aipkitForms_validatePrompt=="function"&&window.aipkitForms_validatePrompt();else if(s("#aipkit_ai_form_toggle_params_btn")){t.preventDefault();let c=s("#aipkit_ai_form_toggle_params_btn"),l=a.querySelector("#aipkit_ai_form_advanced_params_container");if(l){let d=l.style.display!=="none";l.style.display=d?"none":"block",c.classList.toggle("aipkit-active",!d)}}else if(n.matches("#aipkit_save_ai_form_btn")||s("#aipkit_save_ai_form_btn")){t.preventDefault();let c=s("#aipkit_save_ai_form_btn");typeof aipkitForms_saveForm=="function"&&aipkitForms_saveForm(c,r)}else if(n.matches("#aipkit_cancel_edit_ai_form_btn")||s("#aipkit_cancel_edit_ai_form_btn"))t.preventDefault(),typeof aipkitForms_hideFormEditor=="function"&&aipkitForms_hideFormEditor(r);else if(n.matches("#aipkit_preview_ai_form_btn")||s("#aipkit_preview_ai_form_btn")){let f=function(m){if(!document.querySelector(`link[href="${m}"]`)){let g=document.createElement("link");g.rel="stylesheet",g.href=m,document.head.appendChild(g)}},_=function(m){return new Promise((g,k)=>{if(document.querySelector(`script[src="${m}"]`)){g();return}let h=document.createElement("script");h.src=m,h.async=!0,h.onload=()=>g(),h.onerror=()=>k(new Error(`Failed to load script: ${m}`)),document.body.appendChild(h)})};t.preventDefault();let c=s("#aipkit_preview_ai_form_btn"),l=a.querySelector("#aipkit_ai_form_preview_container"),d=c.querySelector(".aipkit_btn-text");if(!c||!l||!d){console.error("AI Forms Preview: Missing required UI elements (button, container, or text span).");return}if(c.classList.contains("aipkit-preview-active")){l.style.display="none",l.innerHTML="",c.classList.remove("aipkit-preview-active"),d.textContent=i("Preview","gpt3-ai-content-generator");return}let u=a.querySelector("#aipkit_ai_form_id").value;if(!u){alert(i("You must save the form before you can preview it.","gpt3-ai-content-generator"));return}c.classList.add("aipkit-preview-active"),d.textContent=i("Close Preview","gpt3-ai-content-generator"),l.innerHTML='<p style="text-align:center;"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading Preview...</p>',l.style.display="block",window.aipkit_apiRequest("aipkit_get_form_preview",{form_id:u,_ajax_nonce:o.nonce_manage_forms}).then(m=>{if(m.config&&(window.aipkit_ai_forms_public_config=m.config),m.models&&(window.aipkit_ai_forms_models=m.models),m.assets&&m.assets.css&&Object.values(m.assets.css).forEach(g=>f(g)),l.innerHTML=m.html,m.assets&&m.assets.js){let g=Object.values(m.assets.js).map(k=>_(k));return Promise.all(g)}}).then(()=>{typeof window.aipkit_initAIFormsPublic=="function"&&window.aipkit_initAIFormsPublic()}).catch(m=>{console.error("Error fetching form preview:",m),l.innerHTML=`<p style="color:red;">Error: ${e(m.message)}</p>`,c.classList.remove("aipkit-preview-active"),d.textContent=i("Preview","gpt3-ai-content-generator")})}else if(s(".aipkit_dropped_element_settings_btn")){t.preventDefault();let c=s(".aipkit_dropped_element");c&&typeof aipkitForms_showSettingsPanel=="function"&&aipkitForms_showSettingsPanel(c.id,r)}else if(s(".aipkit_dropped_element_delete_btn")){t.preventDefault();let c=s(".aipkit_dropped_element");c&&confirm(i(o.text.confirmDeleteElement||"Are you sure you want to delete this form element?","gpt3-ai-content-generator"))&&typeof aipkitForms_deleteDroppedElement=="function"&&aipkitForms_deleteDroppedElement(c.id,r)}else if(s(".aipkit_layout_row_delete_btn")){if(t.preventDefault(),confirm(i("Are you sure you want to delete this row and all elements inside it?","gpt3-ai-content-generator"))){let c=s(".aipkit_layout_row");c&&(Array.from(c.querySelectorAll(".aipkit_dropped_element")).map(d=>d.id).includes(window.aipkitAIFormsState.selectedDesignerElementId)&&aipkitForms_hideSettingsPanel(r),c.remove(),window.aipkitForms_updateFormStructureOrder(),window.aipkitForms_updatePromptSnippets(r))}}else if(s("#aipkit_settings_panel_close_btn"))t.preventDefault(),typeof aipkitForms_hideSettingsPanel=="function"&&aipkitForms_hideSettingsPanel(r);else if(s(".aipkit_remove_option_btn")){t.preventDefault();let c=s(".aipkit_select_option_row");c&&(c.remove(),window.aipkitAIFormsState.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(window.aipkitAIFormsState.selectedDesignerElementId,r))}else if(s("#aipkit_add_select_option_btn"))t.preventDefault(),typeof aipkitForms_addSelectOptionRow=="function"&&aipkitForms_addSelectOptionRow(r);else if(s("#aipkit_save_ai_forms_settings_btn")){t.preventDefault();let c=s("#aipkit_save_ai_forms_settings_btn");typeof window.aipkitForms_saveAiFormsSettings=="function"&&window.aipkitForms_saveAiFormsSettings(c)}}),r.dataset.clickListenerAttached="true")}window.aipkitForms_attachClickEventListeners=p})();(function(){"use strict";function p(o,i){if(!o)return;let e=i.querySelector(`#aif-configurator-${o}`),t=i.querySelector(`#aif-shortcode-input-${o}`);if(!e||!t)return;let n=e.querySelectorAll(".aipkit-aiform-config-input"),s=[];n.forEach(c=>{let l=c.dataset.attrName;l&&(c.type==="checkbox"?c.checked&&s.push(`${l}="true"`):c.type==="select-one"&&c.value&&c.value!=="light"&&s.push(`${l}="${c.value}"`))});let a=`[aipkit_ai_form id=${o}`;s.length>0&&(a+=" "+s.join(" ")),a+="]",t.value=a}function r(o){o.dataset.changeListenerAttached!=="true"&&(o.addEventListener("change",function(i){let e=i.target;if(e.matches(".aipkit-aiform-config-input")){let t=e.dataset.formId;p(t,o)}else e.id==="aipkit_ai_forms_import_file_input"&&(typeof window.aipkitForms_importForms=="function"&&window.aipkitForms_importForms(e),e.value="")}),o.dataset.changeListenerAttached="true")}window.aipkitForms_attachChangeEventListeners=r})();(function(){"use strict";function p(r){let o=window.aipkitAIFormsState,i=r.querySelector("#aipkit_ai_form_element_settings_panel");if(!i){console.warn("AI Forms Init: Settings panel not found, cannot attach listeners.");return}if(i.dataset.inputListenerAttached==="true")return;let e=()=>{o.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(o.selectedDesignerElementId,r)};i.addEventListener("input",t=>{t.target.matches(".aipkit-setting-field")&&e()}),i.addEventListener("change",t=>{t.target.matches('.aipkit-setting-field[type="checkbox"]')&&e()}),i.dataset.inputListenerAttached="true"}window.aipkitForms_attachSettingsPanelListeners=p})();(function(){"use strict";function p(r){let o=window.aipkitAIFormsState;if(!r){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let i=r.querySelector("#aipkit_ai_form_elements_palette"),e=r.querySelector("#aipkit_ai_form_designer_area");if(!i||!e){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(i.dataset.dragListenersAttached==="true"&&e.dataset.dragListenersAttached==="true")return;i.querySelectorAll(".aipkit_form_element_item").forEach(n=>{n.dataset.dragStartListenerAttached!=="true"&&(n.addEventListener("dragstart",s=>{s.target.classList.add("aipkit-dragging"),o.draggedElement=null,s.target.dataset.layoutType?(o.draggedLayoutType=s.target.dataset.layoutType,o.draggedElementType=null,s.dataTransfer.setData("text/plain",o.draggedLayoutType),s.dataTransfer.effectAllowed="copy"):(o.draggedElementType=s.target.dataset.elementType,o.draggedLayoutType=null,s.dataTransfer.setData("text/plain",o.draggedElementType),s.dataTransfer.effectAllowed="copy")}),n.addEventListener("dragend",s=>{s.target.classList.remove("aipkit-dragging"),o.draggedElementType=null,o.draggedLayoutType=null}),n.dataset.dragStartListenerAttached="true")}),i.dataset.dragListenersAttached="true",e.dataset.dragListenersAttached!=="true"&&(e.addEventListener("dragstart",n=>{let s=n.target.closest(".aipkit_layout_row"),a=n.target.closest(".aipkit_dropped_element");if(s&&n.target.classList.contains("aipkit_layout_row_drag_handle"))o.draggedElement=s,n.dataTransfer.setData("text/row-id",s.id),n.dataTransfer.effectAllowed="move";else if(a&&n.target.classList.contains("aipkit_dropped_element_drag_handle"))o.draggedElement=a,n.dataTransfer.setData("text/element-id",a.id),n.dataTransfer.effectAllowed="move";else return;o.draggedElementType=null,o.draggedLayoutType=null,setTimeout(()=>{o.draggedElement&&o.draggedElement.classList.add("aipkit-row-dragging-source")},0)}),e.addEventListener("dragend",n=>{o.draggedElement&&(o.draggedElement.classList.remove("aipkit-row-dragging-source"),o.draggedElement=null)}),e.addEventListener("dragover",n=>{n.preventDefault(),e.classList.add("aipkit-drag-over"),o.draggedElement?n.dataTransfer.dropEffect="move":n.dataTransfer.dropEffect="copy"}),e.addEventListener("dragleave",n=>{e.contains(n.relatedTarget)||e.classList.remove("aipkit-drag-over")}),e.addEventListener("drop",n=>{n.preventDefault(),n.stopPropagation(),e.classList.remove("aipkit-drag-over");let s=e.querySelector("#aipkit_form_designer_placeholder");if(o.draggedLayoutType){s&&(s.style.display="none");let a=window.aipkitForms_createNewLayoutData(o.draggedLayoutType);o.formStructure.push(a),window.aipkitForms_renderLayoutRow(e,a,null,r),o.draggedLayoutType=null}else if(o.draggedElement&&o.draggedElement.classList.contains("aipkit_layout_row")){let a=n.target.closest(".aipkit_layout_row");if(a&&a!==o.draggedElement){let c=a.getBoundingClientRect(),d=n.clientY>c.top+c.height/2?a.nextSibling:a;e.insertBefore(o.draggedElement,d)}window.aipkitForms_updateFormStructureOrder()}else if(o.draggedElementType){s&&(s.style.display="none");let a=window.aipkitForms_createNewLayoutData("1-col"),c=window.aipkitForms_createNewFormElementData(o.draggedElementType);a.columns[0].elements.push(c),o.formStructure.push(a),window.aipkitForms_renderLayoutRow(e,a,null,r),o.draggedElementType=null}o.draggedElement&&(o.draggedElement.classList.remove("aipkit-row-dragging-source"),o.draggedElement=null),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r)}),e.dataset.dragListenersAttached="true")}window.aipkitForms_initializeDragAndDrop=p})();(function(){"use strict";function p(r){let o=r.querySelector("#forms-settings-content");o&&typeof window.aipkit_initAIFormsTokenManagementUI=="function"?window.aipkit_initAIFormsTokenManagementUI(o):console.error("AI Forms Init: Could not initialize token management UI for settings tab.")}window.aipkitForms_initializeTokenUI=p})();(function(){"use strict";function p(r){if(!r)return;let o="data-accordion-listener-attached";r.getAttribute(o)!=="true"&&(r.addEventListener("click",function(i){let e=i.target.closest(".aipkit_accordion-header");if(!e||!e.closest(".aipkit_ai_forms_container"))return;i.preventDefault();let t=e.closest(".aipkit_accordion-group");if(t&&!e.classList.contains("aipkit_active")){let s=t.querySelector(".aipkit_accordion-header.aipkit_active");if(s){s.classList.remove("aipkit_active");let a=s.nextElementSibling;a&&a.classList.remove("aipkit_active")}}let n=e.nextElementSibling;n&&(e.classList.toggle("aipkit_active"),n.classList.toggle("aipkit_active"))}),r.setAttribute(o,"true"))}window.aipkitForms_initializeAccordions=p})();(function(){"use strict";function p(e,t=""){let n=document.getElementById("aipkit_ai_form_ai_model"),s=window.aipkit_dashboard?.models||{};if(!n||!s)return;let a=e.toLowerCase(),c=s[a]||[];if(n.innerHTML="",!c||Array.isArray(c)&&c.length===0||!Array.isArray(c)&&Object.keys(c).length===0){let d=new Option("No models found. Sync in main settings.","");n.appendChild(d);return}let l=!1;if(Array.isArray(c)?c.forEach(d=>{let u=new Option(d.name,d.id);d.id===t&&(u.selected=!0,l=!0),n.appendChild(u)}):Object.keys(c).forEach(d=>{let u=document.createElement("optgroup");u.label=d,c[d].forEach(f=>{let _=new Option(f.name,f.id);f.id===t&&(_.selected=!0,l=!0),u.appendChild(_)}),n.appendChild(u)}),!l&&t){let d=new Option(`${t} (Manual/Not Synced)`,t,!1,!0);n.insertBefore(d,n.firstChild),d.selected=!0}n.selectedIndex===-1&&n.options.length>0&&(n.options[0].selected=!0)}function r(e){let t=document.querySelector('input[name="openai_web_search_enabled"]'),n=document.querySelector('input[name="google_search_grounding_enabled"]'),s=t?.closest(".aipkit_form-group"),a=n?.closest(".aipkit_form-group"),c=document.querySelector(".aipkit_ai_form_openai_web_search_settings"),l=document.querySelector(".aipkit_ai_form_google_search_grounding_settings");s&&(e==="OpenAI"?s.style.display="block":(s.style.display="none",t&&(t.checked=!1),c&&(c.style.display="none"))),a&&(e==="Google"?a.style.display="block":(a.style.display="none",n&&(n.checked=!1),l&&(l.style.display="none")))}function o(e){let t=e.querySelector("#aipkit_ai_form_ai_provider"),n=e.querySelector("#aipkit_ai_form_ai_model"),s=e.querySelector(".aipkit_ai_form_reasoning_effort_field");if(!t||!n||!s){s&&(s.style.display="none");return}let a=t.value,l=(n.value||"").toLowerCase(),d=l.startsWith("o1")||l.startsWith("o3")||l.startsWith("o4"),u=l.includes("gpt-5");a==="OpenAI"&&(d||u)?s.style.display="block":s.style.display="none"}function i(e){let t=e.querySelector("#aipkit_ai_form_ai_provider"),n=e.querySelector("#aipkit_ai_form_ai_model");!t||!n||(t.dataset.modelListenerAttached!=="true"&&(t.addEventListener("change",function(){p(this.value),r(this.value),o(e)}),t.dataset.modelListenerAttached="true"),n.dataset.reasoningListenerAttached!=="true"&&(n.addEventListener("change",function(){o(e)}),n.dataset.reasoningListenerAttached="true"),p(t.value),r(t.value),o(e))}window.aipkitForms_initAiConfig=i,window.aipkitForms_populateAiModels=p,window.aipkitForms_updateWebSearchVisibility=r,window.aipkitForms_toggleReasoningEffort=o})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(n){return n};function r(n){if(!n)return;let s=n.closest("#aipkit_form_editor_container");if(!s)return;let a=s.querySelector("#aipkit_ai_form_ai_provider"),c=a?a.value:"OpenAI",l=n.querySelector(".aipkit_ai_form_vector_store_toggle"),d=n.querySelector(".aipkit_ai_form_openai_web_search_toggle"),u=n.querySelector(".aipkit_ai_form_google_search_grounding_toggle"),f=n.querySelector(".aipkit_ai_form_vector_store_conditional_settings"),_=n.querySelector(".aipkit_ai_form_openai_web_search_settings"),m=n.querySelector(".aipkit_ai_form_google_search_grounding_settings"),g=n.querySelector(".aipkit_ai_form_vector_store_provider_select"),k=n.querySelector(".aipkit_ai_form_embedding_config_row");if(!l||!d||!u||!f||!_||!m||!g)return;let w=l.checked,h=d.checked,y=u.checked;if(f.style.display=w?"block":"none",w){let b=g.value;f.querySelectorAll(".aipkit_ai_form_vector_openai_field, .aipkit_ai_form_vector_pinecone_field, .aipkit_ai_form_vector_qdrant_field").forEach(C=>C.style.display="none");let S=f.querySelector(`.aipkit_ai_form_vector_${b}_field`);S&&(S.style.display="block"),k&&(k.style.display=b==="pinecone"||b==="qdrant"?"block":"none")}_.style.display=h?"block":"none",m.style.display=y?"block":"none",h&&i(n),y&&e(n)}function o(n){let s=n.querySelector(".aipkit_ai_form_vector_embedding_provider_select"),a=n.querySelector(".aipkit_ai_form_vector_embedding_model_select"),l=(window.aipkit_ai_forms_config||{}).embeddingModels||{};if(!s||!a||!l)return;let u=s.value.toLowerCase(),f=l[u]||[];a.innerHTML="",a.appendChild(new Option(`-- Select ${s.options[s.selectedIndex].text} Model --`,"")),f&&Array.isArray(f)&&f.length>0?(f.forEach(_=>{a.appendChild(new Option(p(_.name),_.id))}),a.disabled=!1):(a.appendChild(new Option("(No models found - Sync in Settings)","")),a.disabled=!0)}function i(n){let s=n.querySelector(".aipkit_ai_form_openai_web_search_loc_type_select"),a=n.querySelector(".aipkit_ai_form_openai_web_search_location_details");if(!s||!a)return;let c=s.value==="approximate";a.style.display=c?"block":"none"}function e(n){let s=n.querySelector(".aipkit_ai_form_google_grounding_mode_select"),a=n.querySelector(".aipkit_ai_form_google_grounding_dynamic_threshold_container");if(!s||!a)return;let c=s.value==="MODE_DYNAMIC";a.style.display=c?"block":"none"}function t(n){let s=n.querySelector("#aipkit_form_editor_container");if(!s)return;let a=s.querySelector('.aipkit_accordion-content:has(input[name="enable_vector_store"])');if(!a)return;let c=s.querySelector("#aipkit_ai_form_ai_provider");c&&c.addEventListener("change",()=>{r(a)});let l="data-vector-config-listener-attached";a.getAttribute(l)!=="true"&&(a.addEventListener("change",d=>{let u=d.target;u.matches(".aipkit_ai_form_vector_store_toggle")||u.matches(".aipkit_ai_form_vector_store_provider_select")||u.matches(".aipkit_ai_form_openai_web_search_toggle")||u.matches(".aipkit_ai_form_google_search_grounding_toggle")?r(a):u.matches(".aipkit_ai_form_vector_embedding_provider_select")?o(a):u.matches(".aipkit_ai_form_openai_web_search_loc_type_select")?i(a):u.matches(".aipkit_ai_form_google_grounding_mode_select")&&e(a)}),a.addEventListener("input",d=>{let u=d.target;if(u.matches("#aipkit_ai_form_google_grounding_dynamic_threshold")){let f=a.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");f&&(f.textContent=parseFloat(u.value).toFixed(2))}else if(u.matches("#aipkit_ai_form_vector_store_top_k")){let f=a.querySelector("#aipkit_ai_form_vector_store_top_k_value");f&&(f.textContent=u.value)}else if(u.matches("#aipkit_ai_form_vector_store_confidence_threshold")){let f=a.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");f&&(f.textContent=u.value+"%")}}),r(a),o(a),a.setAttribute(l,"true"))}window.aipkitForms_initVectorConfig=t,window.aipkitForms_toggleVectorConfigVisibility=r,window.aipkitForms_populateVectorEmbeddingModels=o,window.aipkitForms_toggleOpenAIWebSearchLocationDetails=i,window.aipkitForms_toggleGoogleGroundingDynamicThreshold=e})();(function(){"use strict";function p(o,i,e,t){let n=window.aipkitAIFormsState,s=document.createElement("div");s.className="aipkit_layout_row",s.id=i.internalId;let a=`
            <div class="aipkit_layout_row_controls">
                <span class="dashicons dashicons-move aipkit_layout_row_drag_handle" title="Drag to re-order row" draggable="true"></span>
                <span class="dashicons dashicons-trash aipkit_layout_row_delete_btn" title="Delete row"></span>
            </div>
        `,c=document.createElement("div");c.className="aipkit_layout_row_columns_container",i.columns.forEach(l=>{let d=document.createElement("div");d.className="aipkit_layout_column",d.id=l.internalId,d.style.flexBasis=l.width,r(d,t),l.elements.forEach(u=>{window.aipkitForms_renderFieldInColumn(d,u)}),c.appendChild(d)}),s.innerHTML=a,s.appendChild(c),e?o.insertBefore(s,e):o.appendChild(s)}function r(o,i){let e=window.aipkitAIFormsState;o.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation(),o.classList.add("aipkit-drag-over"),(e.draggedElement||e.draggedElementType)&&(t.dataTransfer.dropEffect=e.draggedElement?"move":"copy")}),o.addEventListener("dragleave",t=>{t.preventDefault(),t.stopPropagation(),o.classList.remove("aipkit-drag-over")}),o.addEventListener("drop",t=>{if(t.preventDefault(),o.classList.remove("aipkit-drag-over"),e.draggedElementType||e.draggedElement&&e.draggedElement.classList.contains("aipkit_dropped_element")){t.stopPropagation();let n=o.id;if(e.draggedElementType){let s=window.aipkitForms_createNewFormElementData(e.draggedElementType);e.formStructure.forEach(a=>{let c=a.columns.find(l=>l.internalId===n);c&&c.elements.push(s)}),window.aipkitForms_renderFieldInColumn(o,s,null,i)}else e.draggedElement&&(o.appendChild(e.draggedElement),window.aipkitForms_updateFormStructureOrder());e.draggedElementType=null,e.draggedElement&&(e.draggedElement.classList.remove("aipkit-row-dragging-source"),e.draggedElement=null)}})}window.aipkitForms_renderLayoutRow=p})();(function(){"use strict";function p(){let r=window.aipkitForms_validateContainer();if(r){if(r.dataset.aipkitInitialized==="true"){window.aipkitForms_initializeDragAndDrop(r),window.aipkitForms_initListView(),window.aipkitForms_initializeAccordions(r);return}window.aipkitForms_attachClickEventListeners(r),window.aipkitForms_attachChangeEventListeners(r),window.aipkitForms_attachSettingsPanelListeners(r),window.aipkitForms_initializeAccordions(r),typeof window.aipkitForms_initPromptSnippets=="function"?window.aipkitForms_initPromptSnippets(r):console.error("AI Forms Init: aipkitForms_initPromptSnippets function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_form_editor_container"):console.error("AI Forms Init: aipkit_attachRangeValueHandlers function not found."),window.aipkitForms_initializeDragAndDrop(r),window.aipkitForms_initListView(),window.aipkitForms_initializeTokenUI(r),typeof window.aipkitForms_initAiConfig=="function"?window.aipkitForms_initAiConfig(r):console.error("AI Forms Init: aipkitForms_initAiConfig function not found."),typeof window.aipkitForms_initVectorConfig=="function"?window.aipkitForms_initVectorConfig(r):console.error("AI Forms Init: aipkitForms_initVectorConfig function not found."),r.dataset.aipkitInitialized="true"}}window.aipkit_initAiForms=p})();(function(){"use strict";function p(r,o="",i="",e={}){if(!r)return"N/A";let t=r.toLowerCase();if(t.includes("text content submitted for indexing"))return"Text";if(t.includes("file content submitted for indexing")||t.includes("file content embedded and upserted")||t.includes("original filename:"))return"File Upload";if(t.includes("wordpress post content submitted for indexing"))return"Site Content";if(i==="openai")return"N/A";if(i==="pinecone"&&t.includes("vectors upserted")){if(o.startsWith("wp_post_"))return"Site Content";if(o.startsWith("text_"))return"Text";if(o.includes("pinecone_file_")||o.includes("file_"))return"File Upload"}if(i==="qdrant"){if(t.includes("points upserted to qdrant"))return e.post_id||t.includes("post id:")?"Site Content":"Text";if(t.includes("wordpress post content submitted for indexing"))return"Site Content"}if(o&&i==="pinecone"){if(o.startsWith("wp_post_"))return"Site Content";if(o.startsWith("text_"))return"Text";if(o.includes("file_")||o.includes("pinecone_file_"))return"File Upload"}return"N/A"}window.aipkit_determineContentType=p})();(function(){"use strict";async function p(e,t,n,s){let a=document.getElementById("aipkit_nonce"),c=a&&a.value||window.aipkit_dashboard&&window.aipkit_dashboard.nonce||void 0;return await window.aipkit_apiRequest("aipkit_get_chunk_logs_by_batch",{_ajax_nonce:c,provider:e,store_id:t,batch_id:n,page:s,per_page:10})}function r({snippetText:e="",fileId:t="",provider:n="",batchId:s="",storeId:a=""}={}){let c=window.aipkit_escapeHtml||function(k){return k},l=document.createElement("div");l.className="aipkit-snippet-modal-overlay";let d=document.createElement("div");d.className="aipkit-snippet-modal-content";let u=n?`${n} Indexed Snippet`:"Indexed Snippet",f=t?` (${c(t)})`:"",_=!!s&&!!a&&!!n;d.innerHTML=`
      <div class="aipkit-snippet-modal-header">
        <h3 class="aipkit-snippet-modal-title">${u}${f}</h3>
        <button type="button" class="aipkit-snippet-modal-close" aria-label="Close">\xD7</button>
      </div>
      <div class="aipkit-snippet-modal-body">
        ${_?`
          <div class="aipkit-chunks-list"></div>
          <div class="aipkit-chunks-pagination" style="margin-top:10px; display:flex; justify-content: space-between; align-items:center;">
            <button class="button button-secondary aipkit-chunks-prev">Prev</button>
            <span class="aipkit-chunks-page-info"></span>
            <button class="button button-secondary aipkit-chunks-next">Next</button>
          </div>
        `:`
          <pre class="aipkit-snippet-modal-content-text">${c(e)}</pre>
        `}
      </div>
    `,l.appendChild(d),document.body.appendChild(l);function m(){l.classList.remove("active"),setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l)},300)}d.querySelector(".aipkit-snippet-modal-close").addEventListener("click",m),l.addEventListener("click",k=>{k.target===l&&m()});function g(k){k.key==="Escape"&&(m(),document.removeEventListener("keydown",g))}if(document.addEventListener("keydown",g),requestAnimationFrame(()=>{l.classList.add("active")}),_){let k=d.querySelector(".aipkit-chunks-list"),w=d.querySelector(".aipkit-chunks-page-info"),h=d.querySelector(".aipkit-chunks-prev"),y=d.querySelector(".aipkit-chunks-next"),b=1,v=1,S=T=>{if(!T||!T.length){k.innerHTML="<p>No chunks found.</p>";return}k.innerHTML=T.map(E=>{let M=E.indexed_content||"",x=E.file_id||"";return`<div class="aipkit-chunk-item" style="margin-bottom:12px;">
            <div class="aipkit-chunk-title" style="font-weight:600; margin-bottom:6px;">${c(x)}</div>
            <pre class="aipkit-chunk-text">${c(M)}</pre>
          </div>`}).join("")};async function C(T){k.innerHTML='<p><span class="aipkit_spinner" style="display:inline-block;"></span> Loading...</p>';try{let E=await p(n,a,s,T);S(E.chunks||[]),b=E.pagination?.current_page||T,v=E.pagination?.total_pages||1,w.textContent=`Page ${b} / ${v}`,h.disabled=b<=1,y.disabled=b>=v}catch(E){k.innerHTML=`<p class="aipkit_text-danger">${E&&E.message||"Failed to load chunks."}</p>`}}h.addEventListener("click",()=>{b>1&&C(b-1)}),y.addEventListener("click",()=>{b<v&&C(b+1)}),C(1)}}function o(e,t,n=""){return r({snippetText:e,fileId:t,provider:n})}function i(e,t=""){e&&e.querySelectorAll(".aipkit_view_snippet_icon").forEach(n=>{let s=n.cloneNode(!0);n.parentNode.replaceChild(s,n),s.addEventListener("click",a=>{a.preventDefault();let c=s.dataset.snippet,l=s.dataset.fileId,d=s.dataset.batchId||"",u=s.dataset.storeId||"";r({snippetText:c,fileId:l,provider:t,batchId:d,storeId:u})})})}window.aipkit_showSnippetModal=o,window.aipkit_showSnippetModalEnhanced=r,window.aipkit_attachSnippetModalListeners=i})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(n){return n};function r(n,s,a=""){if(!s){console.error("Search Results Renderer: Container element is required");return}if(!n||!Array.isArray(n)||n.length===0){s.innerHTML=`
                <div class="aipkit_search_empty_state">
                    <div class="aipkit_search_empty_state_icon">\u{1F50D}</div>
                    <h4 class="aipkit_search_empty_state_title">No Results Found</h4>
                    <p class="aipkit_search_empty_state_text">Try adjusting your search query or filters to find relevant content.</p>
                </div>
            `;return}let c=`
            <div class="aipkit_search_results_header">
                <h4 class="aipkit_search_results_title">Search Results</h4>
                <span class="aipkit_search_results_count">${n.length} result${n.length!==1?"s":""}</span>
            </div>
            <div class="aipkit_search_results_list">
                ${n.map((l,d)=>o(l,d,a)).join("")}
            </div>
        `;s.innerHTML=c}function o(n,s,a){let c=n.score||n.similarity||0,l=n.metadata||n.payload||{},d=n.raw_item||n,u="";n.content?Array.isArray(n.content)&&n.content.length>0?u=n.content[0]?.text||n.content[0]||"No content available":typeof n.content=="string"?u=n.content:typeof n.content=="object"&&(u=n.content.text||JSON.stringify(n.content)):a==="pinecone"||a==="qdrant"?u=l.original_content||l.title||"No content available":u=n.text||"No content available";let f=l.source||l.url||l.file_name||d.filename||n.filename||n.file_id||"Unknown source",_=n.id||d.file_id||s+1,m;c>1?m=Math.round(c):m=Math.round(c*100);let g=m>80?"high":m>60?"medium":"low",k=u.length>300?u.substring(0,300)+"...":u,w=p(k);l.url&&(w=`<a href="${p(l.url)}" target="_blank" rel="noopener noreferrer">${p(k)}</a>`);let h=[];if(a==="openai"){if(n.file_id||d?.file_id){let y=n.file_id||d.file_id;h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-media-document"></span> ID: ${p(y.substring(0,20))}${y.length>20?"...":""}</span>`)}d?.filename&&d.filename!==f&&h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-media-text"></span> ${p(d.filename)}</span>`),n.content&&Array.isArray(n.content)&&n.content[0]?.type&&h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-editor-code"></span> ${p(n.content[0].type)}</span>`),d?.attributes&&Array.isArray(d.attributes)&&h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-tag"></span> ${d.attributes.length} attributes</span>`)}else a==="pinecone"?(n.id&&h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-networking"></span> Vector ID: ${p(n.id.substring(0,20))}${n.id.length>20?"...":""}</span>`),l.namespace&&h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-category"></span> Namespace: ${p(l.namespace)}</span>`),n.values&&Array.isArray(n.values)&&h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-chart-line"></span> Dimensions: ${n.values.length}</span>`),n.sparseValues&&h.push('<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-analytics"></span> Sparse Values</span>')):a==="qdrant"&&(n.id&&h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-location-alt"></span> Point ID: ${p(n.id.toString().substring(0,20))}${n.id.toString().length>20?"...":""}</span>`),n.version&&h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-update"></span> Version: ${n.version}</span>`),n.vector&&Array.isArray(n.vector)&&h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-chart-line"></span> Vector: ${n.vector.length}D</span>`));if(u&&u.length>0&&u!=="No content available"&&h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-editor-alignleft"></span> ${u.length} chars</span>`),l.created_at||l.timestamp){let y=new Date(l.created_at||l.timestamp);h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-clock"></span> ${y.toLocaleDateString()}</span>`)}return f!=="Unknown source"&&f!==d?.filename&&h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-admin-links"></span> ${p(f)}</span>`),l.word_count&&h.push(`<span class="aipkit_search_result_meta_item"><span class="dashicons dashicons-editor-alignleft"></span> ${l.word_count} words</span>`),`
            <div class="aipkit_search_result_item" data-result-index="${s}">
                <div class="aipkit_search_result_score ${g}">${m}% match</div>
                <div class="aipkit_search_result_content">${w}</div>
                ${h.length>0?`<div class="aipkit_search_result_meta">${h.join("")}</div>`:""}
                ${u.length>300?`<button type="button" class="aipkit_search_result_expand" data-full-content="${p(u)}">Show Full Content</button>`:""}
            </div>
        `}function i(n,s="info",a){a&&(a.className=`aipkit_search_form_status ${s}`,a.textContent=n,a.style.display="block",s==="success"&&setTimeout(()=>{a.style.display="none"},5e3))}function e(n,s){n&&(s?(n.classList.add("loading"),n.disabled=!0):(n.classList.remove("loading"),n.disabled=!1))}function t(n,s){if(!n||typeof s!="function")return;n.addEventListener("submit",function(c){c.preventDefault(),s()});let a=n.querySelector(".aipkit_search_form_textarea");a&&a.addEventListener("keydown",function(c){c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),s())})}document.addEventListener("click",function(n){if(n.target.classList.contains("aipkit_search_result_expand")){let s=n.target.getAttribute("data-full-content"),a=n.target.parentElement.querySelector(".aipkit_search_result_content");a&&s&&(a.innerHTML=p(s),n.target.remove())}}),window.aipkit_renderSearchResults=r,window.aipkit_showSearchStatus=i,window.aipkit_setSearchButtonLoading=e,window.aipkit_handleSearchFormSubmit=t})();(function(){"use strict";function p(){r(),o(),i()}function r(){let t=document.querySelector("#aipkit_search_store_form_openai_wrapper_modal_placeholder"),n=document.querySelector("#aipkit_search_vector_store_btn_openai"),s=document.querySelector("#aipkit_close_search_panel_btn_openai");if(!t)return;n&&typeof window.aipkit_searchOpenAIVectorStore=="function"&&n.addEventListener("click",function(c){c.preventDefault(),window.aipkit_searchOpenAIVectorStore()}),s&&typeof window.aipkit_showRightColumnSection=="function"&&s.addEventListener("click",function(c){c.preventDefault(),t.style.display="none";let l=document.querySelector("#aipkit_openai_vs_right_col_placeholder");l&&(l.style.display="flex")});let a=t.querySelector("#aipkit_search_query_text_openai");a&&n&&a.addEventListener("keydown",function(c){c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),n.click())})}function o(){let t=document.querySelector("#aipkit_search_pinecone_index_form_wrapper"),n=document.querySelector("#aipkit_search_pinecone_index_btn"),s=document.querySelector("#aipkit_close_search_pinecone_panel_btn");if(!t)return;n&&typeof window.aipkit_searchPineconeIndex=="function"&&n.addEventListener("click",function(c){c.preventDefault(),window.aipkit_searchPineconeIndex()}),s&&s.addEventListener("click",function(c){c.preventDefault(),t.style.display="none";let l=document.querySelector("#aipkit_pinecone_vs_right_col_placeholder");l&&(l.style.display="flex")});let a=t.querySelector("#aipkit_search_query_vector_pinecone");a&&n&&a.addEventListener("keydown",function(c){c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),n.click())})}function i(){let t=document.querySelector("#aipkit_search_qdrant_collection_form_wrapper"),n=document.querySelector("#aipkit_search_qdrant_collection_btn"),s=document.querySelector("#aipkit_close_search_qdrant_panel_btn");if(!t)return;n&&typeof window.aipkit_searchQdrantCollection=="function"&&n.addEventListener("click",function(c){c.preventDefault(),window.aipkit_searchQdrantCollection()}),s&&typeof window.aipkit_showQdrantSection=="function"&&s.addEventListener("click",function(c){c.preventDefault(),t.style.display="none",window.aipkit_showQdrantSection("placeholder")});let a=t.querySelector("#aipkit_search_query_text_qdrant");a&&n&&a.addEventListener("keydown",function(c){c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),n.click())})}function e(){document.addEventListener("input",function(t){if(t.target.classList.contains("aipkit_search_form_textarea")||t.target.classList.contains("aipkit_search_form_input"))if(t.target.classList.remove("aipkit_form_invalid","aipkit_form_valid"),t.target.type==="number"){let n=parseInt(t.target.value),s=parseInt(t.target.getAttribute("min")),a=parseInt(t.target.getAttribute("max"));n&&n>=s&&n<=a?t.target.classList.add("aipkit_form_valid"):t.target.value&&t.target.classList.add("aipkit_form_invalid")}else t.target.tagName==="TEXTAREA"&&t.target.value.trim().length>0&&t.target.classList.add("aipkit_form_valid")})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){p(),e()}):(p(),e()),document.addEventListener("aipkit:searchFormShown",function(){p()}),window.aipkit_initSearchForms=p})();(function(){"use strict";let p=localStorage.getItem("aipkit_last_global_vector_provider")||"openai";function r(){return p}function o(i){p=i}window.aipkit_getCurrentGlobalVectorProvider=r,window.aipkit_setCurrentGlobalVectorProvider=o})();(function(){"use strict";function p(r,o,i="block",e=null){if(!r||!Array.isArray(o)){console.warn("aipkit_ui_showSection: Invalid arguments provided.");return}o.forEach(t=>{let n=null;e&&e[t]&&e[t]instanceof HTMLElement?n=e[t]:typeof t=="string"&&(n=document.getElementById(t)),n&&(n.id===r||t===r&&e&&e[t]===n?(n.style.display=i,n.classList.add("aipkit-active")):(n.style.display="none",n.classList.remove("aipkit-active")))})}window.aipkit_ui_showSection=p})();(function(){"use strict";function p(r,o,i){if(!r||!o||typeof i!="function"){o&&(o.innerHTML="");return}o.innerHTML="";let{total_logs:e,total_pages:t,current_page:n}=r,s=parseInt(n,10);if(!e||e<=0||!t||t<=1)return;let a=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,c=wp.i18n&&wp.i18n._n?wp.i18n._n:(m,g,k)=>k>1?g:m,l=document.createElement("span");l.className="aipkit_pagination-count",l.textContent=`${e.toLocaleString()} ${c("item","items",e)}`,o.appendChild(l);let d=document.createElement("span");d.className="aipkit_pagination-links";let u=document.createElement("button");u.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",u.innerHTML="\xAB "+a("Previous","gpt3-ai-content-generator"),u.disabled=s<=1,u.disabled||u.addEventListener("click",m=>{m.preventDefault(),i(s-1)}),d.appendChild(u);let f=document.createElement("span");f.className="aipkit_pagination-current",f.textContent=`${a("Page","gpt3-ai-content-generator")} ${s} ${a("of","gpt3-ai-content-generator")} ${t}`,d.appendChild(f);let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML=a("Next","gpt3-ai-content-generator")+" \xBB",_.disabled=s>=t,_.disabled||_.addEventListener("click",m=>{m.preventDefault(),i(s+1)}),d.appendChild(_),o.appendChild(d)}window.aipkit_renderLogsPagination=p})();(function(){"use strict";async function p(r){let o=r.target.closest(".aipkit-delete-vector-log-btn");if(!o)return;let i=o.dataset.provider,e=o.dataset.storeId,t=o.dataset.vectorId,n=o.dataset.logId;if(!i||!e||!t||!n){console.error("Delete Vector Log: Missing data attributes on the delete button.",o.dataset),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error: Could not delete record, missing data.","error","aipkit_knowledge_base_global_status");return}let s=window.aipkit_escapeHtml||function(c){return c};if(!confirm(`Are you sure you want to delete this record?

ID: ${s(t)}

This will remove the entry from both ${s(i)} and your local logs. This action cannot be undone.`))return;if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Delete Vector Log: Missing required UI or API helper functions.");return}let a="aipkit_knowledge_base_global_status";window.aipkit_setLoadingStateOpenAI(o,!0,"","..."),window.aipkit_showOpenAIVectorStatus(`Deleting record ${s(t)}...`,"info",a);try{let c={_ajax_nonce:window.aipkit_dashboard.nonce,provider:i,store_id:e,vector_id:t,log_id:n},l=await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",c);window.aipkit_showOpenAIVectorStatus(l.message||"Record deleted successfully!","success",a);let d=o.closest("tr");d&&(d.style.opacity="0",setTimeout(()=>d.remove(),300))}catch(c){console.error("Delete Vector Log Error:",c),window.aipkit_showOpenAIVectorStatus(`Error: ${c.message||"Failed to delete the record."}`,"error",a),window.aipkit_setLoadingStateOpenAI(o,!1,"","")}typeof window.aipkit_resyncAllProviders=="function"&&window.aipkit_resyncAllProviders()}window.aipkit_handleDeleteVectorLogEntryClick=p})();(function(){"use strict";async function p(r){let o=r.target.closest(".aipkit-reindex-vector-log-btn");if(!o)return;let i=o.dataset.provider,e=o.dataset.storeId,t=o.dataset.vectorId,n=o.dataset.logId,s=o.dataset.postId,a=o.dataset.embeddingProvider,c=o.dataset.embeddingModel;if(!i||!e||!t||!n||!s){console.error("Re-index Vector Log: Missing data attributes on the re-index button.",o.dataset),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error: Could not re-index record, missing data.","error","aipkit_knowledge_base_global_status");return}let l=window.aipkit_escapeHtml||function(u){return u};if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Re-index Vector Log: Missing required UI or API helper functions.");return}let d="aipkit_knowledge_base_global_status";window.aipkit_setLoadingStateOpenAI(o,!0,"","..."),window.aipkit_showOpenAIVectorStatus(`Re-indexing Post ID ${l(s)}...`,"info",d);try{let u={_ajax_nonce:window.aipkit_dashboard.nonce,provider:i,store_id:e,vector_id:t,log_id:n,post_id:s,embedding_provider:a||"",embedding_model:c||""},f=await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",u);window.aipkit_showOpenAIVectorStatus(f.message||"Content re-indexed successfully!","success",d);let _=1,m=o.closest(".aipkit_kb_detail_body").querySelector(".aipkit_logs_pagination_container"),g=_;if(m){let k=m.querySelector(".aipkit_pagination-current");if(k){let w=k.textContent.match(/Page (\d+)/);w&&w[1]&&(g=parseInt(w[1],10))}}i==="OpenAI"&&typeof window.aipkit_fetchAndRenderOpenAIIndexingLogs=="function"?window.aipkit_fetchAndRenderOpenAIIndexingLogs(e,g):i==="Pinecone"&&typeof window.aipkit_fetchAndRenderPineconeIndexingLogs=="function"?window.aipkit_fetchAndRenderPineconeIndexingLogs(e,g):i==="Qdrant"&&typeof window.aipkit_fetchAndRenderQdrantIndexingLogs=="function"&&window.aipkit_fetchAndRenderQdrantIndexingLogs(e,g)}catch(u){console.error("Re-index Vector Log Error:",u),window.aipkit_showOpenAIVectorStatus(`Error: ${u.message||"Failed to re-index the record."}`,"error",d),window.aipkit_setLoadingStateOpenAI(o,!1,"","")}}window.aipkit_handleReindexVectorLogEntryClick=p})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_knowledge_base_global_status"),i=window.aipkit_escapeHtml||function(d){return d};if(!o){console.warn("Update Provider Status: Status div (#aipkit_knowledge_base_global_status) not found.");return}o.innerHTML="",o.style.display="none";let e=!0,t=!0,n=window.aipkit_openai_vs_config||{},s=window.aipkit_pinecone_vs_config||{},a=window.aipkit_qdrant_vs_config||{};r==="openai"?e=n.apiKeyIsSet!==!1:r==="pinecone"?e=s.apiKeyIsSet!==!1:r==="qdrant"&&(e=a.apiKeyIsSet!==!1,t=a.urlIsSet!==!1);let c="",l=r.charAt(0).toUpperCase()+r.slice(1);if(e||(c+=`${l} API Key not set. `),!t&&r==="qdrant"&&(c+=`${l} URL not set. `),c.trim()!==""){let d=r==="openai"||r==="google"?"providers":"integrations",u=`${window.aipkit_dashboard.adminUrl}?page=wpaicg#${d}`;o.innerHTML=`<span class="aipkit_text-danger">${i(c.trim())} <a href="${i(u)}">Configure Now</a></span>`,o.style.display="block"}}window.aipkit_updateGlobalProviderStatusMessage=p})();(function(){"use strict";let p="aipkit_last_global_vector_provider",r={openai:"Store",pinecone:"Index",qdrant:"Collection"};async function o(i,e={}){let t=i.target.value,n=!!e.isInit;if(!t)return;let s=["aipkit_setCurrentGlobalVectorProvider","aipkit_updateTargetLabel","aipkit_ui_showSection","aipkit_updateGlobalProviderStatusMessage","aipkit_populateGlobalOpenAITargetSelect","aipkit_populateGlobalPineconeTargetSelect","aipkit_populateGlobalQdrantTargetSelect","aipkit_handleGlobalTargetSelectChange","aipkit_populateGlobalEmbeddingModelSelect"];for(let g of s)if(typeof window[g]!="function"){console.error(`AIPKit Handle Provider Switch: Missing dependency function: ${g}.`);return}window.aipkit_setCurrentGlobalVectorProvider(t),localStorage.setItem(p,t),window.aipkit_updateTargetLabel(r[t]||"Target Store/Index/Collection");let a=["aipkit_vector_openai_management_ui","aipkit_vector_pinecone_management_ui","aipkit_vector_qdrant_management_ui"],c=`aipkit_vector_${t}_management_ui`;window.aipkit_ui_showSection(c,a,"block");let l=document.getElementById(c),u={openai:window.aipkit_initOpenAIVectorStore,pinecone:window.aipkit_initPineconeUI,qdrant:window.aipkit_initQdrantVectorStoreUI}[t];if(l&&typeof u=="function"&&!l.dataset.providerUiInitialized)try{u(),l.dataset.providerUiInitialized="true"}catch(g){console.error(`Error initializing UI for ${t}:`,g)}let f=document.getElementById("aipkit_vs_global_target_select");f&&(t==="openai"?await window.aipkit_populateGlobalOpenAITargetSelect(!1):t==="pinecone"?window.aipkit_populateGlobalPineconeTargetSelect():t==="qdrant"?window.aipkit_populateGlobalQdrantTargetSelect():f.innerHTML='<option value="" disabled>-- Select Provider First --</option>',window.aipkit_handleGlobalTargetSelectChange({target:f})),window.aipkit_updateGlobalProviderStatusMessage(t);let _=document.getElementById("aipkit_vs_global_embedding_model_inline_group");t==="pinecone"||t==="qdrant"?(_&&(_.style.display="block"),window.aipkit_populateGlobalEmbeddingModelSelect()):_&&(_.style.display="none");let m={openai:document.getElementById("aipkit_vs_global_add_openai_store_btn"),pinecone:document.getElementById("aipkit_vs_global_add_pinecone_index_btn"),qdrant:document.getElementById("aipkit_vs_global_add_qdrant_collection_btn")};Object.entries(m).forEach(([g,k])=>{k&&(k.style.display=g===t?"inline-flex":"none",k.disabled=!1)})}window.aipkit_handleGlobalProviderSwitch=o,window.aipkit_updateTargetLabel=function(i){let e=document.getElementById("aipkit_vs_global_target_label");e&&(e.textContent=i)}})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_vs_global_provider_select");if(r){if(typeof window.aipkit_setCurrentGlobalVectorProvider!="function"||typeof window.aipkit_handleGlobalProviderSwitch!="function"){console.error("AIPKit Provider Switcher Init: Missing required utility functions (setCurrentGlobalVectorProvider or handleGlobalProviderSwitch).");return}let o=localStorage.getItem("aipkit_last_global_vector_provider")||"openai";r.value=o,window.aipkit_setCurrentGlobalVectorProvider(o),window.aipkit_handleGlobalProviderSwitch({target:r},{isInit:!0}),r.addEventListener("change",window.aipkit_handleGlobalProviderSwitch)}else console.warn("AIPKit Provider Switcher Init: Global provider select element (#aipkit_vs_global_provider_select) not found.")}window.aipkit_initGlobalProviderSwitcher=p})();(function(){"use strict";function p(r,o=2){if(!+r)return"0 B";let i=1024,e=o<0?0:o,t=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(r)/Math.log(i));return`${parseFloat((r/Math.pow(i,n)).toFixed(e))} ${t[n]}`}window.aipkit_formatFileSize=p})();(function(){"use strict";function p(r,o="info",i="aipkit_knowledge_base_global_status"){let e=document.getElementById(i);if(!e)return;e.messageTimeoutId&&clearTimeout(e.messageTimeoutId),e.messageTimeoutId=null;let t=r?String(r).trim():"";if(t===""){e.textContent="",e.className="aipkit_form-help",e.style.display="none",e.style.opacity="0",e.classList.remove("aipkit-active");return}let n=e.classList.contains("aipkit_settings_message-error"),s=o;n&&o!=="error"&&(s="error"),e.className="aipkit_form-help",s==="success"?e.classList.add("aipkit_settings_message-success"):s==="error"?e.classList.add("aipkit_settings_message-error"):e.classList.add("aipkit_settings_message-info"),s==="error"&&e.textContent||n&&o!=="error"&&e.textContent?e.textContent=e.textContent+`
`+t:e.textContent=t,e.style.display="block",e.style.opacity="1",e.classList.add("aipkit-active"),s!=="error"&&(e.messageTimeoutId=setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.textContent.includes(t)&&(e.textContent="",e.className="aipkit_form-help",e.style.display="none",e.classList.remove("aipkit-active"))},300)},5e3))}window.aipkit_showOpenAIVectorStatus=p})();(function(){"use strict";function p(r,o,i){console.error(`AIPKit OpenAI Vector Store (${o}):`,r);let e=r?.message||`Failed to ${o.replace(/_/g," ")}.`;typeof window.aipkit_showOpenAIVectorStatus=="function"?window.aipkit_showOpenAIVectorStatus(e,"error",i):alert("Error: "+e)}window.aipkit_handleOpenAIAjaxError=p})();(function(){"use strict";function p(r,o,i="Submit",e="Processing..."){if(!r)return;let t=r.querySelector(".aipkit_btn-text")||r.querySelector(".aipkit_btn_text"),n=r.querySelector(".aipkit_spinner"),s=r.querySelector(".dashicons");if(o){if(r.disabled=!0,!r.dataset.originalText)if(t)r.dataset.originalText=t.textContent;else{let c="";r.childNodes.forEach(l=>{l.nodeType===Node.TEXT_NODE&&(c+=l.textContent.trim())}),r.dataset.originalText=c.trim()}s&&(s.dataset.originalDisplay||(s.dataset.originalDisplay=s.style.display||"inline-block"),s.style.display="none");let a=i===""?"":r.dataset.loadingText||e;t?(r.dataset.originalText||(r.dataset.originalText=t.textContent),t.textContent=a):(!s||s.style.display==="none")&&a&&(Array.from(r.childNodes).forEach(c=>{c.nodeType===Node.TEXT_NODE&&c.remove()}),a&&r.insertBefore(document.createTextNode(a),r.firstChild)),n&&(n.style.display="inline-block")}else{r.disabled=!1;let a=i===""?"":r.dataset.originalText||i;s&&s.dataset.originalDisplay&&(s.style.display=s.dataset.originalDisplay,delete s.dataset.originalDisplay),t?t.textContent=a:i!==""&&(Array.from(r.childNodes).forEach(c=>{c.nodeType===Node.TEXT_NODE&&c.remove()}),a&&(s?s.insertAdjacentText("afterend"," "+a):r.insertBefore(document.createTextNode(a),r.firstChild))),n&&(n.style.display="none"),delete r.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=p})();(function(){"use strict";function p(r){let o=window.aipkit_openai_vs_refs;if(!o.rightColumnContainer){console.error("showRightColumnSection: refs.rightColumnContainer (OpenAI main content area) is not defined or found.");return}let i=[o.rightColumnPlaceholder,o.manageFilesPanel,o.searchStoreFormWrapper],e=!1;i.forEach(t=>{t&&t.id&&(t.id===r?(t.style.display="block",t.classList.add("aipkit-active"),e=!0):(t.style.display="none",t.classList.remove("aipkit-active")))}),!e&&o.rightColumnPlaceholder&&(o.rightColumnPlaceholder.style.display="block",o.rightColumnPlaceholder.classList.add("aipkit-active"))}window.aipkit_showRightColumnSection=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};async function r(o,i){let e=document.getElementById(o);if(e&&!(e.dataset.limitsLoaded==="true"&&e.innerHTML!=="")){if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Display Upload Limits: Missing showOpenAIVectorStatus or aipkit_apiRequest."),e.innerHTML='<span class="aipkit_text-danger">Error: UI components missing.</span>',e.style.display="block";return}try{window.aipkit_showOpenAIVectorStatus("Fetching upload limits...","info",i);let t=document.getElementById("aipkit_vector_store_nonce_openai");if(!t||!t.value)throw new Error("Nonce field not found for upload limits.");let n=await window.aipkit_apiRequest("aipkit_get_upload_limits",{_ajax_nonce:t.value});if(n&&n.effective_upload_limit_formatted)window.aipkit_uploadLimits=n,window.aipkit_effectiveUploadLimitBytes=n.effective_upload_limit_bytes,e.innerHTML=`<strong>Max file size:</strong> ${p(n.effective_upload_limit_formatted)}. Server limits: PHP upload_max_filesize: ${p(n.upload_max_filesize_hr)}, PHP post_max_size: ${p(n.post_max_size_hr)}.`,e.style.display="block",e.dataset.limitsLoaded="true",window.aipkit_showOpenAIVectorStatus("","info",i);else throw new Error("Invalid limit data received.")}catch(t){console.error("Error fetching upload limits:",t),e.innerHTML='<span class="aipkit_text-danger">Could not retrieve upload limits.</span>',e.style.display="block",window.aipkit_showOpenAIVectorStatus("Could not retrieve upload limits.","error",i)}}}window.aipkit_displayUploadLimits=r})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(e){return e},o="aipkit_last_openai_vs_id";window.aipkit_openai_fetched_stores_data=window.aipkit_openai_fetched_stores_data||{};async function i(e=!1){let t=document.getElementById("aipkit_vs_global_target_select"),n="aipkit_knowledge_base_global_status";if(!t)return console.error("Populate Global Target Select: Select element #aipkit_vs_global_target_select not found."),Promise.reject(new Error("Global target select not found."));let s=t.value,a=localStorage.getItem(o),c=t.offsetWidth;c>0&&(t.style.minWidth=`${c}px`,t.style.width=`${c}px`),t.innerHTML=`<option value="">${r(p.loading_stores||"Loading stores...")}</option>`,t.disabled=!0,typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("","info",n);let l=null;if(!e&&window.aipkit_initial_openai_stores&&Array.isArray(window.aipkit_initial_openai_stores))l=window.aipkit_initial_openai_stores,l.length===0&&typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("No OpenAI stores found in local registry. Sync or create one.","info",n);else try{let f=document.getElementById("aipkit_vector_store_nonce_openai");if(!f||!f.value)throw new Error("OpenAI Vector Store nonce not found for populating global select.");let _={_ajax_nonce:f.value,limit:100,order:"desc"};l=(await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",_)).stores,Array.isArray(l)&&(window.aipkit_initial_openai_stores=l.slice(),window.aipkit_openai_vs_config&&(window.aipkit_openai_vs_config.initialStores=l.slice())),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Stores synced with OpenAI.","success",n)}catch(f){return console.error("Populate Global Target Select: Error fetching stores via API:",f),t.innerHTML=`<option value="">${r(p.error_fetching_stores||"Error loading stores.")}</option>`,typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(f.message||"Failed to load stores for global select.","error",n),t.disabled=!1,t.style.minWidth="",t.style.width="",Promise.reject(f)}t.innerHTML="",t.appendChild(new Option(`${r(p.selectTargetStore||"-- Select Store --")}`,"")),l&&Array.isArray(l)?(window.aipkit_openai_fetched_stores_data={},l.forEach(f=>{if(f&&f.id){window.aipkit_openai_fetched_stores_data[f.id]=f;let _="(Files: N/A)";f.file_counts&&typeof f.file_counts.total=="number"?_=`(${f.file_counts.total} ${f.file_counts.total===1?"File":"Files"})`:f.file_counts&&(_="(Files: ?)");let m=`${r(f.name||f.id)} ${_}`,g=new Option(m,f.id);t.appendChild(g)}}),l.length===0&&!e&&window.aipkit_initial_openai_stores||l.length===0&&e&&typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("No OpenAI stores found. You can create one via the API.","info",n)):(console.error("Populate Global Target Select: Invalid stores data received.",l),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error processing store list.","error",n));let d=new Option("+ "+(p.createNewStoreButton||"Create New Store..."),"_create_new_openai_");t.appendChild(d);let u=s;return!u&&a&&(u=a),u&&u!=="_create_new_openai_"&&t.querySelector(`option[value="${CSS.escape(u)}"]`)?t.value=u:t.options.length>1&&t.options[0].value===""?t.selectedIndex=0:t.options.length>0&&(t.selectedIndex=t.options[0].value===""?0:t.options.length>1?1:0),t.disabled=!1,t.style.minWidth="",t.style.width="",Promise.resolve()}window.aipkit_populateGlobalOpenAITargetSelect=i})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{};function r(){let e=document.getElementById("aipkit_vs_global_new_target_name")||document.getElementById("aipkit_vs_global_new_target_name"),t=document.getElementById("aipkit_vs_global_create_store_btn_openai")||document.getElementById("aipkit_vs_global_create_new_target_btn"),n="aipkit_knowledge_base_global_status";if(!e||!t){console.error("Create New OpenAI Store: Missing required elements (name/button).");return}let s=(e.value||"").trim();if(!s){typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("New store name cannot be empty.","error",n),e.focus();return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_handleOpenAIAjaxError!="function"||typeof window.aipkit_populateGlobalOpenAITargetSelect!="function"){console.error("Create New OpenAI Store Inline: Missing required UI or API helper functions."),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error: Core UI components missing for store creation.","error",n);return}window.aipkit_setLoadingStateOpenAI(t,!0,p.createStoreButton||"Create Store",p.creatingStore||"Creating..."),window.aipkit_showOpenAIVectorStatus("Creating new OpenAI store...","info",n);let a=document.getElementById("aipkit_vector_store_nonce_openai");if(!a||!a.value){typeof window.aipkit_handleOpenAIAjaxError=="function"&&window.aipkit_handleOpenAIAjaxError(new Error("OpenAI Vector Store nonce not found."),"create_vector_store_inline",n),typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!1,p.createStoreButton||"Create Store");return}let c={_ajax_nonce:a.value,name:s,source_type:"inline_global_form_create"};window.aipkit_apiRequest("aipkit_create_vector_store_openai",c).then(l=>{window.aipkit_showOpenAIVectorStatus(l.message||"Store created successfully!","success",n);let d=l.store;d&&d.id?(window.aipkit_openai_fetched_stores_data&&(window.aipkit_openai_fetched_stores_data[d.id]=d),window.aipkit_initial_openai_stores&&Array.isArray(window.aipkit_initial_openai_stores)&&(window.aipkit_initial_openai_stores.some(u=>u.id===d.id)||window.aipkit_initial_openai_stores.unshift(d)),window.aipkit_populateGlobalOpenAITargetSelect(!1).then(async()=>{if(typeof window.aipkit_apiRequest=="function"&&typeof window.aipkit_applyRefreshToKbViews=="function")try{let f=await window.aipkit_apiRequest("aipkit_refresh_knowledge_base_cards",{});await window.aipkit_applyRefreshToKbViews(f)}catch(f){console.debug("OpenAI Create: KB views refresh failed/omitted.",f?.message||f)}typeof window.updateKbViewToggleVisibility=="function"&&window.updateKbViewToggleVisibility();let u=document.getElementById("aipkit_vs_global_target_select");u&&(u.value=d.id,u.dispatchEvent(new Event("change")))})):window.aipkit_populateGlobalOpenAITargetSelect(!0)}).catch(l=>{typeof window.aipkit_handleOpenAIAjaxError=="function"&&window.aipkit_handleOpenAIAjaxError(l,"create_vector_store_inline",n)}).finally(()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!1,p.createStoreButton||"Create Store")})}function o(){}window.aipkit_initOpenAIInlineStoreCreator=o,window.aipkit_handleCreateOpenAIStoreUnified=function(){let i=document.getElementById("aipkit_vs_global_new_target_name"),e=document.getElementById("aipkit_vs_global_create_new_target_btn"),t="aipkit_knowledge_base_global_status";if(!i||!e){console.error("OpenAI Unified Create: missing unified inputs/buttons.");return}let n=i.value.trim(),s=document.getElementById("aipkit_vs_global_new_store_name_openai");s&&(s.value=n),typeof r=="function"?r():typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Create handler not ready.","error",t)}})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};function o(i,e=null){if(!i){console.warn("Delete Store (Management): No store ID provided."),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("No store selected to delete.","error","aipkit_knowledge_base_global_status");return}if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_showRightColumnSection!="function"){console.error("Delete Store (Management): Missing one or more UI/API helper functions.");return}let t="aipkit_knowledge_base_global_status",n=e;!n&&window.aipkit_openai_vs_refs&&(n=window.aipkit_openai_vs_refs.deleteSelectedStoreButtonPanel),window.aipkit_showOpenAIVectorStatus("Deleting vector store...","info",t),n&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!0,p.deleteStoreButton||"Delete Store",p.deletingStore||"Deleting..."),window.aipkit_apiRequest("aipkit_delete_vector_store_openai",{store_id:i,_ajax_nonce:document.getElementById("aipkit_vector_store_nonce_openai").value}).then(s=>{window.aipkit_showOpenAIVectorStatus(s.message||"Vector store deleted.","success",t);let a=document.querySelector(`.aipkit_vector_store_list_item[data-provider="OpenAI"][data-id="${i}"]`);a&&a.remove();let c=document.querySelector(".aipkit_vector_store_list_container"),l=c?.querySelector(".aipkit_vector_store_list_table tbody");c&&l&&l.children.length===0&&(c.innerHTML=`<p class="aipkit_text-center" style="padding: 15px;">${r(p.noKnowledgeBasesFound||'No knowledge bases found. Click "Add Content" to create one.')}</p>`),typeof window.aipkit_populateGlobalOpenAITargetSelect=="function"?window.aipkit_populateGlobalOpenAITargetSelect(!0):console.error("Delete Store (Management): populateGlobalOpenAITargetSelect function not found. Cannot refresh global dropdown."),typeof window.aipkit_apiRequest=="function"&&typeof window.aipkit_applyRefreshToKbViews=="function"&&window.aipkit_apiRequest("aipkit_refresh_knowledge_base_cards",{}).then(f=>window.aipkit_applyRefreshToKbViews(f)).catch(()=>{});let u=(typeof window.localStorage<"u"?localStorage.getItem("aipkit_kb_view_style"):null)==="list"?"list":"cards";typeof window.aipkit_switchKbView=="function"&&window.aipkit_switchKbView(u),typeof window.aipkit_resyncAllProviders=="function"&&window.aipkit_resyncAllProviders()}).catch(s=>{n&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!1,p.deleteStoreButton||"Delete Store"),typeof window.aipkit_handleOpenAIAjaxError=="function"?window.aipkit_handleOpenAIAjaxError(s,"delete_vector_store",t):console.error("Delete Store (Management): aipkit_handleOpenAIAjaxError function not found.")}).finally(()=>{n&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!1,p.deleteStoreButton||"Delete Store")})}window.aipkit_deleteOpenAIVectorStore=o})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};async function o(i,e){let t=window.aipkit_openai_vs_refs.panelStatusDiv;if(t){if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_populateGlobalOpenAITargetSelect!="function"){console.error("List Files (Sync): Missing one or more required UI or API helper functions.");return}window.aipkit_setLoadingStateOpenAI(e,!0,"Sync Files from API","Syncing...");try{let a=`Successfully synced ${(await window.aipkit_apiRequest("aipkit_list_files_in_vector_store_openai",{store_id:i,_ajax_nonce:document.getElementById("aipkit_vector_store_nonce_openai").value})).files?.length||0} file(s) from OpenAI. File counts are updated.`;if(typeof window.aipkit_showOpenAIVectorStatus=="function"?window.aipkit_showOpenAIVectorStatus(a,"success","aipkit_knowledge_base_global_status"):(t.textContent=a,t.className="aipkit_form-help aipkit_settings_message-success",t.style.display="block"),await window.aipkit_populateGlobalOpenAITargetSelect(!0),typeof window.aipkit_apiRequest=="function"&&typeof window.aipkit_applyRefreshToKbViews=="function")try{let c=await window.aipkit_apiRequest("aipkit_refresh_knowledge_base_cards",{});await window.aipkit_applyRefreshToKbViews(c)}catch(c){console.error("OpenAI Sync: Failed to refresh KB views after sync.",c)}}catch(n){typeof window.aipkit_handleOpenAIAjaxError=="function"&&window.aipkit_handleOpenAIAjaxError(n,"list_files_in_store","aipkit_knowledge_base_global_status")}finally{window.aipkit_setLoadingStateOpenAI(e,!1,"Sync Files from API")}}}window.aipkit_listFilesInStoreForPanel=o})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};async function o(i,e=1){let n=window.aipkit_openai_vs_refs?.panelFilesTableBody,s=document.getElementById("aipkit_openai_logs_pagination");if(!n||!s){console.error("Fetch OpenAI Logs: Log table body or pagination container not found.");return}n.innerHTML=`<tr><td colspan="7" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${r(p.loading_logs||"Loading records...")}</td></tr>`,s.innerHTML="";try{let a=document.getElementById("aipkit_vector_store_nonce_openai");if(!a||!a.value)throw new Error("OpenAI management nonce for logs not found.");let c=await window.aipkit_apiRequest("aipkit_get_openai_indexing_logs",{_ajax_nonce:a.value,store_id:i,page:e}),l=c.logs||[];if(l.length===0){n.innerHTML=`<tr><td colspan="7" class="aipkit_text-center">${r(p.noLogsForStore||"No records found for this store.")}</td></tr>`;return}let d="";l.forEach(u=>{let _=`<span class="aipkit_status-tag ${u.status==="indexed"||u.status==="skipped_already_indexed"?"aipkit_status-success":u.status==="failed"?"aipkit_status-warning":"aipkit_status-info"}" style="white-space: nowrap;">${r(u.status.replace(/_/g," "))}</span>`,m=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(u.message||"",u.file_id||"","openai",u):"N/A",g=m==="Text"?"aipkit_type-text":m==="File Upload"?"aipkit_type-file":m==="Site Content"?"aipkit_type-site":"aipkit_type-na",k=u.message?u.message.length>50?r(u.message.substring(0,50))+"...":r(u.message):"",w=u.indexed_content||"",h=u.post_title||(u.post_id?`Post #${u.post_id}`:u.file_id&&w?w.length>50?w.substring(0,50)+"...":w:u.file_id?"Text/File Upload":"Action"),y=h.length>30?h.substring(0,30)+"...":h,b=u.file_id||"N/A",v=b.length>10?b.substring(0,10)+"...":b,S=typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(u.timestamp):u.timestamp||"N/A",C="";w&&(C=`<button type="button" class="button button-secondary button-small aipkit_view_snippet_icon"
                                    data-file-id="${r(u.id)}" 
                                    data-snippet="${r(w)}" 
                                    title="${r("View Indexed Snippet")}">
                                ${r("View")}
                             </button>`);let T="";m==="Site Content"&&u.post_id&&(T=`<button type="button" class="button button-primary button-small aipkit-reindex-vector-log-btn"
                                            data-provider="OpenAI"
                                            data-store-id="${r(i)}"
                                            data-vector-id="${r(u.file_id)}"
                                            data-log-id="${r(u.id||"")}"
                                            data-post-id="${r(u.post_id)}"
                                            title="${r("Re-index this post. This will delete the current entry and index the latest content.")}">
                                        ${r("Re-index")}
                                 </button>`);let E="";u.file_id&&(E=`<button type="button" class="button button-link-delete button-small aipkit-delete-vector-log-btn" 
                                                   data-provider="OpenAI" 
                                                   data-store-id="${r(i)}" 
                                                   data-vector-id="${r(u.file_id)}"
                                                   data-log-id="${r(u.id||"")}"
                                                   title="${r("This will attempt to remove the file from OpenAI and delete this log. This action cannot be undone.")}">
                                                   ${r("Delete")}
                                            </button>`),d+=`<tr data-log-id="${r(u.id||"")}">
                    <td style="white-space: nowrap;">${r(S)}</td>
                    <td class="aipkit-code-snippet aipkit-code-snippet-cell" style="white-space: nowrap;" title="${r(b)}">${r(v)}</td>
                    <td style="white-space: nowrap;">${_}</td>
                    <td style="white-space: nowrap;"><span class="aipkit_content-type-tag ${g}">${r(m)}</span></td>
                    <td title="${r(u.message||"")}">${k}</td>
                    <td title="${r(h)}">${r(y)}</td>
                    <td class="aipkit_actions_cell">
                        <div class="aipkit-table-actions-group">
                            ${T}
                            ${C}
                            ${E}
                        </div>
                    </td>
                </tr>`}),n.innerHTML=d,typeof window.aipkit_attachSnippetModalListeners=="function"&&window.aipkit_attachSnippetModalListeners(n,"OpenAI"),typeof window.aipkit_renderLogsPagination=="function"&&c.pagination&&window.aipkit_renderLogsPagination(c.pagination,s,u=>o(i,u))}catch(a){console.error("Fetch OpenAI Logs Error:",a),n.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">Error loading logs: ${r(a.message||"Unknown error")}</td></tr>`}}window.aipkit_fetchAndRenderOpenAIIndexingLogs=o})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};function o(i,e,t){let n=window.aipkit_openai_vs_refs.panelStatusDiv;n&&(n.innerHTML="Deleting file from store...",n.className="aipkit_form-help aipkit_settings_message-info",n.style.display="block"),t&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!0,"Delete","Deleting..."),window.aipkit_apiRequest("aipkit_delete_file_from_vector_store_openai",{store_id:i,file_id:e,_ajax_nonce:document.getElementById("aipkit_vector_store_nonce_openai").value}).then(s=>{n&&(n.textContent=s.message||"File deleted successfully.",n.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{n.textContent===(s.message||"File deleted successfully.")&&(n.textContent="",n.style.display="none")},4e3));let a=window.aipkit_openai_vs_refs.manageFilesPanel?.querySelector("#aipkit_manage_files_panel_title_openai"),l=(a?a.textContent:"").match(/Files in:\s*(.*)/),d=l&&l[1]?l[1].trim():i;typeof window.aipkit_listFilesInStoreForPanel=="function"&&window.aipkit_listFilesInStoreForPanel(i,d),typeof window.aipkit_populateGlobalOpenAITargetSelect=="function"&&window.aipkit_populateGlobalOpenAITargetSelect(),typeof window.aipkit_resyncAllProviders=="function"&&window.aipkit_resyncAllProviders()}).catch(s=>{n&&(n.textContent=s.message||"Failed to delete file.",n.className="aipkit_form-help aipkit_settings_message-error",setTimeout(()=>{n.textContent===(s.message||"Failed to delete file.")&&(n.textContent="",n.style.display="none")},6e3))}).finally(()=>{t&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!1,"Delete")})}window.aipkit_deleteFileFromStoreOpenAI=o})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};function o(i,e){let t=window.aipkit_openai_vs_refs;if(!t.manageFilesPanel||!t.rightColumnContainer){console.error("Show Files Panel: Manage files panel or main content area not found in global refs.");return}t.manageFilesPanel.dataset.activeStoreId=i;let n=t.manageFilesPanel.querySelector("#aipkit_manage_files_panel_title_openai"),s=t.panelStatusDiv;if(!s){console.error("Show Files Panel: One or more required child elements of the files panel are missing."),typeof window.aipkit_showRightColumnSection=="function"&&t.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(t.rightColumnPlaceholder.id);return}n&&(n.innerHTML=`Recent Indexing Activity for: <strong>${r(e)}</strong>`),s.innerHTML="",typeof window.aipkit_fetchAndRenderOpenAIIndexingLogs=="function"?window.aipkit_fetchAndRenderOpenAIIndexingLogs(i):console.error("Show Files Panel: aipkit_fetchAndRenderOpenAIIndexingLogs function not found."),typeof window.aipkit_showRightColumnSection=="function"&&window.aipkit_showRightColumnSection(t.manageFilesPanel.id)}window.aipkit_showStoreFilesPanel=o})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};function o(){let i=window.aipkit_openai_vs_refs,e=i.searchStoreFormWrapper?.querySelector("#aipkit_search_vector_store_btn_openai"),t=i.searchStoreFormWrapper?.querySelector("#aipkit_search_vector_store_id_openai"),n=i.searchStoreFormWrapper?.querySelector("#aipkit_search_query_text_openai"),s=i.searchStoreFormWrapper?.querySelector("#aipkit_search_top_k_openai"),a=i.searchStoreFormWrapper?.querySelector("#aipkit_search_results_area_openai"),c=i.searchStoreFormWrapper?.querySelector("#aipkit_search_vector_store_form_status_openai");if(!e||!t||!n||!s||!a||!c){console.error("Search Store: Missing required form or results elements within the search wrapper."),typeof window.aipkit_showSearchStatus=="function"&&window.aipkit_showSearchStatus("Error: Search UI elements missing.","error",c);return}if(typeof window.aipkit_setSearchButtonLoading!="function"||typeof window.aipkit_showSearchStatus!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderSearchResults!="function"){console.error("Search Store: Missing one or more UI/API helper functions."),window.aipkit_showSearchStatus("Error: Core functions missing for search.","error",c);return}let l=t.value,d=n.value.trim(),u=parseInt(s.value,10)||3;if(!l){window.aipkit_showSearchStatus("Vector Store ID is missing.","error",c);return}if(!d){window.aipkit_showSearchStatus("Search query cannot be empty.","error",c);return}window.aipkit_setSearchButtonLoading(e,!0),window.aipkit_showSearchStatus(p.vectorSearching||"Searching vector store...","info",c),a.innerHTML='<div class="aipkit_search_empty_state"><div class="aipkit_search_empty_state_icon"><span class="aipkit_spinner"></span></div></div>';let f={_ajax_nonce:document.getElementById("aipkit_vector_store_nonce_openai").value,store_id:l,query_text:d,top_k:u};window.aipkit_apiRequest("aipkit_search_vector_store_openai",f).then(_=>{if(a.innerHTML="",_.results&&Array.isArray(_.results)){window.aipkit_renderSearchResults(_.results,a,"openai");let m=_.results.length===0?"No results found for your query.":`Found ${_.results.length} result${_.results.length!==1?"s":""}.`;window.aipkit_showSearchStatus(m,_.results.length===0?"info":"success",c)}else throw new Error(_.message||"Invalid response format for search results.")}).catch(_=>{window.aipkit_showSearchStatus(`Search Error: ${_.message||"Unknown error"}`,"error",c),a.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">${r(_.message||"Failed to perform search.")}</p>`}).finally(()=>{window.aipkit_setSearchButtonLoading(e,!1)})}window.aipkit_searchOpenAIVectorStore=o})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};function o(i,e){let n=window.aipkit_openai_vs_refs.searchStoreFormWrapper;if(!n){console.error("Show Search Form: Search form wrapper not found in global refs.");return}let s=n.querySelector("#aipkit_search_vector_store_id_openai"),a=n.querySelector("#aipkit_search_store_form_title_openai"),c=n.querySelector("#aipkit_search_results_area_openai"),l=n.querySelector("#aipkit_search_query_text_openai"),d=n.querySelector("#aipkit_search_vector_store_form_status_openai"),u=n.querySelector("#aipkit_search_vector_store_btn_openai"),f=n.querySelector("#aipkit_search_top_k_openai");s&&(s.value=i),a&&(a.textContent=`Search in: ${r(e)}`),c&&(c.innerHTML=""),l&&(l.value=""),d&&(d.className="aipkit_search_form_status",d.innerHTML=""),u&&(u.classList.remove("loading"),u.disabled=!1),f&&!f.value&&(f.value="5"),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("","info","aipkit_vs_global_provider_status"),typeof window.aipkit_showRightColumnSection=="function"&&window.aipkit_showRightColumnSection(n.id),l&&setTimeout(()=>l.focus(),100)}window.aipkit_showSearchFormForStore=o})();(function(){"use strict";window.aipkit_openai_vs_refs=window.aipkit_openai_vs_refs||{},window.aipkit_initial_openai_stores=null;function p(){window.aipkit_openai_vs_config&&window.aipkit_openai_vs_config.initialStores?window.aipkit_initial_openai_stores=window.aipkit_openai_vs_config.initialStores:console.warn("AIPKit OpenAI Init: Initial OpenAI stores not found in localized config.");let r=document.getElementById("aipkit_vector_openai_management_ui");if(!r){console.warn("AIPKit AI Training (OpenAI Init): OpenAI management block (#aipkit_vector_openai_management_ui) not found.");return}let o=window.aipkit_openai_vs_refs;if(o.rightColumnContainer=r.querySelector("#aipkit_openai_vs_main_content_area"),o.rightColumnPlaceholder=r.querySelector("#aipkit_openai_vs_right_col_placeholder"),o.manageFilesPanel=r.querySelector("#aipkit_manage_files_panel_openai"),o.manageFilesPanel&&(o.panelFilesTableBody=o.manageFilesPanel.querySelector("#aipkit_vector_store_files_table_body_openai"),o.panelStatusDiv=o.manageFilesPanel.querySelector("#aipkit_manage_files_panel_status_openai")),o.searchStoreFormWrapper=r.querySelector("#aipkit_search_store_form_openai_wrapper_modal_placeholder"),o.apiKeyIsSet=!!document.getElementById("aipkit_vector_store_nonce_openai"),!o.apiKeyIsSet&&window.aipkit_openai_vs_config?.apiKeyIsSet===!1){o.rightColumnPlaceholder&&o.rightColumnContainer&&(o.rightColumnContainer.innerHTML=`<div class="aipkit_ai_training_section_wrapper aipkit_openai_vs_content_section" id="aipkit_openai_vs_right_col_placeholder" style="display: flex;">
                                                            <div class="aipkit_ai_training_section_header"><h5>Store Details</h5></div>
                                                            <p class="aipkit_text-center" style="padding: 20px;">OpenAI API Key not set. Store details cannot be displayed. Configure in Main Settings.</p>
                                                        </div>`),console.warn("AIPKit AI Training (OpenAI Init): API key not set. Management features disabled.");return}if(typeof window.aipkit_showRightColumnSection=="function"&&o.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(o.rightColumnPlaceholder.id),r.dataset.openaiManagementListenersAttached!=="true"){if(o.manageFilesPanel){let i=o.manageFilesPanel.querySelector("#aipkit_openai_vs_refresh_files_btn");i&&typeof window.aipkit_listFilesInStoreForPanel=="function"&&i.addEventListener("click",()=>{let e=o.manageFilesPanel.dataset.activeStoreId;e&&window.aipkit_listFilesInStoreForPanel(e,i)}),o.panelFilesTableBody?.addEventListener("click",e=>{let t=e.target.closest(".aipkit-delete-vector-log-btn"),n=e.target.closest(".aipkit-reindex-vector-log-btn");t&&!t.disabled?typeof window.aipkit_handleDeleteVectorLogEntryClick=="function"&&window.aipkit_handleDeleteVectorLogEntryClick(e):n&&!n.disabled&&typeof window.aipkit_handleReindexVectorLogEntryClick=="function"&&window.aipkit_handleReindexVectorLogEntryClick(e)})}o.searchStoreFormWrapper&&o.searchStoreFormWrapper.addEventListener("click",i=>{let e=i.target.closest("#aipkit_search_vector_store_btn_openai"),t=i.target.closest("#aipkit_close_search_panel_btn_openai");if(e)typeof window.aipkit_searchOpenAIVectorStore=="function"&&window.aipkit_searchOpenAIVectorStore();else if(t){let n=o.manageFilesPanel?.dataset.activeStoreId;if(n&&typeof window.aipkit_showStoreFilesPanel=="function"){let s=window.aipkit_openai_fetched_stores_data?window.aipkit_openai_fetched_stores_data[n]:null,a=s?.name||n;window.aipkit_showStoreFilesPanel(n,a,s)}else typeof window.aipkit_showRightColumnSection=="function"&&o.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(o.rightColumnPlaceholder.id)}}),r.dataset.openaiManagementListenersAttached="true"}}window.aipkit_initOpenAIVectorStore=p})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(e){return e},o="aipkit_last_pinecone_index_id";function i(e=null){let t=document.getElementById("aipkit_vs_global_target_select"),n=localStorage.getItem(o);if(!t){console.error("Populate Global Pinecone Target: Select element #aipkit_vs_global_target_select not found.");return}let s=t.value;t.innerHTML=`<option value="">${r(p.selectTargetIndex||"-- Select Index --")}</option>`;let a=e!==null?e:window.aipkit_pinecone_vs_refs.syncedIndexes||[];a&&Array.isArray(a)&&a.length>0?a.forEach(d=>{let u=d.name||d.id;if(u){let f=d.name||u,_="",m=d.total_vector_count;m==="Error"||m==="No Host"?_=" (Stats Err)":m!=null&&m!==""&&!Number.isNaN(Number(m))&&(_=` (Vectors: ${Number(m).toLocaleString()})`);let g=`${r(f)}${_}`,k=new Option(g,u);t.appendChild(k)}}):t.appendChild(new Option(r(p.noPineconeIndexesFound||"No Pinecone indexes found. Sync or create one."),""));let c=new Option("+ "+(p.createNewIndexButton||"Create New Index..."),"_create_new_pinecone_");t.appendChild(c);let l=null;s&&s!=="_create_new_pinecone_"&&t.querySelector(`option[value="${CSS.escape(s)}"]`)?l=s:n&&t.querySelector(`option[value="${CSS.escape(n)}"]`)&&(l=n),l?t.value=l:t.options.length>1&&t.options[0].value===""?t.selectedIndex=0:t.options.length>0&&(t.selectedIndex=t.options[0].value===""?0:t.options.length>1?1:0),t.disabled=!(a&&a.length>0&&t.options.length>1)}window.aipkit_populateGlobalPineconeTargetSelect=i})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(e){return e},o="aipkit_last_pinecone_index_id";window.aipkit_pinecone_vs_refs=window.aipkit_pinecone_vs_refs||{},window.aipkit_pinecone_vs_refs.syncedIndexes=window.aipkit_pinecone_vs_config?.initialIndexes||[];async function i(e=null,t=!1){let n=window.aipkit_pinecone_vs_refs,s="aipkit_knowledge_base_global_status";if(typeof window.aipkit_populateGlobalPineconeTargetSelect!="function")return console.error("AIPKit Pinecone List: aipkit_populateGlobalPineconeTargetSelect function not found."),Promise.reject(new Error("Dependency missing for populating select."));if(t&&n.syncedIndexes&&n.syncedIndexes.length>0){window.aipkit_populateGlobalPineconeTargetSelect(n.syncedIndexes);let a=document.getElementById("aipkit_vs_global_target_select"),c=localStorage.getItem(o),l=a?a.value:null;if(!l&&c&&a&&a.querySelector(`option[value="${CSS.escape(c)}"]`)&&(a.value=c,l=c),l&&typeof window.aipkit_showPineconeIndexDetails=="function"){let d=n.syncedIndexes.find(u=>u.name===l);d&&window.aipkit_showPineconeIndexDetails(l,d)}return Promise.resolve()}e&&typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(e,!0,p.syncIndexesButton||"Sync Indexes",p.syncing||"Syncing..."):e&&(e.disabled=!0,e.textContent=p.syncing||"Syncing..."),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Syncing Pinecone indexes...","info",s);try{let a=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!a||!a.value)throw new Error("Pinecone management nonce not found for listing indexes.");let c=await window.aipkit_apiRequest("aipkit_list_indexes_pinecone",{_ajax_nonce:a.value});n.syncedIndexes=c.indexes||[],window.aipkit_pinecone_vs_refs.syncedIndexes=n.syncedIndexes,window.aipkit_populateGlobalPineconeTargetSelect(n.syncedIndexes),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(c.message||"Pinecone indexes synced successfully.","success",s)}catch(a){console.error("Pinecone List Indexes Error:",a),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(`Error: ${a.message||"Failed to sync Pinecone indexes."}`,"error",s)}finally{if(e&&typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(e,!1,p.syncIndexesButton||"Sync Indexes"):e&&(e.disabled=!1,e.textContent=p.syncIndexesButton||"Sync Indexes"),typeof window.aipkit_apiRequest=="function"&&typeof window.aipkit_applyRefreshToKbViews=="function")try{let a=await window.aipkit_apiRequest("aipkit_refresh_knowledge_base_cards",{});await window.aipkit_applyRefreshToKbViews(a)}catch{}}}window.aipkit_listPineconeIndexes=i})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};function o(i,e){let t=window.aipkit_pinecone_vs_refs;if(!t.searchFormWrapper||!t.searchIndexIdInput||!t.searchResultsArea||!t.searchQueryVectorInput||!t.searchNamespaceInput){console.error("Pinecone Search (Show Form): Missing required search form elements in refs.");return}let n=t.searchStatusDiv,s=document.getElementById("aipkit_search_pinecone_index_btn"),a=document.getElementById("aipkit_search_top_k_pinecone");t.searchIndexIdInput.value=i,t.searchFormTitle&&(t.searchFormTitle.textContent=`Search in Index: ${r(e)}`),t.searchQueryVectorInput.value="",t.searchNamespaceInput.value="",t.searchResultsArea.innerHTML="",n&&(n.className="aipkit_search_form_status",n.innerHTML=""),s&&(s.classList.remove("loading"),s.disabled=!1),a&&!a.value&&(a.value="5"),t.manageIndexPanel&&(t.manageIndexPanel.style.display="none"),t.rightColumnPlaceholder&&(t.rightColumnPlaceholder.style.display="none"),t.searchFormWrapper.style.display="block";let c=document.getElementById("aipkit_pinecone_search_embedding_model_select");c&&typeof window.aipkit_populateEmbeddingModelSelectElement=="function"&&window.aipkit_populateEmbeddingModelSelectElement(c),setTimeout(()=>{t.searchQueryVectorInput&&t.searchQueryVectorInput.focus()},100)}window.aipkit_showSearchFormForPineconeIndex=o})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};async function o(){let i=window.aipkit_pinecone_vs_refs;if(!i.searchSubmitButton||!i.searchIndexIdInput||!i.searchQueryVectorInput||!i.searchTopKInput||!i.searchResultsArea||!i.searchStatusDiv||!i.searchNamespaceInput){console.error("Pinecone Search (Perform): Missing search form submit or input elements in refs for search action.");return}if(typeof window.aipkit_showSearchStatus!="function"||typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Pinecone Search (Perform): Missing required UI or API helper functions.");return}let e=i.searchIndexIdInput.value,t=i.searchQueryVectorInput.value.trim(),n=i.searchNamespaceInput.value.trim(),s=parseInt(i.searchTopKInput.value,10)||3,a=document.getElementById("aipkit_pinecone_search_embedding_model_select"),c=a?a.value:"",l=a&&a.options[a.selectedIndex]?.dataset.provider||"openai";if(!e){window.aipkit_showSearchStatus("Index ID missing.","error",i.searchStatusDiv);return}if(!t){window.aipkit_showSearchStatus("Search query empty.","error",i.searchStatusDiv);return}if(!c){window.aipkit_showSearchStatus("Please select an embedding model.","error",i.searchStatusDiv);return}window.aipkit_setLoadingStateOpenAI(i.searchSubmitButton,!0,p.searchButton||"Search",p.searching||"Searching..."),window.aipkit_showSearchStatus(p.vectorSearching||"Searching index...","info",i.searchStatusDiv),i.searchResultsArea.innerHTML='<div class="aipkit_search_empty_state"><div class="aipkit_search_empty_state_icon"><span class="aipkit_spinner"></span></div></div>';let d={_ajax_nonce:document.getElementById("aipkit_vector_store_pinecone_nonce_management").value,index_id:e,query_text:t,embedding_provider:l,embedding_model:c,top_k:s,...n&&{namespace:n}};try{let u=await window.aipkit_apiRequest("aipkit_search_pinecone_index",d);if(window.aipkit_showSearchStatus(u.message||"Search complete.","success",i.searchStatusDiv),u.results&&Array.isArray(u.results))if(typeof window.aipkit_renderSearchResults=="function")window.aipkit_renderSearchResults(u.results,i.searchResultsArea,"pinecone");else if(u.results.length===0)i.searchResultsArea.innerHTML=`<p class="aipkit_text-center">No results for "${r(t)}".</p>`;else{let f=document.createElement("ul");f.style.listStyleType="decimal",f.style.paddingLeft="20px",u.results.forEach(_=>{let m=document.createElement("li");m.style.marginBottom="10px",m.style.borderBottom="1px dashed #eee",m.style.paddingBottom="5px";let g=`<strong>ID:</strong> ${r(_.id||"N/A")}<br>`;_.score!==null&&typeof _.score<"u"&&(g+=`<strong>Score:</strong> ${Number(_.score).toFixed(4)}<br>`),_.metadata&&Object.keys(_.metadata).length>0&&(g+=`<strong>Metadata:</strong><pre style="white-space: pre-wrap; word-wrap: break-word; max-height: 100px; overflow-y: auto; background: #f0f0f0; border:1px solid #ddd; padding: 5px;">${r(JSON.stringify(_.metadata,null,2))}</pre>`,_.metadata.url&&_.metadata.title&&(g+=`<a href="${r(_.metadata.url)}" target="_blank" rel="noopener noreferrer">${r(_.metadata.title)}</a><br>`)),m.innerHTML=g,f.appendChild(m)}),i.searchResultsArea.innerHTML="",i.searchResultsArea.appendChild(f)}else i.searchResultsArea.innerHTML='<p class="aipkit_text-center aipkit_text-danger">Invalid search response.</p>'}catch(u){window.aipkit_showSearchStatus(`Search Error: ${u.message||"Unknown error"}`,"error",i.searchStatusDiv),i.searchResultsArea.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">${r(u.message||"Failed search.")}</p>`}finally{window.aipkit_setLoadingStateOpenAI(i.searchSubmitButton,!1,p.searchButton||"Search")}}window.aipkit_searchPineconeIndex=o})();(function(){"use strict";function p(r,o="info",i=!0){let e=window.aipkit_pinecone_vs_refs,t=i?e?.createIndexStatusDivGlobal:null;t&&(t.textContent=r,t.className=`aipkit_form-help aipkit_settings_message-${o}`,t.style.display=r?"block":"none",r&&o!=="info"&&setTimeout(()=>{t.textContent===r&&(t.textContent="",t.style.display="none")},5e3))}window.aipkit_showPineconeCreateStatus=p})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};async function o(i=!1){let e=window.aipkit_pinecone_vs_refs,t=i?e.newIndexNameInputGlobal:null,n=i?e.newIndexDimensionInputGlobal:null,s=i?e.createIndexSubmitButtonGlobal:null,a=i?e.createIndexStatusDivGlobal:null,c=i?e.createFormWrapperGlobal:null;if(!s||!t||!n||!a||!c){console.error("Create Pinecone Index: Missing required form elements for ",i?"global form.":"panel form (not supported).");return}let l=t.value.trim(),d=parseInt(n.value,10);if(!l){typeof window.aipkit_showPineconeCreateStatus=="function"?window.aipkit_showPineconeCreateStatus("Index name is required.","error",i):console.error("aipkit_showPineconeCreateStatus not defined");return}if(!d||d<=0){typeof window.aipkit_showPineconeCreateStatus=="function"?window.aipkit_showPineconeCreateStatus("Valid vector dimension is required.","error",i):console.error("aipkit_showPineconeCreateStatus not defined");return}window.aipkit_setLoadingStateOpenAI(s,!0,p.createIndexButton||"Create Index",p.creatingIndex||"Creating..."),typeof window.aipkit_showPineconeCreateStatus=="function"?window.aipkit_showPineconeCreateStatus(p.creatingIndex||"Creating index...","info",i):console.error("aipkit_showPineconeCreateStatus not defined");try{let u=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!u||!u.value)throw new Error("Pinecone management nonce not found for create operation.");let f={_ajax_nonce:u.value,name:l,dimension:d,metric:"cosine",spec_cloud:"aws",spec_region:"us-east-1"},_=await window.aipkit_apiRequest("aipkit_create_index_pinecone",f);if(typeof window.aipkit_showPineconeCreateStatus=="function"&&window.aipkit_showPineconeCreateStatus(_.message||"Index created successfully!","success",i),c&&(c.style.display="none"),typeof window.aipkit_listPineconeIndexes=="function"&&await window.aipkit_listPineconeIndexes(null,!1),typeof window.aipkit_apiRequest=="function"&&typeof window.aipkit_applyRefreshToKbViews=="function")try{let g=await window.aipkit_apiRequest("aipkit_refresh_knowledge_base_cards",{});await window.aipkit_applyRefreshToKbViews(g)}catch(g){console.debug("Pinecone Create: KB views refresh skipped/failed.",g?.message||g)}typeof window.updateKbViewToggleVisibility=="function"&&window.updateKbViewToggleVisibility();let m=document.getElementById("aipkit_vs_global_target_select");if(m){let g=!1;for(let k=0;k<m.options.length;k++)if(m.options[k].value===l){g=!0;break}g?(m.value=l,m.dispatchEvent(new Event("change"))):e.rightColumnPlaceholder&&(e.rightColumnPlaceholder.style.display="block")}else e.rightColumnPlaceholder&&(e.rightColumnPlaceholder.style.display="block")}catch(u){typeof window.aipkit_showPineconeCreateStatus=="function"&&window.aipkit_showPineconeCreateStatus(`Error: ${u.message||"Failed to create index."}`,"error",i)}finally{window.aipkit_setLoadingStateOpenAI(s,!1,p.createIndexButton||"Create Index")}}window.aipkit_handleCreatePineconeIndex=o})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};async function o(i,e=null){let t=window.aipkit_pinecone_vs_refs,n="aipkit_knowledge_base_global_status";if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Delete Pinecone Index: Missing required UI or API helper functions."),e&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!1,p.deleteIndexButton||"Delete Index");return}window.aipkit_showOpenAIVectorStatus(`Deleting Pinecone index "${r(i)}"...`,"info",n),e&&window.aipkit_setLoadingStateOpenAI(e,!0,p.deleteIndexButton||"Delete Index",p.deletingIndex||"Deleting...");try{let s=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!s||!s.value)throw new Error("Pinecone management nonce not found for delete operation.");let a=await window.aipkit_apiRequest("aipkit_delete_index_pinecone",{_ajax_nonce:s.value,index_name:i});window.aipkit_showOpenAIVectorStatus(a.message||`Pinecone index "${r(i)}" deleted.`,"success",n);let c=document.querySelector(`.aipkit_vector_store_list_item[data-provider="Pinecone"][data-id="${i}"]`);c&&c.remove();let l=document.querySelector(".aipkit_vector_store_list_container"),d=l?.querySelector(".aipkit_vector_store_list_table tbody");if(l&&d&&d.children.length===0&&(l.innerHTML=`<p class="aipkit_text-center" style="padding: 15px;">${r(p.noKnowledgeBasesFound||'No knowledge bases found. Click "Add Content" to create one.')}</p>`),typeof window.aipkit_listPineconeIndexes=="function"&&await window.aipkit_listPineconeIndexes(null,!1),typeof window.aipkit_apiRequest=="function"&&typeof window.aipkit_applyRefreshToKbViews=="function")try{let _=await window.aipkit_apiRequest("aipkit_refresh_knowledge_base_cards",{});await window.aipkit_applyRefreshToKbViews(_)}catch(_){console.debug("Pinecone Delete: KB views refresh skipped/failed.",_?.message||_)}let f=(typeof window.localStorage<"u"?localStorage.getItem("aipkit_kb_view_style"):null)==="list"?"list":"cards";typeof window.aipkit_switchKbView=="function"&&window.aipkit_switchKbView(f),typeof window.aipkit_resyncAllProviders=="function"&&window.aipkit_resyncAllProviders()}catch(s){console.error(`Delete Pinecone Index Error for "${r(i)}":`,s),window.aipkit_showOpenAIVectorStatus(`Error deleting index: ${r(s.message)||"Unknown error."}`,"error",n)}finally{e&&window.aipkit_setLoadingStateOpenAI(e,!1,p.deleteIndexButton||"Delete Index")}}window.aipkit_deletePineconeIndex=o})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};async function o(i,e=1){let t=window.aipkit_pinecone_vs_refs;if(!t.indexLogsContainer){console.error("Fetch Pinecone Logs: Log container not found in refs.");return}let n=document.getElementById("aipkit_pinecone_logs_pagination");if(!n){console.error("Fetch Pinecone Logs: Pagination container not found.");return}t.indexLogsContainer.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${r(p.loading_logs||"Loading records...")}</p>`,n.innerHTML="";try{let s=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!s||!s.value)throw new Error("Pinecone management nonce for logs not found.");let a=await window.aipkit_apiRequest("aipkit_get_pinecone_indexing_logs",{_ajax_nonce:s.value,index_name:i,page:e}),c=a.logs||[];if(c.length===0){t.indexLogsContainer.innerHTML=`<p class="aipkit_text-center">${r(p.noLogsForStore||"No records found for this index.")}</p>`;return}let l=f=>{if(!f)return"Uploaded file";let _=null,m=null,g=f.match(/\(\s*chunk\s+(\d+)\/(\d+)\s*\)/i);g&&(_=parseInt(g[2],10));let k=f.match(/for\s+(.+)$/i);return k&&(m=k[1].trim()),`Uploaded ${m||"file"}${_?` (${_} chunks)`:""}`},d='<div class="aipkit_data-table aipkit_index_logs_table"><table>';d+='<thead><tr><th>Time</th><th>Vector ID</th><th style="white-space: nowrap;">Status</th><th style="white-space: nowrap;">Type</th><th>Message</th><th>Embedding</th><th>Source</th><th class="aipkit_actions_cell_header">Actions</th></tr></thead><tbody>';let u=new Set;if(c.forEach(f=>{let m=`<span class="aipkit_status-tag ${f.status==="indexed"||f.status==="skipped_already_indexed"?"aipkit_status-success":f.status==="failed"?"aipkit_status-warning":"aipkit_status-info"}" style="white-space: nowrap;">${r(f.status)}</span>`,g=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(f.message||"",f.file_id||"","pinecone",f):"N/A",k=!!f.batch_id&&g==="File Upload";if(k){if(u.has(f.batch_id))return;u.add(f.batch_id)}let w=g==="Text"?"aipkit_type-text":g==="File Upload"?"aipkit_type-file":g==="Site Content"?"aipkit_type-site":"aipkit_type-na",h="";k?h=r(l(f.message||"")):h=f.message?f.message.length>50?r(f.message.substring(0,50))+"...":r(f.message):"";let y=f.file_id&&f.file_id.startsWith("chatfile_"),b=`<span class="aipkit_content-type-tag ${w}">${r(g)}</span>`;y&&(b+=' <span class="dashicons dashicons-admin-users aipkit_user_upload_icon" title="User uploaded record"></span>');let v=f.file_id?f.file_id.length>10?f.file_id.substring(0,10)+"...":f.file_id:"N/A",S=f.indexed_content||"",C="";(S||k)&&(C=`<button type="button" class="button button-secondary button-small aipkit_view_snippet_icon" 
              data-file-id="${r(f.id)}" 
              data-snippet="${r(S)}" 
              ${k?`data-batch-id="${r(f.batch_id)}" data-store-id="${r(i)}"`:""}
              title="${r("View")}">
              ${r("View")}
            </button>`);let T="";g==="Site Content"&&f.post_id&&(T=`<button type="button" class="button button-primary button-small aipkit-reindex-vector-log-btn"
                                            data-provider="Pinecone"
                                            data-store-id="${r(i)}"
                                            data-vector-id="${r(f.file_id)}"
                                            data-log-id="${r(f.id||"")}"
                                            data-post-id="${r(f.post_id)}"
                                            data-embedding-provider="${r(f.embedding_provider)}"
                                            data-embedding-model="${r(f.embedding_model)}"
                                            title="${r("Re-index this post. This will delete the current entry and index the latest content.")}">
                                        ${r("Re-index")}
                                 </button>`);let E="";f.file_id&&(E=`<button type="button" class="button button-link-delete button-small aipkit-delete-vector-log-btn" 
                                                   data-provider="Pinecone" 
                                                   data-store-id="${r(i)}" 
                                                   data-vector-id="${r(f.file_id)}" 
                                                   data-log-id="${r(f.id||"")}"
                                                   title="${r("Delete this record from Pinecone and local logs")}">
                                                   ${r("Delete")}
                                            </button>`);let M=typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(f.timestamp):f.timestamp||"N/A",x=`${r(f.embedding_provider||"N/A")} / ${r(f.embedding_model||"N/A")}`,L=f.post_id?`Post ID: ${f.post_id}`:f.file_id&&S?S.length>50?S.substring(0,50)+"...":S:f.file_id?"Text/File Upload":"N/A",A=L.length>30?L.substring(0,30)+"...":L;d+=`<tr data-log-id="${r(f.id||"")}">
                    <td style="white-space: nowrap;">${r(M)}</td>
                    <td class="aipkit-code-snippet aipkit-code-snippet-cell" style="white-space: nowrap;" title="${r(f.file_id||"N/A")}">${r(v)}</td>
                    <td style="white-space: nowrap;">${m}</td>
                    <td style="white-space: nowrap;">${b}</td>
                    <td title="${r(f.message||"")}">${h}</td>
                    <td style="white-space: nowrap;">${x}</td>
                    <td title="${r(L)}">${r(A)}</td>
                    <td class="aipkit_actions_cell">
                        <div class="aipkit-table-actions-group">
                            ${T}
                            ${C}
                            ${E}
                        </div>
                    </td>
                </tr>`}),d+="</tbody></table></div>",t.indexLogsContainer.innerHTML=d,typeof window.aipkit_attachSnippetModalListeners=="function"){let f=t.indexLogsContainer.querySelector("table");f&&window.aipkit_attachSnippetModalListeners(f,"Pinecone")}typeof window.aipkit_renderLogsPagination=="function"&&a.pagination&&window.aipkit_renderLogsPagination(a.pagination,n,f=>o(i,f))}catch(s){console.error("Fetch Pinecone Logs Error:",s),t.indexLogsContainer.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">Error loading logs: ${r(s.message||"Unknown error")}</p>`}}window.aipkit_fetchAndRenderPineconeIndexingLogs=o})();(function(){"use strict";function p(r){let o=window.aipkit_pinecone_vs_refs;if(!o||!o.managementBlock){console.error("showPineconeSection: Pinecone refs or management block not initialized.");return}let i=[o.rightColumnPlaceholder,o.manageIndexPanel,o.searchFormWrapper],e=!1;i.forEach(t=>{t&&((t===o.rightColumnPlaceholder?"placeholder":t===o.manageIndexPanel?"manage_panel":t===o.searchFormWrapper?"search_form":null)===r?(t.style.display="block",t.classList.add("aipkit-active"),e=!0):(t.style.display="none",t.classList.remove("aipkit-active")))}),!e&&o.rightColumnPlaceholder&&(o.rightColumnPlaceholder.style.display="block",o.rightColumnPlaceholder.classList.add("aipkit-active"))}window.aipkit_showPineconeSection=p})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};async function o(i){let e=window.aipkit_pinecone_vs_refs;if(!e.manageIndexPanel||!e.indexLogsContainer){console.error("Pinecone Details: Missing one or more UI elements in refs for showing index details.");return}e.manageIndexPanel.dataset.activeIndexName=i,window.aipkit_showPineconeSection("manage_panel"),typeof window.aipkit_fetchAndRenderPineconeIndexingLogs=="function"?aipkit_fetchAndRenderPineconeIndexingLogs(i):(console.error("Dependency missing: aipkit_fetchAndRenderPineconeIndexingLogs"),e.indexLogsContainer.innerHTML='<p class="aipkit_text-center aipkit_text-danger">Error: Log fetching component is not available.</p>')}window.aipkit_showPineconeIndexDetails=o})();(function(){"use strict";window.aipkit_pinecone_vs_refs=window.aipkit_pinecone_vs_refs||{},window.aipkit_pinecone_vs_refs.syncedIndexes=window.aipkit_pinecone_vs_config?.initialIndexes||[];let p=window.aipkit_escapeHtml||function(i){return i},r=window.aipkit_dashboard?.text||{};function o(){let i=document.getElementById("aipkit_vector_pinecone_management_ui");if(!i){console.warn("Pinecone Init: Pinecone management block (#aipkit_vector_pinecone_management_ui) not found.");return}let e=window.aipkit_pinecone_vs_refs;if(e.managementBlock=i,e.rightColumnPlaceholder=i.querySelector("#aipkit_pinecone_vs_right_col_placeholder"),e.manageIndexPanel=i.querySelector("#aipkit_manage_selected_pinecone_index_panel"),e.manageIndexPanel&&(e.panelTitle=e.manageIndexPanel.querySelector("#aipkit_manage_pinecone_index_panel_title"),e.panelStatusDiv=e.manageIndexPanel.querySelector("#aipkit_manage_pinecone_index_panel_status"),e.indexLogsContainer=e.manageIndexPanel.querySelector("#aipkit_pinecone_index_logs_container")),e.searchFormWrapper=i.querySelector("#aipkit_search_pinecone_index_form_wrapper"),e.searchFormWrapper&&(e.searchFormTitle=e.searchFormWrapper.querySelector("#aipkit_search_pinecone_index_form_title"),e.searchIndexIdInput=e.searchFormWrapper.querySelector("#aipkit_search_pinecone_index_id"),e.searchQueryVectorInput=e.searchFormWrapper.querySelector("#aipkit_search_query_vector_pinecone"),e.searchNamespaceInput=e.searchFormWrapper.querySelector("#aipkit_search_pinecone_namespace"),e.searchTopKInput=e.searchFormWrapper.querySelector("#aipkit_search_top_k_pinecone"),e.searchSubmitButton=e.searchFormWrapper.querySelector("#aipkit_search_pinecone_index_btn"),e.searchCloseButton=e.searchFormWrapper.querySelector("#aipkit_close_search_pinecone_panel_btn"),e.searchResultsArea=e.searchFormWrapper.querySelector("#aipkit_search_pinecone_results_area"),e.searchStatusDiv=e.searchFormWrapper.querySelector("#aipkit_search_pinecone_index_form_status")),e.createFormWrapperGlobal=null,e.newIndexNameInputGlobal=document.getElementById("aipkit_vs_global_new_target_name"),e.newIndexDimensionInputGlobal=document.getElementById("aipkit_vs_global_new_target_dimension"),e.createIndexSubmitButtonGlobal=document.getElementById("aipkit_vs_global_create_new_target_btn"),e.createIndexCloseButtonGlobal=document.getElementById("aipkit_vs_global_cancel_add_content_btn"),e.createIndexStatusDivGlobal=document.getElementById("aipkit_knowledge_base_global_status"),e.apiKeyIsSet=!!window.aipkit_pinecone_vs_config?.apiKeyIsSet,!e.apiKeyIsSet){e.manageIndexPanel&&(e.manageIndexPanel.style.display="none"),e.searchFormWrapper&&(e.searchFormWrapper.style.display="none");return}e.rightColumnPlaceholder&&(e.rightColumnPlaceholder.style.display="block"),e.manageIndexPanel&&(e.manageIndexPanel.style.display="none"),e.searchFormWrapper&&(e.searchFormWrapper.style.display="none");let t="data-pinecone-listener-attached";i.getAttribute(t)||(e.manageIndexPanel&&e.manageIndexPanel.addEventListener("click",n=>{let s=n.target.closest(".aipkit-delete-vector-log-btn"),a=n.target.closest(".aipkit-reindex-vector-log-btn");s&&typeof window.aipkit_handleDeleteVectorLogEntryClick=="function"?window.aipkit_handleDeleteVectorLogEntryClick(n):a&&typeof window.aipkit_handleReindexVectorLogEntryClick=="function"&&window.aipkit_handleReindexVectorLogEntryClick(n)}),e.searchFormWrapper&&(e.searchSubmitButton&&typeof window.aipkit_searchPineconeIndex=="function"&&e.searchSubmitButton.addEventListener("click",window.aipkit_searchPineconeIndex),e.searchCloseButton&&e.searchCloseButton.addEventListener("click",()=>{let n=e.searchIndexIdInput?.value;n&&e.syncedIndexes?.find(s=>s.name===n)&&typeof window.aipkit_showPineconeIndexDetails=="function"?window.aipkit_showPineconeIndexDetails(n,e.syncedIndexes.find(s=>s.name===n)):e.rightColumnPlaceholder&&(e.rightColumnPlaceholder.style.display="block",e.manageIndexPanel&&(e.manageIndexPanel.style.display="none"),e.searchFormWrapper&&(e.searchFormWrapper.style.display="none"))})),i.setAttribute(t,"true"))}window.aipkit_initPineconeUI=o})();(function(){"use strict";function p(r){let o=window.aipkit_qdrant_vs_refs;if(!o||!o.managementBlock){console.error("showQdrantSection: Qdrant refs or management block not initialized.");return}let i=[o.rightColumnPlaceholder,o.manageCollectionPanel,o.searchFormWrapper],e=!1;i.forEach(t=>{t&&((t===o.rightColumnPlaceholder?"placeholder":t===o.manageCollectionPanel?"manage_panel":t===o.searchFormWrapper?"search_form":null)===r?(t.style.display="block",t.classList.add("aipkit-active"),e=!0):(t.style.display="none",t.classList.remove("aipkit-active")))}),!e&&o.rightColumnPlaceholder&&(o.rightColumnPlaceholder.style.display="block",o.rightColumnPlaceholder.classList.add("aipkit-active"))}window.aipkit_showQdrantSection=p})();(function(){"use strict";function p(r,o="info",i=!0,e=!1){let t=window.aipkit_qdrant_vs_refs,n=null;if(e?n=t?.searchStatusDiv:i?n=t?.createCollectionStatusDivGlobal:n=t?.panelStatusDiv,!n&&(n=document.getElementById("aipkit_vs_global_provider_status"),!n)){console.warn("showQdrantStatus: No status div found.");return}n.messageTimeoutId&&clearTimeout(n.messageTimeoutId),n.messageTimeoutId=null;let s=r?r.trim():"";s!==""?(n.className="aipkit_form-help",o==="success"?n.classList.add("aipkit_settings_message-success"):o==="error"?n.classList.add("aipkit_settings_message-error"):n.classList.add("aipkit_settings_message-info"),n.textContent=s,n.style.display="block",n.style.opacity="1",n.classList.add("aipkit-active"),n.messageTimeoutId=setTimeout(()=>{n.style.opacity="0",setTimeout(()=>{n.textContent===s&&(n.textContent="",n.className="aipkit_form-help",n.style.display="none",n.classList.remove("aipkit-active"))},300)},5e3)):(n.textContent="",n.className="aipkit_form-help",n.style.display="none",n.style.opacity="0",n.classList.remove("aipkit-active"))}window.aipkit_showQdrantStatus=p})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(t){return t},o="aipkit_last_qdrant_collection_id";function i(t=null){let n=document.getElementById("aipkit_vs_global_target_select"),s=localStorage.getItem(o);if(!n){console.error("Populate Global Qdrant Target: Select element #aipkit_vs_global_target_select not found.");return}let a=n.value,c=n.offsetWidth;c>0&&(n.style.minWidth=`${c}px`,n.style.width=`${c}px`),n.innerHTML=`<option value="">${r(p.selectTargetCollection||"-- Select Collection --")}</option>`;let l=t!==null?t:window.aipkit_qdrant_vs_refs?.syncedCollections||window.aipkit_qdrant_vs_config?.initialCollections||[];l&&l.length>0?l.forEach(f=>{let _=f.name||f.id;if(_){let m=new Option(r(_),_);n.appendChild(m)}}):n.appendChild(new Option(r(p.noQdrantCollectionsFound||"No Qdrant collections. Sync or create one."),""));let d=new Option("+ "+(p.createNewCollectionButton||"Create New Collection..."),"_create_new_qdrant_");n.appendChild(d);let u=null;a&&a!=="_create_new_qdrant_"&&n.querySelector(`option[value="${CSS.escape(a)}"]`)?u=a:s&&n.querySelector(`option[value="${CSS.escape(s)}"]`)&&(u=s),u?n.value=u:n.options.length>1&&n.options[0].value===""?n.selectedIndex=0:n.options.length>0&&(n.selectedIndex=n.options[0].value===""?0:n.options.length>1?1:0),n.disabled=!(l&&l.length>0&&n.options.length>1),n.style.minWidth="",n.style.width=""}async function e(t=null,n=!1){let s=window.aipkit_qdrant_vs_refs||{},a="aipkit_knowledge_base_global_status";if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function")return console.error("List Qdrant Collections: Missing required UI or API helper functions."),Promise.reject(new Error("Dependencies missing."));if(n&&window.aipkit_qdrant_vs_config?.initialCollections&&window.aipkit_qdrant_vs_config.initialCollections.length>0){s.syncedCollections=window.aipkit_qdrant_vs_config.initialCollections,i(s.syncedCollections);let c=document.getElementById("aipkit_vs_global_target_select"),l=localStorage.getItem(o),d=c?c.value:null;return!d&&l&&c&&c.querySelector(`option[value="${CSS.escape(l)}"]`)&&(c.value=l,d=l),d&&typeof window.aipkit_fetchAndShowQdrantCollectionDetails=="function"&&window.aipkit_fetchAndShowQdrantCollectionDetails(d),Promise.resolve()}t&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!0,"Sync Collections","Syncing..."),window.aipkit_showOpenAIVectorStatus("Syncing Qdrant collections...","info",a);try{let c=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!c||!c.value)throw new Error("Qdrant management nonce not found for listing collections.");let l=await window.aipkit_apiRequest("aipkit_list_collections_qdrant",{_ajax_nonce:c.value});s.syncedCollections=l.collections||[],window.aipkit_qdrant_vs_refs.syncedCollections=s.syncedCollections,i(s.syncedCollections),window.aipkit_showOpenAIVectorStatus(l.message||"Qdrant collections synced.","success",a)}catch(c){console.error("List Qdrant Collections Error:",c),window.aipkit_showOpenAIVectorStatus(`Error: ${c.message||"Failed to sync Qdrant collections."}`,"error",a)}finally{if(t&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!1,"Sync Collections"),typeof window.aipkit_apiRequest=="function"&&typeof window.aipkit_applyRefreshToKbViews=="function")try{let c=await window.aipkit_apiRequest("aipkit_refresh_knowledge_base_cards",{});await window.aipkit_applyRefreshToKbViews(c)}catch{}}}window.aipkit_populateGlobalQdrantTargetSelect=i,window.aipkit_listQdrantCollections=e})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{};function r(){let e=window.aipkit_qdrant_vs_refs;if(!e.createFormWrapperGlobal||!e.newCollectionNameInputGlobal||!e.newCollectionVectorSizeInputGlobal){console.error("Show Global Qdrant Create Form: Missing essential global form elements.");return}e.newCollectionNameInputGlobal.value="",e.newCollectionVectorSizeInputGlobal.value="1536",e.createCollectionStatusDivGlobal&&(e.createCollectionStatusDivGlobal.innerHTML=""),typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("create_form_global"),e.newCollectionNameInputGlobal.focus()}function o(){typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")}async function i(e=!0){let t=window.aipkit_qdrant_vs_refs,n=e?t.newCollectionNameInputGlobal:null,s=e?t.newCollectionVectorSizeInputGlobal:null,a=e?t.createCollectionSubmitButtonGlobal:null;if(!a||!n||!s){console.error("Create Qdrant Collection: Missing required form elements for ",e?"global form.":"panel form (deprecated).");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showQdrantStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Create Qdrant Collection: Missing core UI/API helper functions.");return}let c=n.value.trim(),l=parseInt(s.value,10);if(!c){window.aipkit_showQdrantStatus("Collection name is required.","error",e);return}if(!l||l<=0){window.aipkit_showQdrantStatus("Valid vector size (dimension) is required.","error",e);return}window.aipkit_setLoadingStateOpenAI(a,!0,p.createCollectionButton||"Create Collection",p.creatingCollection||"Creating..."),window.aipkit_showQdrantStatus(p.creatingCollection||"Creating collection...","info",e);try{let d=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!d||!d.value)throw new Error("Qdrant management nonce not found for create.");let u={_ajax_nonce:d.value,name:c,dimension:l,metric:"Cosine"},f=await window.aipkit_apiRequest("aipkit_create_collection_qdrant",u);if(window.aipkit_showQdrantStatus(f.message||"Collection created successfully!","success",e),e&&o(),typeof window.aipkit_listQdrantCollections=="function"&&await window.aipkit_listQdrantCollections(null,!1),typeof window.aipkit_apiRequest=="function"&&typeof window.aipkit_applyRefreshToKbViews=="function")try{let m=await window.aipkit_apiRequest("aipkit_refresh_knowledge_base_cards",{});await window.aipkit_applyRefreshToKbViews(m)}catch(m){console.debug("Qdrant Create: KB views refresh skipped/failed.",m?.message||m)}typeof window.updateKbViewToggleVisibility=="function"&&window.updateKbViewToggleVisibility();let _=document.getElementById("aipkit_vs_global_target_select");_&&Array.from(_.options).some(g=>g.value===c)?(_.value=c,_.dispatchEvent(new Event("change"))):typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")}catch(d){window.aipkit_showQdrantStatus(`Error: ${d.message||"Failed to create collection."}`,"error",e)}finally{window.aipkit_setLoadingStateOpenAI(a,!1,p.createCollectionButton||"Create Collection")}}window.aipkit_showCreateQdrantCollectionFormGlobal=r,window.aipkit_hideCreateQdrantCollectionFormGlobal=o,window.aipkit_handleCreateQdrantCollection=i})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};async function o(i,e){let t=window.aipkit_qdrant_vs_refs,n="aipkit_knowledge_base_global_status";if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Delete Qdrant Collection: Missing required UI or API helper functions."),e&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!1,"Delete Collection");return}window.aipkit_showOpenAIVectorStatus(`Deleting Qdrant collection "${r(i)}"...`,"info",n),e&&window.aipkit_setLoadingStateOpenAI(e,!0,"Delete Collection","Deleting...");try{let s=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!s||!s.value)throw new Error("Qdrant management nonce not found for delete.");let a=await window.aipkit_apiRequest("aipkit_delete_collection_qdrant",{_ajax_nonce:s.value,collection_name:i});window.aipkit_showOpenAIVectorStatus(a.message||`Collection "${r(i)}" deleted.`,"success",n);let c=document.querySelector(`.aipkit_vector_store_list_item[data-provider="Qdrant"][data-id="${i}"]`);c&&c.remove();let l=document.querySelector(".aipkit_vector_store_list_container"),d=l?.querySelector(".aipkit_vector_store_list_table tbody");if(l&&d&&d.children.length===0&&(l.innerHTML=`<p class="aipkit_text-center" style="padding: 15px;">${r(p.noKnowledgeBasesFound||'No knowledge bases found. Click "Add Content" to create one.')}</p>`),typeof window.aipkit_listQdrantCollections=="function"&&await window.aipkit_listQdrantCollections(null,!1),typeof window.aipkit_apiRequest=="function"&&typeof window.aipkit_applyRefreshToKbViews=="function")try{let _=await window.aipkit_apiRequest("aipkit_refresh_knowledge_base_cards",{});await window.aipkit_applyRefreshToKbViews(_)}catch(_){console.debug("Qdrant Delete: KB views refresh skipped/failed.",_?.message||_)}let f=(typeof window.localStorage<"u"?localStorage.getItem("aipkit_kb_view_style"):null)==="list"?"list":"cards";typeof window.aipkit_switchKbView=="function"&&window.aipkit_switchKbView(f),typeof window.aipkit_resyncAllProviders=="function"&&window.aipkit_resyncAllProviders()}catch(s){console.error(`Delete Qdrant Collection Error for "${r(i)}":`,s),window.aipkit_showOpenAIVectorStatus(`Error deleting collection: ${r(s.message)||"Unknown error."}`,"error",n)}finally{e&&window.aipkit_setLoadingStateOpenAI(e,!1,"Delete Collection")}}window.aipkit_deleteQdrantCollection=o})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(e){return e};async function o(e){let t=window.aipkit_qdrant_vs_refs;if(!t.manageCollectionPanel||!t.collectionLogsContainer){console.error("Qdrant Details: Missing one or more UI elements in refs for showing collection details."),typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder");return}t.manageCollectionPanel.dataset.activeCollectionName=e,window.aipkit_showQdrantSection("manage_panel"),i(e,1)}async function i(e,t=1){let n=window.aipkit_qdrant_vs_refs;if(!n.collectionLogsContainer)return;let s=document.getElementById("aipkit_qdrant_logs_pagination");if(!s){console.error("Fetch Qdrant Logs: Pagination container not found.");return}n.collectionLogsContainer.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${r(p.loading_logs||"Loading records...")}</p>`,s.innerHTML="";try{let a=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!a||!a.value)throw new Error("Nonce for Qdrant logs not found.");let c=await window.aipkit_apiRequest("aipkit_get_vector_data_source_logs_for_store",{_ajax_nonce:a.value,provider:"Qdrant",store_id:e,page:t}),l=c.logs||[];if(l.length===0){n.collectionLogsContainer.innerHTML=`<p class="aipkit_text-center">${r(p.noLogsForStore||"No records found for this collection.")}</p>`;return}let d=_=>{if(!_)return"Uploaded file";let m=null,g=null,k=_.match(/\(\s*chunk\s+(\d+)\/(\d+)\s*\)/i);k&&(m=parseInt(k[2],10));let w=_.match(/for\s+(.+)$/i);return w&&(g=w[1].trim()),`Uploaded ${g||"file"}${m?` (${m} chunks)`:""}`},u='<div class="aipkit_data-table aipkit_index_logs_table"><table>';u+='<thead><tr><th>Time</th><th>Point ID</th><th style="white-space: nowrap;">Status</th><th style="white-space: nowrap;">Type</th><th>Message</th><th>Embedding</th><th>Source</th><th class="aipkit_actions_cell_header">Actions</th></tr></thead><tbody>';let f=new Set;if(l.forEach(_=>{let g=`<span class="aipkit_status-tag ${_.status==="indexed"||_.status==="skipped_already_indexed"?"aipkit_status-success":_.status==="failed"?"aipkit_status-warning":"aipkit_status-info"}" style="white-space: nowrap;">${r(_.status)}</span>`,k=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(_.message||"",_.file_id||"","qdrant",_):"N/A",w=!!_.batch_id&&k==="File Upload";if(w){if(f.has(_.batch_id))return;f.add(_.batch_id)}let h=k==="Text"?"aipkit_type-text":k==="File Upload"?"aipkit_type-file":k==="Site Content"?"aipkit_type-site":"aipkit_type-na",y="";w?y=r(d(_.message||"")):y=_.message?_.message.length>50?r(_.message.substring(0,50))+"...":r(_.message):"";let b=_.status==="success",v=`<span class="aipkit_content-type-tag ${h}">${r(k)}</span>`;b&&(v+=' <span class="dashicons dashicons-admin-users aipkit_user_upload_icon" title="User uploaded record"></span>');let S=_.file_id?_.file_id.length>10?_.file_id.substring(0,10)+"...":_.file_id:"N/A",C=_.indexed_content||"",T="";(C||w)&&(T=`<button type="button" class="button button-secondary button-small aipkit_view_snippet_icon"
                  data-file-id="${r(_.id)}" 
                  data-snippet="${r(C)}" 
                  ${w?`data-batch-id="${r(_.batch_id)}" data-store-id="${r(e)}"`:""}
                  title="${r("View")}">
                  ${r("View")}
                </button>`);let E="";k==="Site Content"&&_.post_id&&(E=`<button type="button" class="button button-primary button-small aipkit-reindex-vector-log-btn"
                                            data-provider="Qdrant"
                                            data-store-id="${r(e)}"
                                            data-vector-id="${r(_.file_id)}"
                                            data-log-id="${r(_.id||"")}"
                                            data-post-id="${r(_.post_id)}"
                                            data-embedding-provider="${r(_.embedding_provider)}"
                                            data-embedding-model="${r(_.embedding_model)}"
                                            title="${r("Re-index this post. This will delete the current entry and index the latest content.")}">
                                        ${r("Re-index")}
                                 </button>`);let M="";_.file_id&&(M=`<button type="button" class="button button-link-delete button-small aipkit-delete-vector-log-btn" 
                                                   data-provider="Qdrant" 
                                                   data-store-id="${r(e)}" 
                                                   data-vector-id="${r(_.file_id)}"
                                                   data-log-id="${r(_.id||"")}"
                                                   title="${r("Delete this record from Qdrant and local logs")}">
                                                   ${r("Delete")}
                                            </button>`);let x=typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(_.timestamp):_.timestamp||"N/A",L=`${r(_.embedding_provider||"N/A")} / ${r(_.embedding_model||"N/A")}`,A=_.post_id?`Post ID: ${_.post_id}`:_.file_id&&C?C.length>50?C.substring(0,50)+"...":C:_.file_id?"Text/File Upload":"N/A",I=A.length>30?A.substring(0,30)+"...":A;u+=`<tr data-log-id="${r(_.id||"")}">
                    <td style="white-space: nowrap;">${r(x)}</td>
                    <td class="aipkit-code-snippet aipkit-code-snippet-cell" style="white-space: nowrap;" title="${r(_.file_id||"N/A")}">${r(S)}</td>
                    <td style="white-space: nowrap;">${g}</td>
                    <td style="white-space: nowrap;">${v}</td>
                    <td title="${r(_.message||"")}">${y}</td>
                    <td style="white-space: nowrap;">${L}</td>
                    <td title="${r(A)}">${r(I)}</td>
                    <td class="aipkit_actions_cell">
                        <div class="aipkit-table-actions-group">
                           ${E}
                           ${T}
                           ${M}
                        </div>
                    </td>
                </tr>`}),u+="</tbody></table></div>",n.collectionLogsContainer.innerHTML=u,typeof window.aipkit_attachSnippetModalListeners=="function"){let _=n.collectionLogsContainer.querySelector("table");_&&window.aipkit_attachSnippetModalListeners(_,"Qdrant")}typeof window.aipkit_renderLogsPagination=="function"&&c.pagination&&window.aipkit_renderLogsPagination(c.pagination,s,_=>i(e,_))}catch(a){console.error("Fetch Qdrant Logs Error:",a),n.collectionLogsContainer.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">Error loading logs: ${r(a.message||"Unknown error")}</p>`}}window.aipkit_fetchAndShowQdrantCollectionDetails=o,window.aipkit_fetchAndRenderQdrantIndexingLogs=i})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};function r(o,i){let e=window.aipkit_qdrant_vs_refs;if(!e.searchFormWrapper||!e.searchCollectionIdInput||!e.searchResultsArea||!e.searchQueryTextInput||!e.searchFilterInput){console.error("Qdrant Search (Show Form): Missing required search form elements in refs."),typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder");return}let t=e.searchStatusDiv,n=document.getElementById("aipkit_search_qdrant_collection_btn"),s=document.getElementById("aipkit_search_top_k_qdrant");e.searchCollectionIdInput.value=o,e.searchFormTitle&&(e.searchFormTitle.textContent=`Search in Collection: ${p(i)}`),e.searchQueryTextInput.value="",e.searchFilterInput.value="",e.searchResultsArea.innerHTML="",t&&(t.className="aipkit_search_form_status",t.innerHTML=""),n&&(n.classList.remove("loading"),n.disabled=!1),s&&!s.value&&(s.value="5"),typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("search_form");let a=document.getElementById("aipkit_qdrant_search_embedding_model_select");a&&typeof window.aipkit_populateEmbeddingModelSelectElement=="function"&&window.aipkit_populateEmbeddingModelSelectElement(a),setTimeout(()=>{e.searchQueryTextInput&&e.searchQueryTextInput.focus()},100)}window.aipkit_showSearchFormForQdrantCollection=r})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(i){return i};async function o(){let i=window.aipkit_qdrant_vs_refs;if(!i.searchSubmitButton||!i.searchCollectionIdInput||!i.searchQueryTextInput||!i.searchTopKInput||!i.searchResultsArea||!i.searchFilterInput||!i.searchStatusDiv){console.error("Qdrant Search (Perform): Missing search form submit or input elements in refs for search action.");return}if(typeof window.aipkit_setSearchButtonLoading!="function"||typeof window.aipkit_showSearchStatus!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderSearchResults!="function"){console.error("Qdrant Search (Perform): Missing essential UI/API helper functions from search-results-renderer.js.");return}let e=i.searchCollectionIdInput.value,t=i.searchQueryTextInput.value.trim(),n=parseInt(i.searchTopKInput.value,10)||3,s=i.searchFilterInput.value.trim(),a=document.getElementById("aipkit_qdrant_search_embedding_model_select"),c=a?a.value:"",l=a&&a.options[a.selectedIndex]?.dataset.provider||"openai";if(!e){window.aipkit_showSearchStatus("Collection ID missing.","error",i.searchStatusDiv);return}if(!t){window.aipkit_showSearchStatus("Search query empty.","error",i.searchStatusDiv);return}if(!c){window.aipkit_showSearchStatus("Please select an embedding model.","error",i.searchStatusDiv);return}let d=null;if(s)try{d=JSON.parse(s)}catch{window.aipkit_showSearchStatus("Invalid JSON in filter.","error",i.searchStatusDiv);return}window.aipkit_setSearchButtonLoading(i.searchSubmitButton,!0),window.aipkit_showSearchStatus("Searching...","info",i.searchStatusDiv),i.searchResultsArea.innerHTML='<div class="aipkit_search_empty_state"><div class="aipkit_search_empty_state_icon"><span class="aipkit_spinner"></span></div></div>';let u={_ajax_nonce:document.getElementById("aipkit_vector_store_qdrant_nonce_management").value,collection_id:e,query_text:t,embedding_provider:l,embedding_model:c,top_k:n,...d&&{filter:JSON.stringify(d)}};try{let f=await window.aipkit_apiRequest("aipkit_search_qdrant_collection",u);if(f.results&&Array.isArray(f.results)){window.aipkit_renderSearchResults(f.results,i.searchResultsArea,"qdrant");let _=f.results.length>0?`Found ${f.results.length} result${f.results.length!==1?"s":""}.`:"No results found for your query.";window.aipkit_showSearchStatus(_,"success",i.searchStatusDiv)}else throw new Error("Invalid response structure from server.")}catch(f){window.aipkit_showSearchStatus(`Search Error: ${f.message||"Unknown error"}`,"error",i.searchStatusDiv),i.searchResultsArea.innerHTML=""}finally{window.aipkit_setSearchButtonLoading(i.searchSubmitButton,!1)}}window.aipkit_searchQdrantCollection=o})();(function(){"use strict";window.aipkit_qdrant_vs_refs=window.aipkit_qdrant_vs_refs||{},window.aipkit_qdrant_vs_refs.syncedCollections=window.aipkit_qdrant_vs_config?.initialCollections||[];function p(){let r=document.getElementById("aipkit_vector_qdrant_management_ui");if(!r){console.warn("Qdrant Init: Qdrant management block (#aipkit_vector_qdrant_management_ui) not found.");return}let o=window.aipkit_qdrant_vs_refs;o.syncedCollections=window.aipkit_qdrant_vs_config?.initialCollections||[],o.urlIsSet=window.aipkit_qdrant_vs_config?.urlIsSet||!1,o.apiKeyIsSet=window.aipkit_qdrant_vs_config?.apiKeyIsSet||!1,o.managementBlock=r,o.rightColumnPlaceholder=r.querySelector("#aipkit_qdrant_vs_right_col_placeholder"),o.manageCollectionPanel=r.querySelector("#aipkit_manage_selected_qdrant_collection_panel"),o.manageCollectionPanel&&(o.panelTitle=o.manageCollectionPanel.querySelector("#aipkit_manage_qdrant_collection_panel_title"),o.panelStatusDiv=o.manageCollectionPanel.querySelector("#aipkit_manage_qdrant_collection_panel_status"),o.collectionLogsContainer=o.manageCollectionPanel.querySelector("#aipkit_qdrant_collection_logs_container")),o.searchFormWrapper=r.querySelector("#aipkit_search_qdrant_collection_form_wrapper"),o.searchFormWrapper&&(o.searchFormTitle=o.searchFormWrapper.querySelector("#aipkit_search_qdrant_collection_form_title"),o.searchCollectionIdInput=o.searchFormWrapper.querySelector("#aipkit_search_qdrant_collection_id"),o.searchQueryTextInput=o.searchFormWrapper.querySelector("#aipkit_search_query_text_qdrant"),o.searchTopKInput=o.searchFormWrapper.querySelector("#aipkit_search_top_k_qdrant"),o.searchFilterInput=o.searchFormWrapper.querySelector("#aipkit_search_filter_qdrant"),o.searchSubmitButton=o.searchFormWrapper.querySelector("#aipkit_search_qdrant_collection_btn"),o.searchCloseButton=o.searchFormWrapper.querySelector("#aipkit_close_search_qdrant_panel_btn"),o.searchResultsArea=o.searchFormWrapper.querySelector("#aipkit_search_qdrant_results_area"),o.searchStatusDiv=o.searchFormWrapper.querySelector("#aipkit_search_qdrant_collection_form_status")),o.createFormWrapperGlobal=null,o.newCollectionNameInputGlobal=document.getElementById("aipkit_vs_global_new_target_name"),o.newCollectionVectorSizeInputGlobal=document.getElementById("aipkit_vs_global_new_target_dimension"),o.createCollectionSubmitButtonGlobal=document.getElementById("aipkit_vs_global_create_new_target_btn"),o.createCollectionCloseButtonGlobal=document.getElementById("aipkit_vs_global_cancel_add_content_btn"),o.createCollectionStatusDivGlobal=document.getElementById("aipkit_knowledge_base_global_status"),typeof window.aipkit_showQdrantSection=="function"?window.aipkit_showQdrantSection("placeholder"):console.error("Qdrant Init: showQdrantSection function not found.");let i="data-qdrant-ui-listener-attached";r.getAttribute(i)||(r.addEventListener("click",function(e){let t=e.target.closest("button");if(!t)return;let n=e.target.closest(".aipkit-reindex-vector-log-btn");if(t.id==="aipkit_search_qdrant_collection_btn"&&o.searchSubmitButton&&typeof window.aipkit_searchQdrantCollection=="function")window.aipkit_searchQdrantCollection();else if(t.id==="aipkit_close_search_qdrant_panel_btn"&&o.searchCloseButton){let s=o.searchCollectionIdInput?.value;s&&o.syncedCollections?.find(a=>a.name===s)&&typeof window.aipkit_fetchAndShowQdrantCollectionDetails=="function"?window.aipkit_fetchAndShowQdrantCollectionDetails(s):typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")}else t.classList.contains("aipkit-delete-vector-log-btn")?typeof window.aipkit_handleDeleteVectorLogEntryClick=="function"&&window.aipkit_handleDeleteVectorLogEntryClick(e):n&&typeof window.aipkit_handleReindexVectorLogEntryClick=="function"&&window.aipkit_handleReindexVectorLogEntryClick(e)}),r.setAttribute(i,"true"))}window.aipkit_initQdrantVectorStoreUI=p})();(function(){"use strict";let p="aipkit_last_openai_vs_id",r="aipkit_last_pinecone_index_id",o="aipkit_last_qdrant_collection_id";function i(e){let t=e.target,n=t.value,s=typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():"openai";if(n&&n.startsWith("_create_new_")){typeof window.aipkit_openCreateKbModal=="function"&&window.aipkit_openCreateKbModal(s);let d={openai:"aipkit_last_openai_vs_id",pinecone:"aipkit_last_pinecone_index_id",qdrant:"aipkit_last_qdrant_collection_id"}[s],u=d?localStorage.getItem(d):null;u&&t.querySelector(`option[value="${CSS.escape(u)}"]`)?t.value=u:t.selectedIndex=0;return}let a=document.getElementById("aipkit_vs_global_provider_status");if(a&&!a.querySelector(".aipkit_text-danger")&&(typeof window.aipkit_showOpenAIVectorStatus=="function"?window.aipkit_showOpenAIVectorStatus("","info","aipkit_vs_global_provider_status"):a&&(a.textContent="")),s==="openai")if(n&&n!=="_create_new_openai_"?localStorage.setItem(p,n):n!=="_create_new_openai_"&&localStorage.removeItem(p),n&&n!=="_create_new_openai_"&&typeof window.aipkit_showStoreFilesPanel=="function"){let l=window.aipkit_openai_fetched_stores_data?window.aipkit_openai_fetched_stores_data[n]:null,d=l?.name||n;window.aipkit_showStoreFilesPanel(n,d,l)}else n!=="_create_new_openai_"&&typeof window.aipkit_showRightColumnSection=="function"&&window.aipkit_openai_vs_refs?.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(window.aipkit_openai_vs_refs.rightColumnPlaceholder.id);else if(s==="pinecone")if(n&&n!=="_create_new_pinecone_"?localStorage.setItem(r,n):n!=="_create_new_pinecone_"&&localStorage.removeItem(r),n&&n!=="_create_new_pinecone_"&&typeof window.aipkit_showPineconeIndexDetails=="function"){let l=window.aipkit_pinecone_vs_refs?.syncedIndexes?.find(d=>d.name===n);window.aipkit_showPineconeIndexDetails(n,l)}else n!=="_create_new_pinecone_"&&typeof window.aipkit_ui_showSection=="function"&&window.aipkit_pinecone_vs_refs?.rightColumnPlaceholder&&window.aipkit_ui_showSection("placeholder",["placeholder","manageIndexPanel","searchFormWrapper"],window.aipkit_pinecone_vs_refs);else s==="qdrant"?(n&&n!=="_create_new_qdrant_"?localStorage.setItem(o,n):n!=="_create_new_qdrant_"&&localStorage.removeItem(o),n&&n!=="_create_new_qdrant_"&&typeof window.aipkit_fetchAndShowQdrantCollectionDetails=="function"?window.aipkit_fetchAndShowQdrantCollectionDetails(n):n!=="_create_new_qdrant_"&&typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")):typeof window.aipkit_showRightColumnSection=="function"&&window.aipkit_openai_vs_refs?.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(window.aipkit_openai_vs_refs.rightColumnPlaceholder.id);let c=document.getElementById("aipkit_vs_global_data_source");if(c&&c.value==="wordpress_content"&&n&&!n.startsWith("_create_new_")&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&typeof window.aipkit_getWPCurrentPageForTraining=="function"){let l=window.aipkit_getWPCurrentPageForTraining();window.aipkit_fetchWordPressContentForTraining(l)}}window.aipkit_handleGlobalTargetSelectChange=i})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_vs_global_target_select");r?typeof window.aipkit_handleGlobalTargetSelectChange=="function"?r.addEventListener("change",window.aipkit_handleGlobalTargetSelectChange):console.error("AIPKit Global Target Handler Init: aipkit_handleGlobalTargetSelectChange function not found."):console.warn("AIPKit Global Target Handler Init: Global target select element (#aipkit_vs_global_target_select) not found.")}window.aipkit_initGlobalTargetHandler=p})();(function(){"use strict";function p(r){let o=r.target.value;if(typeof window.aipkit_ui_showSection!="function"){console.error("AIPKit Handle Source Change: aipkit_ui_showSection utility function not found.");return}let i=["aipkit_vs_global_text_entry","aipkit_vs_global_file_upload","aipkit_vs_global_wp_content_selector"],e="";o==="text_entry"?e="aipkit_vs_global_text_entry":o==="file_upload"?e="aipkit_vs_global_file_upload":o==="wordpress_content"&&(e="aipkit_vs_global_wp_content_selector"),window.aipkit_ui_showSection(e,i,"block");let t=document.getElementById("aipkit_vs_global_stop_indexing_btn");if(t)if(o==="wordpress_content"){t.style.display="none",t.disabled=!1;let u=window.aipkit_dashboard?.text||{};t.textContent=u.stopButton||"Stop"}else{t.style.display="none",t.disabled=!1;let u=window.aipkit_dashboard?.text||{};t.textContent=u.stopButton||"Stop"}let n=document.getElementById("aipkit_vs_global_submit_upload_limits_info"),s=document.getElementById("aipkit_vs_wp_content_messages_area"),a=document.getElementById("aipkit_vs_global_file_upload"),c=document.getElementById("aipkit_vs_global_file_to_submit"),l=document.getElementById("aipkit_vs_global_submit_data_btn"),d=document.getElementById("aipkit_vs_global_upgrade_to_pro_btn");if(o==="file_upload"){let u=window.aipkit_dashboard?.isProPlan===!0||window.aipkit_dashboard?.isProPlan==="1"||window.aipkit_dashboard?.isProPlan===1;l&&(l.style.display=u?"inline-flex":"none"),d&&(d.style.display=u?"none":"inline-flex"),a&&(a.style.display="block"),u?(c&&(c.disabled=!1),typeof window.aipkit_displayUploadLimits=="function"&&window.aipkit_displayUploadLimits("aipkit_vs_global_submit_upload_limits_info","aipkit_vs_global_provider_status"),c&&!c.dataset.limitBound&&(c.addEventListener("change",()=>{document.getElementById("aipkit_vs_global_provider_select")?.value==="openai"&&typeof window.aipkit_displayUploadLimits=="function"&&window.aipkit_displayUploadLimits("aipkit_vs_global_submit_upload_limits_info","aipkit_vs_global_provider_status")}),c.dataset.limitBound="1"),l&&(l.disabled=!1)):(c&&(c.disabled=!1),n&&(n.style.display="none"),l&&(l.disabled=!0)),typeof window.aipkit_initUploadDragDrop=="function"&&window.aipkit_initUploadDragDrop()}else l&&(l.style.display="inline-flex"),d&&(d.style.display="none"),n&&(n.style.display="none"),c&&(c.disabled=!1),l&&(l.disabled=!1);if(l&&l.style.display!=="none"&&!l.dataset.listenerAttached&&typeof window.aipkit_handleGlobalSubmitDataToStore=="function"&&(l.addEventListener("click",window.aipkit_handleGlobalSubmitDataToStore),l.dataset.listenerAttached="true"),o==="wordpress_content"&&typeof window.aipkit_fetchWordPressContentForTraining=="function"){let u=document.getElementById("aipkit_vs_global_wp_content_selector");u&&u.style.display==="block"&&window.aipkit_fetchWordPressContentForTraining(1)}else if(o!=="wordpress_content"){let u=document.getElementById("aipkit_vs_wp_content_list_area"),f=document.getElementById("aipkit_vs_wp_content_pagination"),_=window.aipkit_dashboard?.text||{},m=window.aipkit_escapeHtml||function(g){return g};u&&(u.innerHTML=`<p class="aipkit_text-center aipkit_text-secondary">${m(_.selectWPCriteria||'Select criteria and click "Load Content".')}</p>`),f&&(f.innerHTML=""),s&&(s.innerHTML="")}}window.aipkit_handleGlobalDataSourceChange=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_vs_global_data_source");r?typeof window.aipkit_handleGlobalDataSourceChange=="function"?(window.aipkit_handleGlobalDataSourceChange({target:r}),r.addEventListener("change",window.aipkit_handleGlobalDataSourceChange)):console.error("AIPKit Global Data Source Init: aipkit_handleGlobalDataSourceChange function not found."):console.warn("AIPKit Global Data Source Init: Global data source select element (#aipkit_vs_global_data_source) not found.")}window.aipkit_initGlobalDataSourceSwitcher=p})();(function(){"use strict";let p="aipkit_last_embedding_model",r=window.aipkit_escapeHtml||function(e){return e};function o(){let e=document.getElementById("aipkit_vs_global_embedding_model_select");if(!e)return;let t=e.value;e.innerHTML=`<option value="">${r("-- Select Embedding Model --")}</option>`;let n=window.aipkit_openai_vs_config||{},s=[{providerKey:"openai",label:"OpenAI",models:n.openaiEmbeddingModels||[]},{providerKey:"google",label:"Google",models:n.googleEmbeddingModels||[]},{providerKey:"azure",label:"Azure",models:n.azureEmbeddingModels||[]}],a=0;s.forEach(d=>{if(d.models&&Array.isArray(d.models)&&d.models.length>0){a+=d.models.length;let u=document.createElement("optgroup");u.label=d.label,d.models.forEach(f=>{if(f&&f.id){let _=new Option(r(f.name||f.id),f.id);_.dataset.provider=d.providerKey,u.appendChild(_)}}),e.appendChild(u)}});let c=null,l=typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():"openai";if(l==="pinecone"||l==="qdrant"){let d=localStorage.getItem(p);d&&e.querySelector(`option[value="${CSS.escape(d)}"]`)&&(c=d)}if(!c&&t&&e.querySelector(`option[value="${CSS.escape(t)}"]`)&&(c=t),c)e.value=c;else{let d="text-embedding-ada-002";if(e.querySelector(`option[value="${d}"]`))e.value=d;else if(e.options.length>1&&e.options[0].value==="")e.selectedIndex=0;else if(e.options.length>0){let f=e.querySelector("optgroup");if(f){let _=f.querySelector("option");_&&_.value&&(e.value=_.value)}else e.options.length>0&&e.options[0].value&&(e.selectedIndex=0)}}e.disabled=!(a>0),a===0&&e.appendChild(new Option(r("(No embedding models found - Sync in AI Settings)"),""))}function i(e){if(!e)return;let t=window.aipkit_openai_vs_config||{},n=[{providerKey:"openai",label:"OpenAI",models:t.openaiEmbeddingModels||[]},{providerKey:"google",label:"Google",models:t.googleEmbeddingModels||[]},{providerKey:"azure",label:"Azure",models:t.azureEmbeddingModels||[]}];e.innerHTML=`<option value="">${r("-- Select Embedding Model --")}</option>`;let s=0;if(n.forEach(a=>{if(a.models&&Array.isArray(a.models)&&a.models.length>0){s+=a.models.length;let c=document.createElement("optgroup");c.label=a.label,a.models.forEach(l=>{if(l&&l.id){let d=new Option(r(l.name||l.id),l.id);d.dataset.provider=a.providerKey,c.appendChild(d)}}),e.appendChild(c)}}),e.disabled=s===0,s===0)e.appendChild(new Option(r("(No embedding models found - Sync in AI Settings)"),""));else{let a="text-embedding-ada-002";if(e.querySelector(`option[value="${a}"]`))e.value=a;else{let l=e.querySelector("optgroup");if(l){let d=l.querySelector("option");d&&(e.value=d.value)}}}}window.aipkit_populateGlobalEmbeddingModelSelect=o,window.aipkit_populateEmbeddingModelSelectElement=i})();(function(){"use strict";let p="aipkit_last_embedding_model";function r(){let o=document.getElementById("aipkit_vs_global_embedding_model_select");o?typeof window.aipkit_populateGlobalEmbeddingModelSelect=="function"?(window.aipkit_populateGlobalEmbeddingModelSelect(),o.addEventListener("change",i=>{let e=typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():null;(e==="pinecone"||e==="qdrant")&&localStorage.setItem(p,i.target.value)})):console.error("AIPKit Global Embedding Config Init: aipkit_populateGlobalEmbeddingModelSelect function not found."):console.warn("AIPKit Global Embedding Config Init: Embedding model select element (#aipkit_vs_global_embedding_model_select) not found.")}window.aipkit_initGlobalEmbeddingConfig=r})();(function(){"use strict";let p=1;function r(i){p=parseInt(i,10)||1}function o(){return p}window.aipkit_setWPCurrentPageForTraining=r,window.aipkit_getWPCurrentPageForTraining=o})();(function(){"use strict";function p(r,o){let i=document.getElementById("aipkit_vs_wp_content_list_area"),e=document.getElementById("aipkit_vs_wp_content_pagination"),t=window.aipkit_escapeHtml||function(a){return a};if(!i||!e){console.error("Render WP List: Missing list or pagination area elements.");return}if(typeof window.aipkit_fetchWordPressContentForTraining!="function"&&console.error("Render WP List: aipkit_fetchWordPressContentForTraining function not found for pagination."),!r||r.length===0){i.innerHTML=`<p class="aipkit_text-center aipkit_text-secondary">${window.aipkit_dashboard?.text?.noWPCPostsFound||"No posts found matching your criteria."}</p>`,e.innerHTML="";return}let n=`<div class="aipkit_wp_content_select_all_wrapper">
                            <label class="aipkit_checkbox-label">
                                <input type="checkbox" id="aipkit_vs_wp_content_select_all">
                                ${t("Select All on Page")}
                            </label>
                        </div><ul>`;if(r.forEach(a=>{let c=a.is_already_indexed?"aipkit_wp_content_indexed_status":"",l=a.is_already_indexed?"\u2713 Indexed":"",d="",u=a.edit_link?`<a href="${t(a.edit_link)}" target="_blank" class="aipkit_wp_content_title">${t(a.title)}</a>`:`<span class="aipkit_wp_content_title">${t(a.title)}</span>`;n+=`<li class="aipkit_wp_content_list_item">
                            <input type="checkbox" name="wp_content_to_index[]" value="${t(a.id)}" ${d}>
                            ${u}
                            <span class="aipkit_wp_content_type">${t(a.type_label)}</span>
                            ${l?`<span class="${c}">${t(l)}</span>`:""}
                         </li>`}),n+="</ul>",i.innerHTML=n,e.innerHTML="",o&&o.total_pages>1){let a=o.total_posts||0,c=parseInt(o.current_page,10),l=parseInt(o.total_pages,10),d=wp.i18n?.__||(w=>w),u=wp.i18n?._n||((w,h,y)=>y>1?h:w),f=document.createElement("span");f.className="aipkit_pagination-count",f.textContent=`${a.toLocaleString()} ${u("item","items",a)}`,e.appendChild(f);let _=document.createElement("span");_.className="aipkit_pagination-links";let m=document.createElement("button");m.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",m.innerHTML="\xAB "+d("Previous","gpt3-ai-content-generator"),m.disabled=c<=1,m.disabled||m.addEventListener("click",w=>{w.preventDefault(),window.aipkit_fetchWordPressContentForTraining(c-1)}),_.appendChild(m);let g=document.createElement("span");g.className="aipkit_pagination-current",g.textContent=`${d("Page","gpt3-ai-content-generator")} ${c} ${d("of","gpt3-ai-content-generator")} ${l}`,_.appendChild(g);let k=document.createElement("button");k.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",k.innerHTML=d("Next","gpt3-ai-content-generator")+" \xBB",k.disabled=c>=l,k.disabled||k.addEventListener("click",w=>{w.preventDefault(),window.aipkit_fetchWordPressContentForTraining(c+1)}),_.appendChild(k),e.appendChild(_)}let s=document.getElementById("aipkit_vs_wp_content_select_all");s&&s.addEventListener("change",function(){i.querySelectorAll('input[name="wp_content_to_index[]"]:not(:disabled)').forEach(a=>{a.checked=this.checked})})}window.aipkit_renderWordPressContentListForTraining=p})();(function(){"use strict";async function p(r=1){let o=document.getElementById("aipkit_vs_wp_content_list_area"),i=document.getElementById("aipkit_vs_wp_content_pagination"),e=document.getElementById("aipkit_vs_wp_content_messages_area"),t=document.getElementById("aipkit_vs_load_wp_content_btn"),n=document.getElementById("aipkit_vs_global_target_select"),s=n?n.value:"";if(typeof window.aipkit_setWPCurrentPageForTraining=="function"?window.aipkit_setWPCurrentPageForTraining(r):console.warn("aipkit_setWPCurrentPageForTraining not defined in wp-content-state.js"),!o||!i||!e||!t){console.error("Fetch WP Content: Missing required UI elements (list, pagination, status, or loadButton).");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderWordPressContentListForTraining!="function"){console.error("Fetch WP Content: Missing UI/API helper or render functions."),e&&(e.innerHTML='<p class="aipkit_text-danger">Error: Core UI functions missing.</p>');return}let a=document.getElementById("aipkit_vs_wp_content_mode")?.value||"bulk",c=document.getElementById(a==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types"),l=document.getElementById(a==="specific"?"aipkit_vs_wp_content_status_specific":"aipkit_vs_wp_content_status"),d=c?Array.from(c.selectedOptions).map(m=>m.value):[],u=l?l.value:"publish";if(d.length===0){e&&(e.innerHTML='<p class="aipkit_text-danger">Please select at least one post type.</p>');return}window.aipkit_setLoadingStateOpenAI(t,!0,"Load Content","Loading..."),o.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading content...</p>',i.innerHTML="",e&&(e.innerHTML="");let f=document.getElementById("aipkit_wp_content_fetch_nonce");if(!f||!f.value){e&&(e.innerHTML='<p class="aipkit_text-danger">Error: Security token missing.</p>'),window.aipkit_setLoadingStateOpenAI(t,!1,"Load Content");return}let _={_ajax_nonce:f.value,post_types:d,post_status:u,target_store_id:s,paged:r};try{let m=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",_);window.aipkit_renderWordPressContentListForTraining(m.posts,m.pagination)}catch(m){console.error("Fetch WP Content Error:",m),e&&(e.innerHTML=`<p class="aipkit_text-danger">Error loading content: ${m.message||"Unknown error"}</p>`),o&&(o.innerHTML='<p class="aipkit_text-center aipkit_text-danger">Failed to load content.</p>')}finally{window.aipkit_setLoadingStateOpenAI(t,!1,"Load Content")}}window.aipkit_fetchWordPressContentForTraining=p})();(function(){"use strict";function p(){let o=document.getElementById("aipkit_vs_wp_types_checkboxes"),i=document.getElementById("aipkit_vs_wp_content_post_types");if(!o||!i)return;let e=Array.from(o.querySelectorAll("input.aipkit_wp_type_cb:checked")).map(t=>t.value);Array.from(i.options).forEach(t=>{t.selected=e.includes(t.value)})}function r(){let o=document.getElementById("aipkit_wp_content_mode_bulk"),i=document.getElementById("aipkit_wp_content_mode_specific"),e=document.getElementById("aipkit_vs_wp_content_mode"),t=document.getElementById("aipkit_wp_content_bulk_panel"),n=document.getElementById("aipkit_wp_content_specific_panel"),s=document.getElementById("aipkit_vs_wp_content_list_area"),a=document.getElementById("aipkit_vs_wp_content_pagination"),c=document.getElementById("aipkit_vs_wp_content_messages_area"),l=document.getElementById("aipkit_vs_wp_types_checkboxes");if(!o||!i||!e||!t||!n)return;function d(u){e.value=u;let f=u==="bulk";if(t.style.display=f?"block":"none",n.style.display=f?"none":"block",f)s&&(s.innerHTML=""),a&&(a.innerHTML=""),c&&(c.innerHTML="");else{let _=document.getElementById("aipkit_vs_global_target_select");_&&_.value&&!_.value.startsWith("_create_new_")&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&window.aipkit_fetchWordPressContentForTraining(1)}}o.addEventListener("change",()=>{o.checked&&d("bulk")}),i.addEventListener("change",()=>{i.checked&&d("specific")}),l&&(l.addEventListener("change",p),p())}window.aipkit_initWpContentModeToggle=r})();(function(){"use strict";async function p(o){let i=document.getElementById("aipkit_wp_content_fetch_nonce"),e=document.getElementById("aipkit_vs_global_target_select"),t=document.getElementById("aipkit_vs_wp_content_status"),n=t?t.value:"publish",s=e?e.value:"";if(!i?.value)return null;try{let a=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:i.value,post_types:[o],post_status:n,target_store_id:s,paged:1}),c=parseInt(a?.pagination?.total_posts||0,10);return isNaN(c)?0:c}catch(a){return console.warn("Failed to fetch count for",o,a?.message||a),null}}async function r(){let o=document.getElementById("aipkit_vs_wp_types_checkboxes");if(!o)return;let i=Array.from(o.querySelectorAll("label[data-ptype]"));i.length&&await Promise.all(i.map(async e=>{let t=e.getAttribute("data-ptype"),n=e.querySelector(".aipkit_count_badge");if(!n||!t)return;n.textContent="\u2026";let s=await p(t);s===null?(n.textContent="",n.dataset.count="-1"):(n.textContent=String(s),n.dataset.count=String(s))}))}window.aipkit_updatePostTypeCounts=r})();(function(){"use strict";function p(r,o,i){return r==="text_entry"?{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:o,vector_id:i}:r==="wp_post"?{source:"wordpress_post",post_id:String(o),vector_id:i}:{}}window.aipkit_utils_extractEmbeddingMeta=p})();(function(){"use strict";function p(){let r=document.querySelectorAll('#aipkit_vs_wp_content_list_area input[name="wp_content_to_index[]"]:checked');return Array.from(r).map(o=>o.value)}window.aipkit_utils_getSelectedPostIds=p})();(function(){"use strict";async function p(){let r="aipkit_knowledge_base_global_status";if((document.getElementById("aipkit_vs_wp_content_mode")?.value||"bulk")!=="bulk")return[];let i=document.getElementById("aipkit_vs_wp_content_post_types"),e=document.getElementById("aipkit_vs_wp_content_status"),t=document.getElementById("aipkit_vs_global_target_select"),n=document.getElementById("aipkit_wp_content_fetch_nonce"),s=i?Array.from(i.selectedOptions).map(f=>f.value):[],a=e?e.value:"publish",c=t?t.value:"";if(!s.length)return[];if(!n?.value)throw new Error("Missing security token for content fetch.");let l=[],d=1,u=1;try{do{let f=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:n.value,post_types:s,post_status:a,target_store_id:c,paged:d}),_=f.posts||[];if(l.push(..._.map(m=>String(m.id))),u=parseInt(f.pagination?.total_pages||1,10),d++,typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(`Preparing... collected ${l.length} item(s) so far`,"info",r),window.aipkit_isIndexingStopped)break}while(d<=u)}catch(f){throw console.error("Bulk ID collection failed:",f),f}return l}window.aipkit_collectBulkPostIds=p})();(function(){"use strict";function p(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,r=>(r^crypto.getRandomValues(new Uint8Array(1))[0]&15>>r/4).toString(16))}window.aipkit_generateUUIDv4=p})();(function(){"use strict";function p(){let r=window.aipkit_dashboard?.text||{},o=document.getElementById("aipkit_vs_global_data_source")?.value,i=document.getElementById("aipkit_vs_global_provider_select")?.value,e=document.getElementById("aipkit_vs_global_target_select"),t=e?e.value:"",n=document.getElementById("aipkit_vs_global_new_target_name"),s=n?n.value.trim():"",a=null,c=null,l=[],d="",u=null,f=[];if(!i)return{isValid:!1,message:"Please select a Vector Provider.",values:null};if(!t)return{isValid:!1,message:"Please select a target Store/Index/Collection.",values:null};if(i==="openai"&&t.startsWith("_create_new_")&&!s)return{isValid:!1,message:"Please provide a name for the new OpenAI store.",values:null};if((i==="pinecone"||i==="qdrant")&&t.startsWith("_create_new_"))return{isValid:!1,message:"Please select an existing Index/Collection or create one using the footer Create button.",values:null};if(i==="pinecone"||i==="qdrant"){let _=document.getElementById("aipkit_vs_global_embedding_model_select");if(_&&_.value){let m=_.options[_.selectedIndex];c=m.value,a=m.dataset.provider||null}if(!a||!c)return{isValid:!1,message:"Please select an Embedding Model for this provider.",values:null}}if(o==="text_entry"){if(d=document.getElementById("aipkit_vs_global_text_content")?.value.trim()||"",!d)return{isValid:!1,message:"Text content cannot be empty.",values:null}}else if(o==="file_upload"){if(u=document.getElementById("aipkit_vs_global_file_to_submit"),!u?.files||u.files.length===0)return{isValid:!1,message:"Please select a file to upload.",values:null};f=Array.from(u.files||[])}else if(o==="wordpress_content")if((document.getElementById("aipkit_vs_wp_content_mode")?.value||"bulk")==="specific"){let m=document.querySelectorAll('#aipkit_vs_wp_content_list_area input[name="wp_content_to_index[]"]:checked');if(l=Array.from(m).map(g=>g.value),l.length===0)return{isValid:!1,message:"Please select WordPress content to index.",values:null}}else{let m=document.getElementById("aipkit_vs_wp_content_post_types");if(!(m?Array.from(m.selectedOptions).map(k=>k.value):[]).length)return{isValid:!1,message:"Please select at least one post type.",values:null}}else return{isValid:!1,message:"Invalid data source selected.",values:null};return{isValid:!0,message:null,values:{dataSource:o,vectorStoreProvider:i,targetStoreId:t,newStoreNameOpenAI:s,embeddingProvider:a,embeddingModel:c,textContent:d,fileInput:u,files:f,postIds:l,wpContentMode:document.getElementById("aipkit_vs_wp_content_mode")?.value||"bulk"}}}window.aipkit_validateGlobalFormState=p})();(function(){"use strict";function p(r,o){return(o==="pinecone"||o==="qdrant")&&(r==="text_entry"||r==="wordpress_content")?{isIterative:!0,type:o}:o==="openai"&&r==="wordpress_content"?{isIterative:!0,type:"openai"}:{isIterative:!1,type:null}}window.aipkit_determineIterationMode=p})();(function(){"use strict";function p(r,o){let i="";return r==="text_entry"?o==="openai"?i="aipkit_add_text_to_vector_store_openai":o==="pinecone"?i="aipkit_upsert_to_pinecone_index":o==="qdrant"&&(i="aipkit_upsert_to_qdrant_collection"):r==="file_upload"&&(o==="openai"?i="aipkit_upload_and_add_file_to_store_direct_openai":o==="pinecone"?i="aipkit_upload_file_and_upsert_to_pinecone":o==="qdrant"&&(i="aipkit_upload_file_and_upsert_to_qdrant")),i}window.aipkit_determineAjaxAction=p})();(function(){"use strict";function p(r){let{dataSource:o,vectorStoreProvider:i,targetStoreId:e,newStoreNameOpenAI:t,embeddingProvider:n,embeddingModel:s,textContent:a,fileInput:c,files:l,postIds:d}=r,u=new FormData,f={provider:i,source_type:o,...n&&{embedding_provider:n},...s&&{embedding_model:s}};i==="openai"?(f.target_store_id=e.startsWith("_create_new_")?"":e,f.new_store_name_openai=t):i==="pinecone"?f.index_name=e.startsWith("_create_new_")?"":e:i==="qdrant"&&(f.collection_name=e.startsWith("_create_new_")?"":e);for(let k in f)u.append(k,f[k]);if(o==="text_entry")f.text_content=a,f.original_text_content=a,u.append("text_content",a);else if(o==="file_upload"){let k=Array.isArray(l)&&l.length?l:c?.files?Array.from(c.files):[];if(k[0]){let w=i==="openai"?"aipkit_vs_global_file_to_submit":"file_to_upload";u.append(w,k[0])}(i==="pinecone"||i==="qdrant")&&e&&u.append("target_store_id",e)}else o==="wordpress_content"&&(f.post_ids=d,u.delete("post_ids"),d.forEach(k=>u.append("post_ids[]",k)));let _="",m="";i==="openai"?m="aipkit_vector_store_nonce_openai":i==="pinecone"?m="aipkit_vector_store_pinecone_nonce_management":i==="qdrant"&&(m="aipkit_vector_store_qdrant_nonce_management"),o==="wordpress_content"&&i==="openai"&&(m="aipkit_wp_content_index_nonce");let g=document.getElementById(m);return g?.value?(_=g.value,u.append("_ajax_nonce",_),f._ajax_nonce=_):console.error(`BuildSubmissionData: Nonce field #${m} not found.`),{formDataForFetch:u,requestDataForAJAX:f}}window.aipkit_buildSubmissionData=p})();(function(){"use strict";function p(r,o,i="Submit",e="Processing..."){if(!r)return;let t=r.querySelector(".aipkit_btn-text"),n=r.querySelector(".aipkit_spinner"),s=r.querySelector(".dashicons");if(o){if(r.disabled=!0,!r.dataset.originalText)if(t)r.dataset.originalText=t.textContent;else{let c="";r.childNodes.forEach(l=>{l.nodeType===Node.TEXT_NODE&&(c+=l.textContent.trim())}),r.dataset.originalText=c.trim()||i}s&&(s.dataset.originalDisplay||(s.dataset.originalDisplay=s.style.display||"inline-block"),s.style.display="none");let a=r.dataset.loadingText||e;t?t.textContent=a:(!s||s.style.display==="none")&&(Array.from(r.childNodes).forEach(c=>{c.nodeType===Node.TEXT_NODE&&c.remove()}),a&&r.insertBefore(document.createTextNode(a),r.firstChild)),n&&(n.style.display="inline-block")}else{r.disabled=!1;let a=r.dataset.originalText||i;s&&s.dataset.originalDisplay&&(s.style.display=s.dataset.originalDisplay,delete s.dataset.originalDisplay),t?t.textContent=a:(Array.from(r.childNodes).forEach(c=>{c.nodeType===Node.TEXT_NODE&&c.remove()}),a&&(s?s.insertAdjacentText("afterend"," "+a):r.insertBefore(document.createTextNode(a),r.firstChild))),n&&(n.style.display="none"),delete r.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=p})();(function(){"use strict";function p(r){if(r==="text_entry"){let o=document.getElementById("aipkit_vs_global_text_content");o&&(o.value="")}else if(r==="file_upload"){let o=document.getElementById("aipkit_vs_global_file_to_submit");o&&(o.value="")}}window.aipkit_clearSubmissionFields=p})();(function(){"use strict";function p(r,o,i){let e=r&&(r.details||r.serverResponse),t=r?.message||"An unknown error occurred.";if(e?console.error(`AIPKit Submission Error (${o}):`,{message:t,code:r.code,status:r.status,details:r.details,server:r.serverResponse}):console.error(`AIPKit Submission Error (${o}):`,r),typeof window.aipkit_showOpenAIVectorStatus=="function"){let n=e&&r?.details?.log_data?.message?`Error: ${r.details.log_data.message}`:`Error: ${t}`;window.aipkit_showOpenAIVectorStatus(n,"error",i)}else{let n=document.getElementById(i);n?(n.textContent=e&&r?.details?.log_data?.message?`Error: ${r.details.log_data.message}`:`Error: ${t}`,n.className="aipkit_form-help aipkit_settings_message-error"):alert(`Error: ${t}`)}}window.aipkit_reportSubmissionError=p})();(function(){"use strict";async function p(r,o,i,e){if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Core API request function is missing."));let t={_ajax_nonce:e,content_to_embed:r,embedding_provider:o,embedding_model:i};return window.aipkit_apiRequest("aipkit_generate_embedding",t)}window.aipkit_api_generateEmbedding=p})();(function(){"use strict";async function p(r,o){if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Core API request function is missing."));let i={_ajax_nonce:o,get_content_for_ids:r};return window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",i)}window.aipkit_api_fetchWpPostContent=p})();(function(){"use strict";async function p(i){return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("Core API request function is missing.")):window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",i)}async function r(i,e){if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return Promise.reject(new Error("AJAX configuration is missing."));i.set("action",e);try{let s=i.get("provider")||"openai",a=i.has("file_to_upload")?"file_to_upload":i.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null,c=a?i.get(a):null;if(c&&typeof c.size=="number"){let l=["text/plain","application/pdf","application/x-pdf","text/html","application/xhtml+xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],d=Array.isArray(window.aipkit_uploadLimits?.allowed_mime_types)&&window.aipkit_uploadLimits.allowed_mime_types.length?window.aipkit_uploadLimits.allowed_mime_types:l,u=Number(window.aipkit_effectiveUploadLimitBytes||0);(!Number.isFinite(u)||u<=0)&&(u=10*1024*1024),s==="openai"&&(u=Math.min(u,10*1024*1024));let f=[];if(c.size>u&&f.push(`File is too large (${o(c.size)}). Max allowed is ${o(u)}.`),c.type&&!d.map(_=>_.toLowerCase()).includes(String(c.type).toLowerCase())&&f.push(`Unsupported file type (${c.type}). Allowed: ${d.join(", ")}.`),f.length){let _=new Error(f.join(" "));throw _.code="client_validation_failed",_}}}catch(s){throw console.warn("[AIPKit] Client-side file validation failed",s),s}let t;try{let s=i.has("file_to_upload")?"file_to_upload":i.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null;if(s)try{let a=i.get(s);a&&console.debug("[AIPKit] File upload request",{action:e,fileField:s,name:a.name,size_bytes:a.size,type:a.type})}catch{}t=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:i,credentials:"same-origin"})}catch(s){throw console.error("[AIPKit] Network error during file upload",{action:e,error:s}),s}let n;try{n=await t.json()}catch(s){console.error("[AIPKit] Failed to parse JSON response for file upload",{action:e,status:t?.status,parseErr:s});let a=new Error(`Unexpected server response (status ${t?.status||"n/a"})`);throw a.status=t?.status,a}if(!t.ok||!n.success){let s=n?.data||{},a=new Error(s.message||`HTTP error! status: ${t.status}`);throw a.code=s.code,a.status=t.status,a.details=s.details||void 0,a.serverResponse=n,console.error("[AIPKit] File upload failed",{action:e,status:t.status,server:n}),a}return n.data}function o(i){if(!Number.isFinite(i))return`${i}`;let e=["B","KB","MB","GB"],t=0,n=i;for(;n>=1024&&t<e.length-1;)n/=1024,t++;return`${(typeof Intl<"u"?new Intl.NumberFormat(void 0,{maximumFractionDigits:1}):{format:a=>a.toFixed(1)}).format(n)} ${e[t]}`}window.aipkit_api_upsertOpenAIText=p,window.aipkit_api_upsertFile=r})();(function(){"use strict";async function p(r,o){if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Core API request function is missing."));let i={...r,_ajax_nonce:o};return window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",i)}window.aipkit_api_upsertToPinecone=p})();(function(){"use strict";async function p(r,o){if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Core API request function is missing."));let i={...r,_ajax_nonce:o};return window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",i)}window.aipkit_api_upsertToQdrant=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};async function r(o,i,e){let t=0,n=0,s="aipkit_index_selected_wp_content";try{for(let[c,l]of o.entries()){if(window.aipkit_isIndexingStopped){window.aipkit_showOpenAIVectorStatus("Indexing stopped by user.","warning",e);break}let d=document.querySelector(`#aipkit_vs_wp_content_list_area input[value="${l}"]`),u=d?d.closest("li").querySelector(".aipkit_wp_content_title"):null,f=u?u.textContent.trim():`Post #${l}`;window.aipkit_showOpenAIVectorStatus(`Processing ${c+1}/${o.length}: "${p(f)}"`,"info",e);let _={...i,post_ids:[l]};try{await window.aipkit_apiRequest(s,_),t++}catch(m){n++,console.error(`AI Training Indexing Error (Post ID ${l}):`,m)}}let a=`Indexing complete. ${t} successful, ${n} failed.`;window.aipkit_isIndexingStopped&&t+n<o.length?a=`Indexing stopped. ${t} successful, ${n} failed.`:n>0&&(a+=" See browser console for details on failed posts."),window.aipkit_showOpenAIVectorStatus(a,n>0||window.aipkit_isIndexingStopped?"warning":"success",e),typeof window.aipkit_fetchWordPressContentForTraining=="function"&&typeof window.aipkit_getWPCurrentPageForTraining=="function"&&window.aipkit_fetchWordPressContentForTraining(window.aipkit_getWPCurrentPageForTraining()),typeof window.aipkit_populateGlobalOpenAITargetSelect=="function"&&window.aipkit_populateGlobalOpenAITargetSelect(!0)}catch(a){console.error("AIPKit OpenAI Indexer: Loop-level error:",a),window.aipkit_showOpenAIVectorStatus(`Error during batch processing: ${a.message}`,"error",e)}finally{setTimeout(()=>{typeof window.aipkit_toggleAddContentForm=="function"&&window.aipkit_toggleAddContentForm(!1),typeof window.aipkit_resyncAllProviders=="function"&&window.aipkit_resyncAllProviders()},2e3)}}window.aipkit_indexOpenAIBatch=r})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};async function r(o,i,e){let t=0,n=0,s=[],{embedding_provider:a,embedding_model:c,index_name:l,_ajax_nonce:d}=i;window.aipkit_showOpenAIVectorStatus(`Preparing to index ${o.length} item(s) for Pinecone...`,"info",e);try{for(let[f,_]of o.entries()){if(window.aipkit_isIndexingStopped){window.aipkit_showOpenAIVectorStatus("Indexing stopped by user.","warning",e);break}try{let m=_.content,g={..._.metadata},k=_.metadata.title||`Item ${f+1}`;if(_.type==="wp_post"){let b=document.querySelector(`#aipkit_vs_wp_content_list_area input[value="${_.postId}"]`),v=b?b.closest("li").querySelector(".aipkit_wp_content_title"):null;k=v?v.textContent.trim():`Post #${_.postId}`}if(window.aipkit_showOpenAIVectorStatus(`Processing ${f+1}/${o.length}: "${p(k)}"`,"info",e),_.type==="wp_post"){let b=document.getElementById("aipkit_wp_content_fetch_nonce");if(!b?.value)throw new Error("WP Content fetch nonce missing.");let v=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:b.value,get_content_for_ids:[_.postId]});if(!v.posts_content||!v.posts_content[_.postId])throw new Error(`Could not fetch content for Post ID ${_.postId}.`);let S=v.posts_content[_.postId];m=S.content,g.title=S.title||"N/A",g.type=S.type_label||"N/A",g.url=S.edit_link||"#"}if(!m)throw new Error(`Content to embed is empty for item ${_.id}`);let w=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:m,embedding_provider:a,embedding_model:c,_ajax_nonce:window.aipkit_dashboard.nonce});if(!w.embeddings||w.embeddings.length===0)throw new Error(`Embedding failed: ${w.message||"No vector returned"}`);let h=w.embeddings[0],y={_ajax_nonce:d,vectors:JSON.stringify([{id:_.id,values:h,metadata:g}]),embedding_provider:a,embedding_model:c,original_text_content:m,index_name:l};await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",y),t++}catch(m){n++,console.error(`Error processing Pinecone item ${p(_.id)}:`,m);let k=`Pinecone error for ${_&&_.metadata&&_.metadata.title?`"${p(_.metadata.title)}"`:p(_?.id||"unknown")}: ${m?.message||"Unknown error."}`;s.push(k),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(k,"error",e)}}let u=`Indexing complete. ${t} successful, ${n} failed.`;if(s.length>0){let f=s.join(" \u2022 ");u+=` Errors: ${f}`}window.aipkit_showOpenAIVectorStatus(u,t>0&&n===0?"success":"warning",e),i.source_type==="wordpress_content"&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&window.aipkit_fetchWordPressContentForTraining(window.aipkit_getWPCurrentPageForTraining()),typeof window.aipkit_listPineconeIndexes=="function"&&window.aipkit_listPineconeIndexes(null,!1).then(()=>{if(l){let f=document.getElementById("aipkit_vs_global_target_select");f&&(f.value=l,f.dispatchEvent(new Event("change")))}})}catch(u){console.error("AIPKit Pinecone Indexer: Loop-level error:",u);let f=`Batch processing error: ${u?.message||"Unknown error."}`;s.push(f),window.aipkit_showOpenAIVectorStatus(f,"error",e)}finally{let u=n>0;setTimeout(()=>{let f=document.getElementById(e);if(u){if(f)try{f.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{}}else typeof window.aipkit_toggleAddContentForm=="function"&&window.aipkit_toggleAddContentForm(!1),typeof window.aipkit_resyncAllProviders=="function"&&window.aipkit_resyncAllProviders()},500)}}window.aipkit_indexPineconeBatch=r})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};async function r(o,i,e){let t=0,n=0,s=[],{embedding_provider:a,embedding_model:c,collection_name:l,_ajax_nonce:d}=i;window.aipkit_showOpenAIVectorStatus(`Preparing to index ${o.length} item(s) for Qdrant...`,"info",e);try{for(let[f,_]of o.entries()){if(window.aipkit_isIndexingStopped){window.aipkit_showOpenAIVectorStatus("Indexing stopped by user.","warning",e);break}try{let m=_.content,g={..._.metadata},k=_.metadata.title||`Item ${f+1}`;if(_.type==="wp_post"){let b=document.querySelector(`#aipkit_vs_wp_content_list_area input[value="${_.postId}"]`),v=b?b.closest("li").querySelector(".aipkit_wp_content_title"):null;k=v?v.textContent.trim():`Post #${_.postId}`}if(window.aipkit_showOpenAIVectorStatus(`Processing ${f+1}/${o.length}: "${p(k)}"`,"info",e),_.type==="wp_post"){let b=document.getElementById("aipkit_wp_content_fetch_nonce");if(!b?.value)throw new Error("WP Content fetch nonce missing.");let v=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:b.value,get_content_for_ids:[_.postId]});if(!v.posts_content||!v.posts_content[_.postId])throw new Error(`Could not fetch content for Post ID ${_.postId}.`);let S=v.posts_content[_.postId];m=S.content,g.title=S.title||"N/A",g.type=S.type_label||"N/A",g.url=S.edit_link||"#"}if(!m)throw new Error(`Content to embed is empty for item ${_.id}`);let w=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:m,embedding_provider:a,embedding_model:c,_ajax_nonce:window.aipkit_dashboard.nonce});if(!w.embeddings||w.embeddings.length===0)throw new Error(`Embedding failed: ${w.message||"No vector returned"}`);let h=w.embeddings[0],y={_ajax_nonce:d,vectors:JSON.stringify([{id:_.id,vector:h,payload:g}]),embedding_provider:a,embedding_model:c,original_text_content:m,collection_name:l};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",y),t++}catch(m){n++,console.error(`Error processing Qdrant item ${p(_.id)}:`,m);let k=`Qdrant error for ${_&&_.metadata&&_.metadata.title?`"${p(_.metadata.title)}"`:p(_?.id||"unknown")}: ${m?.message||"Unknown error."}`;s.push(k),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(k,"error",e)}}let u=`Indexing complete. ${t} successful, ${n} failed.`;if(s.length>0){let f=s.join(" \u2022 ");u+=` Errors: ${f}`}window.aipkit_showOpenAIVectorStatus(u,t>0&&n===0?"success":"warning",e),i.source_type==="wordpress_content"&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&window.aipkit_fetchWordPressContentForTraining(window.aipkit_getWPCurrentPageForTraining()),typeof window.aipkit_listQdrantCollections=="function"&&window.aipkit_listQdrantCollections(null,!1).then(()=>{if(l){let f=document.getElementById("aipkit_vs_global_target_select");f&&(f.value=l,f.dispatchEvent(new Event("change")))}})}catch(u){console.error("AIPKit Qdrant Indexer: Loop-level error:",u);let f=`Batch processing error: ${u?.message||"Unknown error."}`;s.push(f),window.aipkit_showOpenAIVectorStatus(f,"error",e)}finally{let u=n>0;setTimeout(()=>{let f=document.getElementById(e);if(u){if(f)try{f.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{}}else typeof window.aipkit_toggleAddContentForm=="function"&&window.aipkit_toggleAddContentForm(!1),typeof window.aipkit_resyncAllProviders=="function"&&window.aipkit_resyncAllProviders()},500)}}window.aipkit_indexQdrantBatch=r})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{};async function r(o){o.preventDefault();let i=document.getElementById("aipkit_vs_global_submit_data_btn"),e=document.getElementById("aipkit_vs_global_stop_indexing_btn"),t=document.getElementById("aipkit_vs_global_cancel_add_content_btn"),n,s=window.aipkit_validateGlobalFormState(),a="aipkit_knowledge_base_global_status";if(!s.isValid){window.aipkit_showOpenAIVectorStatus(s.message,"error",a);return}let{dataSource:c,vectorStoreProvider:l,...d}=s.values;window.aipkit_isIndexingStopped=!1,window.aipkit_setLoadingStateOpenAI(i,!0,p.addContentButton||"Add Content",p.processingButton||"Processing..."),window.aipkit_showOpenAIVectorStatus(p.processingRequest||"Processing request...","info",a),i.style.display="none",t&&(t.style.display="none");try{let u=window.aipkit_determineIterationMode(c,l),{requestDataForAJAX:f,formDataForFetch:_}=window.aipkit_buildSubmissionData(s.values);if(u.isIterative&&c==="wordpress_content"?(e&&(e.style.display="inline-flex",e.disabled=!1,e.textContent=p.stopButton||"Stop"),n=()=>{window.aipkit_isIndexingStopped=!0,e&&(e.disabled=!0,e.textContent=p.stoppingButton||"Stopping...")},e&&e.addEventListener("click",n,{once:!0})):e&&(e.style.display="none",e.disabled=!1,e.textContent=p.stopButton||"Stop"),u.isIterative){let g=[];if(c==="text_entry"){let k=l==="qdrant"?window.aipkit_generateUUIDv4():`text_${Date.now()}`;g.push({id:k,content:d.textContent,type:"text_entry",metadata:window.aipkit_utils_extractEmbeddingMeta("text_entry",d.textContent,k)})}else if(c==="wordpress_content"){let k=d.postIds;if((d.wpContentMode||"bulk")==="bulk")if(typeof window.aipkit_collectBulkPostIds=="function"){if(window.aipkit_showOpenAIVectorStatus(p.preparingBulk||"Preparing list of content...","info",a),k=await window.aipkit_collectBulkPostIds(),!k.length)throw new Error("No content found for selected post types.")}else throw new Error("Bulk collection module missing.");g=k.map(w=>{let h=l==="qdrant"?window.aipkit_generateUUIDv4():`wp_post_${w}`;return{id:h,postId:w,type:"wp_post",metadata:window.aipkit_utils_extractEmbeddingMeta("wp_post",w,h)}})}u.type==="openai"?await window.aipkit_indexOpenAIBatch(g.map(k=>k.postId),f,a):u.type==="pinecone"?await window.aipkit_indexPineconeBatch(g,f,a):u.type==="qdrant"&&await window.aipkit_indexQdrantBatch(g,f,a)}else{let g=window.aipkit_determineAjaxAction(c,l);if(!g)throw new Error("No AJAX action defined for this submission type.");let k=c==="file_upload",w;if(k)if(typeof window.aipkit_runUploadQueue=="function")await window.aipkit_runUploadQueue(s.values)?w={message:p.filesUploaded||"Files uploaded."}:w=await window.aipkit_api_upsertFile(_,g);else try{w=await window.aipkit_api_upsertFile(_,g)}catch(y){throw window.aipkit_showOpenAIVectorStatus(y?.message||"File validation failed.","error",a),y}else w=await window.aipkit_api_upsertOpenAIText(f);window.aipkit_showOpenAIVectorStatus(w.message||"Content added successfully!","success",a),window.aipkit_clearSubmissionFields(c),typeof window.aipkit_resyncAllProviders=="function"&&window.aipkit_resyncAllProviders();let h=w.new_store_id||w.store_id||d.targetStoreId;l==="openai"?window.aipkit_populateGlobalOpenAITargetSelect(!0).then(()=>{if(h){let y=document.getElementById("aipkit_vs_global_target_select");y&&(y.value=h,y.dispatchEvent(new Event("change")))}}):l==="pinecone"?window.aipkit_listPineconeIndexes(null,!1).then(()=>{if(h){let y=document.getElementById("aipkit_vs_global_target_select");y&&(y.value=h,y.dispatchEvent(new Event("change")))}}):l==="qdrant"&&window.aipkit_listQdrantCollections(null,!1).then(()=>{if(h){let y=document.getElementById("aipkit_vs_global_target_select");y&&(y.value=h,y.dispatchEvent(new Event("change")))}}),setTimeout(()=>{typeof window.aipkit_toggleAddContentForm=="function"&&window.aipkit_toggleAddContentForm(!1)},1500)}}catch(u){window.aipkit_reportSubmissionError(u,`${l} ${c} submission`,a)}finally{n?e&&e.removeEventListener("click",n):(window.aipkit_setLoadingStateOpenAI(i,!1,p.addContentButton||"Add Content"),i.style.display="inline-flex",e&&(e.style.display="none"),t&&(t.style.display="inline-flex"))}}window.aipkit_handleGlobalSubmitDataToStore=r})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_vs_global_submit_data_btn");if(!r){console.warn("AIPKit Submit Init: Global submit button (#aipkit_vs_global_submit_data_btn) not found.");return}if(typeof window.aipkit_handleGlobalSubmitDataToStore!="function"){console.error("AIPKit Submit Init: aipkit_handleGlobalSubmitDataToStore function not found.");return}r.dataset.listenerAttached||(r.addEventListener("click",window.aipkit_handleGlobalSubmitDataToStore),r.dataset.listenerAttached="true")}window.aipkit_initGlobalSubmitButton=p})();(function(){"use strict";let p=window.aipkit_dashboard?.text||{};function r(i){let e=i.currentTarget,t=typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():"openai",n="aipkit_knowledge_base_global_status";if(!t||!e){console.warn("Global Refresh Data: Missing provider slug or refresh button.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"){console.error("Global Refresh Data: Missing required UI helper functions (setLoadingState or showStatus).");return}window.aipkit_setLoadingStateOpenAI(e,!0,"","");let s=Promise.resolve();if(t==="openai"&&typeof window.aipkit_populateGlobalOpenAITargetSelect=="function")s=window.aipkit_populateGlobalOpenAITargetSelect(!0);else if(t==="pinecone"&&typeof window.aipkit_listPineconeIndexes=="function")s=window.aipkit_listPineconeIndexes(null,!1);else if(t==="qdrant"&&typeof window.aipkit_listQdrantCollections=="function")s=window.aipkit_listQdrantCollections(null,!1);else{console.warn(`Global Refresh Data: No specific refresh action defined for provider '${t}'.`),window.aipkit_setLoadingStateOpenAI(e,!1,"");return}s.then(()=>{}).catch(a=>{console.error(`Global Refresh Data: Error refreshing data for ${t}:`,a),window.aipkit_showOpenAIVectorStatus(`Failed to sync ${t} data. ${a.message||""}`,"error",n)}).finally(()=>{window.aipkit_setLoadingStateOpenAI(e,!1,"")})}function o(){let i=document.getElementById("aipkit_vs_global_refresh_data_btn");i&&(i.dataset.listenerAttached||(i.addEventListener("click",r),i.dataset.listenerAttached="true"))}window.aipkit_initGlobalRefreshButton=o})();(function(){"use strict";function p({provider:o}){let i=document.createElement("div");i.className="aipkit-modal-overlay aipkit-active";let e=document.createElement("div");e.className="aipkit-modal-content";let t={openai:"Create New Store",pinecone:"Create New Index",qdrant:"Create New Collection"},n=o==="pinecone"||o==="qdrant";e.innerHTML=`
      <div class="aipkit-modal-header">
        <h3 class="aipkit-modal-title">${t[o]||"Create"}</h3>
        <button type="button" class="aipkit-modal-close-btn" aria-label="Close">\xD7</button>
      </div>
      <div class="aipkit-modal-body">
        <div class="aipkit_form_group_compact">
          <label class="aipkit_form_label_compact">Name</label>
          <input type="text" id="aipkit_create_kb_modal_name" class="aipkit_form_input_compact" placeholder="Support FAQ" />
        </div>
        ${n?`
        <div class="aipkit_form_group_compact">
          <label class="aipkit_form_label_compact">Dimension</label>
          <input type="number" id="aipkit_create_kb_modal_dimension" class="aipkit_form_input_compact" placeholder="1536" min="1" max="4096" value="1536" />
        </div>`:""}
        <div id="aipkit_create_kb_modal_status" class="aipkit-modal-status"></div>
      </div>
      <div class="aipkit-modal-footer" style="text-align:right; gap:8px;">
    <button type="button" class="aipkit_btn aipkit_btn-secondary" id="aipkit_create_kb_modal_cancel_btn">Cancel</button>
    <button type="button" class="aipkit_btn aipkit_btn-primary" id="aipkit_vs_global_create_new_target_btn">Create</button>
      </div>
    `,i.appendChild(e),document.body.appendChild(i);let s=()=>{document.body.removeChild(i)};e.querySelector(".aipkit-modal-close-btn").addEventListener("click",s),e.querySelector("#aipkit_create_kb_modal_cancel_btn").addEventListener("click",s);let a=e.querySelector("#aipkit_create_kb_modal_name"),c=n?e.querySelector("#aipkit_create_kb_modal_dimension"):null,l=e.querySelector("#aipkit_create_kb_modal_status"),d=e.querySelector("#aipkit_vs_global_create_new_target_btn"),u=_=>{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(d,!!_,"Create","Creating..."):d.disabled=!!_},f=(_,m="info")=>{l.textContent=_||"",l.style.color=m==="error"?"var(--aipkit_status-warning, red)":"inherit"};d.addEventListener("click",async()=>{let _=(a.value||"").trim(),m=c?parseInt(c.value,10):null;if(!_){f("Name is required.","error"),a.focus();return}if(n&&(!m||m<=0)){f("Valid dimension is required.","error"),c.focus();return}u(!0),f("Creating...","info");try{if(o==="openai"){let g=document.getElementById("aipkit_vs_global_new_target_name")||document.createElement("input");if(g.id=g.id||"aipkit_vs_global_new_target_name",g.value=_,document.body.contains(g)||document.body.appendChild(g),typeof window.aipkit_handleCreateOpenAIStoreUnified=="function")await window.aipkit_handleCreateOpenAIStoreUnified();else throw new Error("Create handler not available.")}else if(o==="pinecone"){let g=window.aipkit_pinecone_vs_refs=window.aipkit_pinecone_vs_refs||{};if(g.newIndexNameInputGlobal={value:_},g.newIndexDimensionInputGlobal={value:String(m)},g.createIndexSubmitButtonGlobal=d,g.createIndexStatusDivGlobal=l,g.createFormWrapperGlobal=e,typeof window.aipkit_handleCreatePineconeIndex=="function")await window.aipkit_handleCreatePineconeIndex(!0);else throw new Error("Pinecone create handler not available.")}else if(o==="qdrant"){let g=window.aipkit_qdrant_vs_refs=window.aipkit_qdrant_vs_refs||{};if(g.newCollectionNameInputGlobal={value:_},g.newCollectionVectorSizeInputGlobal={value:String(m)},g.createCollectionSubmitButtonGlobal=d,g.createCollectionStatusDivGlobal=l,typeof window.aipkit_handleCreateQdrantCollection=="function")await window.aipkit_handleCreateQdrantCollection(!0);else throw new Error("Qdrant create handler not available.")}s()}catch(g){f(g?.message||"Failed to create.","error")}finally{u(!1)}}),a.focus()}function r(){let o=document.getElementById("aipkit_vs_global_add_openai_store_btn"),i=document.getElementById("aipkit_vs_global_add_pinecone_index_btn"),e=document.getElementById("aipkit_vs_global_add_qdrant_collection_btn");o&&!o.dataset.listenerAttached&&(o.addEventListener("click",()=>p({provider:"openai"})),o.dataset.listenerAttached="true"),i&&!i.dataset.listenerAttached&&(i.addEventListener("click",()=>p({provider:"pinecone"})),i.dataset.listenerAttached="true"),e&&!e.dataset.listenerAttached&&(e.addEventListener("click",()=>p({provider:"qdrant"})),e.dataset.listenerAttached="true")}window.aipkit_initCreateKbModal=r,window.aipkit_openCreateKbModal=function(o){let i=o||(typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():"openai");p({provider:i})}})();(function(){"use strict";function p(){if(!document.getElementById("aipkit_vector_store_management_area")){console.warn("AIPKit Global Form UI Manager: Parent management area not found. Global Form UI not fully initialized.");return}typeof window.aipkit_initGlobalProviderSwitcher=="function"?window.aipkit_initGlobalProviderSwitcher():console.error("AIPKit Global Form UI Init: aipkit_initGlobalProviderSwitcher not found."),typeof window.aipkit_initGlobalTargetHandler=="function"?window.aipkit_initGlobalTargetHandler():console.error("AIPKit Global Form UI Init: aipkit_initGlobalTargetHandler not found."),typeof window.aipkit_initGlobalDataSourceSwitcher=="function"?window.aipkit_initGlobalDataSourceSwitcher():console.error("AIPKit Global Form UI Init: aipkit_initGlobalDataSourceSwitcher not found."),typeof window.aipkit_initGlobalEmbeddingConfig=="function"?window.aipkit_initGlobalEmbeddingConfig():console.error("AIPKit Global Form UI Init: aipkit_initGlobalEmbeddingConfig not found."),typeof window.aipkit_initOpenAIInlineStoreCreator=="function"?window.aipkit_initOpenAIInlineStoreCreator():console.error("AIPKit Global Form UI Init: aipkit_initOpenAIInlineStoreCreator not found.");let o=document.getElementById("aipkit_vs_load_wp_content_btn");if(o&&typeof window.aipkit_fetchWordPressContentForTraining=="function"?o.dataset.listenerAttached||(o.addEventListener("click",()=>window.aipkit_fetchWordPressContentForTraining(1)),o.dataset.listenerAttached="true"):o&&console.error("AIPKit Global Form UI Init: aipkit_fetchWordPressContentForTraining not found for WP Content button."),typeof window.aipkit_initWpContentModeToggle=="function"&&window.aipkit_initWpContentModeToggle(),typeof window.aipkit_updatePostTypeCounts=="function"){window.aipkit_updatePostTypeCounts();let i=document.getElementById("aipkit_vs_wp_content_status");i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>window.aipkit_updatePostTypeCounts()),i.dataset.listenerAttached="true");let e=document.getElementById("aipkit_vs_global_target_select");e&&!e.dataset.ptcListener&&(e.addEventListener("change",()=>window.aipkit_updatePostTypeCounts()),e.dataset.ptcListener="true")}typeof window.aipkit_initGlobalSubmitButton=="function"?window.aipkit_initGlobalSubmitButton():console.error("AIPKit Global Form UI Init: aipkit_initGlobalSubmitButton function not found."),typeof window.aipkit_initUploadQueue=="function"&&window.aipkit_initUploadQueue(),typeof window.aipkit_initGlobalRefreshButton=="function"?window.aipkit_initGlobalRefreshButton():console.error("AIPKit Global Form UI Init: aipkit_initGlobalRefreshButton function not found."),typeof window.aipkit_initCreateKbModal=="function"&&window.aipkit_initCreateKbModal(),window.aipkit_setCreateFooterLoading=function(i,e="Create",t="Creating..."){let n=document.getElementById("aipkit_vs_global_create_new_target_btn");if(n)if(typeof window.aipkit_setLoadingStateOpenAI=="function")window.aipkit_setLoadingStateOpenAI(n,!!i,e,t);else{n.disabled=!!i;let s=n.querySelector(".aipkit_btn-text");s&&(s.textContent=i?t:e)}}}window.aipkit_initGlobalFormUIManager=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||(c=>c||""),r={};async function o(){if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Indexing Settings: aipkit_apiRequest function not available!");return}if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl){console.error("AIPKit Indexing Settings: aipkit_dashboard object not available!");return}let c=document.getElementById("aipkit_indexing_settings_form_container");if(!c){console.error("AIPKit Indexing Settings: Container not found!");return}c.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading content types...</p>';let l=window.aipkit_ai_training_settings_config||{};if(!l.settings_nonce){console.error("AIPKit Indexing Settings: NONCE IS MISSING from config object."),c.innerHTML='<p class="aipkit_text-danger">Error: Security token is missing. Cannot load settings.</p>';return}try{let d=await window.aipkit_apiRequest("aipkit_get_cpt_indexing_options",{_ajax_nonce:l.settings_nonce});if(!d){console.error("AIPKit Indexing Settings: No response received"),c.innerHTML='<p class="aipkit_text-danger">Error: No response received from server. Please try again.</p>';return}let u,f;if(d.success!==void 0){if(!d.success){console.error("AIPKit Indexing Settings: AJAX request failed:",d),c.innerHTML=`<p class="aipkit_text-danger">Error: ${p(d.data||"Failed to load content type settings. Please try again.")}</p>`;return}u=d.data?.cpt_data||{},f=d.data?.saved_settings||{}}else u=d.cpt_data||{},f=d.saved_settings||{};if(r=f,c.innerHTML="",Object.keys(u).length===0){c.innerHTML='<p class="aipkit_text-center">No content types found. Please ensure you have posts or pages in your WordPress site.</p>';return}let _=document.createElement("div");_.className="aipkit_accordion-group";let m=l.isPro===!0||l.isPro==="1";for(let k in u){let w=u[k],h=i(k,w.label,w,m);_.appendChild(h)}c.appendChild(_);let g=document.getElementById("aipkit_indexing_settings_form");g&&g.addEventListener("click",function(k){let w=k.target.closest(".aipkit_accordion-header");w&&(w.classList.toggle("aipkit_active"),w.nextElementSibling.classList.toggle("aipkit_active"))})}catch(d){console.error("AIPKit Indexing Settings: Error fetching CPT indexing options:",d),c.innerHTML=`<p class="aipkit_text-danger">Error: ${p(d.message||"Could not load content type settings.")}</p>`}}function i(c,l,d,u){let f=document.createElement("div");f.className="aipkit_accordion";let _=document.createElement("div");_.className="aipkit_accordion-header",_.innerHTML=`<span class="dashicons dashicons-arrow-right-alt2"></span>${p(l)}`;let m=document.createElement("div");return m.className="aipkit_accordion-content",m.appendChild(t(c,d.basic_labels,u)),m.appendChild(e("Custom Fields",c,"fields",d.fields,u)),m.appendChild(e("Taxonomies",c,"taxonomies",d.taxonomies,u)),c==="product"&&d.woo_attributes&&m.appendChild(e("Product Data",c,"woo_attributes",d.woo_attributes,u)),f.appendChild(_),f.appendChild(m),f}function e(c,l,d,u,f){let _=document.createElement("div");if(_.className="aipkit_indexing_settings_section",u&&Object.keys(u).length>0){let m=document.createElement("h5");m.textContent=c,_.appendChild(m);let g=document.createElement("table");g.className="wp-list-table widefat striped",g.innerHTML=`
        <thead>
            <tr>
                <th class="check-column"><input type="checkbox" class="aipkit-indexing-select-all" ${f?"":"disabled"}/></th>
                <th>Field / Taxonomy</th>
                <th>Label for AI Context</th>
            </tr>
        </thead>
        <tbody></tbody>`;let k=g.querySelector("tbody");for(let h in u){let y=u[h],b=r[l]?.[d]?.[h]||{},v=b.enabled!==void 0?b.enabled:!0,S=b.label||"",C=document.createElement("tr");C.innerHTML=`
            <th scope="row" class="check-column">
                <input type="checkbox" name="settings[${l}][${d}][${h}][enabled]" value="1" ${v?"checked":""} ${f?"":"disabled"}>
            </th>
            <td><code>${p(h)}</code></td>
            <td>
                <input type="text" class="regular-text" name="settings[${l}][${d}][${h}][label]" value="${p(S)}" placeholder="${p(y)}" ${f?"":"disabled"}>
            </td>
        `,k.appendChild(C)}_.appendChild(g),g.querySelector(".aipkit-indexing-select-all").addEventListener("change",h=>{k.querySelectorAll('input[type="checkbox"]').forEach(y=>{y.checked=h.target.checked})})}else _.innerHTML=`<p><em>No ${c.toLowerCase()} found for this content type.</em></p>`;return _}function t(c,l,d){let u=document.createElement("div");u.className="aipkit_indexing_settings_section";let f=document.createElement("h5");f.textContent="Basic Labels",u.appendChild(f);let _=document.createElement("table");_.className="wp-list-table widefat striped",_.innerHTML=`
      <thead>
          <tr>
              <th>Label Type</th>
              <th>Custom Label for AI Context</th>
          </tr>
      </thead>
      <tbody></tbody>`;let m=_.querySelector("tbody"),g=["source_url","title","excerpt","content"],k=["Source URL","Title","Excerpt","Content"];return g.forEach((w,h)=>{let y=l[w]||k[h],b=r[c]?.basic_labels?.[w]||y,v=document.createElement("tr");v.innerHTML=`
          <td><code>${p(k[h])}</code></td>
          <td>
              <input type="text" class="regular-text" name="settings[${c}][basic_labels][${w}]" value="${p(b)}" placeholder="${p(y)}" ${d?"":"disabled"}>
          </td>
      `,m.appendChild(v)}),u.appendChild(_),u}function n(){let c=document.getElementById("aipkit_indexing_settings_form_container"),l=document.getElementById("general-training-settings-content");if(!c||!l)return{};let d={},u=l.querySelector("#aipkit_hide_user_uploads_checkbox");d.hide_user_uploads=u?u.checked:!0;let f=l.querySelector("#aipkit_show_index_button_checkbox");d.show_index_button=f?f.checked:!0;let _=document.getElementById("aipkit_chunk_avg_chars_per_token"),m=document.getElementById("aipkit_chunk_max_tokens_per_chunk"),g=document.getElementById("aipkit_chunk_overlap_tokens");if(_&&m&&g){let h=parseInt(_.value,10),y=parseInt(m.value,10),b=parseInt(g.value,10);Number.isNaN(h)||(d.chunk_avg_chars_per_token=h),Number.isNaN(y)||(d.chunk_max_tokens_per_chunk=y),Number.isNaN(b)||(d.chunk_overlap_tokens=b)}let k=c.querySelectorAll('input[type="checkbox"]'),w=c.querySelectorAll('input[type="text"]');return k.forEach(h=>{let y=h.name.match(/[^[\]']+/g);if(y&&y.length===5&&y[4]==="enabled"){let[,b,v,S]=y;d[b]||(d[b]={}),d[b][v]||(d[b][v]={}),d[b][v][S]||(d[b][v][S]={}),d[b][v][S].enabled=h.checked}}),w.forEach(h=>{let y=h.name.match(/[^[\]']+/g);if(y&&y.length===5&&y[4]==="label"){let[,b,v,S]=y;d[b]||(d[b]={}),d[b][v]||(d[b][v]={}),d[b][v][S]||(d[b][v][S]={}),d[b][v][S].label=h.value.trim()}else if(y&&y.length===4&&y[2]==="basic_labels"){let[,b,,v]=y;d[b]||(d[b]={}),d[b].basic_labels||(d[b].basic_labels={}),d[b].basic_labels[v]=h.value.trim()}}),d}async function s(c){let l=c.currentTarget;if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showMessage!="function")return;window.aipkit_setLoadingStateOpenAI(l,!0,"Save","Saving...");let d=n(),u=window.aipkit_ai_training_settings_config||{};try{let f=await window.aipkit_apiRequest("aipkit_save_cpt_indexing_options",{_ajax_nonce:u.settings_nonce,settings:JSON.stringify(d)});window.aipkit_showMessage("aipkit_indexing_settings_messages","success",f.message||"Settings saved!"),r=d}catch(f){console.error("Error saving indexing settings:",f),window.aipkit_showMessage("aipkit_indexing_settings_messages","error",f.message||"Failed to save settings.")}finally{window.aipkit_setLoadingStateOpenAI(l,!1,"Save")}}function a(){let c=document.getElementById("indexing-settings-tab-content");if(!c||c.dataset.initialized==="true")return;o();let l=document.getElementById("aipkit_save_indexing_settings_btn");l&&l.addEventListener("click",s),c.dataset.initialized="true"}window.aipkit_initIndexingSettings=a})();(function(){"use strict";function p(){try{console.debug("[AI Training] Sorting KB items by recency...")}catch{}let l=document.querySelector(".aipkit_kb_card_grid");if(l){let u=Array.from(l.querySelectorAll(".aipkit_kb_card"));u.sort((f,_)=>(parseInt(_.dataset.lastUpdatedTs||"0",10)||0)-(parseInt(f.dataset.lastUpdatedTs||"0",10)||0)),u.forEach(f=>l.appendChild(f))}let d=document.querySelector("#aipkit_kb_list_view .aipkit_kb_list_body");if(d){let u=Array.from(d.querySelectorAll(".aipkit_kb_list_row"));u.sort((f,_)=>(parseInt(_.dataset.lastUpdatedTs||"0",10)||0)-(parseInt(f.dataset.lastUpdatedTs||"0",10)||0)),u.forEach(f=>d.appendChild(f))}}async function r(l){try{console.debug("[AI Training] Applying refreshed KB views...")}catch{}let d=document.getElementById("aipkit_kb_card_view"),u=document.getElementById("aipkit_kb_list_view"),f=l.cards_html||l.html||"",_=l.list_html||"";d&&f&&(d.innerHTML=f),u&&_&&(u.innerHTML=_);let m=document.getElementById("aipkit_kb_card_view"),g=document.getElementById("aipkit_kb_list_view"),k=w=>{let h=w.target.closest(".aipkit_kb_card"),y=w.target.closest(".aipkit_kb_list_row"),b=h||y;if(!b)return;let v=b.dataset.provider,S=b.dataset.id,C=b.dataset.name;e("details");let T=document.getElementById("aipkit_kb_detail_view");T&&(T.dataset.provider=v,T.dataset.storeId=S,T.dataset.storeName=C);let E=document.getElementById("aipkit_kb_detail_title");E&&(E.textContent=C);let M=document.getElementById("aipkit_kb_detail_view");(M?M.querySelectorAll(".aipkit_vector_provider_management_block"):[]).forEach(L=>{L.style.display=L.dataset.provider===v.toLowerCase()?"block":"none"}),v.toLowerCase()==="openai"&&typeof window.aipkit_showStoreFilesPanel=="function"?window.aipkit_showStoreFilesPanel(S,C):v.toLowerCase()==="pinecone"&&typeof window.aipkit_showPineconeIndexDetails=="function"?window.aipkit_showPineconeIndexDetails(S):v.toLowerCase()==="qdrant"&&typeof window.aipkit_fetchAndShowQdrantCollectionDetails=="function"&&window.aipkit_fetchAndShowQdrantCollectionDetails(S)};m&&m.addEventListener("click",k),g&&g.addEventListener("click",k),p(),oe(),await t()}function o(l,d=!0){try{console.debug("[AI Training] Set listing style ->",l,"persist:",!!d)}catch{}let u=document.getElementById("aipkit_kb_card_view"),f=document.getElementById("aipkit_kb_list_view"),_=document.getElementById("aipkit_kb_detail_view"),m=document.getElementById("aipkit_add_content_form_container"),g=document.getElementById("aipkit_kb_view_style"),k=document.getElementById("aipkit_kb_view_cards_btn"),w=document.getElementById("aipkit_kb_view_list_btn");if(!u||!f||!_||!m)return;let h=m.style.display==="block",y=_.style.display==="block";if(g&&(g.value=l),k&&w){let b=l==="list";k.classList.toggle("aipkit_active",!b),w.classList.toggle("aipkit_active",b),k.setAttribute("aria-pressed",String(!b)),w.setAttribute("aria-pressed",String(b))}if(d&&typeof window.localStorage<"u")try{localStorage.setItem("aipkit_kb_view_style",l)}catch{}if(h||y){u.style.display="none",f.style.display="none";return}l==="list"?(u.style.display="none",f.style.display="block"):(u.style.display="block",f.style.display="none"),t(),p()}function i(l){try{console.debug("[AI Training] Toggle Add Content form. Requested:",l)}catch{}let d=document.getElementById("aipkit_toggle_add_content_form_btn"),u=document.getElementById("aipkit_add_content_form_container"),f=document.getElementById("aipkit_kb_card_view"),_=document.getElementById("aipkit_kb_list_view"),m=document.getElementById("aipkit_kb_detail_view");if(!d||!u||!f||!m)return;let g=typeof l=="boolean"?l:u.style.display==="none";u.style.display=g?"block":"none";try{let k=document.getElementById("aipkit_vs_global_stop_indexing_btn");if(k){k.style.display="none",k.disabled=!1;let w=window.aipkit_dashboard?.text||{};k.textContent=w.stopButton||"Stop"}g&&(window.aipkit_isIndexingStopped=!1)}catch{}if(g){f.style.display="none",_&&(_.style.display="none");try{console.debug("[AI Training] Showing Add Content form, hiding lists.")}catch{}}else{let k=typeof window.localStorage<"u"?localStorage.getItem("aipkit_kb_view_style"):null;o(k==="list"?"list":"cards",!1)}m.style.display="none",d.classList.toggle("aipkit_active",g),g&&!u.dataset.initialized&&(typeof window.aipkit_initGlobalFormUIManager=="function"?window.aipkit_initGlobalFormUIManager():console.error("AIPKit AI Training: aipkit_initGlobalFormUIManager not found."),u.dataset.initialized="true")}function e(l){try{console.debug("[AI Training] Switch view ->",l)}catch{}let d=document.getElementById("aipkit_kb_card_view"),u=document.getElementById("aipkit_kb_list_view"),f=document.getElementById("aipkit_kb_detail_view"),_=document.getElementById("aipkit_add_content_form_container");if(!(!d||!f||!_))if(_.style.display="none",l==="details"){d.style.display="none",u&&(u.style.display="none"),f.style.display="block";try{console.debug("[AI Training] Showing detail view.")}catch{}}else(l==="cards"||l==="list")&&(f.style.display="none",o(l,!1))}async function t(){try{console.debug("[AI Training] Fetching local stats for visible KB items...")}catch{}let l=document.querySelectorAll(".aipkit_kb_card, .aipkit_kb_list_row");if(l.length===0)return;let d=Array.from(l).map(u=>{let f=u.dataset.provider,_=u.dataset.id,m=u.querySelector('[data-stat="doc-count"]'),g=u.querySelector('[data-stat="last-updated"]');return m?.dataset.initialized==="true"&&g?.dataset.initialized==="true"||!f||!_?Promise.resolve():window.aipkit_apiRequest("aipkit_get_knowledge_base_stats",{provider:f,store_id:_}).then(k=>{try{console.debug("[AI Training] Stats OK",f+":"+_,k)}catch{}if(m){let w=k.document_count;typeof w=="number"&&!isNaN(w)?m.textContent=w.toLocaleString():m.textContent=w||"N/A"}g&&(g.textContent=k.last_updated||"N/A")}).catch(k=>{console.error(`Error fetching local stats for ${f}:${_}`,k.message||k,k.debug?`
Server debug: `+k.debug:""),m&&(m.textContent="N/A"),g&&(g.textContent="N/A")})});await Promise.all(d)}async function n(){try{console.debug("[AI Training] Resync all providers triggered.")}catch{}let l=document.getElementById("aipkit_resync_all_providers_btn");if(!l)return;let d=l.querySelector(".aipkit_spinner"),u=l.querySelector(".dashicons");l.disabled=!0,d&&(d.style.display="inline-block"),u&&(u.style.display="none");let f=["PineconeIndexes","QdrantCollections"],_={success:[],failed:[]};try{try{let k=document.getElementById("aipkit_vector_store_nonce_openai");if(!k||!k.value)throw new Error("OpenAI nonce not found for sync.");await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",{_ajax_nonce:k.value,limit:100}),_.success.push("OpenAI")}catch(k){console.error("Failed to sync OpenAI:",k.message||k,k.debug?`
Server debug: `+k.debug:""),_.failed.push({provider:"OpenAI",error:k.message})}for(let k of f)try{await window.aipkit_apiRequest("aipkit_sync_models",{provider:k}),_.success.push(k.replace("Indexes","").replace("Collections",""))}catch(w){console.error(`Failed to sync ${k}:`,w.message||w,w.debug?`
Server debug: `+w.debug:""),_.failed.push({provider:k.replace("Indexes","").replace("Collections",""),error:w.message})}if(document.querySelector(".aipkit_kb_card_grid"))try{let k=await window.aipkit_apiRequest("aipkit_refresh_knowledge_base_cards",{});k&&await r(k)}catch(k){console.error("Failed to refresh knowledge base cards:",k.message||k,k.debug?`
Server debug: `+k.debug:""),await t()}let g="";if(_.success.length>0){let k=_.success.join(", ");g+=`Successfully synced: ${k}. `}if(_.failed.length>0){let k=_.failed.map(w=>w.provider).join(", ");g+=`Failed to sync: ${k}. `}typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(g.trim()||"Sync complete.",_.failed.length>0?"warning":"success","aipkit_knowledge_base_global_status")}catch(m){console.error("Re-sync All error:",m),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(m.message||"An unexpected error occurred during sync.","error","aipkit_knowledge_base_global_status")}finally{l.disabled=!1,d&&(d.style.display="none"),u&&(u.style.display="inline-block")}}function s(){let l=document.querySelectorAll(".aipkit_source_card"),d=document.getElementById("aipkit_vs_global_data_source");!l.length||!d||l.forEach(u=>{u.addEventListener("click",()=>{let f=u.dataset.source;l.forEach(_=>_.classList.remove("aipkit_source_card_active")),u.classList.add("aipkit_source_card_active"),d.value=f,d.dispatchEvent(new Event("change"))})})}function a(){let l=document.getElementById("aipkit_kb_view_style"),d=document.getElementById("aipkit_kb_view_cards_btn"),u=document.getElementById("aipkit_kb_view_list_btn"),f=typeof window.localStorage<"u"?localStorage.getItem("aipkit_kb_view_style"):null;o(f==="list"?"list":"cards",!1),l&&l.addEventListener("change",()=>{let S=l.value==="list"?"list":"cards";o(S,!0)}),d&&d.addEventListener("click",()=>o("cards",!0)),u&&u.addEventListener("click",()=>o("list",!0));let _=document.getElementById("aipkit_toggle_add_content_form_btn");_&&_.addEventListener("click",()=>i());let m=document.getElementById("aipkit_resync_all_providers_btn");m&&m.addEventListener("click",()=>n());let g=document.getElementById("aipkit_vs_global_cancel_add_content_btn");g&&g.addEventListener("click",()=>i(!1)),s();let k=document.getElementById("aipkit_vs_global_upgrade_to_pro_btn");if(k){let S=window.aipkit_dashboard?.upgradeUrl||"#";k.addEventListener("click",C=>{C.preventDefault(),S&&S!=="#"&&window.open(S,"_blank")})}let w=document.getElementById("aipkit_kb_card_view"),h=document.getElementById("aipkit_kb_list_view");function y(S){let C=S.target.closest(".aipkit_kb_card"),T=S.target.closest(".aipkit_kb_list_row"),E=C||T;if(!E)return;let M=E.dataset.provider,x=E.dataset.id,L=E.dataset.name;e("details");let A=document.getElementById("aipkit_kb_detail_view");A&&(A.dataset.provider=M,A.dataset.storeId=x,A.dataset.storeName=L);let I=document.getElementById("aipkit_kb_detail_title");I&&(I.textContent=L),document.getElementById("aipkit_kb_detail_view").querySelectorAll(".aipkit_vector_provider_management_block").forEach(B=>{B.style.display=B.dataset.provider===M.toLowerCase()?"block":"none"}),M.toLowerCase()==="openai"&&typeof window.aipkit_showStoreFilesPanel=="function"?window.aipkit_showStoreFilesPanel(x,L):M.toLowerCase()==="pinecone"&&typeof window.aipkit_showPineconeIndexDetails=="function"?window.aipkit_showPineconeIndexDetails(x):M.toLowerCase()==="qdrant"&&typeof window.aipkit_fetchAndShowQdrantCollectionDetails=="function"&&window.aipkit_fetchAndShowQdrantCollectionDetails(x)}w&&w.addEventListener("click",y),h&&h.addEventListener("click",y);let b=document.getElementById("aipkit_kb_back_to_list_btn");b&&b.addEventListener("click",()=>{let S=typeof window.localStorage<"u"?localStorage.getItem("aipkit_kb_view_style"):null;e(S==="list"?"list":"cards")});let v=document.getElementById("aipkit_kb_detail_view");v&&(v.addEventListener("click",S=>{let C=S.target.closest("#aipkit_kb_detail_search_btn"),T=S.target.closest("#aipkit_kb_detail_delete_btn"),E=S.target.closest(".aipkit_actions_toggle_btn"),M=v.querySelector(".aipkit_actions_dropdown_menu");if(E){M&&(M.style.display=M.style.display==="block"?"none":"block");return}let x=v.dataset.provider,L=v.dataset.storeId,A=v.dataset.storeName;if(C)x.toLowerCase()==="openai"&&typeof window.aipkit_showSearchFormForStore=="function"?window.aipkit_showSearchFormForStore(L,A):x.toLowerCase()==="pinecone"&&typeof window.aipkit_showSearchFormForPineconeIndex=="function"?window.aipkit_showSearchFormForPineconeIndex(L,A):x.toLowerCase()==="qdrant"&&typeof window.aipkit_showSearchFormForQdrantCollection=="function"&&window.aipkit_showSearchFormForQdrantCollection(L,A);else if(T&&confirm(`Are you sure you want to delete the "${A}" knowledge base? This action cannot be undone.`)){let I;x.toLowerCase()==="openai"&&typeof window.aipkit_deleteOpenAIVectorStore=="function"?I=window.aipkit_deleteOpenAIVectorStore(L,T):x.toLowerCase()==="pinecone"&&typeof window.aipkit_deletePineconeIndex=="function"?I=window.aipkit_deletePineconeIndex(L,T):x.toLowerCase()==="qdrant"&&typeof window.aipkit_deleteQdrantCollection=="function"&&(I=window.aipkit_deleteQdrantCollection(L,T))}M&&(M.style.display="none")}),document.addEventListener("click",S=>{let C=v.querySelector(".aipkit_actions_menu");if(C&&!C.contains(S.target)){let T=C.querySelector(".aipkit_actions_dropdown_menu");T&&(T.style.display="none")}})),oe(),p()}function c(){a(),t(),typeof window.aipkit_initOpenAIVectorStore=="function"&&window.aipkit_initOpenAIVectorStore(),typeof window.aipkit_initPineconeUI=="function"&&window.aipkit_initPineconeUI(),typeof window.aipkit_initQdrantVectorStoreUI=="function"&&window.aipkit_initQdrantVectorStoreUI();let l=document.getElementById("indexing-settings-tab-content");l&&l.classList.contains("aipkit_active")&&typeof window.aipkit_initIndexingSettings=="function"&&window.aipkit_initIndexingSettings()}window.aipkit_initAiTraining=c,window.aipkit_toggleAddContentForm=i,window.aipkit_switchKbView=e,window.aipkit_setKbListingStyle=o,window.aipkit_applyRefreshToKbViews=r,window.aipkit_resyncAllProviders=n})();function oe(){try{console.debug("[AI Training] Update view toggle visibility")}catch{}let p=document.querySelector(".aipkit_kb_view_toggle");if(!p)return;let r=!!document.querySelector(".aipkit_kb_card, .aipkit_kb_list_row");p.style.display=r?"flex":"none"}(function(){"use strict";let p=1,r={content_indexing:{steps:[{id:"setup",label:"Content Selection"},{id:"finish_ci",label:"Vector Selection"}],contentMap:{setup:"task_form_setup",finish_ci:"task_config_content_indexing"}},content_writing:{steps:[{id:"setup",label:"Setup"},{id:"prompts",label:"AI & Prompts"},{id:"knowledge_base",label:"Context"},{id:"seo",label:"SEO"},{id:"images",label:"Images"},{id:"finish_cw",label:"Post Settings"}],contentMap:{setup:"task_form_setup",prompts:"task_config_ai",knowledge_base:"task_config_knowledge_base",seo:"task_config_seo",images:"task_form_image_settings",finish_cw:"task_config_content_writing"}},enhance_existing_content:{steps:[{id:"setup",label:"Setup"},{id:"knowledge_base",label:"Context"},{id:"ai_and_prompts",label:"AI & Prompts"}],contentMap:{setup:"task_form_setup",knowledge_base:"task_config_enhancement_knowledge_base",ai_and_prompts:"task_config_enhancement_ai_and_prompts"}},community_reply_comments:{steps:[{id:"setup",label:"Setup"},{id:"filters",label:"Filters"},{id:"prompt",label:"AI & Prompt"}],contentMap:{setup:"task_form_setup",filters:"task_config_comment_reply",prompt:"task_config_comment_reply_ai"}}};function o(){let n=document.querySelectorAll(".aipkit_wizard_step"),s=document.querySelector(".aipkit_wizard_content_container"),a=document.getElementById("aipkit_wizard_prev_btn"),c=document.getElementById("aipkit_wizard_next_btn"),l=document.getElementById("aipkit_save_task_btn");if(!n.length||!s)return;let d="";n.forEach(u=>{let f=parseInt(u.dataset.step,10);u.classList.remove("aipkit_active","aipkit_completed"),f<p?u.classList.add("aipkit_completed"):f===p&&(u.classList.add("aipkit_active"),d=u.dataset.contentId)}),s.querySelectorAll(".aipkit_wizard_content_step").forEach(u=>{(u.dataset.contentId||"")===d?(u.style.display="block",u.classList.add("aipkit_active")):(u.style.display="none",u.classList.remove("aipkit_active"))}),a&&(a.style.display=p>1?"inline-flex":"none"),c&&(c.style.display=p<n.length?"inline-flex":"none"),l&&(l.style.display=p===n.length?"inline-flex":"none")}function i(n){let s=document.querySelectorAll(".aipkit_wizard_step").length;p=Math.max(1,Math.min(n,s||1)),o()}function e(){let n=document.querySelector(".aipkit_wizard_nav");if(!n)return;let s="data-nav-listener-attached";if(n.getAttribute(s))return;let a=document.getElementById("aipkit_wizard_prev_btn"),c=document.getElementById("aipkit_wizard_next_btn");if(!a||!c){console.warn("Wizard Nav: Previous or Next button not found.");return}a.addEventListener("click",()=>{typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),i(p-1)}),c.addEventListener("click",()=>{if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),c.dataset.action==="upgrade"){let l=window.aipkit_dashboard?.upgradeUrl;l?window.open(l,"_blank"):console.error("Upgrade URL not found.");return}if(typeof window.aipkit_form_validateWizardStep=="function"){let l=window.aipkit_form_validateWizardStep(p);if(l!==!0){typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(l,"error");return}}i(p+1)}),n.setAttribute(s,"true")}function t(n){let s=document.querySelector(".aipkit_wizard_steps");if(!s)return;s.innerHTML="";let a="content_writing";n==="content_indexing"?a="content_indexing":n==="community_reply_comments"?a="community_reply_comments":n==="enhance_existing_content"&&(a="enhance_existing_content");let c=window.aipkit_wizardConfig[a];if(!c){console.warn(`No wizard configuration found for task type: ${n}`);return}c.steps.forEach((l,d)=>{let u=d+1,f=document.createElement("div");f.className="aipkit_wizard_step",f.dataset.step=u,f.dataset.contentId=c.contentMap[l.id],f.innerHTML=`
                <div class="aipkit_step_indicator_circle">${u}</div>
                <span>${l.label}</span>
            `,s.appendChild(f)}),typeof window.aipkit_initWizardNavigation=="function"&&window.aipkit_initWizardNavigation(),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_renderWizard=t,window.aipkit_initWizardNavigation=e,window.aipkit_resetWizard=()=>i(1),window.aipkit_wizardConfig=r})();(function(){"use strict";function p(r){let o=window.aipkit_automated_tasks_config||{},i=o.text||{},e=window.aipkit_escapeHtml||function(a){return a},t=document.getElementById("aipkit_task_content_indexing_target_store_id");if(!t)return Promise.resolve();t.innerHTML=`<option value="">${e(i.loading_stores||"Loading...")}</option>`,t.disabled=!0;let n=[],s=i.select_target_store||"-- Select Target Store --";return r==="openai"&&o.openai_vector_stores?n=o.openai_vector_stores:r==="pinecone"&&o.pinecone_indexes?(n=o.pinecone_indexes,s=i.select_target_index||"-- Select Target Index --"):r==="qdrant"&&o.qdrant_collections&&(n=o.qdrant_collections,s=i.select_target_collection||"-- Select Target Collection --"),t.innerHTML=`<option value="">${e(s)}</option>`,n&&Array.isArray(n)&&n.length>0?(n.forEach(a=>{let c=a.id||a.name,l=a.name||a.id,d=e(l);r==="openai"&&a.file_counts?.total!==void 0?d+=` (Files: ${a.file_counts.total})`:r==="pinecone"&&a.dimension!==void 0&&(d+=` (Dim: ${a.dimension})`),t.appendChild(new Option(d,c))}),t.disabled=!1):(t.appendChild(new Option(e(i.no_targets_found_configure||`No ${r} targets found. Configure in AI Training.`),"")),t.disabled=!0),Promise.resolve()}window.aipkit_populateTargetStoreSelectForContentIndexing=p})();(function(){"use strict";function p(){let r=window.aipkit_automated_tasks_config||{},o=r.text||{},i=window.aipkit_escapeHtml||function(d){return d},e=document.getElementById("aipkit_task_content_indexing_embedding_model"),t=window.aipkit_automated_tasks_form_state||{},n=t.pendingEmbeddingModelSelection;if(!e)return Promise.resolve();e.innerHTML=`<option value="">${i(o.select_embedding_model||"-- Select Model --")}</option>`;let s=r.openai_embedding_models||[],a=r.google_embedding_models||[],c=r.azure_embedding_models||[],l=(d,u,f)=>{let _=document.createElement("optgroup");return _.label=i(d),u&&u.length>0&&u.forEach(m=>{let g=`${f}:${m.id}`;_.appendChild(new Option(i(m.name||m.id),g))}),_};if(e.appendChild(l("OpenAI",s,"openai")),e.appendChild(l("Google",a,"google")),e.appendChild(l("Azure",c,"azure")),e.disabled=s.length===0&&a.length===0&&c.length===0,e.disabled&&(e.innerHTML=`<option value="">${i(o.no_embedding_models_sync||"No models found - Sync in AI Settings")}</option>`),n&&e.querySelector(`option[value="${CSS.escape(n)}"]`))e.value=n,t.pendingEmbeddingModelSelection=null;else if(e.options.length>1){let d=e.querySelector("optgroup");d&&d.options.length>0&&(e.value=d.options[0].value)}}window.aipkit_populateEmbeddingModelSelectForContentIndexing=p})();(function(){"use strict";function p(r){let o=r.target.value,i=document.getElementById("aipkit_task_content_indexing_embedding_model_group");if(typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"?window.aipkit_populateTargetStoreSelectForContentIndexing(o):console.error("Target Store Provider Change Handler: populateTargetStoreSelectForContentIndexing function not found."),i){let e=o==="pinecone"||o==="qdrant";i.style.display=e?"block":"none",e&&typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()}}window.aipkit_handleTargetStoreProviderChange=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_task_config_content_indexing");if(!r)return;let o=r.querySelector("#aipkit_task_content_indexing_target_store_provider");o&&(typeof window.aipkit_handleTargetStoreProviderChange=="function"?(o.addEventListener("change",window.aipkit_handleTargetStoreProviderChange),window.aipkit_handleTargetStoreProviderChange({target:o})):console.error("Content Indexing UI Init: aipkit_handleTargetStoreProviderChange function not found."))}window.aipkit_initContentIndexingTaskFormUI=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};function r(o,i){let e=o.value,t=e?e.toLowerCase():"",n=window.aipkit_dashboard?.models,s=window.aipkit_automated_tasks_form_state||{};if(!i)return;if(!n){i.innerHTML=`<option value="">${p("Error: Model data object not found")}</option>`,i.disabled=!0;return}let a=n[t],c=s.pendingModelSelection||i.value;if(i.innerHTML="",t==="openai"&&typeof a=="object"&&!Array.isArray(a)?Object.keys(a).forEach(l=>{let d=document.createElement("optgroup");d.label=p(l),Array.isArray(a[l])&&a[l].forEach(u=>{u&&u.id&&d.appendChild(new Option(p(u.name||u.id),u.id))}),i.appendChild(d)}):Array.isArray(a)&&a.forEach(l=>{l&&l.id&&i.appendChild(new Option(p(l.name||l.id),l.id))}),i.options.length===0)i.appendChild(new Option(p(`No models for ${e}`),"")),i.disabled=!0;else{i.disabled=!1;let l=!1;if(c&&i.querySelector(`option[value="${CSS.escape(c)}"]`)&&(i.value=c,l=!0),!l&&i.options.length>0){let d=i.querySelector('option:not([value=""])');d&&(i.value=d.value)}}s&&(s.pendingModelSelection=null),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort()}window.aipkit_task_cw_populateModels=r})();(function(){"use strict";function p(r){if(!r)return;let o=r.closest(".aipkit_slider_wrapper").querySelector(".aipkit_slider_value");o&&(o.textContent=r.value,r.dataset.listenerAttached||(r.addEventListener("input",()=>o.textContent=r.value),r.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleTemperatureSlider=p})();(function(){"use strict";function p(r){if(!r)return;let o=r.closest(".aipkit_slider_wrapper").querySelector(".aipkit_slider_value");o&&(o.textContent=r.value,r.dataset.listenerAttached||(r.addEventListener("input",()=>o.textContent=r.value),r.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleMaxTokensSlider=p})();(function(){"use strict";function p(r){let o=r.target,i=o.closest(".aipkit_wizard_content_step");if(!i)return;let e=i.querySelector("#aipkit_task_cw_schedule_options_wrapper"),t=i.querySelector("#aipkit_task_cw_smart_schedule_fields"),n=i.querySelector(".aipkit_task_schedule_from_input_option"),s=i.querySelector(".aipkit_task_schedule_from_input_help");if(!e)return;let a=o.value==="publish";e.style.display=a?"block":"none";let c=document.getElementById("aipkit_automated_task_type");if(n){let u=c&&c.value==="content_writing_rss";if(n.style.display=u?"none":"inline-flex",u){let f=n.querySelector('input[name="schedule_mode"][value="from_input"]');if(f&&f.checked){let _=i.querySelector('input[name="schedule_mode"][value="immediate"]');_&&(_.checked=!0,_.dispatchEvent(new Event("change",{bubbles:!0})))}}}i.querySelectorAll('input[name="schedule_mode"]').forEach(u=>{u.dataset.listenerAttached||(u.addEventListener("change",function(){if(t&&(t.style.display=this.value==="smart"?"block":"none"),s){let f=c&&c.value==="content_writing_rss";s.style.display=this.value==="from_input"&&!f?"block":"none"}}),u.dataset.listenerAttached="true")});let d=i.querySelector('input[name="schedule_mode"]:checked');if(d&&t&&(t.style.display=d.value==="smart"?"block":"none"),d&&s){let u=c&&c.value==="content_writing_rss";s.style.display=d.value==="from_input"&&!u?"block":"none"}}window.aipkit_toggleTaskCwScheduleFields=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||(t=>t);function r(t,n){let s=n.querySelector(".aipkit_task_cw_vector_openai_field"),a=n.querySelector(".aipkit_task_cw_vector_pinecone_field"),c=n.querySelector(".aipkit_task_cw_vector_qdrant_field"),l=n.querySelector(".aipkit_task_cw_vector_embedding_config_row");s&&(s.style.display="none"),a&&(a.style.display="none"),c&&(c.style.display="none"),l&&(l.style.display="none"),t==="openai"&&s?s.style.display="block":t==="pinecone"&&a&&l?(a.style.display="block",l.style.display="block"):t==="qdrant"&&c&&l&&(c.style.display="block",l.style.display="block")}function o(t){let n=t.querySelector("#aipkit_task_cw_vector_embedding_model");if(!n)return;let s=t.querySelector("#aipkit_task_cw_vector_embedding_provider"),a=s?s.value:"openai",c=window.aipkit_automated_tasks_config||{},l=window.aipkit_automated_tasks_form_state||{},d=[];if(a==="google"?d=c.google_embedding_models||[]:a==="azure"?d=c.azure_embedding_models||[]:d=c.openai_embedding_models||[],n.innerHTML="",d.length>0){n.add(new Option("-- Select Model --","")),d.forEach(f=>{n.add(new Option(p(f.name||f.id),f.id))}),n.disabled=!1;let u=l.pendingEmbeddingModelSelection;u&&(Array.from(n.options).find(_=>_.value===u)?(n.value=u,l.pendingEmbeddingModelSelection=null):console.warn("Embedding model not found in options:",u,"Available options:",Array.from(n.options).map(_=>_.value)))}else n.add(new Option("No models found","")),n.disabled=!0}function i(){let t=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_knowledge_base"]');if(!t||t.dataset.kbListenerAttached)return;let n=t.querySelector(".aipkit_task_cw_vector_store_toggle"),s=t.querySelector(".aipkit_task_cw_vector_store_settings_container"),a=t.querySelector(".aipkit_task_cw_vector_store_provider_select"),c=t.querySelector(".aipkit_task_cw_vector_embedding_provider_select");n&&s&&n.addEventListener("change",()=>{s.style.display=n.checked?"block":"none"}),a&&s&&(a.addEventListener("change",()=>r(a.value,s)),r(a.value,s)),c&&c.addEventListener("change",()=>{o(s)}),s&&o(s),t.dataset.kbListenerAttached="true"}function e(){let t=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_knowledge_base"]');if(!t)return;let n=t.querySelector(".aipkit_task_cw_vector_store_toggle"),s=t.querySelector(".aipkit_task_cw_vector_store_settings_container"),a=t.querySelector(".aipkit_task_cw_vector_store_provider_select");i(),n&&s&&(s.style.display=n.checked?"block":"none"),a&&s&&r(a.value,s),s&&o(s)}window.aipkit_initCwKnowledgeBaseUI=i,window.aipkit_cw_task_populateEmbeddingModelSelect=o,window.aipkit_updateCwKnowledgeBaseUI=e})();(function(){"use strict";function p(){let i=document.getElementById("aipkit_automated_task_form");if(!i){console.warn("Content Writing UI Init: Could not find main form element.");return}let e=i.querySelector("#aipkit_task_cw_ai_provider"),t=i.querySelector("#aipkit_task_cw_ai_model");e&&t&&typeof window.aipkit_task_cw_populateModels=="function"&&(e.dataset.cwProviderListenerAttached||(e.addEventListener("change",()=>window.aipkit_task_cw_populateModels(e,t)),e.dataset.cwProviderListenerAttached="true"),t.dataset.cwModelListenerAttached||(t.addEventListener("change",()=>{typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort()}),t.dataset.cwModelListenerAttached="true"),window.aipkit_dashboard?.models&&window.aipkit_task_cw_populateModels(e,t),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort());let n=i.querySelector("#aipkit_task_cw_ai_temperature");n&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(n);let s=i.querySelector("#aipkit_task_cw_content_max_tokens");s&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(s);let a=i.querySelector("#aipkit_task_cw_post_status");a&&typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&(a.dataset.cwStatusListenerAttached||(a.addEventListener("change",window.aipkit_toggleTaskCwScheduleFields),a.dataset.cwStatusListenerAttached="true"),window.aipkit_toggleTaskCwScheduleFields({target:a}));let c=i.querySelector("#aipkit_task_cw_generate_meta_desc"),l=i.querySelector(".aipkit_task_cw_custom_meta_prompt"),d=i.querySelector("#aipkit_task_cw_generate_focus_keyword"),u=i.querySelector(".aipkit_task_cw_custom_keyword_prompt"),f=i.querySelector("#aipkit_task_cw_generate_excerpt"),_=i.querySelector(".aipkit_task_cw_custom_excerpt_prompt"),m=i.querySelector("#aipkit_task_cw_generate_tags"),g=i.querySelector(".aipkit_task_cw_custom_tags_prompt"),k=()=>{l&&(l.style.display=c?.checked?"block":"none"),u&&(u.style.display=d?.checked?"block":"none"),_&&(_.style.display=f?.checked?"block":"none"),g&&(g.style.display=m?.checked?"block":"none")};c&&(c.dataset.cwSeoListenerAttached||(c.addEventListener("change",k),c.dataset.cwSeoListenerAttached="true")),d&&(d.dataset.cwSeoListenerAttached||(d.addEventListener("change",k),d.dataset.cwSeoListenerAttached="true")),f&&(f.dataset.cwSeoListenerAttached||(f.addEventListener("change",k),f.dataset.cwSeoListenerAttached="true")),m&&(m.dataset.cwSeoListenerAttached||(m.addEventListener("change",k),m.dataset.cwSeoListenerAttached="true")),k(),typeof window.aipkit_initTaskCsvUploadHandler=="function"&&window.aipkit_initTaskCsvUploadHandler(),window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan&&(typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():console.warn("AutoGPT CW UI: GSheets verification handler not found."),typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():console.warn("AutoGPT CW UI: URL Scrape handler not found."));let h=i.querySelector(".aipkit_task_cw_image_enable_toggle");h&&(h.dataset.cwImgListenerAttached||(h.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),h.dataset.cwImgListenerAttached="true"));let y=i.querySelector("#aipkit_task_cw_image_provider");y&&(y.dataset.cwImgListenerAttached||(y.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),y.dataset.cwImgListenerAttached="true"));let b=i.querySelector("#aipkit_task_cw_generate_featured_image");b&&(b.dataset.cwImgListenerAttached||(b.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),b.dataset.cwImgListenerAttached="true"));let v=i.querySelector(".aipkit_task_cw_image_placement_select");v&&(v.dataset.cwImgListenerAttached||(v.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),v.dataset.cwImgListenerAttached="true")),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{window.aipkit_updateTaskImageSettingsUI()},100)),typeof window.aipkit_initCwKnowledgeBaseUI=="function"&&window.aipkit_initCwKnowledgeBaseUI();let S=i.querySelector("#aipkit_task_cw_ai_settings_toggle"),C=i.querySelector("#aipkit_task_cw_ai_parameters_row");S&&C&&(S.dataset.cwAiSettingsListenerAttached||(S.addEventListener("click",()=>{let M=C.style.display==="none"||C.style.display==="";C.style.display=M?"block":"none",S.classList.toggle("aipkit_active",M),S.setAttribute("aria-expanded",M)}),S.dataset.cwAiSettingsListenerAttached="true"));let T=i.querySelector("#aipkit_task_config_ai");T&&(T.dataset.cwPromptListenerAttached||(T.addEventListener("click",M=>{let x=M.target.closest(".aipkit_textarea_toggle");if(!x)return;let L=x.dataset.target,A=document.getElementById(L),I=x.querySelector(".dashicons");if(!A||!I)return;A.classList.toggle("aipkit_collapsed")?(I.classList.remove("dashicons-minus"),I.classList.add("dashicons-plus-alt2"),x.title="Expand"):(I.classList.remove("dashicons-plus-alt2"),I.classList.add("dashicons-minus"),x.title="Collapse")}),T.dataset.cwPromptListenerAttached="true"));let E=i.querySelector("#aipkit_task_config_seo");E&&(E.dataset.cwSeoPromptListenerAttached||(E.addEventListener("click",M=>{let x=M.target.closest(".aipkit_textarea_toggle");if(!x)return;let L=x.dataset.target,A=document.getElementById(L),I=x.querySelector(".dashicons");if(!A||!I)return;A.classList.toggle("aipkit_collapsed")?(I.classList.remove("dashicons-minus"),I.classList.add("dashicons-plus-alt2"),x.title="Expand"):(I.classList.remove("dashicons-plus-alt2"),I.classList.add("dashicons-minus"),x.title="Collapse")}),E.dataset.cwSeoPromptListenerAttached="true"))}function r(){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let e=window.aipkit_debug||!1,t=i.querySelector(".aipkit_task_cw_image_enable_toggle"),n=i.querySelector("#aipkit_task_cw_generate_featured_image"),s=i.querySelector(".aipkit_task_cw_image_settings_container"),a=i.querySelector("#aipkit_task_cw_image_provider");if(!t||!n||!s||!a)return;let c=t.checked,l=n.checked,d=c||l,u=a.value,f=u==="pexels"||u==="pixabay";if(s.style.display=d?"block":"none",d){let _=["#aipkit_task_cw_image_count","#aipkit_task_cw_image_placement","#aipkit_task_cw_image_size","#aipkit_task_cw_image_alignment"],m=i.querySelector("#aipkit_task_cw_image_prompt")?.closest(".aipkit_form-group"),g=i.querySelector(".aipkit_task_cw_featured_image_prompt_field"),k=i.querySelector(".aipkit_task_cw_image_placement_select"),w=i.querySelector(".aipkit_task_cw_image_placement_x_field"),h=i.querySelector("#aipkit_task_cw_pexels_options"),y=i.querySelector("#aipkit_task_cw_pixabay_options"),b=i.querySelector("#aipkit_task_cw_image_model_group");if(_.forEach(v=>{let S=i.querySelector(v);if(S){let C=S.closest(".aipkit_form-group");C&&(C.style.display=c?"block":"none")}}),k&&w){let v=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(k.value);w.style.display=c&&v?"block":"none"}m&&(m.style.display=c&&!f?"block":"none"),g&&(g.style.display=l&&!f?"block":"none"),h&&(h.style.display=d&&f&&u==="pexels"?"flex":"none"),y&&(y.style.display=d&&f&&u==="pixabay"?"flex":"none"),b&&(b.style.display=d&&!f?"block":"none"),d&&!f&&typeof o=="function"&&o(u)}}function o(i){let e=document.getElementById("aipkit_task_cw_image_model");if(!e)return;let n=window.aipkit_dashboard?.imageGeneratorModels?.[i.toLowerCase()]||[],s=window.aipkit_escapeHtml||function(c){return c},a=window.aipkit_automated_tasks_form_state?.pendingImageModelSelection||e.value;e.innerHTML="",n.length>0?(n.forEach(c=>{e.appendChild(new Option(s(c.name),c.id))}),e.querySelector(`option[value="${CSS.escape(a)}"]`)&&(e.value=a)):e.appendChild(new Option("No models available","")),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=null)}window.aipkit_initContentWritingTaskFormUI=p,window.aipkit_updateTaskImageSettingsUI=r,window.aipkit_populateTaskImageModels=o})();(function(){"use strict";function p(){let r=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_comment_reply_ai"]');if(!r)return;let o=r.querySelector("#aipkit_task_cc_ai_provider"),i=r.querySelector("#aipkit_task_cc_ai_model");o&&i&&typeof window.aipkit_task_cw_populateModels=="function"&&(o.dataset.ccProviderListenerAttached||(o.addEventListener("change",()=>{window.aipkit_task_cw_populateModels(o,i),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),o.dataset.ccProviderListenerAttached="true"),i.dataset.ccModelListenerAttached||(i.addEventListener("change",()=>{typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),i.dataset.ccModelListenerAttached="true"),window.aipkit_task_cw_populateModels(o,i),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort());let e=r.querySelector("#aipkit_task_cc_ai_temperature");e&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(e);let t=r.querySelector("#aipkit_task_cc_content_max_tokens");t&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(t);let n=r.querySelector("#aipkit_task_cc_ai_settings_toggle"),s=r.querySelector("#aipkit_task_cc_ai_parameters_row");n&&s&&(n.dataset.ccAiSettingsListenerAttached||(n.addEventListener("click",()=>{let a=s.style.display==="none"||s.style.display==="";s.style.display=a?"block":"none",n.classList.toggle("aipkit_active",a),n.setAttribute("aria-expanded",a)}),n.dataset.ccAiSettingsListenerAttached="true"))}window.aipkit_initCommentReplyTaskFormUI=p})();(function(){"use strict";function p(){let r=document.querySelector("#aipkit_task_cw_ai_provider"),o=document.querySelector("#aipkit_task_cw_ai_model"),i=document.querySelector(".aipkit_task_cw_reasoning_effort_field");if(!r||!o||!i){i&&(i.style.display="none");return}let e=r.value,n=(o.value||"").toLowerCase(),s=n.startsWith("o1")||n.startsWith("o3")||n.startsWith("o4"),a=n.includes("gpt-5");e.toLowerCase()==="openai"&&(s||a)?i.style.display="block":i.style.display="none"}window.aipkit_autogpt_cw_toggleReasoningEffort=p})();(function(){"use strict";function p(){let r=document.querySelector("#aipkit_task_cc_ai_provider"),o=document.querySelector("#aipkit_task_cc_ai_model"),i=document.querySelector(".aipkit_task_cc_reasoning_effort_field");if(!r||!o||!i){i&&(i.style.display="none");return}let e=r.value,n=(o.value||"").toLowerCase(),s=n.startsWith("o1")||n.startsWith("o3")||n.startsWith("o4"),a=n.includes("gpt-5");e.toLowerCase()==="openai"&&(s||a)?i.style.display="block":i.style.display="none"}window.aipkit_autogpt_cc_toggleReasoningEffort=p})();(function(){"use strict";function p(r,o){let i=document.getElementById("aipkit_automated_task_form_title"),e=r.querySelector("#aipkit_save_task_btn"),t=e?e.querySelector(".aipkit_btn-text"):null,n=r.elements.task_id,s=r.elements.task_name,a=r.elements.task_type,c=r.elements.task_status,l=document.getElementById("aipkit_cancel_edit_task_btn"),u=(window.aipkit_automated_tasks_config||{}).text||{};o?(i&&(i.textContent=u.edit_task_title||"Edit Automated Task"),t&&(t.textContent=u.save_task_button||"Save Task"),n&&(n.value=o.id||""),s&&(s.value=o.task_name||""),a&&(a.value=o.task_type||"content_indexing"),c&&(c.value=o.status||"active"),l&&(l.style.display="inline-flex")):(i&&(i.textContent=u.create_task_title||"Create New Automated Task"),t&&(t.textContent=u.create_task_button||"Create Task"),n&&(n.value=""),s&&(s.value=""),a&&(a.value="content_indexing"),c&&(c.value="active"),l&&(l.style.display="inline-flex"))}window.aipkit_form_populateCommonFields=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};function r(o){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let e=i.elements["post_types[]"];e&&(Array.from(e.options).forEach(n=>n.selected=!1),(o.post_types||[]).forEach(n=>{let s=e.querySelector(`option[value="${p(n)}"]`);s&&(s.selected=!0)}));let t=i.elements.target_store_provider;t&&(t.value=o.target_store_provider||"openai",t.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"&&window.aipkit_populateTargetStoreSelectForContentIndexing(o.target_store_provider||"openai").then(()=>{let n=i.elements.target_store_id;n&&(n.value=o.target_store_id||"")}),i.elements.index_existing_now_flag&&(i.elements.index_existing_now_flag.checked=o.index_existing_now_flag==="1"),i.elements.only_new_updated_flag&&(i.elements.only_new_updated_flag.checked=o.only_new_updated_flag==="1"),(o.target_store_provider==="pinecone"||o.target_store_provider==="qdrant")&&(window.aipkit_automated_tasks_form_state&&o.embedding_provider&&o.embedding_model&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=`${o.embedding_provider}:${o.embedding_model}`),typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()),i.elements.task_frequency&&(i.elements.task_frequency.value=o.indexing_frequency||"daily")}window.aipkit_form_populateContentIndexingFields=r})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};function r(o){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let e=o.cw_generation_mode||"bulk";if(e==="bulk"||e==="single"||e==="task"){let b=i.elements.content_title_bulk;b&&(b.value=o.content_title||"")}else if(e==="csv"){let b=i.elements.content_title;b&&(b.value=o.content_title||"")}else if(e==="rss")i.elements.rss_feeds&&(i.elements.rss_feeds.value=o.rss_feeds||""),i.elements.rss_include_keywords&&(i.elements.rss_include_keywords.value=o.rss_include_keywords||""),i.elements.rss_exclude_keywords&&(i.elements.rss_exclude_keywords.value=o.rss_exclude_keywords||"");else if(e==="url")i.elements.url_list&&(i.elements.url_list.value=o.url_list||"");else if(e==="gsheets"){let b=i.elements.gsheets_credentials;if(b){let v=o.gsheets_credentials,S=b.closest(".aipkit_gsheets_section_container");typeof v=="object"&&v!==null?b.value=JSON.stringify(v,null,2):b.value=v||"",b.value?(b.dataset.filename="credentials.json",S&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(S),100)):(delete b.dataset.filename,S&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(S,"clear"))}i.elements.gsheets_sheet_id&&(i.elements.gsheets_sheet_id.value=o.gsheets_sheet_id||"")}i.elements.custom_title_prompt&&(i.elements.custom_title_prompt.value=o.custom_title_prompt||""),i.elements.custom_content_prompt&&(i.elements.custom_content_prompt.value=o.custom_content_prompt||"");let t=document.getElementById("aipkit_task_cw_ai_provider"),n=document.getElementById("aipkit_task_cw_ai_model");t&&(t.value=o.ai_provider?o.ai_provider.toLowerCase():"openai",o.ai_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=o.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&n&&window.aipkit_task_cw_populateModels(t,n));let s=document.getElementById("aipkit_task_cw_ai_temperature");if(s){s.value=o.ai_temperature||"1.0";let b=document.getElementById("aipkit_task_cw_ai_temperature_value");b&&(b.textContent=s.value)}let a=document.getElementById("aipkit_task_cw_content_max_tokens");if(a){a.value=o.content_max_tokens||"4000";let b=document.getElementById("aipkit_task_cw_content_max_tokens_value");b&&(b.textContent=a.value)}let c=i.elements.reasoning_effort;c&&(c.value=o.reasoning_effort||"low"),n&&typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&setTimeout(()=>n.dispatchEvent(new Event("change",{bubbles:!0})),100),i.elements.generate_meta_description&&(i.elements.generate_meta_description.checked=o.generate_meta_description==="1"),i.elements.custom_meta_prompt&&(i.elements.custom_meta_prompt.value=o.custom_meta_prompt||""),i.elements.generate_focus_keyword&&(i.elements.generate_focus_keyword.checked=o.generate_focus_keyword==="1"),i.elements.custom_keyword_prompt&&(i.elements.custom_keyword_prompt.value=o.custom_keyword_prompt||""),i.elements.generate_excerpt&&(i.elements.generate_excerpt.checked=o.generate_excerpt==="1"),i.elements.custom_excerpt_prompt&&(i.elements.custom_excerpt_prompt.value=o.custom_excerpt_prompt||""),i.elements.generate_tags&&(i.elements.generate_tags.checked=o.generate_tags==="1"),i.elements.custom_tags_prompt&&(i.elements.custom_tags_prompt.value=o.custom_tags_prompt||""),i.elements.generate_toc&&(i.elements.generate_toc.checked=o.generate_toc==="1"),i.elements.generate_seo_slug&&(i.elements.generate_seo_slug.checked=o.generate_seo_slug==="1"),i.elements.post_type&&(i.elements.post_type.value=o.post_type||"post");let l=i.elements.post_author;l&&(l.value=o.post_author||window.aipkit_dashboard?.currentUserId||"1");let d=document.getElementById("aipkit_task_cw_post_status");d&&(d.value=o.post_status||"draft");let u=o.schedule_mode||"immediate",f=i.querySelector(`input[name="schedule_mode"][value="${u}"]`);f&&(f.checked=!0),i.elements.smart_schedule_start_datetime&&(i.elements.smart_schedule_start_datetime.value=o.smart_schedule_start_datetime||""),i.elements.smart_schedule_interval_value&&(i.elements.smart_schedule_interval_value.value=o.smart_schedule_interval_value||"1"),i.elements.smart_schedule_interval_unit&&(i.elements.smart_schedule_interval_unit.value=o.smart_schedule_interval_unit||"hours"),typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&window.aipkit_toggleTaskCwScheduleFields({target:d});let _=document.getElementById("aipkit_task_cw_post_categories");_&&_.options&&(Array.from(_.options).forEach(v=>v.selected=!1),(Array.isArray(o.post_categories)?o.post_categories.map(String):[]).forEach(v=>{let S=_.querySelector(`option[value="${p(v)}"]`);S&&(S.selected=!0)})),i.elements.generate_images_enabled&&(i.elements.generate_images_enabled.checked=o.generate_images_enabled==="1"),i.elements.image_provider&&(i.elements.image_provider.value=(o.image_provider||"openai").toLowerCase()),i.elements.image_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=o.image_model),i.elements.image_prompt&&(i.elements.image_prompt.value=o.image_prompt||""),i.elements.image_count&&(i.elements.image_count.value=o.image_count||"1"),i.elements.image_placement&&(i.elements.image_placement.value=o.image_placement||"after_first_h2"),i.elements.image_placement_param_x&&(i.elements.image_placement_param_x.value=o.image_placement_param_x||"2"),i.elements.image_size&&(i.elements.image_size.value=o.image_size||"large"),i.elements.image_alignment&&(i.elements.image_alignment.value=o.image_alignment||"none"),i.elements.generate_featured_image&&(i.elements.generate_featured_image.checked=o.generate_featured_image==="1"),i.elements.featured_image_prompt&&(i.elements.featured_image_prompt.value=o.featured_image_prompt||""),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI();let m=i.querySelector('input[name="enable_vector_store"]');m&&(m.checked=o.enable_vector_store==="1");let g=i.querySelector("#aipkit_task_cw_vector_store_provider");g&&(g.value=o.vector_store_provider||"openai");let k=i.querySelector("#aipkit_task_cw_vector_store_top_k");k&&(k.value=o.vector_store_top_k||"3");let w=document.getElementById("aipkit_task_cw_openai_vector_store_ids");if(w&&w.options){let b=Array.isArray(o.openai_vector_store_ids)?o.openai_vector_store_ids.map(String):[];Array.from(w.options).forEach(v=>{v.selected=b.includes(v.value)})}let h=document.getElementById("aipkit_task_cw_pinecone_index_name");h&&(h.value=o.pinecone_index_name||"");let y=document.getElementById("aipkit_task_cw_qdrant_collection_name");if(y&&(y.value=o.qdrant_collection_name||""),o.vector_store_provider==="pinecone"||o.vector_store_provider==="qdrant"){let b=document.getElementById("aipkit_task_cw_vector_embedding_provider");b&&(b.value=o.vector_embedding_provider||"openai")}typeof window.aipkit_updateCwKnowledgeBaseUI=="function"&&window.aipkit_updateCwKnowledgeBaseUI(),o.vector_store_provider&&(o.vector_store_provider==="pinecone"||o.vector_store_provider==="qdrant")&&o.vector_embedding_model&&setTimeout(()=>{window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=o.vector_embedding_model);let b=document.querySelector(".aipkit_task_cw_vector_store_settings_container");b&&typeof window.aipkit_cw_task_populateEmbeddingModelSelect=="function"&&window.aipkit_cw_task_populateEmbeddingModelSelect(b)},150),i.elements.task_frequency&&(i.elements.task_frequency.value=o.task_frequency||"daily")}window.aipkit_form_populateContentWritingFields=r})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_automated_task_form");if(!o)return;let i=document.getElementById("aipkit_task_cc_ai_provider"),e=document.getElementById("aipkit_task_cc_ai_model");i&&e&&(i.value=r.ai_provider?r.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&r.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=r.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&window.aipkit_task_cw_populateModels(i,e));let t=document.getElementById("aipkit_task_cc_ai_temperature");if(t){t.value=r.ai_temperature||1;let _=document.getElementById(t.id+"_value");_&&(_.textContent=t.value)}let n=document.getElementById("aipkit_task_cc_content_max_tokens");if(n){n.value=r.content_max_tokens||4e3;let _=document.getElementById(n.id+"_value");_&&(_.textContent=n.value)}let s=o.elements.cc_reasoning_effort;s&&(s.value=r.reasoning_effort||"low"),e&&typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&setTimeout(()=>e.dispatchEvent(new Event("change",{bubbles:!0})),100);let a=document.getElementById("aipkit_task_cc_custom_content_prompt");a&&(a.value=r.custom_content_prompt||"");let c=document.getElementById("aipkit_task_comment_reply_include_keywords");c&&(c.value=r.include_keywords||"");let l=document.getElementById("aipkit_task_comment_reply_exclude_keywords");l&&(l.value=r.exclude_keywords||"");let d=o.elements["post_types_for_comments[]"];d&&(Array.from(d.options).forEach(_=>_.selected=!1),(r.post_types_for_comments||[]).forEach(_=>{let m=d.querySelector(`option[value="${_}"]`);m&&(m.selected=!0)}));let u=o.elements.reply_action;u&&(u.value=r.reply_action||"approve");let f=o.elements.no_reply_to_replies;f&&(f.checked=r.no_reply_to_replies==="1"),o.elements.task_frequency&&(o.elements.task_frequency.value=r.task_frequency||"hourly")}window.aipkit_form_populateCommentReplyFields=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_automated_task_form"),o=window.aipkit_automated_tasks_config||{},i=window.aipkit_dashboard||{},e=o.default_cw_prompts||{};if(!r)return;r.elements.custom_title_prompt&&(r.elements.custom_title_prompt.value=e.title||""),r.elements.custom_content_prompt&&(r.elements.custom_content_prompt.value=e.content||""),r.elements.custom_meta_prompt&&(r.elements.custom_meta_prompt.value=e.meta||""),r.elements.custom_keyword_prompt&&(r.elements.custom_keyword_prompt.value=e.keyword||""),r.elements.image_prompt&&(r.elements.image_prompt.value=e.image||""),r.elements.featured_image_prompt&&(r.elements.featured_image_prompt.value=e.featured_image||"");let t=document.getElementById("aipkit_task_cw_ai_provider"),n=document.getElementById("aipkit_task_cw_ai_model");if(t&&n){let s=(i.main_provider||"openai").toLowerCase();if(t.value=s,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(t,n);let a="",c=i?.models?.[s];switch(s){case"openai":a="gpt-4.1-mini";break;case"google":a="gemini-1.5-flash-latest";break;case"openrouter":a="anthropic/claude-3.5-sonnet";break;case"azure":case"deepseek":case"ollama":Array.isArray(c)&&c.length>0&&(a=c[0].id||"");break}n.querySelector(`option[value="${CSS.escape(a)}"]`)?n.value=a:console.warn(`Default model ${a} not found for provider ${s}.`)}}r.elements.generate_images_enabled&&(r.elements.generate_images_enabled.checked=!1),r.elements.image_provider&&(r.elements.image_provider.value="openai"),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{r.elements.image_model&&(r.elements.image_model.value="gpt-image-1")},0)),r.elements.image_count&&(r.elements.image_count.value="1"),r.elements.image_placement&&(r.elements.image_placement.value="after_first_h2"),r.elements.generate_featured_image&&(r.elements.generate_featured_image.checked=!1)}window.aipkit_form_setContentWritingDefaults=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_automated_task_form"),o=window.aipkit_dashboard||{};if(!r)return;let i=document.getElementById("aipkit_task_cc_custom_content_prompt");i&&(i.value=`Write a helpful and friendly reply to this comment on my blog post titled '{post_title}'.

Comment: {comment_content}`);let e=document.getElementById("aipkit_task_cc_ai_provider"),t=document.getElementById("aipkit_task_cc_ai_model");if(e&&t){let n=(o.main_provider||"openai").toLowerCase();if(e.value=n,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(e,t);let s="",a=(o.models||{})[n]||{};switch(n){case"openai":s="gpt-4o-mini";break;case"google":s="gemini-1.5-flash-latest";break;case"openrouter":s="anthropic/claude-3.5-sonnet";break;case"azure":case"deepseek":case"ollama":Array.isArray(a)&&a.length>0&&(s=a[0].id||"");break}t.querySelector(`option[value="${CSS.escape(s)}"]`)&&(t.value=s)}}}window.aipkit_form_setCommentReplyDefaults=p})();(function(){"use strict";function p(r,o,i,e=null){let t=document.getElementById("aipkit_automated_task_form"),n=document.getElementById("aipkit_automated_task_queue_wrapper");if(!t){console.error("Show Task Form: Core form element not found.");return}if(typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard(),t.reset(),t.elements.task_id&&(t.elements.task_id.value=""),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=null),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),e){let c=((window.aipkit_automated_tasks_config||{}).task_types||{})[e.task_type];if(c){let l=t.elements.task_category;if(l){l.value=c.category;let d=new Event("change",{bubbles:!0});l.dispatchEvent(d)}}}else{let a=t.elements.task_category,c=t.elements.task_type;a&&c&&(a.value="content_creation",a.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{c.value="content_writing_bulk",c.dispatchEvent(new Event("change",{bubbles:!0}))},0))}typeof window.aipkit_form_populateCommonFields=="function"?window.aipkit_form_populateCommonFields(t,e):(console.error("Show Task Form: aipkit_form_populateCommonFields function is missing."),document.getElementById("aipkit_automated_task_form_title").textContent=e?"Edit Task":"Create Task");let s=t.elements.task_type;if(s&&typeof window.aipkit_form_handleTaskTypeChange=="function"&&window.aipkit_form_handleTaskTypeChange({target:s}),e){let a=JSON.parse(e.task_config||"{}");e.task_type==="content_indexing"?typeof window.aipkit_form_populateContentIndexingFields=="function"?window.aipkit_form_populateContentIndexingFields(a):console.error("Show Task Form: aipkit_form_populateContentIndexingFields function is missing."):e.task_type.startsWith("content_writing")?typeof window.aipkit_form_populateContentWritingFields=="function"?window.aipkit_form_populateContentWritingFields(a):console.error("Show Task Form: aipkit_form_populateContentWritingFields function is missing."):e.task_type==="community_reply_comments"?typeof window.aipkit_form_populateCommentReplyFields=="function"?window.aipkit_form_populateCommentReplyFields(a):console.error("Show Task Form: aipkit_form_populateCommentReplyFields function is missing."):e.task_type==="enhance_existing_content"&&(typeof window.aipkit_form_populateContentEnhancementFields=="function"?window.aipkit_form_populateContentEnhancementFields(a):console.error("Show Task Form: aipkit_form_populateContentEnhancementFields function is missing."))}r&&(r.style.display="block"),o&&(o.style.display="none"),n&&(n.style.display="none"),i&&(i.style.display="none")}window.aipkit_form_showAutomatedTaskForm=p})();(function(){"use strict";function p(r,o,i){let e=document.getElementById("aipkit_automated_task_queue_wrapper");r&&(r.style.display="none"),o&&(o.style.display="block"),e&&(e.style.display="block"),i&&(i.style.display="inline-flex");let t=document.getElementById("aipkit_automated_task_form"),n=document.getElementById("aipkit_automated_task_id"),s=document.getElementById("aipkit_automated_task_category");t&&t.reset(),n&&(n.value=""),s&&(s.value="",s.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_form_hideAutomatedTaskForm=p})();(function(){"use strict";function p(i,e){let t=document.getElementById(i),n=window.aipkit_escapeHtml||function(d){return d};if(!t)return;let s=e.startsWith("content_writing_")?e.replace("content_writing_",""):"bulk",a=["{topic}","{keywords}"];s==="rss"?(a.push("{description}"),a.push("{source_url}")):s==="url"&&a.push("{url_content}");let l=("Use placeholders: "+a.join(", ")+".").replace(/(\{[a-zA-Z0-9_]+\})/g,d=>`<code class="aipkit-placeholder" title="Click to copy">${n(d)}</code>`);t.innerHTML=l}function r(i){let e=i.target.value,t=document.getElementById("aipkit_automated_task_type"),n=(window.aipkit_automated_tasks_config||{}).task_types||{},s=window.aipkit_escapeHtml||function(l){return l};t.innerHTML="",t.disabled=!0;let a=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(a&&a.querySelectorAll(".aipkit_task_config_section").forEach(l=>{l.id==="aipkit_task_cw_input_modes_wrapper"&&l.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(d=>{d.style.display="none"}),l.style.display="none"}),!e){t.appendChild(new Option(s("-- Select a category first --"),"")),t.dispatchEvent(new Event("change",{bubbles:!0}));return}let c=Object.entries(n).filter(([l,d])=>d.category===e);c.length===0?t.appendChild(new Option(s("-- No tasks in this category --"),"")):(t.appendChild(new Option(s("-- Select a Task Type --"),"")),c.forEach(([l,d])=>{let u=new Option(s(d.label),l);d.disabled&&(u.disabled=!0),t.appendChild(u)}),t.disabled=!1),e==="knowledge_base"?t.value="content_indexing":e==="community_engagement"?t.value="community_reply_comments":e==="content_enhancement"&&(t.value="enhance_existing_content"),t.dispatchEvent(new Event("change",{bubbles:!0}))}function o(i){let e=i.target.value,t=document.getElementById("aipkit_automated_task_id"),n=!t||!t.value,s=document.getElementById("aipkit_wizard_next_btn"),a=s?s.querySelector(".aipkit_btn-text"):null,c=document.getElementById("aipkit_save_task_btn"),l=c?c.querySelector(".aipkit_btn-text"):null,d=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,f=((window.aipkit_automated_tasks_config||{}).task_types||{})[e],_=f&&f.pro===!0,m=(window.aipkit_automated_tasks_config||{}).text||{};if(_&&!d)a&&s&&(s.dataset.action="upgrade",a.textContent="Upgrade to Pro"),l&&c&&(c.dataset.action="upgrade",l.textContent="Upgrade to Pro");else if(a&&s&&(s.dataset.action="next",a.textContent=m.wizard_next_button||"Next"),l&&c){c.dataset.action="save";let b=t&&t.value;l.textContent=b?m.save_task_button||"Save Task":m.create_task_button||"Create Task"}typeof window.aipkit_renderWizard=="function"?window.aipkit_renderWizard(e):console.error("Task Type Change: aipkit_renderWizard function is missing.");let g=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(!g){console.error("Task Type Change: Could not find setup pane.");return}let k=g.querySelector("#aipkit_task_ci_source_wrapper"),w=g.querySelector("#aipkit_task_cw_input_modes_wrapper"),h=g.querySelector("#aipkit_task_cc_source_wrapper"),y=g.querySelector("#aipkit_task_ce_content_selection_wrapper");if(k&&(k.style.display="none"),w&&(w.style.display="none"),h&&(h.style.display="none"),y&&(y.style.display="none"),!!e){if(e==="content_indexing")k&&(k.style.display="block");else if(e.startsWith("content_writing")){if(p("aipkit_task_cw_content_prompt_placeholders",e),p("aipkit_task_cw_image_prompt_placeholders",e),w){w.style.display="block";let b=e.replace("content_writing_",""),v=b==="content_writing"?"bulk":b;w.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(S=>{S.id===`aipkit_task_cw_input_mode_${v}`?S.style.display="block":S.style.display="none"})}}else if(e==="community_reply_comments")h&&(h.style.display="block");else if(e==="enhance_existing_content"){y&&(y.style.display="block");let b=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),v=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(b&&v){let S=b.querySelector("#aipkit_task_ce_post_types");if(S&&!S.dataset.placeholderListenerAttached){let C=()=>{let E=Array.from(S.selectedOptions).map(x=>x.value).includes("product");v.querySelectorAll(".aipkit-product-placeholders").forEach(x=>{x.style.display=E?"inline":"none"})};S.addEventListener("change",C),S.dataset.placeholderListenerAttached="true",C()}}}n&&(e.startsWith("content_writing")?typeof window.aipkit_form_setContentWritingDefaults=="function"&&window.aipkit_form_setContentWritingDefaults():e==="community_reply_comments"?typeof window.aipkit_form_setCommentReplyDefaults=="function"&&window.aipkit_form_setCommentReplyDefaults():e==="enhance_existing_content"&&typeof window.aipkit_form_setContentEnhancementDefaults=="function"&&window.aipkit_form_setContentEnhancementDefaults()),e==="content_indexing"?typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI():e.startsWith("content_writing")?typeof window.aipkit_initContentWritingTaskFormUI=="function"&&window.aipkit_initContentWritingTaskFormUI():e==="community_reply_comments"?typeof window.aipkit_initCommentReplyTaskFormUI=="function"&&window.aipkit_initCommentReplyTaskFormUI():e==="enhance_existing_content"&&(typeof window.aipkit_initContentEnhancementTaskFormUI=="function"?setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0):console.error("[handleTaskTypeChange] aipkit_initContentEnhancementTaskFormUI not found!"))}}window.aipkit_form_handleCategoryChange=r,window.aipkit_form_handleTaskTypeChange=o})();(function(){"use strict";function p(r,o="info"){let i=document.getElementById("aipkit_automated_task_form_status");if(i){if(!r){i.textContent="",i.className="aipkit_form-help";return}i.textContent=r,i.className=`aipkit_form-help aipkit_settings_message-${o}`,setTimeout(()=>{i.textContent===r&&(i.textContent="",i.className="aipkit_form-help")},5e3)}}window.aipkit_form_showAutomatedTaskFormStatus=p})();(function(){"use strict";function p(r){let o=new FormData(r),i=Object.fromEntries(o.entries());return i.task_type=document.getElementById("aipkit_automated_task_type").value,{formData:o,data:i}}window.aipkit_save_task_extractBaseData=p})();(function(){"use strict";function p(r,o){if(r.task_type==="content_indexing"){if(r.post_types=o.getAll("post_types[]"),r.target_store_provider=o.get("target_store_provider")||"openai",r.target_store_id=o.get("target_store_id")||"",r.target_store_provider==="pinecone"||r.target_store_provider==="qdrant"){let e=o.get("embedding_model")||"";if(e&&e.includes(":")){let[t,n]=e.split(":",2);r.embedding_provider=t,r.embedding_model=n}else r.embedding_provider="",r.embedding_model=e}else delete r.embedding_provider,delete r.embedding_model;["ai_provider","ai_model","content_title_bulk","content_keywords","ai_temperature","content_max_tokens","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","enable_vector_store","vector_store_provider","openai_vector_store_ids","openai_vector_store_ids[]","pinecone_index_name","qdrant_collection_name","vector_store_top_k","csv_file_input","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(e=>delete r[e])}else delete r.post_types,delete r["post_types[]"],delete r.target_store_provider,delete r.target_store_id,delete r.index_existing_now_flag,delete r.only_new_updated_flag,delete r.embedding_model,delete r.embedding_provider;return r}window.aipkit_save_task_handleContentIndexing=p})();(function(){"use strict";function p(r,o){return r.task_type.startsWith("content_writing")?(r.post_categories=o.getAll("post_categories[]"),r.openai_vector_store_ids=o.getAll("openai_vector_store_ids[]"),delete r["post_categories[]"],delete r["openai_vector_store_ids[]"],["post_types","post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(e=>delete r[e])):(delete r.content_title,delete r.content_title_bulk,delete r.content_keywords,delete r.ai_temperature,delete r.content_max_tokens,delete r.post_type,delete r.post_author,delete r.post_status,delete r["post_categories[]"],delete r.post_categories,delete r.prompt_mode,delete r.custom_title_prompt,delete r.custom_content_prompt,delete r.generate_meta_description,delete r.custom_meta_prompt,delete r.generate_focus_keyword,delete r.custom_keyword_prompt,delete r.cw_generation_mode,delete r.rss_feeds,delete r.gsheets_sheet_id,delete r.gsheets_credentials,delete r.url_list,delete r.generate_toc,delete r.generate_images_enabled,delete r.image_provider,delete r.image_model,delete r.image_prompt,delete r.image_count,delete r.image_placement,delete r.image_placement_param_x,delete r.image_alignment,delete r.image_size,delete r.generate_featured_image,delete r.featured_image_prompt,delete r.pexels_orientation,delete r.pexels_size,delete r.pexels_color,delete r.pixabay_orientation,delete r.pixabay_image_type,delete r.pixabay_category,delete r.enable_vector_store,delete r.vector_store_provider,delete r["openai_vector_store_ids[]"],delete r.openai_vector_store_ids,delete r.pinecone_index_name,delete r.qdrant_collection_name,delete r.vector_embedding_provider,delete r.vector_embedding_model,delete r.vector_store_top_k,delete r.rss_include_keywords,delete r.rss_exclude_keywords),r}window.aipkit_save_task_handleContentWriting=p})();(function(){"use strict";function p(r){let i=(window.aipkit_automated_tasks_config||{}).text||{};if(!r.task_name)return i.task_name_required||"Task name is required.";if(!r.task_type)return i.task_type_required||"Task type is required.";if(r.task_type==="content_indexing"){if(!r.target_store_id)return i.target_store_required||"A target vector store/index must be selected.";if(!r.post_types||r.post_types.length===0)return i.content_type_required||"Please select content types for indexing.";if(r.target_store_provider==="pinecone"||r.target_store_provider==="qdrant"){if(!r.embedding_provider)return i.embedding_provider_required||"Embedding provider is required for this vector provider.";if(!r.embedding_model)return i.embedding_model_required||"Embedding model is required for this vector provider."}}if(r.task_type.startsWith("content_writing")){let e=r.cw_generation_mode;if(e==="bulk"||e==="csv"||e==="single"){if(!r.content_title)return i.content_title_required_cw_task||"Content Title/Topic is required for this Content Writing task mode."}else{if(e==="rss"&&!r.rss_feeds)return"RSS Feed URLs are required for this task mode.";if(e==="url"&&!r.url_list)return"Website URLs are required for this task mode.";if(e==="gsheets"&&(!r.gsheets_sheet_id||!r.gsheets_credentials))return"Google Sheet ID and Credentials are required for this task mode."}if(!r.ai_provider||!r.ai_model)return i.ai_config_required_cw_task||"AI Provider and Model are required for Content Writing task."}return!0}window.aipkit_save_task_validateData=p})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_automated_task_form");if(!o)return console.error("Wizard Validation: Form element not found."),"An internal error occurred: Form not found.";let i=document.querySelector(`.aipkit_wizard_step[data-step="${r}"]`);if(!i)return console.warn(`Validation: Step indicator for step ${r} not found.`),!0;let e=i.dataset.contentId;if(!e)return console.warn(`Validation: Could not find content ID for step ${r}`),!0;let t=(window.aipkit_automated_tasks_config||{}).text||{};switch(e){case"task_form_setup":{if(!o.elements.task_name.value.trim())return t.task_name_required||"Task name is required.";if(!o.elements.task_category.value)return"Task category is required.";let n=o.elements.task_type.value;if(!n)return t.task_type_required||"Task type is required.";if(n==="content_indexing"){let s=o.elements["post_types[]"];if(!s||!Array.from(s.selectedOptions).some(a=>a.value))return t.content_type_required||"Please select at least one post type to index."}else if(n.startsWith("content_writing")){let s=n.replace("content_writing_","");if(s==="bulk"&&!o.elements.content_title_bulk.value.trim())return"At least one topic is required for Bulk mode.";if(s==="csv"){let a=document.getElementById("aipkit_task_cw_csv_data_holder");if(!a||!a.value.trim())return"A parsed CSV file is required for CSV mode."}if(s==="rss"&&!o.elements.rss_feeds.value.trim())return"RSS Feed URL(s) are required for RSS mode.";if(s==="url"&&!o.elements.url_list.value.trim())return"Website URL(s) are required for URL mode.";if(s==="gsheets"&&!o.elements.gsheets_sheet_id.value.trim())return"Google Sheet ID is required for Google Sheets mode."}else if(n==="enhance_existing_content"){let s=document.getElementById("aipkit_task_ce_post_types");if(!s||!Array.from(s.selectedOptions).some(u=>u.value))return"Please select at least one post type to enhance.";let a=document.getElementById("aipkit_task_ce_update_title"),c=document.getElementById("aipkit_task_ce_update_excerpt"),l=document.getElementById("aipkit_task_ce_update_content"),d=document.getElementById("aipkit_task_ce_update_meta");if(!a?.checked&&!c?.checked&&!d?.checked&&!l?.checked)return"Please select at least one field to enhance (Title, Excerpt, Content, or Meta Description)."}break}case"task_config_ai":{let n=o.elements.custom_content_prompt;if(!n||!n.value.trim())return"The Content Prompt cannot be empty.";break}case"task_config_content_indexing":{if(!o.elements.target_store_id.value)return t.target_store_required||"A target vector store/index must be selected.";if(o.elements.target_store_provider.value==="pinecone"||o.elements.target_store_provider.value==="qdrant"){if(!o.elements.embedding_provider.value)return"Embedding provider is required for this vector provider.";if(!o.elements.embedding_model.value)return"Embedding model is required for this vector provider."}break}case"task_config_seo":case"task_form_image_settings":case"task_config_content_writing":break;default:break}return!0}window.aipkit_form_validateWizardStep=p})();(function(){"use strict";async function p(r){let o=window.aipkit_automated_tasks_config||{},i={...r,_ajax_nonce:o.nonce_manage_tasks};return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("API request function is missing.")):await window.aipkit_apiRequest("aipkit_save_automated_task",i)}window.aipkit_save_task_submitRequest=p})();(function(){"use strict";function p(){typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_form_hideAutomatedTaskForm=="function"&&window.aipkit_form_hideAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"))}window.aipkit_save_task_finalizeSuccess=p})();(function(){"use strict";async function p(r){if(r.preventDefault(),window.aipkit_automated_tasks_form_state.isSubmitting)return;let o=r.target,i=o.querySelector("#aipkit_save_task_btn");if(i&&i.dataset.action==="upgrade"){let s=window.aipkit_dashboard?.upgradeUrl;s?window.open(s,"_blank"):console.error("Upgrade URL not found.");return}window.aipkit_automated_tasks_form_state.isSubmitting=!0;let e=(window.aipkit_automated_tasks_config||{}).text||{},n=!!(o.elements.task_id&&o.elements.task_id.value)?e.save_task_button||"Save Task":e.create_task_button||"Create Task";try{let{formData:s,data:a}=window.aipkit_save_task_extractBaseData(o),c;a.task_type==="content_indexing"?c=window.aipkit_save_task_handleContentIndexing(a,s):a.task_type.startsWith("content_writing")?c=window.aipkit_save_task_handleContentWriting(a,s):a.task_type==="enhance_existing_content"?c=window.aipkit_save_task_handleContentEnhancement(a,s):c=a;let l=window.aipkit_save_task_validateData(c);if(l!==!0)throw typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(l,"error"),new Error("Validation failed: "+l);typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!0,n,e.saving_task||"Saving..."),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(e.saving_task||"Saving task...","info");let d=await window.aipkit_save_task_submitRequest(c);typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(d.message||"Task saved successfully!","success"),typeof window.aipkit_save_task_finalizeSuccess=="function"&&window.aipkit_save_task_finalizeSuccess()}catch(s){console.error("Save Task Error:",s),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&s.message.indexOf("Validation failed:")===-1&&window.aipkit_form_showAutomatedTaskFormStatus(`Error: ${s.message||"Failed to save task."}`,"error")}finally{window.aipkit_automated_tasks_form_state.isSubmitting=!1,typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!1,n)}}window.aipkit_form_handleSaveTask=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_automated_task_form"),o=document.getElementById("aipkit_automated_task_category"),i=document.getElementById("aipkit_automated_task_type"),e=document.getElementById("aipkit_cancel_edit_task_btn"),t=document.getElementById("aipkit_automated_task_form_wrapper"),n=document.getElementById("aipkit_automated_task_list_wrapper"),s=document.getElementById("aipkit_add_new_task_btn");typeof window.aipkit_initWizardNavigation=="function"?window.aipkit_initWizardNavigation():console.error("Automated Task Form Init: Wizard Navigation function not found."),r&&typeof window.aipkit_form_handleSaveTask=="function"?r.addEventListener("submit",window.aipkit_form_handleSaveTask):r&&console.error("Automated Task Form Init: handleSaveTask function not found."),o&&typeof window.aipkit_form_handleCategoryChange=="function"?o.addEventListener("change",window.aipkit_form_handleCategoryChange):o&&console.error("Automated Task Form Init: handleCategoryChange function not found."),i&&typeof window.aipkit_form_handleTaskTypeChange=="function"?(i.addEventListener("change",window.aipkit_form_handleTaskTypeChange),window.aipkit_form_handleTaskTypeChange({target:i})):i&&console.error("Automated Task Form Init: handleTaskTypeChange function not found."),e&&typeof window.aipkit_form_hideAutomatedTaskForm=="function"?e.addEventListener("click",()=>{window.aipkit_form_hideAutomatedTaskForm(t,n,s)}):e&&console.error("Automated Task Form Init: hideAutomatedTaskForm function not found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI()}window.aipkit_form_initAutomatedTaskForm=p})();(function(){"use strict";let p=!1,r=null,o=null;window.aipkit_automated_tasks_form_state={get isSubmitting(){return p},set isSubmitting(e){p=e},get pendingModelSelection(){return r},set pendingModelSelection(e){r=e},get pendingEmbeddingModelSelection(){return o},set pendingEmbeddingModelSelection(e){o=e}};function i(){typeof window.aipkit_form_initAutomatedTaskForm=="function"?window.aipkit_form_initAutomatedTaskForm():console.error("Automated Tasks Form Handler: aipkit_form_initAutomatedTaskForm function not found.")}window.aipkit_initAutomatedTaskForm=i})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_automated_tasks_tbody"),i=window.aipkit_automated_tasks_config||{},e=i.text||{},t=window.aipkit_escapeHtml||function(l){return l},n=window.aipkit_ucfirst||function(l){return l?l.charAt(0).toUpperCase()+l.slice(1):""},s=i.frequencies||{},a=window.aipkit_automated_tasks_list_state;if(document.querySelectorAll("#aipkit_automated_task_list_wrapper th.aipkit-sortable-col").forEach(l=>{l.removeAttribute("data-sort-direction"),a&&l.dataset.sortBy===a.sortBy&&l.setAttribute("data-sort-direction",a.sortOrder.toLowerCase())}),!o){console.warn("Render Tasks Table: Table body not found.");return}if(o.innerHTML="",!r||r.length===0){o.innerHTML=`<tr><td colspan="7" class="aipkit_text-center">${e.no_tasks_configured||"No automated tasks configured yet."}</td></tr>`;return}r.forEach(l=>{let d=JSON.parse(l.task_config||"{}"),u=o.insertRow();u.insertCell().textContent=t(l.task_name);let _=(i.task_types?.[l.task_type]||{}).label||n(l.task_type.replace(/_/g," "));u.insertCell().textContent=t(_);let m=d.indexing_frequency||d.task_frequency||"N/A",g=s[m]||n(m.replace(/_/g," "));u.insertCell().textContent=t(g);let k=u.insertCell();k.innerHTML=`<span class="aipkit_job_status_${t(l.status)}">${t(n(l.status))}</span>`,u.insertCell().textContent=l.last_run_time?new Date(l.last_run_time.replace(" ","T")+"Z").toLocaleString():e.never_run||"Never",u.insertCell().textContent=l.next_run_time&&typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(l.next_run_time):l.next_run_time?new Date(l.next_run_time.replace(" ","T")+"Z").toLocaleString():e.not_scheduled||"Not Scheduled";let w=u.insertCell();w.className="aipkit_automated_tasks_table_actions",w.innerHTML=`
                <button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="edit" data-task-id="${l.id}">${e.edit_button||"Edit"}</button>
                <button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="${l.status==="active"?"pause":"resume"}" data-task-id="${l.id}">${l.status==="active"?e.pause_button||"Pause":e.resume_button||"Resume"}</button>
                <button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="run_now" data-task-id="${l.id}" ${l.status!=="active"?"disabled":""} title="${l.status!=="active"?e.task_not_active_run_title||"Task must be active to run":""}">${e.run_now_button||"Run Now"}</button>
                <button class="aipkit_btn aipkit_btn-danger aipkit_btn-small" data-action="delete" data-task-id="${l.id}">${e.delete_button||"Delete"}</button>
            `})}window.aipkit_list_renderTasksTable=p})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_automated_task_list_pagination"),e=(window.aipkit_automated_tasks_config||{}).text||{};if(!o){console.warn("Render List Pagination: Pagination container not found.");return}o.innerHTML="";let{total_items:t,total_pages:n,current_page:s}=r||{};if(!n||n<=1){t>0&&(o.innerHTML=`<span class="aipkit_pagination-count">${Number(t).toLocaleString()} ${Number(t)===1?e.task_singular||"task":e.task_plural||"tasks"}</span>`);return}let a=document.createElement("span");a.className="aipkit_pagination-count",a.textContent=`${Number(t).toLocaleString()} ${Number(t)===1?e.task_singular||"task":e.task_plural||"tasks"}`,o.appendChild(a);let c=document.createElement("span");c.className="aipkit_pagination-links";let l=document.createElement("button");l.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",l.innerHTML=`\xAB ${e.previous_button||"Previous"}`,l.disabled=Number(s)<=1,l.disabled||(l.dataset.page=Number(s)-1),c.appendChild(l);let d=document.createElement("span");d.className="aipkit_pagination-current",d.textContent=`${e.page_label||"Page"} ${Number(s)} ${e.of_label||"of"} ${Number(n)}`,c.appendChild(d);let u=document.createElement("button");u.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",u.innerHTML=`${e.next_button||"Next"} \xBB`,u.disabled=Number(s)>=Number(n),u.disabled||(u.dataset.page=Number(s)+1),c.appendChild(u),o.appendChild(c)}window.aipkit_list_renderListPagination=p})();(function(){"use strict";async function p(r=1){let o=document.getElementById("aipkit_automated_tasks_tbody"),i=window.aipkit_automated_tasks_list_state,e=window.aipkit_automated_tasks_config||{},t=e.text||{};if(!o){console.warn("Fetch Tasks: Table body not found.");return}o.innerHTML=`<tr><td colspan="7" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${t.loading_tasks||"Loading tasks..."}</td></tr>`,i&&(i.page=r);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let n={page:r,search:i?i.search:"",orderby:i?i.sortBy:"created_at",order:i?i.sortOrder:"DESC",_ajax_nonce:e.nonce_manage_tasks},s=await window.aipkit_apiRequest("aipkit_get_automated_tasks",n);window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks=s.tasks||[]:console.warn("Fetch Tasks: List state object not available to store tasks."),typeof window.aipkit_list_renderTasksTable=="function"?window.aipkit_list_renderTasksTable(s.tasks||[]):console.error("Fetch Tasks: renderTasksTable function not found."),typeof window.aipkit_list_renderListPagination=="function"?window.aipkit_list_renderListPagination(s.pagination||{}):console.error("Fetch Tasks: renderListPagination function not found.")}catch(n){console.error("Fetch Tasks Error:",n),o.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">${t.error_loading_tasks||"Error loading tasks:"} ${n.message||"Unknown error"}</td></tr>`}}window.aipkit_list_fetchTasks=p})();(function(){"use strict";function p(r){if(!r){console.error("Edit Task Action: Task data is missing.");return}typeof window.aipkit_form_showAutomatedTaskForm=="function"?window.aipkit_form_showAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"),r):(console.error("Edit Task Action: showAutomatedTaskForm function is not available."),alert("Error: Cannot open the edit form."))}window.aipkit_handleEditTaskAction=p})();(function(){"use strict";async function p(r,o){let i=window.aipkit_automated_tasks_config||{},e=i.text||{};if(confirm(e.confirm_delete_task||"Are you sure you want to delete this task?")){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,e.delete_button||"Delete",e.deleting_task||"Deleting...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task",{task_id:o,_ajax_nonce:i.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.task_deleted_success||"Task deleted successfully.","success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(t){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${e.error_deleting_task||"Error deleting task:"} ${t.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,e.delete_button||"Delete")}}}window.aipkit_handleDeleteTaskAction=p})();(function(){"use strict";async function p(r,o,i){let e=window.aipkit_automated_tasks_config||{},t=e.text||{},n=i==="paused",s=n?t.pausing_task||"Pausing...":t.resuming_task||"Resuming...",a=n?t.pause_button||"Pause":t.resume_button||"Resume";typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,a,s);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_update_automated_task_status",{task_id:o,status:i,_ajax_nonce:e.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${t.task_status_updated||"Task status updated to"} ${i}.`,"success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks()}catch(c){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${t.error_updating_status||"Error updating task status:"} ${c.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,a)}}window.aipkit_handleToggleTaskStatusAction=p})();(function(){"use strict";async function p(r,o){let i=window.aipkit_automated_tasks_config||{},e=i.text||{};typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,e.run_now_button||"Run Now",e.running_task||"Initiating Run...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_run_automated_task_now",{task_id:o,_ajax_nonce:i.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.task_run_initiated||"Task run initiated. Check queue below for progress.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(t){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${e.error_initiating_run||"Error initiating task run:"} ${t.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,e.run_now_button||"Run Now")}}window.aipkit_handleRunNowTaskAction=p})();(function(){"use strict";async function p(r){let o=r.target.closest("button[data-action]");if(!o)return;let i=o.dataset.action,e=o.dataset.taskId;if(!e)return;let n=(window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks:[]).find(s=>s.id.toString()===e.toString());switch(i){case"edit":typeof window.aipkit_handleEditTaskAction=="function"&&window.aipkit_handleEditTaskAction(n);break;case"delete":typeof window.aipkit_handleDeleteTaskAction=="function"&&window.aipkit_handleDeleteTaskAction(o,e);break;case"pause":case"resume":if(typeof window.aipkit_handleToggleTaskStatusAction=="function"){let s=i==="pause"?"paused":"active";window.aipkit_handleToggleTaskStatusAction(o,e,s)}break;case"run_now":typeof window.aipkit_handleRunNowTaskAction=="function"&&window.aipkit_handleRunNowTaskAction(o,e);break;default:console.warn(`Unknown task action: ${i}`);break}}window.aipkit_list_handleTaskActionClick=p})();(function(){"use strict";function p(r){let o=r.target.closest("button[data-page]");if(o&&!o.disabled){let i=parseInt(o.dataset.page,10);typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks(i):console.error("List Pagination Click: aipkit_list_fetchTasks function not found.")}}window.aipkit_list_handleListPaginationClick=p})();(function(){"use strict";function p(r,o="info"){let i=document.getElementById("aipkit_automated_task_status");i&&(i.textContent=r,i.className=`aipkit_form-help aipkit_settings_message-${o}`,setTimeout(()=>{i.textContent===r&&(i.textContent="",i.className="aipkit_form-help")},5e3))}window.aipkit_list_showAutomatedTaskStatus=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_automated_task_list_wrapper"),o=document.getElementById("aipkit_automated_tasks_tbody"),i=document.getElementById("aipkit_add_new_task_btn"),e=document.getElementById("aipkit_automated_task_form_wrapper"),t=document.getElementById("aipkit_automated_task_list_pagination"),n=document.getElementById("aipkit_task_list_search_input"),s=r?r.querySelector(".aipkit_data-table"):null;if(i&&e&&r&&typeof window.aipkit_form_showAutomatedTaskForm=="function"&&i.addEventListener("click",()=>{window.aipkit_form_showAutomatedTaskForm(e,r,i)}),o&&typeof window.aipkit_list_handleTaskActionClick=="function"&&o.addEventListener("click",window.aipkit_list_handleTaskActionClick),t&&typeof window.aipkit_list_handleListPaginationClick=="function"&&t.addEventListener("click",window.aipkit_list_handleListPaginationClick),n){let a;n.addEventListener("input",()=>{clearTimeout(a),a=setTimeout(()=>{let c=window.aipkit_automated_tasks_list_state;c&&(c.search=n.value.trim()),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)},500)})}s&&s.addEventListener("click",a=>{let c=a.target.closest("th.aipkit-sortable-col");if(!c)return;let l=c.dataset.sortBy,d=window.aipkit_automated_tasks_list_state;if(!d)return;let u="DESC";d.sortBy===l&&(u=d.sortOrder==="DESC"?"ASC":"DESC"),d.sortBy=l,d.sortOrder=u,typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)}),typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks():console.error("Automated Task List Init: fetchTasks function not found.")}window.aipkit_list_initAutomatedTaskList=p})();(function(){"use strict";let p=[],r=1,o="",i="created_at",e="DESC";window.aipkit_automated_tasks_list_state={get tasks(){return[...p]},set tasks(n){p=Array.isArray(n)?n:[]},get page(){return r},set page(n){r=n},get search(){return o},set search(n){o=n},get sortBy(){return i},set sortBy(n){i=n},get sortOrder(){return e},set sortOrder(n){e=n}};function t(){typeof window.aipkit_list_initAutomatedTaskList=="function"?window.aipkit_list_initAutomatedTaskList():console.error("Automated Tasks List Handler: aipkit_list_initAutomatedTaskList function not found.")}window.aipkit_initAutomatedTaskList=t})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_automated_task_queue_tbody"),i=window.aipkit_automated_tasks_config||{},e=i.text||{},t=window.aipkit_escapeHtml||function(c){return c},n=window.aipkit_ucfirst||function(c){return c?c.charAt(0).toUpperCase()+c.slice(1):""},s=window.aipkit_automated_tasks_queue_state;if(document.querySelectorAll("#aipkit_automated_task_queue_viewer_area th.aipkit-sortable-col").forEach(c=>{c.removeAttribute("data-sort-direction"),s&&c.dataset.sortBy===s.sortBy&&c.setAttribute("data-sort-direction",s.sortOrder.toLowerCase())}),!o){console.warn("Render Queue Table: Table body not found.");return}if(o.innerHTML="",!r||r.length===0){o.innerHTML=`<tr><td colspan="7" class="aipkit_text-center">${e.queue_empty||"Task queue is currently empty."}</td></tr>`;return}r.forEach(c=>{let l=o.insertRow(),d=l.insertCell(),u=document.createElement("textarea");u.innerHTML=c.target_title||`${e.target_id_prefix||"Target ID:"} ${c.target_identifier}`;let f=u.value,_=c.task_type.startsWith("content_writing"),m=c.task_type==="enhance_existing_content",g=null;_&&c.status==="completed"&&c.generated_post_id?g=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${c.generated_post_id}&action=edit`:m&&!isNaN(parseInt(c.target_identifier,10))&&(g=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${c.target_identifier}&action=edit`),g?d.innerHTML=`<a href="${g}" target="_blank" title="${t(e.edit_generated_post_title||"Edit generated post")}">${t(f)}</a>`:d.textContent=f,l.insertCell().textContent=t(c.task_name||`${e.task_id_prefix||"Task ID:"} ${c.task_id}`);let k=i.task_types&&i.task_types[c.task_type]?i.task_types[c.task_type].label:n(c.task_type.replace(/_/g," "));l.insertCell().textContent=t(k);let w=l.insertCell(),h=`<span class="aipkit_job_status_${t(c.status)}">${t(n(c.status))}</span>`;c.status==="failed"&&c.error_message&&(h+=`<span class="aipkit_queue_error_message" title="${t(c.error_message)}">${t(c.error_message)}</span>`),w.innerHTML=h,l.insertCell().textContent=c.attempts;let y=l.insertCell();if(c.added_at){let S=new Date(c.added_at.replace(" ","T")+"Z").toLocaleString(),C=`<div class="aipkit_queue_time_entry aipkit_queue_time_added">${t(e.added_at_label||"Added")}: ${t(S)}</div>`;if(c.scheduled_gmt_time){let T=new Date(c.scheduled_gmt_time.replace(" ","T")+"Z").toLocaleString();C+=`<div class="aipkit_queue_time_entry aipkit_queue_time_scheduled">${t(e.scheduled_for_label||"Scheduled")}: ${t(T)}</div>`}y.innerHTML=C}else y.textContent=e.not_applicable||"N/A";let b=l.insertCell();b.className="aipkit_automated_tasks_table_actions";let v=`<button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="delete_queue_item" data-item-id="${c.id}">${e.delete_button||"Delete"}</button>`;c.status==="failed"&&(v+=` <button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="retry_queue_item" data-item-id="${c.id}">${e.retry_button||"Retry"}</button>`),b.innerHTML=v})}window.aipkit_queue_renderQueueTable=p})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_automated_task_queue_pagination"),e=(window.aipkit_automated_tasks_config||{}).text||{};if(!o){console.warn("Render Queue Pagination: Pagination container not found.");return}o.innerHTML="";let{total_items:t,total_pages:n,current_page:s}=r||{};if(!t||t<=0)return;let a=document.createElement("span");if(a.className="aipkit_pagination-count",a.textContent=`${Number(t).toLocaleString()} ${Number(t)===1?e.item_singular||"item":e.item_plural||"items"}`,o.appendChild(a),n>1){let c=document.createElement("span");c.className="aipkit_pagination-links";let l=document.createElement("button");l.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",l.innerHTML=`\xAB ${e.previous_button||"Previous"}`,l.disabled=Number(s)<=1,l.disabled||(l.dataset.page=Number(s)-1),c.appendChild(l);let d=document.createElement("span");d.className="aipkit_pagination-current",d.textContent=`${e.page_label||"Page"} ${Number(s)} ${e.of_label||"of"} ${Number(n)}`,c.appendChild(d);let u=document.createElement("button");u.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",u.innerHTML=`${e.next_button||"Next"} \xBB`,u.disabled=Number(s)>=Number(n),u.disabled||(u.dataset.page=Number(s)+1),c.appendChild(u),o.appendChild(c)}}window.aipkit_queue_renderQueuePagination=p})();(function(){"use strict";async function p(r=1){let o=window.aipkit_automated_tasks_queue_state;o?o.page=r:console.warn("Fetch/Render Queue: Queue state object not available.");let i=document.getElementById("aipkit_automated_task_queue_tbody"),e=document.getElementById("aipkit_automated_task_queue_status"),t=window.aipkit_automated_tasks_config||{},n=t.text||{};if(!i){console.warn("Fetch/Render Queue: Table body not found.");return}i.innerHTML=`<tr><td colspan="8" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${n.loading_queue||"Loading queue items..."}</td></tr>`,e&&(e.textContent="");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let s={page:r,search:o?o.search:"",status_filter:o?o.status:"all",orderby:o?o.sortBy:"q.added_at",order:o?o.sortOrder:"DESC",_ajax_nonce:t.nonce_manage_tasks},a=await window.aipkit_apiRequest("aipkit_get_automated_task_queue_items",s);typeof window.aipkit_queue_renderQueueTable=="function"?window.aipkit_queue_renderQueueTable(a.items||[]):console.error("Fetch/Render Queue: renderQueueTable function not found."),typeof window.aipkit_queue_renderQueuePagination=="function"?window.aipkit_queue_renderQueuePagination(a.pagination||{}):console.error("Fetch/Render Queue: renderQueuePagination function not found.")}catch(s){console.error("Fetch/Render Queue Error:",s),i.innerHTML=`<tr><td colspan="8" class="aipkit_text-center aipkit_text-danger">${n.error_loading_queue||"Error loading queue:"} ${s.message||"Unknown error"}</td></tr>`}}window.aipkit_queue_fetchAndRenderQueueItems=p})();(function(){"use strict";async function p(r){let o=r.target.closest("button[data-action]");if(!o)return;let i=o.dataset.action,e=o.dataset.itemId;if(!e)return;let t=document.getElementById("aipkit_automated_task_queue_status"),n=window.aipkit_automated_tasks_config||{},s=n.text||{},a=window.aipkit_automated_tasks_queue_state?window.aipkit_automated_tasks_queue_state.page:1;if(i==="delete_queue_item"){if(confirm(s.confirm_delete_queue_item||"Are you sure you want to remove this item from the queue?")){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!0,s.delete_button||"Delete");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_item",{item_id:e,_ajax_nonce:n.nonce_manage_tasks}),t&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(t,"success",s.queue_item_deleted||"Queue item deleted."),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(a)}catch(c){t&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(t,"error",`${s.error_deleting_queue_item||"Error deleting item:"} ${c.message||"Unknown error"}`)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!1,s.delete_button||"Delete")}}}else if(i==="retry_queue_item"){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!0,s.retry_button||"Retry");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_retry_automated_task_queue_item",{item_id:e,_ajax_nonce:n.nonce_manage_tasks}),t&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(t,"success",s.item_marked_retry||"Item marked for retry. Queue processing will pick it up."),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(a)}catch(c){t&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(t,"error",`${s.error_retrying_item||"Error retrying item:"} ${c.message||"Unknown error"}`)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!1,s.retry_button||"Retry")}}}window.aipkit_queue_handleQueueItemActionClick=p})();(function(){"use strict";async function p(){let r=document.getElementById("aipkit_delete_queue_by_status_btn"),o=document.getElementById("aipkit_task_queue_status_filter");if(!r||!o){console.error("Delete by status button or filter dropdown not found.");return}let i=o.value,e=o.options[o.selectedIndex].text.toLowerCase(),t=window.aipkit_automated_tasks_config||{},n=t.text||{},s=i==="all"?n.confirmDeleteQueueAll||"Are you sure you want to delete ALL items from the queue? This cannot be undone.":(n.confirmDeleteQueueByStatus||"Are you sure you want to delete all %s items from the queue? This cannot be undone.").replace("%s",e);if(confirm(s)){typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(r,!0,n.delete_button||"Delete",n.deleting_task||"Deleting..."):r.disabled=!0;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");let a=await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_items_by_status",{status:i,_ajax_nonce:t.nonce_manage_tasks}),c=document.getElementById("aipkit_automated_task_queue_status");c&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"success",a.message||"Queue items deleted."),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(a){let c=document.getElementById("aipkit_automated_task_queue_status");c&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"error",`${n.errorDeletingAllItems||"Error deleting items:"} ${a.message||"Unknown error"}`)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(r,!1,n.delete_button||"Delete"):r.disabled=!1}}}window.aipkit_handleDeleteQueueByStatus=p})();(function(){"use strict";function p(r){let o=r.target.closest("button[data-page]");if(o&&!o.disabled){let i=parseInt(o.dataset.page,10);typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems(i):console.error("Queue Pagination Click: fetchAndRenderQueueItems function not found.")}}window.aipkit_queue_handleQueuePaginationClick=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_automated_task_queue_tbody"),o=document.getElementById("aipkit_refresh_task_queue_btn"),i=document.getElementById("aipkit_delete_queue_by_status_btn"),e=document.getElementById("aipkit_automated_task_queue_pagination"),t=document.getElementById("aipkit_task_queue_search_input"),n=document.getElementById("aipkit_task_queue_status_filter"),s=document.querySelector("#aipkit_automated_task_queue_viewer_area table");if(o&&typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&o.addEventListener("click",()=>window.aipkit_queue_fetchAndRenderQueueItems(1)),i&&typeof window.aipkit_handleDeleteQueueByStatus=="function"&&i.addEventListener("click",window.aipkit_handleDeleteQueueByStatus),t){let a;t.addEventListener("input",()=>{clearTimeout(a),a=setTimeout(()=>{let c=window.aipkit_automated_tasks_queue_state;c&&(c.search=t.value.trim()),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)},500)})}n&&n.addEventListener("change",()=>{let a=window.aipkit_automated_tasks_queue_state;a&&(a.status=n.value),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),s&&s.addEventListener("click",a=>{let c=a.target.closest("th.aipkit-sortable-col");if(!c)return;let l=c.dataset.sortBy,d=window.aipkit_automated_tasks_queue_state;if(!d)return;let u="DESC";d.sortBy===l&&(u=d.sortOrder==="DESC"?"ASC":"DESC"),d.sortBy=l,d.sortOrder=u,typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),r&&typeof window.aipkit_queue_handleQueueItemActionClick=="function"&&r.addEventListener("click",window.aipkit_queue_handleQueueItemActionClick),e&&typeof window.aipkit_queue_handleQueuePaginationClick=="function"&&e.addEventListener("click",window.aipkit_queue_handleQueuePaginationClick),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems():console.error("Automated Task Queue Init: fetchAndRenderQueueItems function not found for initial fetch.")}window.aipkit_queue_initAutomatedTaskQueue=p})();(function(){"use strict";let p=1,r="",o="all",i="q.added_at",e="DESC";window.aipkit_automated_tasks_queue_state={get page(){return p},set page(n){p=n},get search(){return r},set search(n){r=n},get status(){return o},set status(n){o=n},get sortBy(){return i},set sortBy(n){i=n},get sortOrder(){return e},set sortOrder(n){e=n}};function t(){typeof window.aipkit_queue_initAutomatedTaskQueue=="function"?window.aipkit_queue_initAutomatedTaskQueue():console.error("Automated Tasks Queue Handler: aipkit_queue_initAutomatedTaskQueue function not found.")}window.aipkit_initAutomatedTaskQueue=t})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_autogpt_container");if(r&&typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():r&&console.warn("AIPKit AutoGPT: Tab initializer function missing, but autogpt container found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function")try{window.aipkit_initContentIndexingTaskFormUI()}catch(o){console.error("AIPKit AutoGPT: Error initializing Content Indexing Task Form UI:",o)}else console.warn("AIPKit AutoGPT: Content Indexing Task Form UI initializer (aipkit_initContentIndexingTaskFormUI) not found.");if(typeof window.aipkit_initAutomatedTaskForm=="function")try{window.aipkit_initAutomatedTaskForm()}catch(o){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Form Handler:",o)}else console.warn("AIPKit AutoGPT: Automated Tasks Form Handler initializer (aipkit_initAutomatedTaskForm) not found.");if(typeof window.aipkit_initAutomatedTaskList=="function")try{window.aipkit_initAutomatedTaskList()}catch(o){console.error("AIPKit AutoGPT: Error initializing Automated Tasks List Handler:",o)}else console.warn("AIPKit AutoGPT: Automated Tasks List Handler initializer (aipkit_initAutomatedTaskList) not found.");if(typeof window.aipkit_initAutomatedTaskQueue=="function")try{window.aipkit_initAutomatedTaskQueue()}catch(o){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Queue Handler:",o)}else console.warn("AIPKit AutoGPT: Automated Tasks Queue Handler initializer (aipkit_initAutomatedTaskQueue) not found.")}window.aipkit_initAutogpt=p})();(function(){"use strict";function p(e,t=""){let n=document.getElementById("aipkit_content_writer_form_status");if(n)switch(e){case"progress":n.textContent=t;break;case"success":n.textContent=t,n.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{n.textContent===t&&r()},3e3);break;case"clear":default:n.textContent="";break}}function r(){p("clear")}function o(e){p("progress",e)}function i(e){p("success",e)}window.aipkit_updateGeneralStatus=p,window.aipkit_clearGeneralStatus=r,window.aipkit_showProgress=o,window.aipkit_showSuccess=i})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_content_writer_container");if(!r){console.warn("Content Writer Accordions: Main container not found.");return}r.dataset.accordionListenerAttached!=="true"&&(r.addEventListener("click",function(o){let i=o.target.closest(".aipkit_accordion-header");if(!i)return;let e=i.closest(".aipkit_accordion");if(!e)return;let t=i.nextElementSibling;if(!t||!t.classList.contains("aipkit_accordion-content"))return;let n=e.closest(".aipkit_accordion-group");if(n&&!i.classList.contains("aipkit_active")){let s=n.querySelector(".aipkit_accordion-header.aipkit_active");if(s){s.classList.remove("aipkit_active");let a=s.nextElementSibling;a&&a.classList.remove("aipkit_active")}}i.classList.toggle("aipkit_active"),t.classList.toggle("aipkit_active")}),r.dataset.accordionListenerAttached="true")}window.aipkit_initContentWriterAccordions=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(e){return e},r=new Set;function o(e,t,n=""){let s=document.getElementById(`aipkit_cw_status_${e}_generation`),a=s?s.querySelector(".aipkit_cw_status_icon"):null,c=s?s.querySelector(".status-text"):null;if(!s||!a||!c){console.warn(`Could not find all elements for status indicator step: ${e}`);return}if(!(r.has(e)&&t==="generating"))switch((t==="success"||t==="skipped")&&r.add(e),t==="pending"&&r.delete(e),s.classList.remove("status-pending","status-generating","status-success","status-error","status-skipped"),s.classList.add(`status-${t}`),t){case"pending":c.textContent="Pending";let l="dashicons-text-page";e==="content"&&(l="dashicons-admin-post"),e==="image"&&(l="dashicons-format-image"),e==="excerpt"&&(l="dashicons-editor-quote"),e==="tags"&&(l="dashicons-tag"),e==="meta"&&(l="dashicons-search"),e==="keyword"&&(l="dashicons-flag"),a.className=`dashicons ${l} aipkit_cw_status_icon`;break;case"generating":c.textContent=n||"Generating...",a.className="aipkit_spinner aipkit_inline_spinner aipkit_cw_status_icon";break;case"success":c.textContent="Complete",a.className="dashicons dashicons-yes-alt aipkit_cw_status_icon";break;case"error":c.textContent=`Error ${n?": "+p(n):""}`,a.className="dashicons dashicons-warning aipkit_cw_status_icon",r.delete(e);break;case"skipped":c.textContent="Skipped",a.className="dashicons dashicons-minus aipkit_cw_status_icon";break}}function i(){r.clear(),["title","content","image","meta","keyword","excerpt","tags"].forEach(e=>{o(e,"pending")})}window.aipkit_updateCwGenerationStatus=o,window.aipkit_resetAllGenerationStatuses=i})();(function(){"use strict";function p(){let r=document.querySelector(".aipkit_cw_generation_status_indicators");r&&(r.style.display="flex",typeof window.aipkit_updateCwGenerationStatus=="function"?(window.aipkit_updateCwGenerationStatus("title","pending"),window.aipkit_updateCwGenerationStatus("content","pending"),window.aipkit_updateCwGenerationStatus("excerpt","pending"),window.aipkit_updateCwGenerationStatus("tags","pending"),window.aipkit_updateCwGenerationStatus("image","pending"),window.aipkit_updateCwGenerationStatus("meta","pending"),window.aipkit_updateCwGenerationStatus("keyword","pending")):console.error("Reset Status Indicators: aipkit_updateCwGenerationStatus function not found."))}window.aipkit_resetGenerationStatusIndicators=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};async function r(o,i,e){let t=new FormData(o),n=Object.fromEntries(t.entries()),s=window.aipkit_dashboard?.text||{},a=document.querySelector(".aipkit_cw_tab.aipkit_active"),c=a?a.dataset.mode:"task";if(n.cw_generation_mode=c,c==="csv"){let f=document.getElementById("aipkit_cw_csv_data_holder");n.content_title=f?f.value:""}else c==="url"?(n.url_list=o.elements.url_list?.value||"",n.content_title=n.url_list):c==="task"?n.content_title=o.elements.content_title_bulk?o.elements.content_title_bulk.value:"":c==="single"&&(n.content_title=o.elements.content_title?o.elements.content_title.value:"");delete n.content_title_bulk,delete n.content_title_csv;let l=document.getElementById("aipkit_cw_template_select"),d="";if(l&&l.selectedIndex>0){let f=l.options[l.selectedIndex];f&&(d=f.text)}if(d&&d.trim()!=="")n.task_name=d.trim();else{let f=(n.content_title||n.rss_feeds||n.gsheets_sheet_id||n.url_list||"").split(`
`)[0].trim();n.task_name=f||"Automated Content Writing Task"}if((c==="task"||c==="csv"||c==="single")&&!n.content_title){e&&(e.textContent=c==="csv"?"Please upload and parse a valid CSV file first.":"Content Title/Topic is required for automated tasks.",e.className="aipkit_form-help aipkit_settings_message-error");return}if(c==="rss"&&!n.rss_feeds){e&&(e.textContent="RSS Feed URL(s) are required for this task mode.",e.className="aipkit_form-help aipkit_settings_message-error");return}if(c==="gsheets"&&(!n.gsheets_sheet_id||!n.gsheets_credentials)){e&&(e.textContent="Google Sheet ID and Credentials are required for this task mode.",e.className="aipkit_form-help aipkit_settings_message-error");return}if(c==="url"&&!n.url_list){e&&(e.textContent="Website URL(s) are required for this task mode.",e.className="aipkit_form-help aipkit_settings_message-error");return}typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(i,!0,"Create Task","Creating Task..."):(i.disabled=!0,i.textContent="Creating Task..."),e&&(e.textContent="Creating automated task...",e.className="aipkit_form-help aipkit_settings_message-info");try{let f=document.getElementById("aipkit_content_writer_nonce");if(n._ajax_nonce=f?f.value:"",!n._ajax_nonce)throw new Error("Security token missing for task creation.");let _=await window.aipkit_apiRequest("aipkit_content_writer_create_task",n);e&&(e.textContent=_.message||(s.task_queued_content_writing??"Your content writing task is queued. You can track it under the Automated Tasks tab."),e.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{e&&(e.textContent="",e.className="aipkit_form-help")},5e3))}catch(f){console.error("Content Writer Create Task Error:",f),e&&(e.textContent=`Error creating task: ${p(f.message||"Unknown error")}`,e.className="aipkit_form-help aipkit_settings_message-error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(i,!1,"Create Task"):(i.disabled=!1,i.textContent="Create Task")}}window.aipkit_createContentWriterTask=r})();(function(){"use strict";window.aipkit_cw_template_state={currentTemplates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,pendingModelSelection:null,pendingImageModelSelection:null,isSavingOrDeleting:!1}})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};function r(o,i){let e=o.value,t=e?e.toLowerCase():"",n=window.aipkit_dashboard?.models;if(!i){console.error("Content Writer Model Populator: modelSelect element is null or undefined.");return}if(!n){console.error("Content Writer Model Populator: window.aipkit_dashboard.models is NOT available."),i.innerHTML='<option value="">'+p("Error: Model data object not found")+"</option>",i.disabled=!0;return}let s=n[t];if((typeof s>"u"||s===null)&&(console.warn(`Content Writer Model Populator: No model data found in allModelsData for provider key '${t}'. Defaulting to empty.`),s=t==="openai"?{}:[]),i.innerHTML="",t==="openai"&&typeof s=="object"&&!Array.isArray(s)?Object.keys(s).forEach(a=>{let c=document.createElement("optgroup");c.label=p(a);let l=s[a];Array.isArray(l)?l.forEach(d=>{if(d&&typeof d=="object"&&d.id){let u=new Option(p(d.name||d.id),d.id);c.appendChild(u)}else console.warn(`Content Writer Model Populator (OpenAI): Skipping invalid model item in group '${a}':`,d)}):console.warn(`Content Writer Model Populator: Items for group '${a}' under '${t}' is not an array.`),i.appendChild(c)}):Array.isArray(s)?s.forEach(a=>{if(a&&typeof a=="object"&&a.id){let c=new Option(p(a.name||a.id),a.id);i.appendChild(c)}else console.warn(`Content Writer Model Populator (Array): Skipping invalid model item for provider '${t}':`,a)}):(console.warn(`Content Writer Model Populator: Data for provider '${t}' is not in expected format. Actual type: ${typeof s}`),i.appendChild(new Option(p(`No models for ${e} (Format Error)`),""))),!i.options||typeof i.options.length>"u")console.error("Content Writer Model Populator: modelSelect.options is invalid after attempting to populate."),i.appendChild(new Option(p("Error loading models"),"")),i.disabled=!0;else if(i.options.length===0)i.appendChild(new Option(p(`No models for ${e} (Sync in settings)`),"")),i.disabled=!0;else{i.disabled=!1;let a=null;if(window.aipkit_cw_template_state&&window.aipkit_cw_template_state.pendingModelSelection){let c=window.aipkit_cw_template_state.pendingModelSelection;i.querySelector(`option[value="${CSS.escape(c)}"]`)?a=c:console.warn(`Content Writer Model Populator: Pending model '${c}' not found in new list for provider '${e}'.`),window.aipkit_cw_template_state.pendingModelSelection=null}if(a===null){let c=i.querySelector("optgroup");c&&c.options&&c.options.length>0&&c.options[0].value?a=c.options[0].value:i.options&&i.options.length>0&&i.options[0].value?a=i.options[0].value:a=""}i.value=a}if(typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications(),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let a=document.getElementById("aipkit_content_writer_container");a&&window.aipkit_cw_toggleReasoningEffort(a)}}window.aipkit_populateModelsForContentWriter=r})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(i){return i};function r(i){if(!document.getElementById("aipkit_content_writer_form"))return;let t=document.getElementById("aipkit_content_writer_generate_btn"),n=t?t.querySelector(".aipkit_btn-text"):null,s=document.getElementById("aipkit_cw_task_options"),a=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,c=new Set(["task","csv","rss","gsheets","url"]),l=new Set(["rss","gsheets","url"]),d=document.getElementById("aipkit_cw_single_output_wrapper");d&&i!=="single"&&(d.style.display="none");let u=document.getElementById("aipkit_cw_content_prompt_placeholders");if(u){let f="Use placeholders: {topic}, {keywords}";i==="rss"?f+=", {description}, {source_url}":i==="url"&&(f+=", {url_content}"),f+=".";let _=f.replace(/(\{[a-zA-Z0-9_]+\})/g,m=>`<code class="aipkit-placeholder" title="Click to copy">${p(m)}</code>`);u.innerHTML=_}n&&t&&(c.has(i)?l.has(i)&&!a?(n.textContent="Upgrade to Pro",t.dataset.action="upgrade"):(n.textContent="Create Task",t.dataset.action="create_task"):(n.textContent="Generate",t.dataset.action="generate_single")),s&&(s.style.display=c.has(i)?"flex":"none"),typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields()}function o(i){if(!i){console.error("Content Writer Tabs: Scope element not provided for initialization.");return}let e=i.querySelector(".aipkit_cw_tabs"),t=i.querySelector(".aipkit_cw_tab_content_container");if(!e||!t){console.warn("Content Writer Tabs: Tab or content container not found within the provided scope.");return}e.addEventListener("click",function(s){let a=s.target.closest(".aipkit_cw_tab");if(!a||a.classList.contains("aipkit_active"))return;e.querySelectorAll(".aipkit_cw_tab").forEach(d=>d.classList.remove("aipkit_active")),t.querySelectorAll(".aipkit_cw_tab_content").forEach(d=>d.classList.remove("aipkit_active"));let c=a.dataset.mode;a.classList.add("aipkit_active");let l=t.querySelector(`.aipkit_cw_tab_content[data-pane="${c}"]`);l&&l.classList.add("aipkit_active"),r(c)});let n=e.querySelector(".aipkit_cw_tab.aipkit_active");n&&r(n.dataset.mode)}window.aipkit_initContentWriterTabs=o})();(function(){"use strict";function p(r,o){if(!r||!o||typeof window.aipkit_populateModelsForContentWriter!="function"){console.error("Provider/Model Dropdown Handler: Missing providerSelect, modelSelect, or populateModelsForContentWriter function.");return}if(r.addEventListener("change",()=>{window.aipkit_populateModelsForContentWriter(r,o)}),window.aipkit_dashboard&&window.aipkit_dashboard.models)window.aipkit_populateModelsForContentWriter(r,o);else{console.warn("Content Writer UI: aipkit_dashboard.models not available for initial population. Will try on provider change.");let i=window.aipkit_escapeHtml||function(e){return e};o.innerHTML='<option value="">'+i("Models unavailable (Data Object Missing)")+"</option>",o.disabled=!0}}window.aipkit_handleProviderModelDropdowns=p})();(function(){"use strict";function p(r){if(!r){console.error("Temperature Slider Handler: Slider element was not passed or not found.");return}let o=document.getElementById("aipkit_content_writer_temperature_value");o?r.dataset.listenerAttached||(r.addEventListener("input",()=>o.textContent=r.value),r.dataset.listenerAttached="true"):console.error("Temperature Slider Handler: Value Span #aipkit_content_writer_temperature_value NOT FOUND.")}window.aipkit_handleTemperatureSlider=p})();(function(){"use strict";function p(r){if(!r){console.error("Max Tokens Slider Handler: Slider element was not passed or not found.");return}let o=document.getElementById("aipkit_content_writer_max_tokens_value");o&&(o.textContent=r.value,r.dataset.listenerAttached||(r.addEventListener("input",function(){o.textContent=this.value}),r.dataset.listenerAttached="true"))}window.aipkit_handleMaxTokensSlider=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_content_writer_container");if(!r){console.warn("AI Settings Toggle: Content writer container not found.");return}let o=r.querySelector(".aipkit_ai_settings_toggle"),i=r.querySelector(".aipkit_cw_ai_parameters_row");if(!o||!i){console.warn("AI Settings Toggle: Toggle button or settings row not found.");return}let e="data-settings-toggle-listener-attached";o.getAttribute(e)||(o.addEventListener("click",function(){let t=i.style.display==="none";i.style.display=t?"block":"none",o.classList.toggle("aipkit_active",t),o.setAttribute("aria-expanded",t)}),o.setAttribute(e,"true"))}window.aipkit_initAiSettingsToggle=p})();(function(){"use strict";function p(r){if(!r){console.warn("Copy Button Handler: Button element not provided.");return}r.dataset.listenerAttached||(r.addEventListener("click",()=>{let o=document.getElementById("aipkit_content_writer_output_display");o&&navigator.clipboard.writeText(o.innerText).then(()=>{let i=r.innerHTML;r.innerHTML='<span class="dashicons dashicons-yes"></span> Copied!',setTimeout(()=>{r.innerHTML=i},2e3)}).catch(i=>console.error("Failed to copy: ",i))}),r.dataset.listenerAttached="true")}window.aipkit_handleCopyButton=p})();(function(){"use strict";function p(){let o=document.getElementById("aipkit_cw_single_output_wrapper"),i=document.getElementById("aipkit_content_writer_output_display"),e=document.getElementById("aipkit_cw_generated_content_area"),t=document.querySelector(".aipkit_content_writer_output_actions"),n=document.getElementById("aipkit_cw_status_display_container"),s=document.getElementById("aipkit_cw_generated_title_display"),a=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),c=document.getElementById("aipkit_cw_generated_meta_desc"),l=document.getElementById("aipkit_cw_focus_keyword_output_wrapper"),d=document.getElementById("aipkit_cw_generated_focus_keyword"),u=document.getElementById("aipkit_cw_excerpt_output_wrapper"),f=document.getElementById("aipkit_cw_generated_excerpt"),_=document.getElementById("aipkit_cw_tags_output_wrapper"),m=document.getElementById("aipkit_cw_generated_tags"),g=document.getElementById("aipkit_content_writer_copy_btn"),k=document.getElementById("aipkit_content_writer_clear_btn");if(o&&(o.style.display="none"),i&&e){e.innerHTML=`
            <div class="aipkit_cw_output_placeholder">
                <span class="dashicons dashicons-edit-large"></span>
                <span>Your article will appear here...</span>
            </div>`,i.scrollTop=0,t&&(t.style.display="none"),g&&(g.disabled=!0),k&&(k.disabled=!0),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton();let w=document.getElementById("aipkit_content_writer_form_status");w&&(w.textContent=""),n&&typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():n&&(n.style.display="none"),s&&(s.style.display="none",s.textContent=""),a&&(a.style.display="none"),c&&(c.value=""),l&&(l.style.display="none"),d&&(d.value=""),u&&(u.style.display="none"),f&&(f.value=""),_&&(_.style.display="none"),m&&(m.value="")}}function r(o,i){if(!o){console.warn("Clear Button Handler: Button element not provided.");return}o.dataset.listenerAttached||(o.addEventListener("click",()=>{typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput()}),o.dataset.listenerAttached="true")}window.aipkit_handleClearButton=r,window.aipkit_clearContentWriterOutput=p})();(function(){"use strict";function p(){let o=document.getElementById("aipkit_content_writer_form");if(!o)return;let i=o.elements.generate_meta_description,e=o.querySelector("#aipkit_cw_custom_meta_prompt_field"),t=o.elements.generate_focus_keyword,n=o.querySelector("#aipkit_cw_custom_keyword_prompt_field"),s=o.elements.generate_excerpt,a=o.querySelector(".aipkit_cw_custom_excerpt_prompt"),c=o.elements.generate_tags,l=o.querySelector(".aipkit_cw_custom_tags_prompt");e&&(e.style.display=i&&i.checked?"block":"none"),n&&(n.style.display=t&&t.checked?"block":"none"),a&&(a.style.display=s&&s.checked?"block":"none"),l&&(l.style.display=c&&c.checked?"block":"none")}function r(){let o=document.getElementById("aipkit_content_writer_form");if(!o||o.dataset.optionToggleListenerAttached)return;let i=o.elements.generate_meta_description,e=o.elements.generate_focus_keyword,t=o.elements.generate_excerpt,n=o.elements.generate_tags;i&&i.addEventListener("change",p),e&&e.addEventListener("change",p),t&&t.addEventListener("change",p),n&&n.addEventListener("change",p),o.dataset.optionToggleListenerAttached="true",p()}window.aipkit_cw_toggleCustomOptionPrompts=p,window.aipkit_cw_initOptionPromptToggles=r})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_content_writer_container");if(!r){console.warn("Prompt Toggle Handler: Content writer container not found.");return}r.querySelectorAll(".aipkit_textarea_toggle").forEach(e=>{let t=e.dataset.target;if(!t)return;let n=`aipkit-cw-prompt-${t}-state`,s=localStorage.getItem(n),a=document.getElementById(t),c=e.querySelector(".dashicons");a&&c&&(s==="expanded"?(a.classList.remove("aipkit_collapsed"),c.classList.remove("dashicons-plus-alt2"),c.classList.add("dashicons-minus"),e.title="Collapse"):(a.classList.add("aipkit_collapsed"),c.classList.remove("dashicons-minus"),c.classList.add("dashicons-plus-alt2"),e.title="Expand"))});let i="data-prompt-toggle-listener-attached";r.getAttribute(i)||(r.addEventListener("click",function(e){let t=e.target.closest(".aipkit_textarea_toggle");if(!t)return;let n=t.dataset.target,s=document.getElementById(n),a=t.querySelector(".dashicons");if(!s||!a){console.error("Prompt Toggle Handler: Target element or icon not found for toggle button.",t);return}let c=s.classList.toggle("aipkit_collapsed");c?(a.classList.remove("dashicons-minus"),a.classList.add("dashicons-plus-alt2"),t.title="Expand"):(a.classList.remove("dashicons-plus-alt2"),a.classList.add("dashicons-minus"),t.title="Collapse");let l=`aipkit-cw-prompt-${n}-state`;localStorage.setItem(l,c?"collapsed":"expanded")}),r.setAttribute(i,"true"))}window.aipkit_initPromptToggles=p})();(function(){"use strict";function p(r){if(!r)return;let o=r.querySelector("#aipkit_content_writer_provider"),i=r.querySelector("#aipkit_content_writer_model"),e=r.querySelector(".aipkit_cw_reasoning_effort_field");if(!o||!i||!e){e&&(e.style.display="none");return}let t=o.value,s=(i.value||"").toLowerCase(),a=s.startsWith("o1")||s.startsWith("o3")||s.startsWith("o4"),c=s.includes("gpt-5");t==="openai"&&(a||c)?e.style.display="block":e.style.display="none"}window.aipkit_cw_toggleReasoningEffort=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(e){return e};function r(e){let t=document.getElementById("aipkit_cw_image_model");if(!t)return;let n=window.aipkit_dashboard?.imageGeneratorModels;if(!n){console.error("Image models data not found in aipkit_dashboard object."),t.innerHTML='<option value="">Error: Models not loaded</option>';return}let s=n[e.toLowerCase()]||[],a=window.aipkit_cw_template_state?.pendingImageModelSelection,c=t.value,l=a||c;t.innerHTML="",s.length>0?(s.forEach(d=>{t.appendChild(new Option(d.name,d.id))}),t.querySelector(`option[value="${CSS.escape(l)}"]`)?t.value=l:t.options.length>0&&(t.selectedIndex=0)):t.appendChild(new Option("No models available","")),window.aipkit_cw_template_state&&(window.aipkit_cw_template_state.pendingImageModelSelection=null)}function o(){let e=document.getElementById("aipkit_content_writer_container");if(!e)return;let t=e.querySelector(".aipkit_cw_image_enable_toggle"),n=e.querySelector("#aipkit_cw_generate_featured_image"),s=e.querySelector("#aipkit_cw_image_placement"),a=e.querySelector("#aipkit_cw_image_provider"),c=t?.closest(".aipkit_accordion-content")?.querySelector(".aipkit_cw_image_settings_container"),l=n?.closest(".aipkit_accordion-content")?.querySelector(".aipkit_cw_featured_image_prompt_field"),d=e.querySelector("#aipkit_cw_image_prompt")?.closest(".aipkit_form-group");if(!t||!n||!c||!l||!d)return;let u=t.checked,f=n.checked,_=u||f,m=a.value,g=m==="pexels"||m==="pixabay";if(c.style.display=_?"block":"none",_){let k=["#aipkit_cw_image_count","#aipkit_cw_image_placement","#aipkit_cw_image_size","#aipkit_cw_image_alignment"],w=e.querySelector("#aipkit_cw_pexels_options"),h=e.querySelector("#aipkit_cw_pixabay_options"),y=e.querySelector("#aipkit_cw_image_model_group");if(k.forEach(b=>{let v=e.querySelector(b);if(v){let S=v.closest(".aipkit_form-group");S&&(S.style.display=u?"block":"none")}}),s){let b=s.closest(".aipkit_form-row")?.querySelector(".aipkit_cw_image_placement_x_field");if(b){let v=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(s.value);b.style.display=u&&v?"block":"none"}}d.style.display=u&&!g?"block":"none",l.style.display=f&&!g?"block":"none",w&&(w.style.display=g&&m==="pexels"?"flex":"none"),h&&(h.style.display=g&&m==="pixabay"?"flex":"none"),y&&(y.style.display=g?"none":"block"),g||r(m)}}function i(){let e=document.getElementById("aipkit_content_writer_container");e&&(e.dataset.imageHandlerAttached||(e.addEventListener("change",function(t){t.target.matches(".aipkit_cw_image_enable_toggle, #aipkit_cw_generate_featured_image, #aipkit_cw_image_placement, #aipkit_cw_image_provider")&&o()}),o(),e.dataset.imageHandlerAttached="true"))}window.aipkit_initImageSettingsHandler=i,window.aipkit_updateImageSettingsUI=o})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(t){return t};function r(t){let n=t.querySelector(".aipkit_cw_vector_store_toggle"),s=t.querySelector(".aipkit_cw_vector_store_settings_container");if(n&&s){let a=n.checked;s.style.display=a?"block":"none",a&&o(t)}}function o(t){let n=t.querySelector(".aipkit_cw_vector_store_provider_select");if(!n)return;let s=n.value,a=t.querySelector(".aipkit_cw_vector_openai_field"),c=t.querySelector(".aipkit_cw_vector_pinecone_field"),l=t.querySelector(".aipkit_cw_vector_qdrant_field"),d=t.querySelector(".aipkit_cw_vector_embedding_config_row");if(a&&(a.style.display=s==="openai"?"block":"none"),c&&(c.style.display=s==="pinecone"?"block":"none"),l&&(l.style.display=s==="qdrant"?"block":"none"),d){let u=s==="pinecone"||s==="qdrant";if(d.style.display=u?"block":"none",u){let f=d.querySelector(".aipkit_cw_vector_embedding_provider_select");f&&i(f.value)}}}function i(t){let n=document.getElementById("aipkit_cw_vector_embedding_model");if(!n)return;let a=(window.aipkit_dashboard?.embeddingModels||{})[t.toLowerCase()]||[],c=window.aipkit_cw_template_state?.initialConfigForSelectedTemplate?.vector_embedding_model||"";n.innerHTML=`<option value="">${p("-- Select Model --")}</option>`,a.length>0?(a.forEach(l=>{if(l&&l.id){let d=new Option(p(l.name||l.id),l.id);l.id===c&&(d.selected=!0),n.appendChild(d)}}),n.disabled=!1):(n.disabled=!0,n.innerHTML=`<option value="">${p("-- No models found --")}</option>`)}function e(){let t=document.getElementById("aipkit_content_writer_container");t&&(t.dataset.vectorSettingsHandlerAttached||(t.addEventListener("change",function(n){let s=n.target;s.matches(".aipkit_cw_vector_store_toggle")?r(s.closest(".aipkit_accordion-content")):s.matches(".aipkit_cw_vector_store_provider_select")?o(s.closest(".aipkit_cw_vector_store_settings_container")):s.matches(".aipkit_cw_vector_embedding_provider_select")&&i(s.value)}),t.querySelectorAll(".aipkit_accordion-content").forEach(n=>{n.querySelector(".aipkit_cw_vector_store_toggle")&&r(n)}),t.dataset.vectorSettingsHandlerAttached="true"))}window.aipkit_initContentWriterVectorSettings=e,window.aipkit_cw_toggleVectorSettingsContainer=r,window.aipkit_cw_toggleProviderSpecificFields=o,window.aipkit_cw_populateEmbeddingModelSelect=i})();(function(){"use strict";function p(r,o,i,e,t,n,s){typeof window.aipkit_handleProviderModelDropdowns=="function"?window.aipkit_handleProviderModelDropdowns(r,o):console.error("Content Writer UI: handleProviderModelDropdowns function not found."),typeof window.aipkit_handleTemperatureSlider=="function"?window.aipkit_handleTemperatureSlider(i):console.error("Content Writer UI: handleTemperatureSlider function not found."),typeof window.aipkit_handleMaxTokensSlider=="function"?window.aipkit_handleMaxTokensSlider(e):console.error("Content Writer UI: handleMaxTokensSlider function not found."),typeof window.aipkit_handleCopyButton=="function"?window.aipkit_handleCopyButton(n):console.error("Content Writer UI: handleCopyButton function not found."),typeof window.aipkit_handleClearButton=="function"?window.aipkit_handleClearButton(s,n):console.error("Content Writer UI: handleClearButton function not found.")}window.aipkit_initContentWriterUI=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_content_writer_generate_btn"),o=document.getElementById("aipkit_content_writer_stop_btn");r&&(typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(r,!1,"Generate"):(r.disabled=!1,r.textContent="Generate"),r.style.display="inline-flex"),o&&(o.style.display="none")}window.aipkit_resetContentWriterButtons=p})();(function(){"use strict";function p(r){r.current&&(r.current.close(),r.current=null),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():console.error("Content Writer Finalize Stream: resetButtons function not found.");let o=document.getElementById("aipkit_content_writer_output_display"),i=document.querySelector(".aipkit_content_writer_output_actions"),e=document.getElementById("aipkit_content_writer_copy_btn"),t=document.getElementById("aipkit_content_writer_clear_btn");o&&o.textContent.trim()!==""&&!o.classList.contains("aipkit_content_writer_output_error")?(i&&(i.style.display="block"),e&&(e.disabled=!1),t&&(t.disabled=!1),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton()):(i&&(i.style.display="none"),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton())}window.aipkit_finalizeStream=p})();(function(){"use strict";async function p(i){let e=i.target,t=e.closest(".aipkit_form-group");if(!t)return;let n=t.querySelector(".aipkit_csv_analysis_results"),s=t.querySelector(".aipkit_csv_data_holder"),a=document.getElementById("aipkit_content_writer_nonce"),c=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,l=a?a.value:c;if(!n||!s||!l){console.error("CSV Handler: Missing status div, data holder, or nonce field."),n&&(n.textContent="Error: A required UI component or security token is missing.",n.className="aipkit_form-help aipkit_settings_message-error");return}let d=e.files[0];if(!d){n.textContent="Please select a CSV file first.",n.className="aipkit_form-help aipkit_settings_message-error";return}if(!d.name.toLowerCase().endsWith(".csv")){n.textContent="Invalid file type. Please upload a .csv file.",n.className="aipkit_form-help aipkit_settings_message-error";return}n.textContent="Parsing CSV...",n.className="aipkit_form-help aipkit_settings_message-info";let u=new FormData;u.append("file",d),u.append("_ajax_nonce",l),u.append("action","aipkit_content_writer_parse_csv");try{let f=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:u,credentials:"same-origin"});if(!f.ok){let g=`Server returned status ${f.status}`;try{let k=await f.json();k&&k.data&&k.data.message&&(g=k.data.message)}catch{}throw new Error(g)}let _=await f.json();if(!_.success)throw new Error(_.data?.message||"Unknown server error.");let m=_.data;m.tasks_found>0?(s.value=m.formatted_data,n.textContent=`Success! Found ${m.tasks_found} tasks in the CSV file. Ready.`,n.className="aipkit_form-help aipkit_settings_message-success"):(s.value="",n.textContent="No valid tasks found in the CSV file.",n.className="aipkit_form-help aipkit_settings_message-error")}catch(f){s.value="",n.textContent=`Error: ${f.message||"Failed to parse CSV file."}`,n.className="aipkit_form-help aipkit_settings_message-error",console.error("CSV Parse Error:",f)}}function r(){let i=document.getElementById("aipkit_cw_csv_file_input");i&&i.dataset.listenerAttached!=="true"&&(i.addEventListener("change",p),i.dataset.listenerAttached="true")}function o(){let i=document.getElementById("aipkit_task_cw_csv_file_input");i&&i.dataset.listenerAttached!=="true"&&(i.addEventListener("change",p),i.dataset.listenerAttached="true")}window.aipkit_initCsvUploadHandler=r,window.aipkit_initTaskCsvUploadHandler=o})();(function(){"use strict";function p(r,o){let i=document.getElementById("aipkit_content_writer_frontend_stream_nonce");if(!i||!i.value)throw new Error("Security token missing for stream. Please reload.");let e=new URL(window.aipkit_dashboard.ajaxurl);e.searchParams.append("action","aipkit_frontend_chat_stream"),e.searchParams.append("cache_key",r),e.searchParams.append("_ajax_nonce",i.value),o.current&&o.current.close();try{let t=new EventSource(e.toString());return t.userStopped=!1,t}catch(t){throw console.error("EventSource Connection Setup: EventSource creation error:",t),new Error("Could not connect to stream. "+t.message)}}window.aipkit_stream_setupEventSourceConnection=p})();(function(){"use strict";function p(r,o,i,e){if(r.data)try{let t=JSON.parse(r.data);if(t.delta){if(o.fullContent+=t.delta,e)i.innerHTML=e.render(o.fullContent);else{let s=i.textContent||"";i.textContent=s+t.delta}let n=i.parentElement;if(n){let s=i.lastElementChild;s?s.scrollIntoView({behavior:"auto",block:"end"}):n.scrollTop=n.scrollHeight}}}catch(t){console.error("Stream Message Handler: Error parsing event data.",t)}}window.aipkit_stream_handleMessage=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};async function r(o,i,e,t,n,s){if(i.isDone)return;i.isDone=!0,t&&(e.innerHTML=t.render(i.fullContent)),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success");let a=document.getElementById("aipkit_content_writer_form"),c=a?a.elements.generate_meta_description:null,l=a?a.elements.generate_focus_keyword:null,d=a?a.elements.generate_excerpt:null,u=a?a.elements.generate_tags:null,f=document.getElementById("aipkit_content_writer_nonce")?.value,_=a.elements.ai_provider?.value,m=a.elements.ai_model?.value,g=a.elements.content_max_tokens?.value,k=a.querySelector('input[name="prompt_mode"]:checked')?.value||"custom",w=document.getElementById("aipkit_cw_generated_title_display"),h=w?w.textContent:a.elements.content_title?.value.split("|")[0].trim()||"Untitled",y=a.elements.content_keywords?.value.trim()||"",b="",v=document.getElementById("aipkit_content_writer_title");if(v){let x=v.value.split("|")||[];x.length>1&&(b=x[1].trim())}let S=b||y,C=S;if(l?.checked&&!S&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","generating");try{let x=a.elements.enable_vector_store,L=x&&x.checked?"1":"0",A=a.elements.vector_store_provider?.value,I=a.elements["openai_vector_store_ids[]"],q=I?Array.from(I.selectedOptions).map(N=>N.value):[],P=a.elements.pinecone_index_name?.value,B=a.elements.qdrant_collection_name?.value,F=a.elements.vector_store_top_k?.value,O=a.elements.vector_store_confidence_threshold?.value,D={generated_content:i.fullContent,final_title:h,provider:_,model:m,prompt_mode:k,custom_keyword_prompt:a.elements.custom_keyword_prompt.value,content_max_tokens:g,enable_vector_store:L,vector_store_provider:A,openai_vector_store_ids:q,pinecone_index_name:P,qdrant_collection_name:B,vector_store_top_k:F,vector_store_confidence_threshold:O,vector_embedding_provider:a.elements.vector_embedding_provider?.value,vector_embedding_model:a.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:f},$=await window.aipkit_apiRequest("aipkit_content_writer_generate_focus_keyword",D);if($&&$.focus_keyword){C=$.focus_keyword;let N=document.getElementById("aipkit_cw_generated_focus_keyword"),R=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");N&&R&&(N.value=C,R.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else throw new Error("AI did not return a focus keyword.")}catch(x){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error",x.message||"Failed")}}else if(S){let x=document.getElementById("aipkit_cw_generated_focus_keyword"),L=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");x&&L&&(x.value=S.split(",")[0].trim(),L.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","skipped");let T=a?a.elements.generate_images_enabled:null,E=a?a.elements.generate_featured_image:null;if((T?.checked||E?.checked)&&i.fullContent.trim()!==""){let x=T?.checked,L=E?.checked,A=x?parseInt(a.elements.image_count?.value,10)||1:0,I=A+(L?1:0),q="Generating images...";I>1?q=`Generating ${I} images...`:I===1&&L&&!x?q="Generating featured image...":I===1&&(q="Generating 1 image..."),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","generating",q);let P={original_topic:v?v.value.split("|")[0].trim():h,final_title:h,keywords:C,image_provider:a.elements.image_provider?.value,image_model:a.elements.image_model?.value,image_prompt:a.elements.image_prompt?.value,image_alignment:a.elements.image_alignment?.value,image_size:a.elements.image_size?.value,featured_image_prompt:a.elements.featured_image_prompt?.value,pexels_orientation:a.elements.pexels_orientation?.value,pexels_size:a.elements.pexels_size?.value,pexels_color:a.elements.pexels_color?.value,pixabay_orientation:a.elements.pixabay_orientation?.value,pixabay_image_type:a.elements.pixabay_image_type?.value,pixabay_category:a.elements.pixabay_category?.value,_ajax_nonce:f,generate_images_enabled:x?"1":"0",image_count:A,generate_featured_image:L?"1":"0",image_placement:a.elements.image_placement?.value,image_placement_param_x:a.elements.image_placement_param_x?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0};try{let B=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",P);if(B?.image_data){let F=document.getElementById("aipkit_cw_image_data_holder");F&&(F.value=JSON.stringify(B.image_data)),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","success")}else throw new Error("Image generation failed or returned no data.")}catch(B){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","error",B.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped");if(d?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let x=a.elements.enable_vector_store,L=x&&x.checked?"1":"0",A=a.elements.vector_store_provider?.value,I=a.elements["openai_vector_store_ids[]"],q=I?Array.from(I.selectedOptions).map(N=>N.value):[],P=a.elements.pinecone_index_name?.value,B=a.elements.qdrant_collection_name?.value,F=a.elements.vector_store_top_k?.value,O=a.elements.vector_store_confidence_threshold?.value,D={generated_content:i.fullContent,final_title:h,keywords:C,provider:_,model:m,prompt_mode:k,custom_excerpt_prompt:a.elements.custom_excerpt_prompt.value,content_max_tokens:g,enable_vector_store:L,vector_store_provider:A,openai_vector_store_ids:q,pinecone_index_name:P,qdrant_collection_name:B,vector_store_top_k:F,vector_store_confidence_threshold:O,vector_embedding_provider:a.elements.vector_embedding_provider?.value,vector_embedding_model:a.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:f},$=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",D);if($&&$.excerpt){let N=document.getElementById("aipkit_cw_generated_excerpt"),R=document.getElementById("aipkit_cw_excerpt_output_wrapper");N&&R&&(N.value=$.excerpt,R.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("AI did not return an excerpt.")}catch(x){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",x.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","skipped");if(u?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let x=a.elements.enable_vector_store,L=x&&x.checked?"1":"0",A=a.elements.vector_store_provider?.value,I=a.elements["openai_vector_store_ids[]"],q=I?Array.from(I.selectedOptions).map(N=>N.value):[],P=a.elements.pinecone_index_name?.value,B=a.elements.qdrant_collection_name?.value,F=a.elements.vector_store_top_k?.value,O=a.elements.vector_store_confidence_threshold?.value,D={generated_content:i.fullContent,final_title:h,keywords:C,provider:_,model:m,prompt_mode:k,custom_tags_prompt:a.elements.custom_tags_prompt.value,content_max_tokens:g,enable_vector_store:L,vector_store_provider:A,openai_vector_store_ids:q,pinecone_index_name:P,qdrant_collection_name:B,vector_store_top_k:F,vector_store_confidence_threshold:O,vector_embedding_provider:a.elements.vector_embedding_provider?.value,vector_embedding_model:a.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:f},$=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",D);if($&&$.tags){let N=document.getElementById("aipkit_cw_generated_tags"),R=document.getElementById("aipkit_cw_tags_output_wrapper");N&&R&&(N.value=$.tags,R.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("AI did not return any tags.")}catch(x){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",x.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","skipped");if(c?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","generating");try{let x=a.elements.enable_vector_store,L=x&&x.checked?"1":"0",A=a.elements.vector_store_provider?.value,I=a.elements["openai_vector_store_ids[]"],q=I?Array.from(I.selectedOptions).map(N=>N.value):[],P=a.elements.pinecone_index_name?.value,B=a.elements.qdrant_collection_name?.value,F=a.elements.vector_store_top_k?.value,O=a.elements.vector_store_confidence_threshold?.value,D={generated_content:i.fullContent,final_title:h,keywords:C,provider:_,model:m,prompt_mode:k,custom_meta_prompt:a.elements.custom_meta_prompt.value,content_max_tokens:g,enable_vector_store:L,vector_store_provider:A,openai_vector_store_ids:q,pinecone_index_name:P,qdrant_collection_name:B,vector_store_top_k:F,vector_store_confidence_threshold:O,vector_embedding_provider:a.elements.vector_embedding_provider?.value,vector_embedding_model:a.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:f},$=await window.aipkit_apiRequest("aipkit_content_writer_generate_meta_desc",D);if($&&$.meta_description){let N=document.getElementById("aipkit_cw_generated_meta_desc"),R=document.getElementById("aipkit_cw_meta_desc_output_wrapper");N&&R&&(N.value=$.meta_description,R.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else throw new Error("AI did not return a meta description.")}catch(x){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error",x.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","skipped");typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(s)}window.aipkit_stream_handleDone=r})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};function r(o,i,e,t,n){if(i.isDone)return;if(n.current&&n.current.userStopped===!0){typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(n);return}let s="Error during streaming.";if(o.data)try{s=JSON.parse(o.data).error||s}catch{}console.error("Stream Error Handler: Error event received:",o),e&&(e.textContent="",e.className="aipkit_form-help"),t&&t.classList.add("aipkit_content_writer_output_error"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error",s),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(n)}window.aipkit_stream_handleError=r})();(function(){"use strict";let p={current:null};function r(o,i){let e=document.getElementById("aipkit_content_writer_output_display"),t=document.getElementById("aipkit_cw_generated_content_area"),n=document.getElementById("aipkit_content_writer_form_status");if(!e||!t||!n){console.error("EventSource Orchestrator: Missing UI elements for streaming.");return}let s=["aipkit_getMarkdownRenderer","aipkit_stream_setupEventSourceConnection","aipkit_stream_handleMessage","aipkit_stream_handleDone","aipkit_stream_handleError","aipkit_finalizeStream","aipkit_updateCwGenerationStatus"];for(let c of s)if(typeof window[c]!="function"){console.error(`EventSource Orchestrator: Missing required function: ${c}`),n&&(n.textContent="",n.className="aipkit_form-help"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let a={fullContent:"",isDone:!1};t.innerHTML="",e.classList.remove("aipkit_content_writer_output_error"),n&&(n.textContent="",n.className="aipkit_form-help"),window.aipkit_updateCwGenerationStatus("content","generating");try{i.current=window.aipkit_stream_setupEventSourceConnection(o,i);let c=window.aipkit_getMarkdownRenderer();i.current.onopen=function(){window.aipkit_updateCwGenerationStatus("content","generating")},i.current.onmessage=function(l){window.aipkit_stream_handleMessage(l,a,t,c)},i.current.addEventListener("done",function(l){window.aipkit_stream_handleDone(l,a,t,c,n,i)}),i.current.addEventListener("error",function(l){window.aipkit_stream_handleError(l,a,n,e,i)})}catch(c){console.error("EventSource Orchestrator: Error during setup:",c),n&&(n.textContent="",n.className="aipkit_form-help"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons(),window.aipkit_updateCwGenerationStatus("content","error","Connection Failed")}}window.aipkit_handleContentWriterEventSource=r,window.aipkit_contentWriterEventSourceInstanceRef=p})();(function(){"use strict";function p(r){r&&r.current&&r.current.close()}window.aipkit_stopContentWriterEventSource=p})();(function(){"use strict";async function p(r){let o=document.getElementById("aipkit_content_writer_form"),i=document.getElementById("aipkit_content_writer_generate_btn"),e=document.getElementById("aipkit_content_writer_stop_btn"),t=document.getElementById("aipkit_content_writer_form_status"),n=document.getElementById("aipkit_cw_generated_content_area"),s=document.getElementById("aipkit_content_writer_copy_btn"),a=document.getElementById("aipkit_content_writer_clear_btn"),c=document.querySelector(".aipkit_content_writer_progress_bar_container"),l=document.querySelector(".aipkit_content_writer_output_actions");if(!o||!i||!e||!t||!n||!s||!a||!l){console.error("Handle SSE: Missing UI elements.");return}let d=new FormData(o),u=Object.fromEntries(d.entries());if(!u.conversation_uuid){let _=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();_&&(u.conversation_uuid=_)}if(!u.content_title){t.textContent="",t.className="aipkit_form-help";return}let f=document.getElementById("aipkit_content_writer_nonce");if(f&&f.value)u._ajax_nonce=f.value;else{t.textContent="",t.className="aipkit_form-help";return}if(window.aipkit_setLoadingStateOpenAI(i,!0,"Generate","Initializing..."),i.style.display="none",e.style.display="inline-flex",c&&(c.style.display="none"),l.style.display="none",n){let _=n.querySelector(".aipkit_cw_output_placeholder");_&&(_.style.display="none"),n.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Preparing to generate content...</p>'}s.disabled=!0,a.disabled=!0,typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),t.textContent="",t.className="aipkit_form-help";try{u.content_title=document.getElementById("aipkit_content_writer_title").value;let _=await window.aipkit_apiRequest("aipkit_content_writer_init_stream",u);if(!_.cache_key)throw new Error(_.message||"Failed to initialize stream.");if(document.getElementById("aipkit_content_writer_stream_cache_key").value=_.cache_key,_.conversation_uuid){window.aipkit_current_conversation_uuid=_.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",_.conversation_uuid)}catch{}}if(typeof window.aipkit_handleContentWriterEventSource=="function")window.aipkit_handleContentWriterEventSource(_.cache_key,r);else throw new Error("Stream orchestrator function (aipkit_handleContentWriterEventSource) not found.")}catch(_){console.error("Content Writer Init Stream Error:",_),t.textContent="",t.className="aipkit_form-help",window.aipkit_setLoadingStateOpenAI(i,!1,"Generate"),i.style.display="inline-flex",e.style.display="none",n&&(n.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error initializing content generation.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Stream Init Failed")}}window.aipkit_handleGenerateContentSSE=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};async function r(){let o=document.getElementById("aipkit_content_writer_form"),i=document.getElementById("aipkit_content_writer_generate_btn"),e=document.getElementById("aipkit_content_writer_stop_btn"),t=document.getElementById("aipkit_content_writer_form_status"),n=document.getElementById("aipkit_cw_generated_content_area"),s=document.getElementById("aipkit_content_writer_copy_btn"),a=document.getElementById("aipkit_content_writer_clear_btn"),c=document.querySelector(".aipkit_content_writer_progress_bar_container"),l=c?c.querySelector(".aipkit_content_writer_progress_bar"):null,d=document.querySelector(".aipkit_content_writer_output_actions"),u=document.getElementById("aipkit_cw_status_display_container");if(!o||!i||!e||!t||!n||!s||!a){console.error("Handle AJAX: Missing UI elements.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getMarkdownRenderer!="function"){console.error("Handle AJAX: Missing core helper functions."),t.textContent="",t.className="aipkit_form-help";return}let f=new FormData(o),_=Object.fromEntries(f.entries());if(!_.conversation_uuid){let y=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();y&&(_.conversation_uuid=y)}if(!_.content_title){t.textContent="",t.className="aipkit_form-help",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Missing title");return}let m=document.getElementById("aipkit_content_writer_nonce");if(m&&m.value)_._ajax_nonce=m.value;else{t.textContent="",t.className="aipkit_form-help",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Token Missing");return}u&&(u.style.display="block");let g=document.getElementById("aipkit_cw_generate_meta_desc"),k=document.getElementById("aipkit_cw_generate_focus_keyword"),w=document.getElementById("aipkit_cw_generate_excerpt"),h=document.getElementById("aipkit_cw_generate_tags");if(typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","skipped"),window.aipkit_updateCwGenerationStatus("excerpt",w?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("tags",h?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("meta",g?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("keyword",k?.checked?"pending":"skipped")),window.aipkit_setLoadingStateOpenAI(i,!0,"Generate","Generating..."),e.style.display="none",d&&(d.style.display="none"),n){let y=n.querySelector(".aipkit_cw_output_placeholder");y&&(y.style.display="none"),n.innerHTML=""}s.disabled=!0,a.disabled=!0,typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),t.textContent="Generating content, please wait...",t.className="aipkit_form-help aipkit_settings_message-info",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","generating"),c&&l&&(c.style.display="block",l.style.width="0%",l.classList.add("aipkit_indeterminate"));try{let y=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",_);if(y.content){if(y.conversation_uuid){window.aipkit_current_conversation_uuid=y.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",y.conversation_uuid)}catch{}}let b=window.aipkit_getMarkdownRenderer();if(n&&(b?n.innerHTML=b.render(y.content):n.textContent=y.content),d&&(d.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success"),s.disabled=!1,a.disabled=!1,typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton(),y.content&&w?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let v=o.elements.enable_vector_store,S=v&&v.checked?"1":"0",C=o.elements.vector_store_provider?.value,T=o.elements["openai_vector_store_ids[]"],E=T?Array.from(T.selectedOptions).map(P=>P.value):[],M=o.elements.pinecone_index_name?.value,x=o.elements.qdrant_collection_name?.value,L=o.elements.vector_store_top_k?.value,A=o.elements.vector_store_confidence_threshold?.value,I={generated_content:y.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||_.content_title,provider:_.ai_provider,model:_.ai_model,prompt_mode:_.prompt_mode,custom_excerpt_prompt:_.custom_excerpt_prompt,enable_vector_store:S,vector_store_provider:C,openai_vector_store_ids:E,pinecone_index_name:M,qdrant_collection_name:x,vector_store_top_k:L,vector_store_confidence_threshold:A,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:_._ajax_nonce},q=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",I);if(q&&q.excerpt){let P=document.getElementById("aipkit_cw_generated_excerpt"),B=document.getElementById("aipkit_cw_excerpt_output_wrapper");P&&B&&(P.value=q.excerpt,B.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("Not returned")}catch(v){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",v.message||"Not returned")}}if(y.content&&h?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let v=o.elements.enable_vector_store,S=v&&v.checked?"1":"0",C=o.elements.vector_store_provider?.value,T=o.elements["openai_vector_store_ids[]"],E=T?Array.from(T.selectedOptions).map(P=>P.value):[],M=o.elements.pinecone_index_name?.value,x=o.elements.qdrant_collection_name?.value,L=o.elements.vector_store_top_k?.value,A=o.elements.vector_store_confidence_threshold?.value,I={generated_content:y.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||_.content_title,provider:_.ai_provider,model:_.ai_model,prompt_mode:_.prompt_mode,custom_tags_prompt:_.custom_tags_prompt,enable_vector_store:S,vector_store_provider:C,openai_vector_store_ids:E,pinecone_index_name:M,qdrant_collection_name:x,vector_store_top_k:L,vector_store_confidence_threshold:A,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:_._ajax_nonce},q=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",I);if(q&&q.tags){let P=document.getElementById("aipkit_cw_generated_tags"),B=document.getElementById("aipkit_cw_tags_output_wrapper");P&&B&&(P.value=q.tags,B.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("Not returned")}catch(v){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",v.message||"Not returned")}}if(y.meta_description){let v=document.getElementById("aipkit_cw_generated_meta_desc"),S=document.getElementById("aipkit_cw_meta_desc_output_wrapper");v&&S&&(v.value=y.meta_description,S.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else g?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error","Not returned");if(y.focus_keyword){let v=document.getElementById("aipkit_cw_generated_focus_keyword"),S=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");v&&S&&(v.value=y.focus_keyword,S.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else k?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error","Not returned")}else throw new Error(y.message||"No content received.")}catch(y){console.error("Content Writer AJAX Error:",y),t.textContent="",t.className="aipkit_form-help",n&&(n.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error generating content.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("content","error",y.message),w?.checked&&window.aipkit_updateCwGenerationStatus("excerpt","error","Not Generated"),h?.checked&&window.aipkit_updateCwGenerationStatus("tags","error","Not Generated"),g?.checked&&window.aipkit_updateCwGenerationStatus("meta","error","Not Generated"),k?.checked&&window.aipkit_updateCwGenerationStatus("keyword","error","Not Generated")),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),d&&(d.style.display="none")}finally{window.aipkit_setLoadingStateOpenAI(i,!1,"Generate"),c&&(c.style.display="none"),l&&l.classList.remove("aipkit_indeterminate")}}window.aipkit_handleGenerateContentAjax=r})();(function(){"use strict";function p(r){if(!r||!r.current){typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let o=document.getElementById("aipkit_content_writer_form_status");r.current.userStopped=!0,typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","skipped","Stopped"),typeof window.aipkit_stopContentWriterEventSource=="function"?window.aipkit_stopContentWriterEventSource(r):console.error("Handle Stop Generation: stopContentWriterEventSource function not found."),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons()}window.aipkit_handleStopGeneration=p})();(function(){"use strict";function p(r,o,i,e){r&&(r.dataset.listenerAttached||(r.addEventListener("click",async()=>{try{delete window.aipkit_current_conversation_uuid,sessionStorage.removeItem("aipkit_current_conversation_uuid")}catch{}if(r.dataset.action==="upgrade"){window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.open(window.aipkit_dashboard.upgradeUrl,"_blank"):alert("Upgrade URL not found. Please visit our website.");return}typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput();let t=document.getElementById("aipkit_content_writer_form_status"),n=document.getElementById("aipkit_cw_status_display_container"),s=document.getElementById("aipkit_cw_generated_title_display"),a=document.getElementById("aipkit_content_writer_title");if((r.dataset.action||"generate_single")==="create_task"){n&&(n.style.display="block"),typeof window.aipkit_createContentWriterTask=="function"?window.aipkit_createContentWriterTask(o,r,t):(console.error("Generate Button Listener: aipkit_createContentWriterTask function not found."),t&&(t.textContent="",t.className="aipkit_form-help"));return}let l=document.getElementById("aipkit_cw_single_output_wrapper");l&&(l.style.display="block"),n&&(n.style.display="block");let d=document.getElementById("aipkit_content_writer_stream_mode"),f=o.querySelector("#aipkit_cw_custom_title_prompt")?.value.trim()!=="";typeof window.aipkit_resetGenerationStatusIndicators=="function"&&window.aipkit_resetGenerationStatusIndicators(),i.style.display="flex";let _={meta:"aipkit_cw_generate_meta_desc",keyword:"aipkit_cw_generate_focus_keyword",excerpt:"aipkit_cw_generate_excerpt",tags:"aipkit_cw_generate_tags"};for(let[k,w]of Object.entries(_)){let h=document.getElementById(w);h&&!h.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus(k,"skipped")}let m=document.getElementById("aipkit_cw_generate_images_enabled"),g=document.getElementById("aipkit_cw_generate_featured_image");if(m&&g&&!m.checked&&!g.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped"),f){typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","generating"),window.aipkit_updateCwGenerationStatus("content","pending"),s&&(s.style.display="none"));try{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,"Generate","Generating Title...");let k=new FormData(o),w=Object.fromEntries(k.entries()),h=document.getElementById("aipkit_content_writer_nonce");w._ajax_nonce=h?h.value:"",window.aipkit_current_conversation_uuid&&(w.conversation_uuid=window.aipkit_current_conversation_uuid);let y=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",w);if(y&&y.new_title){if(y.conversation_uuid){window.aipkit_current_conversation_uuid=y.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",y.conversation_uuid)}catch{}}s&&(s.textContent=y.new_title,s.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","success")}else throw new Error(y.message||"Failed to generate new title.")}catch(k){console.error("Title Generation Error:",k),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","error",k.message),t&&(t.textContent="",t.className="aipkit_form-help"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","skipped"),s&&a&&(s.textContent=a.value.split("|")[0].trim(),s.style.display="block");!d||d.checked?typeof window.aipkit_handleGenerateContentSSE=="function"&&window.aipkit_handleGenerateContentSSE(e):typeof window.aipkit_handleGenerateContentAjax=="function"&&window.aipkit_handleGenerateContentAjax()}),r.dataset.listenerAttached="true"))}window.aipkit_attachGenerateButtonListener=p})();(function(){"use strict";function p(r,o){r&&(r.dataset.listenerAttached||(r.addEventListener("click",()=>{typeof window.aipkit_handleStopGeneration=="function"?window.aipkit_handleStopGeneration(o):console.error("Stop Button Listener: aipkit_handleStopGeneration function not found.")}),r.dataset.listenerAttached="true"))}window.aipkit_attachStopButtonListener=p})();(function(){"use strict";function p(r,o){if(r===o)return!0;if(r==null||typeof r!="object"||o==null||typeof o!="object")return!1;let i=Object.keys(r),e=Object.keys(o);if(i.length!==e.length)return!1;for(let t of i)if(!e.includes(t)||!p(r[t],o[t]))return!1;return!0}window.aipkit_deepEqual=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_content_writer_provider"),o=document.getElementById("aipkit_content_writer_temperature"),i=document.getElementById("aipkit_content_writer_post_author"),e=i?i.value:window.aipkit_dashboard?.currentUserId||"1",n=(r&&r.options.length>0?r.options[0].value:(window.aipkit_dashboard?.models?.openai,"OpenAI")).toLowerCase(),s=r?r.value.toLowerCase():n,a="",c=window.aipkit_dashboard?.models?.[s];switch(s){case"openai":a="gpt-4.1-mini";break;case"google":a="gemini-2.5-flash";break;case"openrouter":a="anthropic/claude-3.7-sonnet";break;case"azure":case"deepseek":case"ollama":Array.isArray(c)&&c.length>0?a=c[0].id||"":a="";break;default:a=""}let l=o&&o.defaultValue||"1.0",u=(window.aipkit_dashboard?.aiParams||{}).max_completion_tokens||"4000",f=window.aipkit_content_writer_config?.default_prompts||{};return{ai_provider:s,ai_model:a,content_title:"",content_title_bulk:"",content_keywords:"",ai_temperature:l,content_max_tokens:u,post_type:"post",post_author:e,post_status:"draft",post_schedule_date:"",post_schedule_time:"",post_categories:[],prompt_mode:"custom",custom_title_prompt:f.title,custom_content_prompt:f.content,generate_meta_description:"1",custom_meta_prompt:f.meta,generate_focus_keyword:"1",custom_keyword_prompt:f.keyword,generate_excerpt:"1",custom_excerpt_prompt:f.excerpt,generate_tags:"1",custom_tags_prompt:f.tags,cw_generation_mode:"single",rss_feeds:"",gsheets_sheet_id:"",gsheets_credentials:"",url_list:"",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",image_provider:"openai",image_model:"gpt-image-1",image_prompt:f.image||"A high-quality, relevant image for an article about: {topic}",image_count:"1",image_placement:"after_first_h2",image_placement_param_x:"2",image_alignment:"none",image_size:"large",generate_featured_image:"0",featured_image_prompt:f.featured_image||"An eye-catching, high-quality featured image for a blog post about: {topic}. Keywords: {keywords}.",pexels_orientation:"none",pexels_size:"none",pexels_color:"",pixabay_orientation:"all",pixabay_image_type:"all",pixabay_category:"",enable_vector_store:"0",vector_store_provider:"openai",openai_vector_store_ids:[],pinecone_index_name:"",qdrant_collection_name:"",vector_embedding_provider:"openai",vector_embedding_model:"text-embedding-3-small",vector_store_top_k:"3",vector_store_confidence_threshold:"20",rss_include_keywords:"",rss_exclude_keywords:""}}window.aipkit_getDefaultContentWriterTemplateConfig=p})();(function(){"use strict";function p(r){let o={};if(!r)return o;["ai_provider","ai_model","content_title","content_keywords","ai_temperature","content_max_tokens","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","prompt_mode","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_embedding_model","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(k=>{r.elements[k]&&(o[k]=r.elements[k].value)});let e=r.elements.generate_meta_description;e?o.generate_meta_description=e.checked?"1":"0":o.generate_meta_description="0";let t=r.elements.generate_focus_keyword;t?o.generate_focus_keyword=t.checked?"1":"0":o.generate_focus_keyword="0";let n=r.elements.generate_excerpt;n?o.generate_excerpt=n.checked?"1":"0":o.generate_excerpt="0";let s=r.elements.generate_tags;s?o.generate_tags=s.checked?"1":"0":o.generate_tags="0";let a=r.elements.generate_toc;a?o.generate_toc=a.checked?"1":"0":o.generate_toc="0";let c=r.elements.generate_seo_slug;c?o.generate_seo_slug=c.checked?"1":"0":o.generate_seo_slug="0";let l=r.elements.generate_images_enabled;l?o.generate_images_enabled=l.checked?"1":"0":o.generate_images_enabled="0";let d=r.elements.generate_featured_image;d?o.generate_featured_image=d.checked?"1":"0":o.generate_featured_image="0";let u=r.elements.enable_vector_store;u?o.enable_vector_store=u.checked?"1":"0":o.enable_vector_store="0";let f=r.elements["openai_vector_store_ids[]"];f?o.openai_vector_store_ids=Array.from(f.selectedOptions).map(k=>k.value):o.openai_vector_store_ids=[];let _=r.querySelector("#aipkit_cw_prompt_mode_hidden_input");_?o.prompt_mode=_.value:o.prompt_mode="custom";let m=r.querySelector("#aipkit_cw_generation_mode");o.cw_generation_mode=m?m.value:"single";let g=r.elements["post_categories[]"];return g?o.post_categories=Array.from(g.selectedOptions).map(k=>k.value):o.post_categories=[],o}window.aipkit_getContentWriterFormConfig=p})();(function(){"use strict";function p(r){if(!r||!r.value)return!1;let o=r.value,i=window.aipkit_cw_template_state.currentTemplates.find(e=>String(e.id)===String(o));return i&&String(i.is_default)==="1"}window.aipkit_isDefaultTemplateSelected=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_content_writer_post_status"),o=document.getElementById("aipkit_cw_schedule_options_wrapper"),i=document.getElementById("aipkit_cw_smart_schedule_fields"),e=document.querySelector(".aipkit_schedule_from_input_help"),t=document.querySelector(".aipkit_schedule_from_input_option");if(!r||!o)return;let n=r.value==="publish";o.style.display=n?"block":"none";let s=document.querySelector(".aipkit_cw_tab.aipkit_active"),a=s?s.dataset.mode:"single";if(t){let d=a==="rss";t.style.display=d?"none":"inline-flex";let u=t.querySelector('input[name="schedule_mode"]');if(d&&u&&u.checked){let f=document.querySelector('input[name="schedule_mode"][value="immediate"]');f&&(f.checked=!0,f.dispatchEvent(new Event("change",{bubbles:!0})))}}document.querySelectorAll('input[name="schedule_mode"]').forEach(d=>{d.dataset.listenerAttached||(d.addEventListener("change",function(){i&&(i.style.display=this.value==="smart"?"block":"none"),e&&(e.style.display=this.value==="from_input"?"block":"none")}),d.dataset.listenerAttached="true")});let l=document.querySelector('input[name="schedule_mode"]:checked');l&&i&&(i.style.display=l.value==="smart"?"block":"none"),l&&e&&(e.style.display=l.value==="from_input"?"block":"none")}window.aipkit_toggleContentWriterScheduleFields=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(i){return i};function r(){let i=document.getElementById("aipkit_cw_single_output_wrapper"),e=document.getElementById("aipkit_cw_generated_title_display"),t=document.getElementById("aipkit_cw_generated_content_area"),n=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),s=document.querySelector(".aipkit_content_writer_output_actions");i&&(i.style.display="none"),e&&(e.style.display="none",e.textContent=""),t&&(t.innerHTML=`
            <div class="aipkit_cw_output_placeholder">
                <span class="dashicons dashicons-edit-large"></span>
                <span>Your article will appear here...</span>
            </div>`),n&&(n.style.display="none"),s&&(s.style.display="none")}function o(i,e=!1){let t=document.getElementById("aipkit_cw_template_status");window.aipkit_cw_template_state.currentTemplateId=i,i?sessionStorage.setItem("aipkit_cw_last_template_id",i):sessionStorage.removeItem("aipkit_cw_last_template_id");let n=window.aipkit_cw_template_state.currentTemplates.find(y=>String(y.id)===String(i)),s;if(n)s=JSON.parse(JSON.stringify(n.config));else{if(typeof window.aipkit_getDefaultContentWriterTemplateConfig!="function"){console.error("Apply Template: getDefaultContentWriterTemplateConfig function is missing."),t&&!e&&(t.textContent="Error: Cannot load default template.",t.className="aipkit_form-help aipkit_settings_message-error");return}s=window.aipkit_getDefaultContentWriterTemplateConfig()}window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(s)),window.aipkit_cw_template_state.currentTemplateModified=!1,r();let a=document.getElementById("aipkit_content_writer_form");if(!a){console.error("Apply Template: Content writer form not found.");return}s.ai_model&&a.elements.ai_model?window.aipkit_cw_template_state.pendingModelSelection=s.ai_model:window.aipkit_cw_template_state.pendingModelSelection=null,s.image_model&&a.elements.image_model?window.aipkit_cw_template_state.pendingImageModelSelection=s.image_model:window.aipkit_cw_template_state.pendingImageModelSelection=null,["ai_provider","content_title","content_keywords","ai_temperature","content_max_tokens","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(y=>{let b=a.elements[y];if(b){let v=s[y]===null||typeof s[y]>"u"?"":s[y];if(y==="gsheets_credentials"&&typeof v=="object"&&v!==null)b.value=JSON.stringify(v,null,2);else if((y==="ai_temperature"||y==="content_max_tokens"||y==="vector_store_top_k"||y==="vector_store_confidence_threshold")&&b.type==="range"){b.value=v||(y==="ai_temperature"?"1.0":y==="vector_store_top_k"?"3":y==="vector_store_confidence_threshold"?"20":"4000");let S=document.getElementById(b.id+"_value");S&&(S.textContent=y==="vector_store_confidence_threshold"?b.value+"%":b.value)}else b.type==="checkbox"?b.checked=v==="1":b.value=v;y==="post_status"&&typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields()}});let l=a.elements.gsheets_credentials;if(l){let y=s.gsheets_credentials,b=l.closest(".aipkit_gsheets_section_container");l.value=typeof y=="object"&&y!==null?JSON.stringify(y,null,2):y||"",l.value?(l.dataset.filename="credentials.json",b&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(b),100)):(delete l.dataset.filename,b&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(b,"clear"))}let d={generate_meta_description:"1",generate_focus_keyword:"1",generate_excerpt:"0",generate_tags:"0",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",generate_featured_image:"0",enable_vector_store:"0"};for(let[y,b]of Object.entries(d)){let v=a.elements[y];v&&(v.checked=(s[y]||b)==="1")}let u=document.getElementById("aipkit_cw_prompt_mode_hidden_input");u&&(u.value=s.prompt_mode||"custom");let f=a.querySelector("#aipkit_cw_generation_mode"),_=s.cw_generation_mode||"single";f&&(f.value=_,typeof window.aipkit_initContentWriterTaskModeHandler=="function"&&f.dispatchEvent(new Event("change",{bubbles:!0})));let m=a.elements["post_categories[]"];if(m){let y=Array.isArray(s.post_categories)?s.post_categories.map(b=>String(b)):[];Array.from(m.options).forEach(b=>{b.selected=y.includes(b.value)})}let g=a.elements["openai_vector_store_ids[]"];if(g){let y=Array.isArray(s.openai_vector_store_ids)?s.openai_vector_store_ids.map(String):[];Array.from(g.options).forEach(b=>{b.selected=y.includes(b.value)})}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI(),typeof window.aipkit_cw_toggleCustomOptionPrompts=="function"&&window.aipkit_cw_toggleCustomOptionPrompts();let k=a.elements.enable_vector_store;k&&typeof window.aipkit_cw_toggleVectorSettingsContainer=="function"&&window.aipkit_cw_toggleVectorSettingsContainer(k.closest(".aipkit_accordion-content"));let w=a.elements.vector_store_provider;w&&typeof window.aipkit_cw_toggleProviderSpecificFields=="function"&&(w.value=s.vector_store_provider||"openai",w.dispatchEvent(new Event("change",{bubbles:!0})));let h=a.elements.ai_provider;if(h){let y=h.value,b=(window.aipkit_dashboard?.models?.openai,"OpenAI").toLowerCase(),v=(s.ai_provider||b).toLowerCase();if(y!==v)h.value=v,h.dispatchEvent(new Event("change",{bubbles:!0}));else{let S=a.elements.ai_model;S&&typeof window.aipkit_populateModelsForContentWriter=="function"?window.aipkit_populateModelsForContentWriter(h,S):typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications()}}if(!e&&t&&(n&&i?(t.textContent=`Template "${p(n.template_name)}" applied.`,t.className="aipkit_form-help aipkit_settings_message-success"):i||(t.textContent="Form reset to defaults.",t.className="aipkit_form-help aipkit_settings_message-info"),setTimeout(()=>{t&&(t.textContent="",t.className="aipkit_form-help")},3e3)),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(i),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let y=document.getElementById("aipkit_content_writer_container");y&&window.aipkit_cw_toggleReasoningEffort(y)}}window.aipkit_applyContentWriterTemplate=o})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};async function r(o){if(!o){console.error("Fetch & Populate Templates: Select element is missing.");return}let i=document.getElementById("aipkit_cw_template_status"),e=document.getElementById("aipkit_content_writer_template_nonce_field");o.innerHTML=`<option value="">${p("Loading templates...")}</option>`,o.disabled=!0,i&&(i.textContent="",i.className="aipkit_form-help");try{let t=await window.aipkit_apiRequest("aipkit_list_cw_templates",{_ajax_nonce:e?e.value:""});window.aipkit_cw_template_state.currentTemplates=t.templates||[],o.innerHTML="";let n=new Option(p("-- Select Template --"),"");o.appendChild(n);let s=window.aipkit_cw_template_state.currentTemplates||[],a=window.aipkit_dashboard?.currentUserId?.toString(),c=null,l=[],d={};if(s.forEach(_=>{if(String(_.is_default)==="1"&&_.user_id.toString()===a&&(c=_.id),_.user_id.toString()===a)l.push(_);else{let m=_.display_name||`User ID: ${_.user_id}`;d[m]||(d[m]=[]),d[m].push(_)}}),l.sort((_,m)=>_.is_default==="1"?-1:m.is_default==="1"?1:_.template_name.localeCompare(m.template_name)),l.length>0){let _=document.createElement("optgroup");_.label=p("My Templates"),l.forEach(m=>{_.appendChild(new Option(p(m.template_name),m.id))}),o.appendChild(_)}Object.keys(d).sort().forEach(_=>{let m=document.createElement("optgroup");m.label=p(_),d[_].forEach(g=>{m.appendChild(new Option(p(g.template_name),g.id))}),o.appendChild(m)}),o.disabled=!1;let f=sessionStorage.getItem("aipkit_cw_last_template_id");f&&o.querySelector(`option[value="${CSS.escape(f)}"]`)?(o.value=f,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(f,!0)):c?(o.value=c,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(c,!0)):typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate("",!0)}catch(t){console.error("Error fetching templates:",t),o.innerHTML=`<option value="">${p("Error loading templates")}</option>`,i&&(i.textContent=`Error: ${t.message||"Failed to load templates."}`,i.className="aipkit_form-help aipkit_settings_message-error")}}window.aipkit_fetchAndPopulateTemplates=r})();(function(){"use strict";async function p(r,o,i){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;window.aipkit_cw_template_state.isSavingOrDeleting=!0;let e=document.getElementById("aipkit_cw_template_status"),t=document.getElementById("aipkit_content_writer_template_nonce_field");e&&(e.textContent="Saving template...",e.className="aipkit_form-help aipkit_settings_message-info");try{let n=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:r,template_name:o,config:JSON.stringify(i),_ajax_nonce:t?t.value:""});e&&(e.textContent=n.message||"Template saved successfully.",e.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{e&&(e.textContent="",e.className="aipkit_form-help")},3e3)),window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(n.template_config||i)),window.aipkit_cw_template_state.currentTemplateModified=!1;let s=document.getElementById("aipkit_cw_template_select");typeof window.aipkit_fetchAndPopulateTemplates=="function"&&s&&(await window.aipkit_fetchAndPopulateTemplates(s),n.template_id&&(s.value=n.template_id,window.aipkit_cw_template_state.currentTemplateId=n.template_id,sessionStorage.setItem("aipkit_cw_last_template_id",window.aipkit_cw_template_state.currentTemplateId))),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}catch(n){console.error("Error saving template:",n),e&&(e.textContent=`Error: ${n.message||"Failed to save template."}`,e.className="aipkit_form-help aipkit_settings_message-error")}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}window.aipkit_saveContentWriterTemplate=p})();(function(){"use strict";function p(r){let o=document.getElementById("aipkit_cw_rename_template_btn"),i=document.getElementById("aipkit_cw_delete_template_btn"),e=document.getElementById("aipkit_cw_update_template_btn"),t=window.aipkit_dashboard||{},n=t.isAdmin||!1,s=t.currentUserId?String(t.currentUserId):"0",a=window.aipkit_cw_template_state.currentTemplates.find(u=>String(u.id)===String(r));if(!a){o&&(o.disabled=!0),i&&(i.disabled=!0),e&&(e.disabled=!0);return}let c=String(a.user_id)===s,l=c||n,d=c||n;if(o&&(o.disabled=!l),i&&(i.disabled=!d),e){let u=l&&window.aipkit_cw_template_state.currentTemplateModified;e.disabled=!u}}window.aipkit_updateTemplateActionButtonsState=p})();(function(){"use strict";function p(){if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_deepEqual!="function"||!window.aipkit_cw_template_state){console.error("checkFormForModifications: Missing required dependencies (getFormConfig, deepEqual, or state object).");return}let r=document.getElementById("aipkit_content_writer_form");if(!r)return;let o=window.aipkit_getContentWriterFormConfig(r),i=window.aipkit_cw_template_state.initialConfigForSelectedTemplate;window.aipkit_cw_template_state.currentTemplateModified=!window.aipkit_deepEqual(o,i),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}window.aipkit_checkFormForModifications=p})();(function(){"use strict";function p(){if(!window.aipkit_cw_template_state.isSavingOrDeleting){if(typeof window.aipkit_showTemplateNameForm!="function"){console.error("Save As Template: aipkit_showTemplateNameForm function not found."),alert("An error occurred. Please refresh the page.");return}window.aipkit_showTemplateNameForm("new")}}window.aipkit_handleSaveAsContentWriterTemplate=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};function r(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let o=document.getElementById("aipkit_cw_template_select"),i=o.value,e=o.options[o.selectedIndex],t=e?e.text:"";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateNameForm!="function"){console.error("Rename Template: aipkit_isDefaultTemplateSelected or aipkit_showTemplateNameForm function missing."),alert("An error occurred. Please refresh the page.");return}if(!i||i===""||window.aipkit_isDefaultTemplateSelected(e)){alert("Cannot rename the default template or no template is selected.");return}window.aipkit_showTemplateNameForm("rename",t)}window.aipkit_handleRenameContentWriterTemplate=r})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(o){return o};function r(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let o=document.getElementById("aipkit_cw_template_select"),i=o.value,e=o.options[o.selectedIndex],t=e?e.text:"this template";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateDeleteConfirm!="function"){console.error("Delete Template: isDefaultTemplateSelected or showTemplateDeleteConfirm function missing."),alert("Cannot delete: core function missing.");return}if(!i||i===""||window.aipkit_isDefaultTemplateSelected(e)){alert("Cannot delete the default template or no template is selected.");return}window.aipkit_showTemplateDeleteConfirm(t)}window.aipkit_handleDeleteContentWriterTemplate=r})();(function(){"use strict";function p(o,i=""){let e=document.querySelector(".aipkit_cw_template_select_group"),t=document.getElementById("aipkit_cw_template_inline_form"),n=document.getElementById("aipkit_cw_template_name_input");!e||!t||!n||(e.style.display="none",t.style.display="flex",t.dataset.mode=o,n.value=i,n.focus())}function r(){let o=document.querySelector(".aipkit_cw_template_select_group"),i=document.getElementById("aipkit_cw_template_inline_form"),e=document.getElementById("aipkit_cw_template_name_input");!o||!i||!e||(o.style.display="block",i.style.display="none",e.value="",delete i.dataset.mode)}window.aipkit_showTemplateNameForm=p,window.aipkit_hideTemplateNameForm=r})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(i){return i};function r(i){let e=document.querySelector(".aipkit_cw_template_select_group"),t=document.getElementById("aipkit_cw_template_inline_form"),n=document.getElementById("aipkit_cw_template_inline_delete_confirm"),s=document.getElementById("aipkit_cw_template_delete_confirm_text");!e||!t||!n||!s||(e.style.display="none",t.style.display="none",n.style.display="flex",s.innerHTML=`Delete "<strong>${p(i)}</strong>"?`)}function o(){let i=document.querySelector(".aipkit_cw_template_select_group"),e=document.getElementById("aipkit_cw_template_inline_delete_confirm");!i||!e||(i.style.display="block",e.style.display="none")}window.aipkit_showTemplateDeleteConfirm=r,window.aipkit_hideTemplateDeleteConfirm=o})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_cw_template_save_inline_btn"),o=document.getElementById("aipkit_cw_template_cancel_inline_btn"),i=document.getElementById("aipkit_cw_template_inline_form"),e=document.getElementById("aipkit_cw_template_name_input");if(!r||!o||!i||!e){console.warn("bindInlineFormButtons: One or more inline form elements are missing.");return}o.addEventListener("click",()=>{typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()}),r.addEventListener("click",async()=>{let t=i.dataset.mode,n=e.value.trim();if(!n){alert("Please enter a template name.");return}let s=document.getElementById("aipkit_content_writer_form"),a=document.getElementById("aipkit_cw_template_select");if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_saveContentWriterTemplate!="function"){console.error("Inline Save: Missing required helper functions.");return}let c=window.aipkit_getContentWriterFormConfig(s);if(t==="new")await window.aipkit_saveContentWriterTemplate(0,n,c);else if(t==="rename"){let l=a.value;l&&await window.aipkit_saveContentWriterTemplate(parseInt(l),n,c)}typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()})}window.aipkit_bindInlineFormButtons=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_cw_template_confirm_delete_btn"),o=document.getElementById("aipkit_cw_template_cancel_delete_btn");if(!r||!o){console.warn("bindInlineDeleteButtons: One or more inline delete buttons are missing.");return}o.addEventListener("click",()=>{typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}),r.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let i=document.getElementById("aipkit_cw_template_select"),e=i.value,t=document.getElementById("aipkit_cw_template_status"),n=document.getElementById("aipkit_content_writer_template_nonce_field");window.aipkit_cw_template_state.isSavingOrDeleting=!0,t&&(t.textContent="Deleting...",t.className="aipkit_form-help aipkit_settings_message-info");try{await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:e,_ajax_nonce:n?n.value:""}),t&&(t.textContent="Template deleted.",t.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{t&&(t.textContent="",t.className="aipkit_form-help")},3e3)),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&window.aipkit_fetchAndPopulateTemplates(i)}catch(s){console.error("Error deleting template:",s),t&&(t.textContent=`Error: ${s.message||"Failed to delete template."}`,t.className="aipkit_form-help aipkit_settings_message-error")}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1,typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}})}window.aipkit_bindInlineDeleteButtons=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_cw_template_select");if(!r){console.warn("initTemplateSelect: Template select element not found.");return}typeof window.aipkit_fetchAndPopulateTemplates=="function"?window.aipkit_fetchAndPopulateTemplates(r):console.error("initTemplateSelect: fetchAndPopulateTemplates function missing."),typeof window.aipkit_applyContentWriterTemplate=="function"?r.addEventListener("change",o=>window.aipkit_applyContentWriterTemplate(o.target.value)):console.error("initTemplateSelect: applyContentWriterTemplate function missing.")}window.aipkit_initTemplateSelect=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_cw_save_as_template_btn");if(!r){console.warn("bindSaveAsTemplateBtn: Button not found.");return}typeof window.aipkit_handleSaveAsContentWriterTemplate=="function"?r.addEventListener("click",window.aipkit_handleSaveAsContentWriterTemplate):console.error("bindSaveAsTemplateBtn: handleSaveAsContentWriterTemplate function missing.")}window.aipkit_bindSaveAsTemplateBtn=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_cw_update_template_btn"),o=document.getElementById("aipkit_cw_template_select"),i=document.getElementById("aipkit_content_writer_form");if(!r||!o||!i){console.warn("bindUpdateTemplateBtn: Required elements (button, select, form) not found.");return}typeof window.aipkit_saveContentWriterTemplate=="function"&&typeof window.aipkit_getContentWriterFormConfig=="function"?r.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting||!window.aipkit_cw_template_state.currentTemplateId)return;let e=o.options[o.selectedIndex],t=e?e.text:"Untitled Template",n=window.aipkit_getContentWriterFormConfig(i);await window.aipkit_saveContentWriterTemplate(parseInt(window.aipkit_cw_template_state.currentTemplateId),t,n)}):console.error("bindUpdateTemplateBtn: Missing saveContentWriterTemplate or getContentWriterFormConfig function.")}window.aipkit_bindUpdateTemplateBtn=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_cw_rename_template_btn");if(!r){console.warn("bindRenameTemplateBtn: Button not found.");return}typeof window.aipkit_handleRenameContentWriterTemplate=="function"?r.addEventListener("click",window.aipkit_handleRenameContentWriterTemplate):console.error("bindRenameTemplateBtn: handleRenameContentWriterTemplate function missing.")}window.aipkit_bindRenameTemplateBtn=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_cw_delete_template_btn");if(!r){console.warn("bindDeleteTemplateBtn: Button not found.");return}typeof window.aipkit_handleDeleteContentWriterTemplate=="function"?r.addEventListener("click",window.aipkit_handleDeleteContentWriterTemplate):console.error("bindDeleteTemplateBtn: handleDeleteContentWriterTemplate function missing.")}window.aipkit_bindDeleteTemplateBtn=p})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_content_writer_post_status");if(!r){console.warn("bindPostStatusHandler: Post status select not found.");return}typeof window.aipkit_toggleContentWriterScheduleFields=="function"?(r.addEventListener("change",window.aipkit_toggleContentWriterScheduleFields),window.aipkit_toggleContentWriterScheduleFields()):console.error("bindPostStatusHandler: aipkit_toggleContentWriterScheduleFields function missing.")}window.aipkit_bindPostStatusHandler=p})();(function(){"use strict";function p(){let r=document.querySelector(".aipkit_content_writer_inputs");if(!r){console.warn("bindFormChangeListeners: Form inputs wrapper not found for change detection.");return}typeof window.aipkit_checkFormForModifications=="function"?(r.addEventListener("input",window.aipkit_checkFormForModifications),r.addEventListener("change",window.aipkit_checkFormForModifications)):console.error("bindFormChangeListeners: aipkit_checkFormForModifications function is missing.")}window.aipkit_bindFormChangeListeners=p})();(function(){"use strict";function p(){let r=["aipkit_initTemplateSelect","aipkit_bindSaveAsTemplateBtn","aipkit_bindUpdateTemplateBtn","aipkit_bindRenameTemplateBtn","aipkit_bindDeleteTemplateBtn","aipkit_bindPostStatusHandler","aipkit_bindFormChangeListeners","aipkit_bindInlineFormButtons","aipkit_bindInlineDeleteButtons"];for(let i of r)if(typeof window[i]!="function"){console.error(`Content Writer Template Handler Init: Missing required function: ${i}`);return}window.aipkit_initTemplateSelect(),window.aipkit_bindSaveAsTemplateBtn(),window.aipkit_bindUpdateTemplateBtn(),window.aipkit_bindRenameTemplateBtn(),window.aipkit_bindDeleteTemplateBtn(),window.aipkit_bindPostStatusHandler(),window.aipkit_bindFormChangeListeners(),window.aipkit_bindInlineFormButtons(),window.aipkit_bindInlineDeleteButtons();let o=document.getElementById("aipkit_cw_template_select");o&&typeof window.aipkit_updateTemplateActionButtonsState=="function"?window.aipkit_updateTemplateActionButtonsState(o.value):o&&console.error("Content Writer Template Handler Init: updateTemplateActionButtonsState function missing for initial state set.")}window.aipkit_initContentWriterTemplateHandler=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(i){return i};function r(){let i=document.getElementById("aipkit_cw_save_as_post_btn");if(!i){console.warn("Save as Post Handler: Button not found.");return}i.addEventListener("click",o)}async function o(){let i=document.getElementById("aipkit_content_writer_form"),e=document.getElementById("aipkit_cw_save_as_post_btn"),t=document.getElementById("aipkit_cw_generated_content_area"),n=document.getElementById("aipkit_content_writer_output_display"),s=document.getElementById("aipkit_cw_save_post_status");if(!i||!e||!t||!n||!s){console.error("Save as Post: Missing required UI elements.");return}let a=t.innerHTML;if(t.textContent.trim()===""||t.textContent.trim()==="Your article will appear here..."){s&&(s.textContent="Nothing to save. Please generate content first.",s.className="aipkit_form-help aipkit_settings_message-error");return}let c=document.getElementById("aipkit_cw_generated_title_display"),l={post_title:c?c.textContent:"Untitled AI Post",post_content:a,generated_excerpt:i.elements.generated_excerpt?.value||"",generated_tags:i.elements.generated_tags?.value||"",meta_description:i.elements.meta_description?i.elements.meta_description.value:"",focus_keyword:i.elements.focus_keyword?i.elements.focus_keyword.value:"",post_type:i.elements.post_type?i.elements.post_type.value:"post",post_author:i.elements.post_author?i.elements.post_author.value:1,post_status:i.elements.post_status?i.elements.post_status.value:"draft",post_schedule_date:i.elements.post_schedule_date?i.elements.post_schedule_date.value:"",post_schedule_time:i.elements.post_schedule_time?i.elements.post_schedule_time.value:"",post_categories:i.elements["post_categories[]"]?Array.from(i.elements["post_categories[]"].selectedOptions).map(d=>d.value):[],generate_toc:i.elements.generate_toc?.checked?"1":"0",image_data:document.getElementById("aipkit_cw_image_data_holder")?.value,image_alignment:i.elements.image_alignment?i.elements.image_alignment.value:"none",image_size:i.elements.image_size?i.elements.image_size.value:"large",_ajax_nonce:document.getElementById("aipkit_content_writer_nonce")?document.getElementById("aipkit_content_writer_nonce").value:""};s&&(s.textContent="Saving post...",s.className="aipkit_form-help aipkit_settings_message-info"),window.aipkit_setLoadingStateOpenAI(e,!0,"Save","Saving...");try{let d=await window.aipkit_apiRequest("aipkit_content_writer_save_post",l);s&&(s.textContent=d.message||"Post saved successfully!",s.className="aipkit_form-help aipkit_settings_message-success",d.edit_link&&(s.innerHTML+=` <a href="${p(d.edit_link)}" target="_blank">Edit Post</a>`))}catch(d){console.error("Error saving post:",d),s&&(s.textContent=`Error: ${d.message||"Failed to save post."}`,s.className="aipkit_form-help aipkit_settings_message-error")}finally{window.aipkit_setLoadingStateOpenAI(e,!1,"Save as Post"),setTimeout(()=>{s&&(s.textContent="",s.className="aipkit_form-help")},5e3)}}window.aipkit_initSaveAsPostButton=r})();(function(){"use strict";function p(){let r=document.getElementById("aipkit_content_writer_container");if(!r){console.error("Content Writer Main: Could not find the main container (#aipkit_content_writer_container). Aborting initialization.");return}let o=document.getElementById("aipkit_content_writer_form"),i=document.getElementById("aipkit_content_writer_generate_btn"),e=document.getElementById("aipkit_content_writer_stop_btn"),t=document.getElementById("aipkit_content_writer_copy_btn"),n=document.getElementById("aipkit_content_writer_clear_btn"),s=document.getElementById("aipkit_content_writer_provider"),a=document.getElementById("aipkit_content_writer_model"),c=document.getElementById("aipkit_content_writer_temperature"),l=document.getElementById("aipkit_content_writer_max_tokens"),d=document.getElementById("aipkit_cw_save_as_post_btn"),u=document.querySelector(".aipkit_cw_generation_status_indicators");if(!o||!i||!e||!t||!n||!s||!a||!c||!l||!d||!u){console.error("Content Writer Main: Missing one or more required UI elements.");return}typeof window.aipkit_initContentWriterAccordions=="function"?window.aipkit_initContentWriterAccordions():console.error("Content Writer Main: aipkit_initContentWriterAccordions function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_content_writer_container"),typeof window.aipkit_initContentWriterTabs=="function"?window.aipkit_initContentWriterTabs(r):console.error("Content Writer Main: aipkit_initContentWriterTabs function not found."),typeof window.aipkit_cw_initOptionPromptToggles=="function"?window.aipkit_cw_initOptionPromptToggles():console.error("Content Writer Main: aipkit_cw_initOptionPromptToggles function not found."),typeof window.aipkit_initPromptToggles=="function"?window.aipkit_initPromptToggles():console.error("Content Writer Main: aipkit_initPromptToggles function not found."),typeof window.aipkit_initAiSettingsToggle=="function"?window.aipkit_initAiSettingsToggle():console.error("Content Writer Main: aipkit_initAiSettingsToggle function not found."),typeof window.aipkit_cw_toggleReasoningEffort=="function"?(s.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(r)}),a.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(r)}),window.aipkit_cw_toggleReasoningEffort(r)):console.error("Content Writer Main: aipkit_cw_toggleReasoningEffort function not found."),typeof window.aipkit_initImageSettingsHandler=="function"?window.aipkit_initImageSettingsHandler():console.error("Content Writer Main: aipkit_initImageSettingsHandler function not found."),typeof window.aipkit_initContentWriterVectorSettings=="function"?window.aipkit_initContentWriterVectorSettings():console.error("Content Writer Main: aipkit_initContentWriterVectorSettings function not found."),typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():console.error("Content Writer Main: resetGenerationStatusIndicators function not found."),typeof window.aipkit_initContentWriterUI=="function"?window.aipkit_initContentWriterUI(s,a,c,l,i,t,n):console.error("Content Writer Main: aipkit_initContentWriterUI function not found."),typeof window.aipkit_initContentWriterTemplateHandler=="function"?window.aipkit_initContentWriterTemplateHandler():console.error("Content Writer Main: aipkit_initContentWriterTemplateHandler function not found."),typeof window.aipkit_initSaveAsPostButton=="function"?window.aipkit_initSaveAsPostButton():console.error("Content Writer Main: aipkit_initSaveAsPostButton function not found."),typeof window.aipkit_initCsvUploadHandler=="function"?window.aipkit_initCsvUploadHandler():console.error("Content Writer Main: aipkit_initCsvUploadHandler function not found.");let f=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;f&&typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():f&&console.error("Content Writer Main: aipkit_initGsheetsVerification function not found."),f&&typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():f&&console.error("Content Writer Main: aipkit_initUrlScrapeHandler function not found."),typeof window.aipkit_attachGenerateButtonListener=="function"?window.aipkit_attachGenerateButtonListener(i,o,u,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachGenerateButtonListener function not found."),typeof window.aipkit_attachStopButtonListener=="function"?window.aipkit_attachStopButtonListener(e,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachStopButtonListener function not found."),window.aipkit_enableSaveAsPostButton=function(){d&&(d.disabled=!1)},window.aipkit_disableSaveAsPostButton=function(){d&&(d.disabled=!0)},window.aipkit_disableSaveAsPostButton()}window.aipkit_initContentWriter=p})();(function(){"use strict";let p=!1,r="aipkit_image_gen_preview_theme",o=["dark","light"];function i(){let f=document.getElementById("aipkit_image_generator_container");if(!f){console.error("AIPKit Image Generator: Main container #aipkit_image_generator_container not found.");return}if(f.querySelector("#aipkit_public_image_generator"))if(typeof window.aipkit_initPublicImageGenerator=="function")try{window.aipkit_initPublicImageGenerator()}catch(m){console.error("AIPKit Image Generator: Error calling public UI initializer:",m);let g=document.getElementById("aipkit_public_image_results");g&&(g.innerHTML='<p style="color:red">Error initializing preview scripts.</p>')}else{console.error("AIPKit Image Generator: Public UI initializer function not found!");let m=document.getElementById("aipkit_public_image_results");m&&(m.innerHTML='<p style="color:red">Error: Preview script not loaded.</p>')}d(f),c(f),e()}function e(){let f=document.getElementById("image-settings-content");if(!f)return;typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Image Generator: aipkit_initSyncButtons function not found."),f.querySelectorAll(".aipkit_accordion-group").forEach(k=>{let w="data-accordion-listener-added";k.hasAttribute(w)||(k.addEventListener("click",function(h){let y=h.target.closest(".aipkit_accordion-header");if(!y)return;let b=y.nextElementSibling;!b||!b.classList.contains("aipkit_accordion-content")||(k.querySelectorAll(".aipkit_accordion-content").forEach(v=>{v!==b&&v.classList.contains("aipkit_active")&&(v.classList.remove("aipkit_active"),v.previousElementSibling?.classList.remove("aipkit_active"))}),y.classList.toggle("aipkit_active"),b.classList.toggle("aipkit_active"))}),k.setAttribute(w,"true"))});let m="data-token-listener-attached";f.hasAttribute(m)||(f.addEventListener("change",function(k){k.target.closest(".aipkit_token_limit_mode_select")&&t(f)}),f.setAttribute(m,"true"),t(f));let g=f.querySelector("#aipkit_save_image_settings_btn");g&&!g.hasAttribute("data-listener-added")&&(g.addEventListener("click",n),g.setAttribute("data-listener-added","true"));try{s(f)}catch(k){console.error("AIPKit Image Settings: Failed to init model selector",k)}}function t(f){if(!f)return;let _=f.querySelector(".aipkit_token_limit_mode_select"),m=f.querySelector(".aipkit_token_general_user_limit_field"),g=f.querySelector(".aipkit_token_role_limits_container");if(!_||!m||!g){document.querySelector('.aipkit_accordion[data-section="token-management"]');return}let k=_.value;m.style.display=k==="general"?"block":"none",g.style.display=k==="role_based"?"block":"none"}function n(f){f.preventDefault();let _=f.currentTarget;a();let m=document.querySelector("#image-settings-content form"),g=document.getElementById("aipkit_image_settings_save_status"),k=_.querySelector(".aipkit_spinner");if(!m||!g||p)return;p=!0,_.disabled=!0,k&&(k.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(_,"Saving..."),g.textContent="",g.className="aipkit_form-help";let w=new FormData(m);if(w.has("frontend_models")){let y=m.getElementById?m.getElementById("aipkit_image_gen_frontend_models"):m.querySelector("#aipkit_image_gen_frontend_models");y&&y.value===""&&w.set("frontend_models","")}else{let y=m.querySelector("#aipkit_image_gen_frontend_models");y&&w.append("frontend_models",y.value||"")}let h=m.querySelector('input[name="_ajax_nonce"]');if(!h||!h.value){typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(g,"error","Security check failed (Nonce missing). Please reload."),p=!1,_.disabled=!1,k&&(k.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(_,"Save Image Settings");return}window.aipkit_apiRequest("aipkit_save_image_settings",Object.fromEntries(w.entries())).then(y=>{typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(g,"success",y.message||"Settings saved!")}).catch(y=>{typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(g,"error","Save failed: "+y.message)}).finally(()=>{p=!1,_.disabled=!1,k&&(k.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(_,"Save Image Settings")})}function s(f){let _=f.querySelector("#aipkit_image_gen_models_selector");if(!_||_.getAttribute("data-enhanced")==="true")return;let m=f.querySelector("#aipkit_image_gen_frontend_models"),g=_.dataset.initialValue||"",w=!0&&g===""?[]:g.split(",").map(x=>x.trim()).filter(Boolean),h=new Set(w),y=window.aipkit_image_generator_config_public||{},b=y.azure_models||[];if((!b||b.length===0)&&window.aipkit_dashboard_providers)try{Array.isArray(window.aipkit_dashboard_providers.AzureImage)&&(b=window.aipkit_dashboard_providers.AzureImage.map(x=>typeof x=="string"?{id:x,name:x}:x))}catch{}let v=[{key:"openai",label:"OpenAI",type:"flat",models:(y.openai_models||[]).map(x=>({id:x.id,name:x.name}))},{key:"azure",label:"Azure",type:"flat",models:b.map(x=>x.id?x:{id:x.id||x.name||x,name:x.name||x.id||x})},{key:"google",label:"Google",type:"grouped",models:y.google_models||{}},{key:"replicate",label:"Replicate",type:"flat",models:(y.replicate_models||[]).map(x=>x.id?x:{id:x.id||x.name||x,name:x.name||x.id||x})}].filter(x=>x.key==="azure"?!0:x.models&&(Array.isArray(x.models)?x.models.length:Object.keys(x.models).length));_.innerHTML="",_.classList.add("aipkit_models_selector--ready");let S=document.createElement("input");S.type="search",S.placeholder="Filter models...",S.className="aipkit_models_selector-search",_.appendChild(S);let C=document.createElement("div");C.className="aipkit_models_selector-summary",_.appendChild(C);let T=document.createElement("div");T.className="aipkit_models_selector-providers",_.appendChild(T),v.forEach(x=>{let L=document.createElement("div");L.className="aipkit_models_selector-provider",L.dataset.provider=x.key;let A=document.createElement("div");A.className="aipkit_models_selector-provider-header",A.innerHTML=`<strong>${x.label}</strong>`;let I=document.createElement("div");I.className="aipkit_models_selector-provider-actions";let q=document.createElement("button");q.type="button",q.className="aipkit_btn aipkit_btn-xs",q.textContent="All";let P=document.createElement("button");P.type="button",P.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",P.textContent="None",I.appendChild(q),I.appendChild(P),A.appendChild(I),L.appendChild(A);let B=document.createElement("div");B.className="aipkit_models_selector-models";let F=O=>{if(!O||!O.id)return;let D=O.id,$=document.createElement("label");$.className="aipkit_models_selector-item",$.title=D;let N=document.createElement("input");N.type="checkbox",N.value=D,N.checked=h.has(D),N.dataset.modelId=D,N.addEventListener("change",M);let R=document.createElement("span");R.textContent=O.name||D,$.appendChild(N),$.appendChild(R),B.appendChild($)};if(x.type==="grouped"?Object.keys(x.models).forEach(O=>{let D=x.models[O];if(!Array.isArray(D))return;let $=document.createElement("div");$.className="aipkit_models_selector-subgroup",$.textContent=O.charAt(0).toUpperCase()+O.slice(1),B.appendChild($),D.forEach(N=>F(N))}):x.models.forEach(O=>F(O)),x.key==="azure"&&x.models.length===0){let O=document.createElement("div");O.className="aipkit_models_selector-empty",O.textContent="No Azure image models found. Sync Azure Image models in the main Models settings first.",B.appendChild(O)}q.addEventListener("click",()=>{B.querySelectorAll('input[type="checkbox"]').forEach(O=>{O.checked=!0}),M()}),P.addEventListener("click",()=>{B.querySelectorAll('input[type="checkbox"]').forEach(O=>{O.checked=!1}),M()}),L.appendChild(B),T.appendChild(L)}),S.addEventListener("input",()=>{let x=S.value.toLowerCase();T.querySelectorAll(".aipkit_models_selector-item").forEach(L=>{let A=L.textContent.toLowerCase();L.style.display=A.includes(x)?"":"none"})}),_.setAttribute("data-enhanced","true"),E();function E(){let x=Array.from(_.querySelectorAll(".aipkit_models_selector-item input:checked")).map(L=>L.value);x.length===0?C.textContent="Showing all models (none selected)":C.textContent=`${x.length} model${x.length>1?"s":""} selected`}function M(){let x=Array.from(_.querySelectorAll(".aipkit_models_selector-item input:checked")).map(L=>L.value.trim()).filter(Boolean);m&&(m.value=x.join(", ")),E()}window.aipkit_syncAllowedModelsHiddenField=M}function a(){typeof window.aipkit_syncAllowedModelsHiddenField=="function"&&window.aipkit_syncAllowedModelsHiddenField()}function c(f){let _=f.querySelector("#aipkit_theme_switcher_toggle_btn"),m=f.querySelector("#generator-content .aipkit_image_generator_admin_preview_wrapper");if(!_||!m){console.warn("AIPKit Image Gen Admin: Theme toggle or preview wrapper not found in scope:",f);return}let g=o.indexOf(localStorage.getItem(r)||"dark");g===-1&&(g=o.indexOf("dark")),l(o[g],m,_),_.hasAttribute("data-listener-attached")||(_.addEventListener("click",function(){g=(g+1)%o.length;let k=o[g];l(k,m,_),localStorage.setItem(r,k)}),_.setAttribute("data-listener-attached","true"))}function l(f,_,m){let g=_.querySelector(".aipkit_shortcode_container.aipkit_image_generator_public_wrapper");g&&(o.forEach(h=>g.classList.remove(`aipkit-theme-${h}`)),g.classList.add(`aipkit-theme-${f}`));let k=f.charAt(0).toUpperCase()+f.slice(1),w="Toggle Preview Theme";m.title=`${w} (Current: ${k})`}function d(f){let _=f.querySelector("#aipkit_image_generator_shortcode_snippet"),m=f.querySelector("#aipkit_image_generator_shortcode_settings_toggle"),g=f.querySelector("#aipkit_image_generator_shortcode_configurator"),k=f.querySelectorAll("#aipkit_image_generator_shortcode_configurator .aipkit_config_input");if(!_||!m||!g||k.length===0){console.warn("AIPKit Image Gen Admin: Shortcode configurator elements not found in scope:",f);return}m.hasAttribute("data-listener-attached")||(m.addEventListener("click",()=>{let w=g.style.display==="none"||!g.style.display;g.style.display=w?"block":"none",m.classList.toggle("aipkit_active",w),m.setAttribute("aria-expanded",w.toString())}),k.forEach(w=>w.addEventListener("change",()=>u(f))),_.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(_.textContent,_):console.error("AIPKit Image Generator: aipkit_copyShortcode function not found.")}),u(f),m.setAttribute("data-listener-attached","true"))}function u(f){let _=f.querySelector("#aipkit_image_generator_shortcode_snippet"),m=f.querySelector("#aipkit_image_generator_shortcode_configurator");if(!_||!m)return;let g=m.querySelector('input[name="cfg_show_provider"]').checked,k=m.querySelector('input[name="cfg_show_model"]').checked,w=m.querySelector('input[name="cfg_show_history"]').checked,h=m.querySelector('input[name="cfg_theme"]:checked'),y=h?h.value:"dark",b="[aipkit_image_generator";g||(b+=' show_provider="false"'),k||(b+=' show_model="false"'),w&&(b+=' history="true"'),y!=="dark"&&(b+=` theme="${y}"`),b+="]",_.textContent=b}window.aipkit_initImageGenerator=i})();(function(){"use strict";function p(r,o,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Title Fetcher: Missing required API function."),typeof o=="function"&&o(new Error("API function missing."),null,i);return}let e=window.aipkit_post_enhancer,t=e?.nonce_generate_title,n=e?.text||{};if(!t){console.error("AIPKit Post Enhancer Fetcher (Title): Missing nonce."),typeof o=="function"&&o(new Error("Configuration missing (nonce)."),null,i);return}let s={_ajax_nonce:t,post_id:r};window.aipkit_apiRequest("aipkit_generate_title_suggestions",s).then(a=>{if(!a?.suggestions||a.suggestions.length===0)throw new Error(n.no_suggestions_title||"No title suggestions generated.");typeof o=="function"&&o(null,a.suggestions,i)}).catch(a=>{console.error("AIPKit Post Enhancer Fetcher (Title):",a),typeof o=="function"&&o(a,null,i)})}window.aipkit_fetchTitleSuggestions=p})();(function(){"use strict";let p=null;function r(){p&&(p.classList.remove("aipkit-active"),p.addEventListener("transitionend",()=>{p?.parentNode&&p.parentNode.removeChild(p),p=null},{once:!0}),setTimeout(()=>{p?.parentNode&&p.parentNode.removeChild(p),p=null},500)),typeof window.aipkit_resetTitleUpdateFlag=="function"&&window.aipkit_resetTitleUpdateFlag()}function o(t,n,s){p&&r();let a=window.aipkit_escapeHtml||function(k){return k},c=window.aipkit_escapeAttribute||a,l=s?.default_ai_provider||"N/A",d=s?.default_ai_model||"N/A",u=s?.default_ai_params||{},f=u.temperature!==void 0?parseFloat(u.temperature).toFixed(1):"N/A",m=(n.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${a(l)}</strong>`).replace("%2$s",`<strong>${a(d)}</strong>`).replace("%3$s",a(f));p=document.createElement("div"),p.className="aipkit-modal-overlay",p.addEventListener("click",k=>{k.target===p&&r()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=t,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${a(n.modal_title_title||"Title Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${c(n.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content"> <?php // Wrapper for loading state ?>
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${a(n.loading_title||"Generating Titles...")} <?php // Use title text ?>
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p> <?php // Display AI info ?>
                </div>
            </div>
        `,p.appendChild(g),document.body.appendChild(p),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),requestAnimationFrame(()=>{p.classList.add("aipkit-active")}),p}function i(t,n){if(!p)return;let s=p.querySelector(".aipkit-modal-body");if(!s)return;let a=window.aipkit_escapeHtml||function(d){return d},c=window.aipkit_escapeAttribute||a;s.innerHTML=`
            <p>${a(n.select_title||"Click a title to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${t.map(d=>`<li data-new-title="${c(d)}">${a(d)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div> <?php // Empty status div for potential update messages ?>
        `;let l=s.querySelector(".aipkit-suggestions-list");l&&typeof window.aipkit_attachSuggestionClickListener=="function"?window.aipkit_attachSuggestionClickListener(l):console.error("Post Title Modal: Suggestion list or click handler attachment function missing after update.")}function e(t,n){if(!p)return;let s=p.querySelector(".aipkit-modal-body");if(!s)return;let a=window.aipkit_escapeHtml||function(c){return c};s.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${a(n.error_loading_title||"Error loading title suggestions.")}</p>
                 <p><small>${a(t)}</small></p>
            </div>
        `}window.aipkit_showLoadingModal=o,window.aipkit_updateModalWithSuggestions=i,window.aipkit_updateModalWithError=e,window.aipkit_closePostTitleModal=r})();(function(){"use strict";let p=!1;function r(){p=!1}function o(t){if(p)return;p=!0;let n=t.currentTarget,s=n.closest(".aipkit-modal-content"),a=s?.dataset.postId,c=n.dataset.newTitle,l=s?.querySelector(".aipkit-modal-status"),d=s?.querySelectorAll(".aipkit-suggestions-list li"),u=window.aipkit_post_enhancer?.text||{};if(!a||!c||!l||!d){console.error("AIPKit Post Enhancer Updater: Missing data for title update."),l&&(l.innerHTML='<span style="color: red;">Error: Cannot update title.</span>'),p=!1;return}d.forEach(f=>f.classList.add("aipkit-disabled")),l.innerHTML=`<span class="aipkit_spinner"></span> ${u.updating_title||"Updating Title..."}`,l.style.color="",i(a,c,l,d,u)}function i(t,n,s,a,c){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTitleModal!="function"){console.error("Post Title Updater: Missing required API or modal close functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',a.forEach(u=>u.classList.remove("aipkit-disabled")),p=!1;return}let l=window.aipkit_post_enhancer?.nonce_update_title;if(!l){console.error("AIPKit Post Enhancer Updater (Title): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',a.forEach(u=>u.classList.remove("aipkit-disabled")),p=!1;return}let d={_ajax_nonce:l,post_id:t,new_value:n};window.aipkit_apiRequest("aipkit_update_post_title",d).then(u=>{let f=document.querySelector(`#post-${t} .row-title`);f?f.textContent=n:console.warn(`AIPKit Post Enhancer Updater: Could not find visible title element for post ${t}.`);let _=document.getElementById(`post-${t}`);if(_){let m=_.querySelector(`#inline_${t}`);if(m){let g=m.querySelector(".post_title");g?g.textContent=n:console.warn(`AIPKit Post Enhancer Updater: Quick Edit div not found for post ${t}.`)}else console.warn(`AIPKit Post Enhancer Updater: Inline data container not found for post ${t}.`)}window.aipkit_closePostTitleModal()}).catch(u=>{console.error("AIPKit Post Enhancer Update Error (Title):",u),s.innerHTML=`<span class="error">${u.message||c.error_updating_title||"Error updating title."}</span>`,a.forEach(f=>f.classList.remove("aipkit-disabled"))}).finally(()=>{p=!1})}function e(t){t&&t.addEventListener("click",function(n){let s=n.target.closest("li[data-new-title]");s&&o({currentTarget:s})})}window.aipkit_attachSuggestionClickListener=e,window.aipkit_resetTitleUpdateFlag=r})();(function(){"use strict";function p(r,o,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Excerpt Fetcher: Missing required API function."),typeof o=="function"&&o(new Error("API function missing."),null,i);return}let e=window.aipkit_post_enhancer,t=e?.nonce_generate_excerpt,n=e?.text||{};if(!t){console.error("AIPKit Post Enhancer Fetcher (Excerpt): Missing nonce."),typeof o=="function"&&o(new Error("Configuration missing (nonce)."),null,i);return}let s={_ajax_nonce:t,post_id:r};window.aipkit_apiRequest("aipkit_generate_excerpt_suggestions",s).then(a=>{if(!a?.suggestions||a.suggestions.length===0)throw new Error(n.no_suggestions_excerpt||"No excerpt suggestions generated.");typeof o=="function"&&o(null,a.suggestions,i)}).catch(a=>{console.error("AIPKit Post Enhancer Fetcher (Excerpt):",a),typeof o=="function"&&o(a,null,i)})}window.aipkit_fetchExcerptSuggestions=p})();(function(){"use strict";let p=null;function r(){p&&(p.classList.remove("aipkit-active"),p.addEventListener("transitionend",()=>{p?.parentNode&&p.parentNode.removeChild(p),p=null},{once:!0}),setTimeout(()=>{p?.parentNode&&p.parentNode.removeChild(p),p=null},500)),typeof window.aipkit_resetExcerptUpdateFlag=="function"&&window.aipkit_resetExcerptUpdateFlag()}function o(t,n,s){p&&r();let a=window.aipkit_escapeHtml||function(k){return k},c=window.aipkit_escapeAttribute||a,l=s?.default_ai_provider||"N/A",d=s?.default_ai_model||"N/A",u=s?.default_ai_params||{},f=u.temperature!==void 0?parseFloat(u.temperature).toFixed(1):"N/A",m=(n.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${a(l)}</strong>`).replace("%2$s",`<strong>${a(d)}</strong>`).replace("%3$s",a(f));p=document.createElement("div"),p.className="aipkit-modal-overlay",p.addEventListener("click",k=>{k.target===p&&r()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=t,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${a(n.modal_title_excerpt||"Excerpt Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${c(n.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${a(n.loading_excerpt||"Generating Excerpts...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,p.appendChild(g),document.body.appendChild(p),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),requestAnimationFrame(()=>{p.classList.add("aipkit-active")}),p}function i(t,n){if(!p)return;let s=p.querySelector(".aipkit-modal-body");if(!s)return;let a=window.aipkit_escapeHtml||function(d){return d},c=window.aipkit_escapeAttribute||a;s.innerHTML=`
            <p>${a(n.select_excerpt||"Click an excerpt to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${t.map(d=>`<li data-new-excerpt="${c(d)}">${a(d)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let l=s.querySelector(".aipkit-suggestions-list");l&&typeof window.aipkit_attachExcerptSuggestionClickListener=="function"?window.aipkit_attachExcerptSuggestionClickListener(l):console.error("Post Excerpt Modal: Suggestion list or click handler attachment function missing after update.")}function e(t,n){if(!p)return;let s=p.querySelector(".aipkit-modal-body");if(!s)return;let a=window.aipkit_escapeHtml||function(c){return c};s.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${a(n.error_loading_excerpt||"Error loading excerpt suggestions.")}</p>
                 <p><small>${a(t)}</small></p>
            </div>
        `}window.aipkit_showLoadingExcerptModal=o,window.aipkit_updateModalWithExcerptSuggestions=i,window.aipkit_updateModalWithErrorExcerpt=e,window.aipkit_closePostExcerptModal=r})();(function(){"use strict";let p=!1;function r(){p=!1}function o(t){if(p)return;p=!0;let n=t.currentTarget,s=n.closest(".aipkit-modal-content"),a=s?.dataset.postId,c=n.dataset.newExcerpt,l=s?.querySelector(".aipkit-modal-status"),d=s?.querySelectorAll(".aipkit-suggestions-list li"),u=window.aipkit_post_enhancer?.text||{};if(!a||c===void 0||!l||!d){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing data for excerpt update.",{postId:a,newExcerpt:c,statusDiv:l,listItems:d}),l&&(l.innerHTML='<span style="color: red;">Error: Cannot update excerpt.</span>'),p=!1;return}d.forEach(f=>f.classList.add("aipkit-disabled")),l.innerHTML=`<span class="aipkit_spinner"></span> ${u.updating_excerpt||"Updating Excerpt..."}`,l.style.color="",i(a,c,l,d,u)}function i(t,n,s,a,c){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostExcerptModal!="function"){console.error("Post Excerpt Updater: Missing required API or modal close functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',a.forEach(u=>u.classList.remove("aipkit-disabled")),p=!1;return}let l=window.aipkit_post_enhancer?.nonce_update_excerpt;if(!l){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',a.forEach(u=>u.classList.remove("aipkit-disabled")),p=!1;return}let d={_ajax_nonce:l,post_id:t,new_value:n};window.aipkit_apiRequest("aipkit_update_post_excerpt",d).then(u=>{window.aipkit_closePostExcerptModal()}).catch(u=>{console.error("AIPKit Post Enhancer Update Error (Excerpt):",u),s.innerHTML=`<span class="error">${u.message||c.error_updating_excerpt||"Error updating excerpt."}</span>`,a.forEach(f=>f.classList.remove("aipkit-disabled"))}).finally(()=>{p=!1})}function e(t){t&&t.addEventListener("click",function(n){let s=n.target.closest("li[data-new-excerpt]");s&&o({currentTarget:s})})}window.aipkit_attachExcerptSuggestionClickListener=e,window.aipkit_resetExcerptUpdateFlag=r})();(function(){"use strict";function p(r,o,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Meta Fetcher: Missing required API function."),typeof o=="function"&&o(new Error("API function missing."),null,i);return}let e=window.aipkit_post_enhancer,t=e?.nonce_generate_meta,n=e?.text||{};if(!t){console.error("AIPKit Post Enhancer Fetcher (Meta): Missing nonce."),typeof o=="function"&&o(new Error("Configuration missing (nonce)."),null,i);return}let s={_ajax_nonce:t,post_id:r};window.aipkit_apiRequest("aipkit_generate_meta_suggestions",s).then(a=>{if(!a?.suggestions||a.suggestions.length===0)throw new Error(n.no_suggestions_meta||"No meta description suggestions generated.");typeof o=="function"&&o(null,a.suggestions,i)}).catch(a=>{console.error("AIPKit Post Enhancer Fetcher (Meta):",a),typeof o=="function"&&o(a,null,i)})}window.aipkit_fetchMetaSuggestions=p})();(function(){"use strict";let p=null;function r(){p&&(p.classList.remove("aipkit-active"),p.addEventListener("transitionend",()=>{p?.parentNode&&p.parentNode.removeChild(p),p=null},{once:!0}),setTimeout(()=>{p?.parentNode&&p.parentNode.removeChild(p),p=null},500)),typeof window.aipkit_resetMetaUpdateFlag=="function"&&window.aipkit_resetMetaUpdateFlag()}function o(t,n,s){p&&r();let a=window.aipkit_escapeHtml||function(k){return k},c=window.aipkit_escapeAttribute||a,l=s?.default_ai_provider||"N/A",d=s?.default_ai_model||"N/A",u=s?.default_ai_params||{},f=u.temperature!==void 0?parseFloat(u.temperature).toFixed(1):"N/A",m=(n.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${a(l)}</strong>`).replace("%2$s",`<strong>${a(d)}</strong>`).replace("%3$s",a(f));p=document.createElement("div"),p.className="aipkit-modal-overlay",p.addEventListener("click",k=>{k.target===p&&r()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=t,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${a(n.modal_title_meta||"Meta Description Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${c(n.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${a(n.loading_meta||"Generating Meta Descriptions...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,p.appendChild(g),document.body.appendChild(p),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),requestAnimationFrame(()=>{p.classList.add("aipkit-active")}),p}function i(t,n){if(!p)return;let s=p.querySelector(".aipkit-modal-body");if(!s)return;let a=window.aipkit_escapeHtml||function(d){return d},c=window.aipkit_escapeAttribute||a;s.innerHTML=`
            <p>${a(n.select_meta||"Click a meta description to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${t.map(d=>`<li data-new-meta="${c(d)}">${a(d)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let l=s.querySelector(".aipkit-suggestions-list");l&&typeof window.aipkit_attachMetaSuggestionClickListener=="function"?window.aipkit_attachMetaSuggestionClickListener(l):console.error("Post Meta Modal: Suggestion list or click handler attachment function missing after update.")}function e(t,n){if(!p)return;let s=p.querySelector(".aipkit-modal-body");if(!s)return;let a=window.aipkit_escapeHtml||function(c){return c};s.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${a(n.error_loading_meta||"Error loading meta description suggestions.")}</p>
                 <p><small>${a(t)}</small></p>
            </div>
        `}window.aipkit_showLoadingMetaModal=o,window.aipkit_updateModalWithMetaSuggestions=i,window.aipkit_updateModalWithErrorMeta=e,window.aipkit_closePostMetaModal=r})();(function(){"use strict";let p=!1;function r(){p=!1}function o(t){if(p)return;p=!0;let n=t.currentTarget,s=n.closest(".aipkit-modal-content"),a=s?.dataset.postId,c=n.dataset.newMeta,l=s?.querySelector(".aipkit-modal-status"),d=s?.querySelectorAll(".aipkit-suggestions-list li"),u=window.aipkit_post_enhancer?.text||{};if(!a||c===void 0||!l||!d){console.error("AIPKit Post Enhancer Updater (Meta): Missing data for meta description update.",{postId:a,newMetaDesc:c,statusDiv:l,listItems:d}),l&&(l.innerHTML='<span style="color: red;">Error: Cannot update meta description.</span>'),p=!1;return}d.forEach(f=>f.classList.add("aipkit-disabled")),l.innerHTML=`<span class="aipkit_spinner"></span> ${u.updating_meta||"Updating Meta Desc..."}`,l.style.color="",i(a,c,l,d,u)}function i(t,n,s,a,c){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostMetaModal!="function"||typeof window.aipkit_escapeHtml!="function"){console.error("Post Meta Updater: Missing required API, modal close, or escaper functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',a.forEach(u=>u.classList.remove("aipkit-disabled")),p=!1;return}let l=window.aipkit_post_enhancer?.nonce_update_meta;if(!l){console.error("AIPKit Post Enhancer Updater (Meta): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',a.forEach(u=>u.classList.remove("aipkit-disabled")),p=!1;return}let d={_ajax_nonce:l,post_id:t,new_value:n};window.aipkit_apiRequest("aipkit_update_post_meta_desc",d).then(u=>{try{let m=`${`#post-${t}`} .column-wpseo-metadesc`,g=document.querySelector(m);g&&(g.textContent=window.aipkit_escapeHtml(n),g.style.transition="background-color 0.1s ease-out",g.style.backgroundColor="#f0f7ff",setTimeout(()=>{g.style.backgroundColor=""},300))}catch(f){console.error("AIPKit Post Enhancer UI Update: Error updating Yoast column.",f)}window.aipkit_closePostMetaModal()}).catch(u=>{console.error("AIPKit Post Enhancer Update Error (Meta):",u),s.innerHTML=`<span class="error">${u.message||c.error_updating_meta||"Error updating meta description."}</span>`,a.forEach(f=>f.classList.remove("aipkit-disabled"))}).finally(()=>{p=!1})}function e(t){t&&t.addEventListener("click",function(n){let s=n.target.closest("li[data-new-meta]");s&&o({currentTarget:s})})}window.aipkit_attachMetaSuggestionClickListener=e,window.aipkit_resetMetaUpdateFlag=r})();(function(){"use strict";function p(r,o,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Tags Fetcher: Missing required API function."),typeof o=="function"&&o(new Error("API function missing."),null,i);return}let e=window.aipkit_post_enhancer,t=e?.nonce_generate_tags,n=e?.text||{};if(!t){console.error("AIPKit Post Enhancer Fetcher (Tags): Missing nonce."),typeof o=="function"&&o(new Error("Configuration missing (nonce)."),null,i);return}let s={_ajax_nonce:t,post_id:r};window.aipkit_apiRequest("aipkit_generate_tags_suggestions",s).then(a=>{if(!a?.suggestions||a.suggestions.length===0)throw new Error(n.no_suggestions_tags||"No tag suggestions generated.");typeof o=="function"&&o(null,a.suggestions,i)}).catch(a=>{console.error("AIPKit Post Enhancer Fetcher (Tags):",a),typeof o=="function"&&o(a,null,i)})}window.aipkit_fetchTagsSuggestions=p})();(function(){"use strict";let p=null;function r(){p&&(p.classList.remove("aipkit-active"),p.addEventListener("transitionend",()=>{p?.parentNode&&p.parentNode.removeChild(p),p=null},{once:!0}),setTimeout(()=>{p?.parentNode&&p.parentNode.removeChild(p),p=null},500)),typeof window.aipkit_resetTagsUpdateFlag=="function"&&window.aipkit_resetTagsUpdateFlag()}function o(t,n,s){p&&r();let a=window.aipkit_escapeHtml||(k=>k),c=window.aipkit_escapeAttribute||a,l=s?.default_ai_provider||"N/A",d=s?.default_ai_model||"N/A",u=s?.default_ai_params||{},f=u.temperature!==void 0?parseFloat(u.temperature).toFixed(1):"N/A",m=(n.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${a(l)}</strong>`).replace("%2$s",`<strong>${a(d)}</strong>`).replace("%3$s",a(f));p=document.createElement("div"),p.className="aipkit-modal-overlay",p.addEventListener("click",k=>{k.target===p&&r()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=t,g.innerHTML=`
        <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">${a(n.modal_title_tags||"Tag Suggestions")}</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="${c(n.close||"Close")}">\xD7</button>
        </div>
        <div class="aipkit-modal-body">
            <div class="aipkit-modal-loading-content">
                <div class="aipkit-modal-status" style="text-align: center;">
                    <span class="aipkit_spinner"></span> ${a(n.loading_tags||"Generating Tags...")}
                </div>
                <p class="aipkit_modal-loading-info">${m}</p>
            </div>
        </div>
    `,p.appendChild(g),document.body.appendChild(p),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),requestAnimationFrame(()=>p.classList.add("aipkit-active")),p}function i(t,n){if(!p)return;let s=p.querySelector(".aipkit-modal-body");if(!s)return;let a=window.aipkit_escapeHtml||(d=>d),c=window.aipkit_escapeAttribute||a;s.innerHTML=`
        <p>${a(n.select_tags||"Click a tag set to apply:")}</p>
        <ul class="aipkit-suggestions-list">
            ${t.map(d=>`<li data-new-tags="${c(d)}">${a(d)}</li>`).join("")}
        </ul>
        <div class="aipkit-modal-status"></div>
    `;let l=s.querySelector(".aipkit-suggestions-list");l&&typeof window.aipkit_attachTagsSuggestionClickListener=="function"?window.aipkit_attachTagsSuggestionClickListener(l):console.error("Post Tags Modal: Suggestion list or click handler attachment function missing.")}function e(t,n){if(!p)return;let s=p.querySelector(".aipkit-modal-body");if(!s)return;let a=window.aipkit_escapeHtml||(c=>c);s.innerHTML=`
        <div class="aipkit-modal-error">
             <p>${a(n.error_loading_tags||"Error loading tag suggestions.")}</p>
             <p><small>${a(t)}</small></p>
        </div>
    `}window.aipkit_showLoadingTagsModal=o,window.aipkit_updateModalWithTagsSuggestions=i,window.aipkit_updateModalWithErrorTags=e,window.aipkit_closePostTagsModal=r})();(function(){"use strict";let p=!1;function r(){p=!1}function o(t){if(p)return;p=!0;let n=t.currentTarget,s=n.closest(".aipkit-modal-content"),a=s?.dataset.postId,c=n.dataset.newTags,l=s?.querySelector(".aipkit-modal-status"),d=s?.querySelectorAll(".aipkit-suggestions-list li"),u=window.aipkit_post_enhancer?.text||{};if(!a||c===void 0||!l||!d){console.error("AIPKit Post Enhancer Updater (Tags): Missing data for tags update.",{postId:a,newTags:c,statusDiv:l,listItems:d}),l&&(l.innerHTML='<span style="color: red;">Error: Cannot update tags.</span>'),p=!1;return}d.forEach(f=>f.classList.add("aipkit-disabled")),l.innerHTML=`<span class="aipkit_spinner"></span> ${u.updating_tags||"Updating Tags..."}`,l.style.color="",i(a,c,l,d,u)}function i(t,n,s,a,c){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTagsModal!="function"){console.error("Post Tags Updater: Missing required API or modal close functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',a.forEach(u=>u.classList.remove("aipkit-disabled")),p=!1;return}let l=window.aipkit_post_enhancer?.nonce_update_tags;if(!l){console.error("AIPKit Post Enhancer Updater (Tags): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',a.forEach(u=>u.classList.remove("aipkit-disabled")),p=!1;return}let d={_ajax_nonce:l,post_id:t,new_value:n};window.aipkit_apiRequest("aipkit_update_post_tags",d).then(u=>{let f=document.getElementById(`post-${t}`);if(f){let _=f.querySelector(".column-tags");_&&(_.textContent=n.split(",").join(", "))}window.aipkit_closePostTagsModal()}).catch(u=>{console.error("AIPKit Post Enhancer Update Error (Tags):",u),s.innerHTML=`<span class="error">${u.message||c.error_updating_tags||"Error updating tags."}</span>`,a.forEach(f=>f.classList.remove("aipkit-disabled"))}).finally(()=>{p=!1})}function e(t){t&&t.addEventListener("click",function(n){let s=n.target.closest("li[data-new-tags]");s&&o({currentTarget:s})})}window.aipkit_attachTagsSuggestionClickListener=e,window.aipkit_resetTagsUpdateFlag=r})();(function(){"use strict";function p(r,o,i){let t=(window.aipkit_post_enhancer||{}).text||{};r?window.aipkit_updateModalWithErrorTags(r.message||t.error_loading_tags,t):o?window.aipkit_updateModalWithTagsSuggestions(o,t):window.aipkit_updateModalWithErrorTags(t.error_loading_tags||"Unknown error occurred.",t)}window.aipkit_handleTagsSuggestionsResult=p})();(function(){"use strict";window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}})();(function(){"use strict";function p(a,c=60){return a.length<=c?a:a.substring(0,c-3)+"..."}function r(a,c="info"){let l=document.getElementById("aipkit-enhancer-bulk-status-log");if(l){let d=document.createElement("div");d.className=`aipkit_enhancer_bulk_log-entry aipkit_enhancer_bulk_log--${c}`,d.textContent=a,l.appendChild(d),l.scrollTop=l.scrollHeight}}function o(){let a=document.getElementById("aipkit-enhancer-bulk-progress-bar"),c=document.getElementById("aipkit-enhancer-progress-text"),l=document.getElementById("aipkit-enhancer-progress-stats");if(a&&window.aipkit_enhancer_bulkState.total>0){let d=window.aipkit_enhancer_bulkState.completed,u=window.aipkit_enhancer_bulkState.failed,f=window.aipkit_enhancer_bulkState.total,_=d+u,m=Math.round(_/f*100);a.style.width=`${m}%`,c&&(_===f?c.textContent="Update complete!":c.textContent=`Processing ${_+1} of ${f}...`),l&&(u>0?l.innerHTML=`${m}% \u2022 <span style="color: #28a745;">${d} successful</span> \u2022 <span style="color: #dc3545;">${u} failed</span>`:l.textContent=`${m}%`)}}function i(a){let c=document.getElementById("aipkit-enhancer-bulk-status-log");if(!c)return;let d=(window.aipkit_enhancer_postTitles||{})[a]||`Post #${a}`;d=p(d,60);let u=document.createElement("div");u.className="aipkit_enhancer_post_steps",u.id=`aipkit_enhancer_post_${a}_steps`;let f=document.createElement("div");f.className="aipkit_enhancer_post_header",f.innerHTML=`<strong>${d}</strong>`;let _=document.createElement("div");_.className="aipkit_enhancer_steps_container",_.id=`aipkit_enhancer_steps_${a}`,u.appendChild(f),u.appendChild(_),c.appendChild(u),c.scrollTop=c.scrollHeight;let m=[],g=window.aipkit_enhancer_bulkState?.enhancementsConfig||{};["keyword","title","excerpt","content","meta","tags"].forEach(k=>{g[k]&&g[k].prompt&&m.push({field:k,display_name:k.charAt(0).toUpperCase()+k.slice(1).replace("_"," ")})}),g.generate_seo_slug==="1"&&m.push({field:"slug",display_name:"URL"}),m.forEach(k=>{let w=document.createElement("div");w.className="aipkit_enhancer_step aipkit_enhancer_step--pending",w.id=`aipkit_enhancer_step_${a}_${k.field}`,w.innerHTML=`
        <span class="aipkit_enhancer_step_icon">\u23F3</span>
        <span class="aipkit_enhancer_step_name">${k.display_name}</span>
        <span class="aipkit_enhancer_step_status">Pending</span>
      `,_.appendChild(w)})}function e(a,c,l,d=""){let u=document.getElementById(`aipkit_enhancer_step_${a}_${c}`);if(!u)return;u.className=`aipkit_enhancer_step aipkit_enhancer_step--${l}`;let f="\u23F3",_="Pending";switch(l){case"processing":f="\u{1F504}",_="Processing...";break;case"completed":f="\u2705",_="Completed";break;case"error":f="\u274C",_="Failed";break;case"pending":f="\u23F3",_="Pending";break}u.querySelector(".aipkit_enhancer_step_icon").textContent=f,u.querySelector(".aipkit_enhancer_step_status").textContent=_,d&&(u.title=d);let m=document.getElementById("aipkit-enhancer-bulk-status-log");m&&(m.scrollTop=m.scrollHeight)}function t(a,c,l){let d=document.getElementById(`aipkit_enhancer_steps_${a}`);if(!d||l.length===0)return;let u=c.length+l.length,f=document.createElement("div");f.className="aipkit_enhancer_completion_message",c.length===0?f.innerHTML=`<strong style="color: #dc3545;">\u274C All ${u} enhancement steps failed!</strong>`:f.innerHTML=`<strong style="color: #ff8c00;">\u26A0\uFE0F Completed ${c.length} of ${u} steps. ${l.length} failed.</strong>`,d.appendChild(f);let _=document.getElementById("aipkit-enhancer-bulk-status-log");_&&(_.scrollTop=_.scrollHeight)}function n(a,c){let l=document.getElementById(`aipkit_enhancer_steps_${a}`);if(!l)return;c.forEach(_=>{let m=document.getElementById(`aipkit_enhancer_step_${a}_${_.field}`);if(m){m.className=`aipkit_enhancer_step aipkit_enhancer_step--${_.status}`;let g="\u23F3";switch(_.status){case"completed":g="\u2705";break;case"error":g="\u274C";break;case"processing":g="\u{1F504}";break;case"pending":g="\u23F3";break}m.querySelector(".aipkit_enhancer_step_icon").textContent=g,m.querySelector(".aipkit_enhancer_step_status").textContent=_.status.charAt(0).toUpperCase()+_.status.slice(1),_.message&&(m.title=_.message)}});let d=c.filter(_=>_.status==="completed").length,u=c.length;if(d!==u){let _=document.createElement("div");_.className="aipkit_enhancer_completion_message";let m=c.filter(g=>g.status==="error").length;_.innerHTML=`<strong style="color: #dc3545;">\u26A0\uFE0F Completed ${d} of ${u} steps. ${m} failed.</strong>`,l.appendChild(_)}let f=document.getElementById("aipkit-enhancer-bulk-status-log");f&&(f.scrollTop=f.scrollHeight)}function s(a,c){let l=document.getElementById(`aipkit_enhancer_steps_${a}`);if(!l)return;l.querySelectorAll(".aipkit_enhancer_step").forEach(_=>{_.classList.contains("aipkit_enhancer_step--completed")||(_.className="aipkit_enhancer_step aipkit_enhancer_step--error",_.querySelector(".aipkit_enhancer_step_icon").textContent="\u274C",_.querySelector(".aipkit_enhancer_step_status").textContent="Failed",_.title=c)});let u=document.createElement("div");u.className="aipkit_enhancer_completion_message",u.innerHTML=`<strong style="color: #dc3545;">\u274C Enhancement failed: ${c}</strong>`,l.appendChild(u);let f=document.getElementById("aipkit-enhancer-bulk-status-log");f&&(f.scrollTop=f.scrollHeight)}window.aipkit_enhancer_logToModal=r,window.aipkit_enhancer_updateProgressBar=o,window.aipkit_enhancer_initStepProgress=i,window.aipkit_enhancer_updateFieldStatus=e,window.aipkit_enhancer_showPostCompletion=t,window.aipkit_enhancer_displayStepResults=n,window.aipkit_enhancer_showStepError=s,window.aipkit_enhancer_truncateTitle=p})();(function(){"use strict";function p(o="user"){if(!window.aipkit_enhancer_bulkState.isRunning)return;window.aipkit_enhancer_bulkState.isRunning=!1;let i=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!i)return;o==="user"&&typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal("Processing stopped by user.","info");let e=i.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");e&&(e.textContent="Start"),i.querySelector("#aipkit_bulk_enhancer_start_btn").disabled=!1,i.querySelector("#aipkit_bulk_enhancer_stop_btn").style.display="none",i.querySelector("#aipkit_bulk_enhancer_cancel_btn").style.display="inline-flex",i.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").style.display="inline-flex"}function r(){let o=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!o)return;window.aipkit_enhancer_bulkState.isRunning&&p("user"),o.querySelector("#aipkit-enhancer-bulk-config").style.display="block",o.querySelector("#aipkit-enhancer-bulk-progress").style.display="none",o.querySelector("#aipkit_bulk_enhancer_start_btn").disabled=!1,o.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text").textContent="Start",o.querySelector("#aipkit_bulk_enhancer_stop_btn").style.display="none",o.querySelector("#aipkit_bulk_enhancer_cancel_btn").style.display="inline-flex",o.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").style.display="none";let i=o.querySelector("#aipkit-enhancer-bulk-status-log");i&&(i.innerHTML="");let e=o.querySelector("#aipkit-enhancer-bulk-progress-bar");e&&(e.style.width="0%");let t=o.querySelector("#aipkit-enhancer-progress-text");t&&(t.textContent="Processing posts...");let n=o.querySelector("#aipkit-enhancer-progress-stats");n&&(n.textContent="0 of 0 (0%)"),window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}}window.aipkit_enhancer_stopBulkProcess=p,window.aipkit_enhancer_returnToSettings=r})();(function(){"use strict";function p(o){let i=o.querySelector("#aipkit_bulk_ai_provider"),e=o.querySelector("#aipkit_bulk_ai_model"),t=o.querySelector(".aipkit_enhancer_reasoning_effort_field");if(!i||!e||!t){t&&(t.style.display="none");return}let n=i.value,a=(e.value||"").toLowerCase(),c=a.startsWith("o1")||a.startsWith("o3")||a.startsWith("o4"),l=a.includes("gpt-5");n==="openai"&&(c||l)?t.style.display="block":t.style.display="none"}function r(o,i){let e=o.value.toLowerCase(),n=(window.aipkit_dashboard?.models||{})[e]||[],s=window.aipkit_escapeHtml||(c=>c);if(i.innerHTML="",e==="openai"&&typeof n=="object"&&!Array.isArray(n)?Object.keys(n).forEach(c=>{let l=document.createElement("optgroup");l.label=s(c),Array.isArray(n[c])&&n[c].forEach(d=>{d&&d.id&&l.appendChild(new Option(s(d.name||d.id),d.id))}),i.appendChild(l)}):Array.isArray(n)&&n.forEach(c=>{c&&c.id&&i.appendChild(new Option(s(c.name||c.id),c.id))}),i.options.length===0)i.appendChild(new Option(s(`No models for ${o.value}`),"")),i.disabled=!0;else{i.disabled=!1;let c;switch(e){case"openai":c="gpt-4o-mini";break;case"google":c="gemini-1.5-flash-latest";break;case"openrouter":c="anthropic/claude-3.5-sonnet";break;default:c=null;break}c&&i.querySelector(`option[value="${CSS.escape(c)}"]`)?i.value=c:i.selectedIndex=0}let a=o.closest(".aipkit-enhancer-bulk-modal-overlay");a&&p(a)}window.aipkit_enhancer_populateBulkModels=r,window.aipkit_enhancer_toggleReasoningEffort=p})();(function(){"use strict";async function p(){if(!window.aipkit_enhancer_bulkState.isRunning||window.aipkit_enhancer_bulkState.queue.length===0){typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Update complete. Processed ${window.aipkit_enhancer_bulkState.total} posts. Success: ${window.aipkit_enhancer_bulkState.completed}, Failed: ${window.aipkit_enhancer_bulkState.failed}.`,"success"),typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess("complete");return}let i=window.aipkit_enhancer_bulkState.queue.shift();await r(i),typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),setTimeout(p,200)}async function r(i){try{let e=`enhancer-bulk-${i}-${Date.now()}`;typeof window.aipkit_enhancer_initStepProgress=="function"&&window.aipkit_enhancer_initStepProgress(i);let t=window.aipkit_post_enhancer?.nonce_generate_title;if(!t)throw new Error("Security nonce not found.");let n=window.aipkit_enhancer_bulkState.enhancementsConfig,s=["keyword","title","excerpt","content","meta","tags"],a=[];s.forEach(d=>{n[d]&&n[d].prompt&&a.push(d)});let c=[],l=[];for(let d of a){if(!window.aipkit_enhancer_bulkState.isRunning)break;try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,d,"processing");let u={_ajax_nonce:t,post_id:i,field:d,enhancements:JSON.stringify({[d]:n[d],ai_provider:n.ai_provider,ai_model:n.ai_model,temperature:n.temperature,max_tokens:n.max_tokens,reasoning_effort:n.reasoning_effort,enable_vector_store:n.enable_vector_store,vector_store_provider:n.vector_store_provider,vector_store_top_k:n.vector_store_top_k,openai_vector_store_ids:n.openai_vector_store_ids,pinecone_index_name:n.pinecone_index_name,qdrant_collection_name:n.qdrant_collection_name,vector_embedding_provider:n.vector_embedding_provider,vector_embedding_model:n.vector_embedding_model}),conversation_uuid:e},f=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",u,{timeout:18e4});typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,d,"completed",f.message),c.push(d)}catch(u){typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,d,"error",u.message||"Processing failed"),l.push(d),console.error(`Failed to process field ${d} for post ${i}:`,u)}}if(n.generate_seo_slug==="1"&&c.length>0)try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,"slug","processing");let d={_ajax_nonce:t,post_id:i,action_type:"update_slug"};await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",d,{timeout:3e4}),typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,"slug","completed","URL updated")}catch{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,"slug","error","URL update failed")}if(typeof window.aipkit_enhancer_showPostCompletion=="function"&&window.aipkit_enhancer_showPostCompletion(i,c,l),c.length>0)window.aipkit_enhancer_bulkState.completed++;else if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_logToModal=="function"){let u=(window.aipkit_enhancer_postTitles||{})[i]||`Post #${i}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(u=window.aipkit_enhancer_truncateTitle(u,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${u}". No fields were processed successfully.`,"error")}}catch(e){if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_showStepError=="function"&&window.aipkit_enhancer_showStepError(i,e.message||"Unknown error"),typeof window.aipkit_enhancer_logToModal=="function"){let n=(window.aipkit_enhancer_postTitles||{})[i]||`Post #${i}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(n=window.aipkit_enhancer_truncateTitle(n,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${n}": ${e.message||"Unknown error"}`,"error")}}}function o(i){let e=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!e)return;let t={},n=e.querySelectorAll('input[name="bulk_enhance_fields"]:checked');if(n.length===0){alert("Please select at least one field to enhance.");return}n.forEach(_=>{let m=_.value,g=e.querySelector(`#aipkit_bulk_prompt_${m}`);g&&(t[m]={prompt:g.value})});let s=e.querySelector("#aipkit_bulk_ai_provider").value,a=e.querySelector("#aipkit_bulk_ai_model").value,c=e.querySelector("#aipkit_bulk_ai_temperature").value,l=e.querySelector("#aipkit_bulk_content_max_tokens").value,d=e.querySelector("#aipkit_bulk_reasoning_effort").value;if(!s||!a){alert("Please select an AI Provider and Model.");return}t.ai_provider=s,t.ai_model=a,t.temperature=c,t.max_tokens=l,t.reasoning_effort=d;let u=e.querySelector("#aipkit_bulk_generate_seo_slug");u&&(t.generate_seo_slug=u.checked?"1":"0");let f=e.querySelector('input[name="enable_vector_store"]');if(f&&f.checked){if(t.enable_vector_store="1",t.vector_store_provider=e.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",t.vector_store_top_k=e.querySelector("#aipkit_bulk_vector_store_top_k")?.value||3,t.vector_store_provider==="openai"){let _=e.querySelector("#aipkit_bulk_openai_vector_store_ids");_&&(t.openai_vector_store_ids=Array.from(_.selectedOptions).map(m=>m.value))}else t.vector_store_provider==="pinecone"?t.pinecone_index_name=e.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":t.vector_store_provider==="qdrant"&&(t.qdrant_collection_name=e.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(t.vector_store_provider==="pinecone"||t.vector_store_provider==="qdrant")&&(t.vector_embedding_provider=e.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",t.vector_embedding_model=e.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else t.enable_vector_store="0";window.aipkit_enhancer_bulkState={queue:[...i],isRunning:!0,completed:0,failed:0,total:i.length,enhancementsConfig:t},e.querySelector("#aipkit-enhancer-bulk-config").style.display="none",e.querySelector("#aipkit-enhancer-bulk-progress").style.display="block",e.querySelector("#aipkit_bulk_enhancer_start_btn").disabled=!0,e.querySelector("#aipkit_bulk_enhancer_stop_btn").style.display="inline-flex",e.querySelector("#aipkit_bulk_enhancer_cancel_btn").style.display="none",e.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").style.display="none",typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),p()}window.aipkit_enhancer_startBulkProcess=o})();(function(){"use strict";let p={templates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,isSavingOrDeleting:!1,modalElement:null},r="aipkit_bulk_enhancer_selected_template",o=window.aipkit_escapeHtml||function(_){return _};function i(_){try{_&&String(_)!==""?localStorage.setItem(r,String(_)):localStorage.removeItem(r)}catch(m){console.warn("Failed to save template to localStorage:",m)}}function e(){try{return localStorage.getItem(r)}catch(_){return console.warn("Failed to load template from localStorage:",_),null}}function t(){let _=p.modalElement;if(!_)return{};let m={};["title","excerpt","content","meta","keyword","tags"].forEach(w=>{let h=_.querySelector(`#aipkit_bulk_enhance_${w}`),y=_.querySelector(`#aipkit_bulk_prompt_${w}`);h&&y&&(m[w]={enabled:h.checked?"1":"0",prompt:y.value})}),m.ai_provider=_.querySelector("#aipkit_bulk_ai_provider")?.value||"openai",m.ai_model=_.querySelector("#aipkit_bulk_ai_model")?.value||"",m.ai_temperature=_.querySelector("#aipkit_bulk_ai_temperature")?.value,m.content_max_tokens=_.querySelector("#aipkit_bulk_content_max_tokens")?.value,m.reasoning_effort=_.querySelector("#aipkit_bulk_reasoning_effort")?.value||"low",m.generate_seo_slug=_.querySelector("#aipkit_bulk_generate_seo_slug")?.checked?"1":"0";let k=_.querySelector('input[name="enable_vector_store"]');if(k&&k.checked){if(m.enable_vector_store="1",m.vector_store_provider=_.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",m.vector_store_top_k=_.querySelector("#aipkit_bulk_vector_store_top_k")?.value||"3",m.vector_store_provider==="openai"){let w=_.querySelector("#aipkit_bulk_openai_vector_store_ids");w&&(m.openai_vector_store_ids=Array.from(w.selectedOptions).map(h=>h.value))}else m.vector_store_provider==="pinecone"?m.pinecone_index_name=_.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":m.vector_store_provider==="qdrant"&&(m.qdrant_collection_name=_.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(m.vector_store_provider==="pinecone"||m.vector_store_provider==="qdrant")&&(m.vector_embedding_provider=_.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",m.vector_embedding_model=_.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else m.enable_vector_store="0";return m}function n(_){p.currentTemplateId=_,i(_);let m=p.templates.find(M=>String(M.id)===String(_)),g=m?JSON.parse(JSON.stringify(m.config)):{};p.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(g));let k=p.modalElement;if(!k)return;let w=k.querySelector("#aipkit_bulk_ai_provider"),h=k.querySelector("#aipkit_bulk_ai_model"),y=k.querySelector("#aipkit_bulk_ai_temperature"),b=k.querySelector("#aipkit_bulk_ai_temperature_value"),v=k.querySelector("#aipkit_bulk_content_max_tokens"),S=k.querySelector("#aipkit_bulk_content_max_tokens_value"),C=k.querySelector("#aipkit_bulk_reasoning_effort");w&&(w.value=g.ai_provider||"openai"),h&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(window.aipkit_enhancer_populateBulkModels(w,h),g.ai_model&&setTimeout(()=>{h.querySelector(`option[value="${CSS.escape(g.ai_model)}"]`)&&(h.value=g.ai_model,h.dispatchEvent(new Event("change")))},150)),y&&(y.value=g.ai_temperature||"1.0"),b&&(b.textContent=g.ai_temperature||"1.0"),v&&(v.value=g.content_max_tokens||"4000"),S&&(S.textContent=g.content_max_tokens||"4000"),C&&(C.value=g.reasoning_effort||"low"),["title","excerpt","content","meta","keyword","tags"].forEach(M=>{let x=k.querySelector(`#aipkit_bulk_enhance_${M}`),L=k.querySelector(`#aipkit_bulk_prompt_${M}`);if(x&&L){let A=g[M]?.enabled==="1";x.checked!==A&&(x.checked=A,x.dispatchEvent(new Event("change"))),L.value=g[M]?.prompt||L.defaultValue}});let T=k.querySelector("#aipkit_bulk_generate_seo_slug");T&&(T.checked=g.generate_seo_slug==="1");let E=k.querySelector('input[name="enable_vector_store"]');if(E&&(E.checked=g.enable_vector_store==="1",E.dispatchEvent(new Event("change"))),g.enable_vector_store==="1"){let M=k.querySelector("#aipkit_bulk_vector_store_provider");M&&(M.value=g.vector_store_provider||"openai",M.dispatchEvent(new Event("change",{bubbles:!0})));let x=k.querySelector("#aipkit_bulk_vector_store_top_k");x&&(x.value=g.vector_store_top_k||"3"),setTimeout(()=>{if(g.vector_store_provider==="openai"){let L=k.querySelector("#aipkit_bulk_openai_vector_store_ids");L&&Array.isArray(g.openai_vector_store_ids)&&Array.from(L.options).forEach(A=>{A.selected=g.openai_vector_store_ids.includes(A.value)})}else if(g.vector_store_provider==="pinecone"){let L=k.querySelector("#aipkit_bulk_pinecone_index_name");L&&(L.value=g.pinecone_index_name||"")}else if(g.vector_store_provider==="qdrant"){let L=k.querySelector("#aipkit_bulk_qdrant_collection_name");L&&(L.value=g.qdrant_collection_name||"")}if(g.vector_store_provider==="pinecone"||g.vector_store_provider==="qdrant"){let L=k.querySelector("#aipkit_bulk_vector_embedding_provider"),A=k.querySelector("#aipkit_bulk_vector_embedding_model");L&&(L.value=g.vector_embedding_provider||"openai",L.dispatchEvent(new Event("change"))),A&&g.vector_embedding_model&&setTimeout(()=>{A.value=g.vector_embedding_model},150)}},100)}p.currentTemplateModified=!1,a()}function s(){let _=t();p.currentTemplateModified=!window.aipkit_deepEqual(_,p.initialConfigForSelectedTemplate),a()}function a(){let _=p.modalElement;if(!_)return;let m=_.querySelector("#aipkit_enhancer_template_select").value,g=m&&String(m)!=="";_.querySelector("#aipkit_enhancer_rename_template_btn").disabled=!g,_.querySelector("#aipkit_enhancer_delete_template_btn").disabled=!g,_.querySelector("#aipkit_enhancer_update_template_btn").disabled=!g||!p.currentTemplateModified}function c(_,m="info"){let g=p.modalElement?.querySelector("#aipkit_enhancer_template_status");g&&(g.textContent=_,g.className=`aipkit_form-help aipkit_settings_message-${m}`,setTimeout(()=>{g.textContent="",g.className="aipkit_form-help"},4e3))}async function l(){let _=p.modalElement.querySelector("#aipkit_enhancer_template_select");_.innerHTML='<option value="">Loading...</option>',_.disabled=!0;try{let m=window.aipkit_post_enhancer?.nonce_manage_templates;if(!m)throw new Error("Security nonce for templates not found.");let g=await window.aipkit_apiRequest("aipkit_list_cw_templates",{template_type:"enhancer",_ajax_nonce:m});p.templates=g.templates||[],_.innerHTML='<option value="">-- Select Template --</option>',p.templates.forEach(w=>{_.appendChild(new Option(o(w.template_name),w.id))}),_.disabled=!1;let k=e();k&&(p.templates.some(h=>String(h.id)===String(k))?(_.value=k,n(k)):i(null))}catch(m){c("Error loading templates: "+m.message,"error")}}async function d(_,m){if(!p.isSavingOrDeleting){p.isSavingOrDeleting=!0,c("Saving template...","info");try{let g=t(),k=window.aipkit_post_enhancer?.nonce_manage_templates;if(!k)throw new Error("Security nonce for templates not found.");let w=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:_,template_name:m,config:JSON.stringify(g),template_type:"enhancer",_ajax_nonce:k});c(w.message,"success"),await l(),p.modalElement.querySelector("#aipkit_enhancer_template_select").value=w.template_id,p.currentTemplateId=w.template_id,i(w.template_id),p.currentTemplateModified=!1,a()}catch(g){c("Error saving: "+g.message,"error")}finally{p.isSavingOrDeleting=!1}}}async function u(){let _=p.modalElement.querySelector("#aipkit_enhancer_template_select").value;if(!(!_||p.isSavingOrDeleting)&&confirm("Are you sure you want to delete this enhancer template?")){p.isSavingOrDeleting=!0,c("Deleting...","info");try{let m=window.aipkit_post_enhancer?.nonce_manage_templates;if(!m)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:_,_ajax_nonce:m}),c("Template deleted.","success"),await l(),p.currentTemplateId=null;let g=e();g&&String(g)===String(_)&&i(null),a()}catch(m){c("Error deleting: "+m.message,"error")}finally{p.isSavingOrDeleting=!1}}}function f(_){p.modalElement=_;let m=_.querySelector("#aipkit_enhancer_template_select");m.addEventListener("change",g=>n(g.target.value)),_.querySelector("#aipkit_enhancer_save_as_template_btn").addEventListener("click",()=>{let g=prompt("Enter a name for the new template:");g&&d(0,g)}),_.querySelector("#aipkit_enhancer_update_template_btn").addEventListener("click",()=>{let g=m.options[m.selectedIndex];p.currentTemplateId&&g&&d(p.currentTemplateId,g.text)}),_.querySelector("#aipkit_enhancer_rename_template_btn").addEventListener("click",()=>{let g=m.options[m.selectedIndex];if(p.currentTemplateId&&g){let k=prompt("Enter new name:",g.text);k&&d(p.currentTemplateId,k)}}),_.querySelector("#aipkit_enhancer_delete_template_btn").addEventListener("click",u),l(),_.addEventListener("input",s),_.addEventListener("change",s)}window.aipkit_enhancer_initTemplateControls=f})();(function(){"use strict";function p(r){let{postCount:o,providerOptions:i,defaultPrompts:e,postType:t}=r,n="Placeholders: {original_title}, {original_content}, {original_excerpt}, {original_focus_keyword}, {original_tags}, {categories}.";t==="product"&&(n+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),n=n.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>');let s="Placeholders: {original_title}, {original_content}, {original_focus_keyword}, {original_meta_description}, {original_tags}, {categories}.";return t==="product"&&(s+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),s=s.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>'),`
      <div class="aipkit-modal-overlay aipkit-enhancer-bulk-modal-overlay">
        <div class="aipkit-modal-content aipkit-enhancer-bulk-modal-content" style="min-height: auto;min-width:700px;">
          <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">Content Assistant</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="Close">\xD7</button>
          </div>
          <div class="aipkit-modal-body">
            <div id="aipkit-enhancer-bulk-config">
              <p>You have selected <strong>${o}</strong> items to enhance.</p>
              
              <div class="aipkit_accordion-group">
                <!-- Accordion 1: Template -->
                <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header aipkit_active">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> Template
                    </div>
                    <div class="aipkit_accordion-content aipkit_active">
                        <div class="aipkit_cw_template_controls">
                          <div class="aipkit_form-group aipkit_cw_template_select_group">
                              <label class="aipkit_form-label" for="aipkit_enhancer_template_select">Template</label>
                              <div class="aipkit_cw_template_inline_controls">
                                  <select id="aipkit_enhancer_template_select" name="enhancer_template_id" class="aipkit_form-input" style="max-width: inherit;">
                                      <option value="">-- Select Template --</option>
                                  </select>
                                  <div class="aipkit_cw_template_action_buttons">
                                      <button type="button" id="aipkit_enhancer_update_template_btn" class="aipkit_btn aipkit_btn-primary aipkit_icon_btn" title="Update Current Template" disabled>
                                          <span class="dashicons dashicons-saved"></span>
                                      </button>
                                      <button type="button" id="aipkit_enhancer_save_as_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn" title="Create New Template">
                                          <span class="dashicons dashicons-plus"></span>
                                      </button>
                                      <button type="button" id="aipkit_enhancer_rename_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn" title="Rename Selected Template" disabled>
                                          <span class="dashicons dashicons-edit"></span>
                                      </button>
                                      <button type="button" id="aipkit_enhancer_delete_template_btn" class="aipkit_btn aipkit_btn-danger aipkit_icon_btn" title="Delete Selected Template" disabled>
                                          <span class="dashicons dashicons-trash"></span>
                                      </button>
                                  </div>
                              </div>
                          </div>
                          <div id="aipkit_enhancer_template_inline_form" class="aipkit_cw_template_inline_form" style="display: none;">
                              <input type="text" id="aipkit_enhancer_template_name_input" class="aipkit_form-input" placeholder="Enter template name...">
                              <div class="aipkit_cw_template_inline_form_actions">
                                  <button type="button" id="aipkit_enhancer_template_save_inline_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">Save</button>
                                  <button type="button" id="aipkit_enhancer_template_cancel_inline_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                              </div>
                          </div>
                          <div id="aipkit_enhancer_template_inline_delete_confirm" class="aipkit_cw_template_inline_delete_confirm" style="display: none;">
                              <span id="aipkit_enhancer_template_delete_confirm_text"></span>
                              <div class="aipkit_cw_template_inline_form_actions">
                                  <button type="button" id="aipkit_enhancer_template_confirm_delete_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small">Confirm</button>
                                  <button type="button" id="aipkit_enhancer_template_cancel_delete_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                              </div>
                          </div>
                          <div id="aipkit_enhancer_template_status" class="aipkit_form-help"></div>
                      </div>
                    </div>
                </div>

                <!-- Accordion 2: AI Settings -->
                <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> AI
                    </div>
                    <div class="aipkit_accordion-content">
                       <div class="aipkit_form-row">
                            <div class="aipkit_form-group aipkit_form-col">
                                <label class="aipkit_form-label" for="aipkit_bulk_ai_provider">Provider</label>
                                <select id="aipkit_bulk_ai_provider" class="aipkit_form-input">${i}</select>
                            </div>
                            <div class="aipkit_form-group aipkit_form-col">
                                 <label class="aipkit_form-label" for="aipkit_bulk_ai_model">Model</label>
                                 <div class="aipkit_input-with-button">
                                     <select id="aipkit_bulk_ai_model" class="aipkit_form-input"><option value="">-- Select Provider --</option></select>
                                     <button type="button" id="aipkit_bulk_enhancer_ai_settings_toggle" class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn" title="Toggle Advanced AI Parameters">
                                        <span class="dashicons dashicons-admin-generic"></span>
                                     </button>
                                 </div>
                            </div>
                       </div>
                       <div id="aipkit_bulk_enhancer_ai_parameters_row" style="display: none;">
                            <div class="aipkit_form-row">
                                <div class="aipkit_form-group aipkit_form-col">
                                    <label class="aipkit_form-label" for="aipkit_bulk_ai_temperature">Temperature</label>
                                    <div class="aipkit_slider_wrapper">
                                        <input type="range" id="aipkit_bulk_ai_temperature" class="aipkit_form-input aipkit_range_slider" min="0" max="2" step="0.1" value="1.0">
                                        <span id="aipkit_bulk_ai_temperature_value" class="aipkit_slider_value">1.0</span>
                                    </div>
                                </div>
                                <div class="aipkit_form-group aipkit_form-col">
                                    <label class="aipkit_form-label" for="aipkit_bulk_content_max_tokens">Max Tokens</label>
                                    <div class="aipkit_slider_wrapper">
                                        <input type="range" id="aipkit_bulk_content_max_tokens" class="aipkit_form-input aipkit_range_slider" min="100" max="128000" step="100" value="4000">
                                        <span id="aipkit_bulk_content_max_tokens_value" class="aipkit_slider_value">4000</span>
                                    </div>
                                </div>
                                <div class="aipkit_form-group aipkit_form-col aipkit_enhancer_reasoning_effort_field" style="display: none;">
                                    <label class="aipkit_form-label" for="aipkit_bulk_reasoning_effort">Reasoning</label>
                                    <select id="aipkit_bulk_reasoning_effort" name="reasoning_effort" class="aipkit_form-input">
                                        <option value="minimal">Minimal</option>
                                        <option value="low" selected>Low (Default)</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                            </div>
                       </div>
                    </div>
                </div>

                <!-- Accordion 3: Context -->
                <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> Context
                    </div>
                    <div class="aipkit_accordion-content">
                      <div class="aipkit_form-group">
                          <label class="aipkit_form-label aipkit_checkbox-label">
                              <input type="checkbox" name="enable_vector_store" value="1">
                              Use Context
                          </label>
                          <p class="aipkit_form-help" style="margin-left: 23px; margin-top: -5px;">Allow the AI to use your knowledge base for more accurate enhancements.</p>
                      </div>
                      <div class="aipkit_cw_vector_store_settings_container" style="display:none; margin-top: 15px; padding-left: 23px;">
                          
                          <div class="aipkit_form-row">
                              <div class="aipkit_form-group aipkit_form-col">
                                  <label class="aipkit_form-label" for="aipkit_bulk_vector_store_provider">Vector Provider</label>
                                  <select id="aipkit_bulk_vector_store_provider" name="vector_store_provider" class="aipkit_form-input">
                                      <option value="openai" selected>OpenAI</option>
                                      <option value="pinecone">Pinecone</option>
                                      <option value="qdrant">Qdrant</option>
                                  </select>
                              </div>
                              <div class="aipkit_form-col">
                                  <div class="aipkit_form-group aipkit_cw_vector_openai_field">
                                      <label class="aipkit_form-label" for="aipkit_bulk_openai_vector_store_ids">Stores</label>
                                      <select id="aipkit_bulk_openai_vector_store_ids" name="openai_vector_store_ids[]" class="aipkit_form-input" multiple size="3" style="height: auto;"></select>
                                  </div>
                                  <div class="aipkit_form-group aipkit_cw_vector_pinecone_field" style="display:none;">
                                      <label class="aipkit_form-label" for="aipkit_bulk_pinecone_index_name">Index</label>
                                      <select id="aipkit_bulk_pinecone_index_name" name="pinecone_index_name" class="aipkit_form-input"></select>
                                  </div>
                                  <div class="aipkit_form-group aipkit_cw_vector_qdrant_field" style="display:none;">
                                      <label class="aipkit_form-label" for="aipkit_bulk_qdrant_collection_name">Collection</label>
                                      <select id="aipkit_bulk_qdrant_collection_name" name="qdrant_collection_name" class="aipkit_form-input"></select>
                                  </div>
                              </div>
                              <div class="aipkit_form-group aipkit_form-col">
                                  <label class="aipkit_form-label" for="aipkit_bulk_vector_store_top_k">Results Limit</label>
                                  <input type="number" id="aipkit_bulk_vector_store_top_k" name="vector_store_top_k" class="aipkit_form-input" value="3" min="1" max="20" step="1">
                              </div>
                          </div>

                          <div class="aipkit_cw_vector_embedding_config_row" style="display: none;">
                              <div class="aipkit_form-row">
                                  <div class="aipkit_form-group aipkit_form-col">
                                      <label class="aipkit_form-label" for="aipkit_bulk_vector_embedding_provider">Embedding Provider</label>
                                      <select id="aipkit_bulk_vector_embedding_provider" name="vector_embedding_provider" class="aipkit_form-input">
                                          <option value="openai" selected>OpenAI</option>
                                          <option value="google">Google</option>
                                          <option value="azure">Azure</option>
                                      </select>
                                  </div>
                                  <div class="aipkit_form-group aipkit_form-col">
                                      <label class="aipkit_form-label" for="aipkit_bulk_vector_embedding_model">Embedding Model</label>
                                      <select id="aipkit_bulk_vector_embedding_model" name="vector_embedding_model" class="aipkit_form-input"></select>
                                  </div>
                              </div>
                          </div>
                      </div>
                    </div>
                </div>
                
                <!-- NEW: SEO Accordion -->
                 <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> SEO
                    </div>
                    <div class="aipkit_accordion-content">
                        <div class="aipkit_form-group">
                            <label class="aipkit_form-label aipkit_checkbox-label">
                                <input type="checkbox" id="aipkit_bulk_generate_seo_slug" name="generate_seo_slug" value="1">
                                Optimize URL
                            </label>
                            <p class="aipkit_form-help" style="margin-left: 23px; margin-top: -5px;">Generate a new, SEO-friendly post slug based on the focus keyword or title.</p>
                        </div>
                    </div>
                </div>

                <!-- Accordion 4: Fields & Prompts -->
                <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> Prompts
                    </div>
                    <div class="aipkit_accordion-content">
                      <div class="aipkit_form-group">
                          <label class="aipkit_form-label">Fields to Update</label>
                          <div class="aipkit_checkbox-group">
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_title">
                                  <input type="checkbox" id="aipkit_bulk_enhance_title" name="bulk_enhance_fields" value="title"> Title
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_excerpt">
                                  <input type="checkbox" id="aipkit_bulk_enhance_excerpt" name="bulk_enhance_fields" value="excerpt"> Excerpt
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_content">
                                  <input type="checkbox" id="aipkit_bulk_enhance_content" name="bulk_enhance_fields" value="content"> Content
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_tags">
                                  <input type="checkbox" id="aipkit_bulk_enhance_tags" name="bulk_enhance_fields" value="tags"> Tags
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_meta">
                                  <input type="checkbox" id="aipkit_bulk_enhance_meta" name="bulk_enhance_fields" value="meta"> Meta Description
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_keyword">
                                  <input type="checkbox" id="aipkit_bulk_enhance_keyword" name="bulk_enhance_fields" value="keyword"> Focus Keyword
                              </label>
                          </div>
                      </div>
                      <div class="aipkit_tabs aipkit_enhancer_prompt_tabs">
                        <div class="aipkit_tab" data-tab="prompt-title" style="display: none;">Title</div>
                        <div class="aipkit_tab" data-tab="prompt-excerpt" style="display: none;">Excerpt</div>
                        <div class="aipkit_tab" data-tab="prompt-content" style="display: none;">Content</div>
                        <div class="aipkit_tab" data-tab="prompt-tags" style="display: none;">Tags</div>
                        <div class="aipkit_tab" data-tab="prompt-meta" style="display: none;">Meta</div>
                        <div class="aipkit_tab" data-tab="prompt-keyword" style="display: none;">Keyword</div>
                      </div>
                      <div class="aipkit_tab_content_container">
                        <div class="aipkit_tab-content" data-pane="prompt-title">
                            <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_title" class="aipkit_form-input" rows="6">${e.title}</textarea>
                                <p class="aipkit_form-help">${n}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-excerpt">
                             <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_excerpt" class="aipkit_form-input" rows="6">${e.excerpt}</textarea>
                                <p class="aipkit_form-help">${n}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-content">
                             <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_content" class="aipkit_form-input" rows="6">${e.content}</textarea>
                                <p class="aipkit_form-help">${n}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-tags">
                            <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_tags" class="aipkit_form-input" rows="6">${e.tags}</textarea>
                                <p class="aipkit_form-help">${n}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-meta">
                            <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_meta" class="aipkit_form-input" rows="6">${e.meta}</textarea>
                                <p class="aipkit_form-help">${s}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-keyword">
                            <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_keyword" class="aipkit_form-input" rows="6">${e.keyword}</textarea>
                                <p class="aipkit_form-help">${n}</p>
                            </div>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
            </div>

            <!-- Progress Display -->
            <div id="aipkit-enhancer-bulk-progress" style="display: none;">
                <div class="aipkit_enhancer_progress_header">
                    <div id="aipkit-enhancer-progress-text" class="aipkit_enhancer_progress_text">Processing posts...</div>
                    <div id="aipkit-enhancer-progress-stats" class="aipkit_enhancer_progress_stats">0 of 0 (0%)</div>
                </div>
                <div class="aipkit_progress_bar_container">
                    <div id="aipkit-enhancer-bulk-progress-bar" class="aipkit_progress_bar_filled" style="width: 0%;"></div>
                </div>
                <div id="aipkit-enhancer-bulk-status-log" class="aipkit_enhancer_bulk_log"></div>
            </div>

          </div>
          <div class="aipkit-modal-footer">
            <button type="button" id="aipkit_bulk_enhancer_cancel_btn" class="aipkit_btn aipkit_btn-secondary">Close</button>
            <button type="button" id="aipkit_bulk_enhancer_back_to_settings_btn" class="aipkit_btn aipkit_btn-secondary" style="display:none;">
                <span class="dashicons dashicons-arrow-left-alt2" style="margin-right: 5px;"></span>Back to Settings
            </button>
            <button type="button" id="aipkit_bulk_enhancer_stop_btn" class="aipkit_btn aipkit_btn-danger" style="display:none;">Stop</button>
            <button type="button" id="aipkit_bulk_enhancer_start_btn" class="aipkit_btn aipkit_btn-primary">
                <span class="aipkit_btn-text">Start</span>
                <span class="aipkit_spinner" style="display:none;"></span>
            </button>
          </div>
        </div>
      </div>
    `}window.aipkit_enhancer_getBulkModalHtml=p})();(function(){"use strict";function p(r,o){if(typeof window.aipkit_enhancer_getBulkModalHtml!="function"){console.error("Bulk Modal UI: aipkit_enhancer_getBulkModalHtml function is not available."),alert("Error: Could not load modal interface.");return}let i={};r.forEach(l=>{let d=document.querySelector(`tr#post-${l}`);if(d){let u=d.querySelector(".row-title")||d.querySelector("strong a")||d.querySelector(".title a")||d.querySelector("a.row-title")||d.querySelector(".column-title strong a")||d.querySelector(".column-title .row-title");u&&(i[l]=u.textContent.trim())}i[l]||(i[l]=`Post #${l}`)}),window.aipkit_enhancer_postTitles=i;let e=window.aipkit_post_enhancer?.default_prompts||{title:"Generate a new title for: {original_title}",excerpt:"Generate a new excerpt for: {original_title}",content:"Rewrite the content for: {original_title}",meta:"Generate a meta description for: {original_title}",keyword:"Generate a focus keyword for: {original_title}"},t=window.aipkit_dashboard?.models?Object.keys(window.aipkit_dashboard.models):["openai"],n={openai:"OpenAI",openrouter:"OpenRouter",google:"Google",azure:"Azure",deepseek:"DeepSeek",ollama:"Ollama"},s=t.map(l=>`<option value="${l.toLowerCase()}">${n[l.toLowerCase()]||l.toUpperCase()}</option>`).join(""),a=window.aipkit_enhancer_getBulkModalHtml({postCount:r.length,providerOptions:s,defaultPrompts:e,postType:o});document.body.insertAdjacentHTML("beforeend",a);let c=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");typeof window.aipkit_enhancer_attachBulkModalListeners=="function"?window.aipkit_enhancer_attachBulkModalListeners(c,r):console.error("Bulk Modal UI: aipkit_enhancer_attachBulkModalListeners function is not available."),requestAnimationFrame(()=>{c.classList.add("aipkit-active")})}window.aipkit_enhancer_createAndShowBulkModal=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||(n=>n||"");function r(n,s){let a=window.aipkit_post_enhancer||{},c,l,d,u,f;n==="openai"?(c=s.querySelector("#aipkit_bulk_openai_vector_store_ids"),l=a.openai_vector_stores||[],d="id",u="name",f="No OpenAI stores found."):n==="pinecone"?(c=s.querySelector("#aipkit_bulk_pinecone_index_name"),l=a.pinecone_indexes||[],d="name",u="name",f="No Pinecone indexes found."):n==="qdrant"&&(c=s.querySelector("#aipkit_bulk_qdrant_collection_name"),l=a.qdrant_collections||[],d="name",u="name",f="No Qdrant collections found."),c&&(c.innerHTML="",l.length>0?c.multiple?l.forEach(_=>{c.add(new Option(p(_[u]),_[d]))}):(c.add(new Option("-- Select --","")),l.forEach(_=>{c.add(new Option(p(_[u]),_[d]))})):(c.add(new Option(f,"")),c.disabled=!0))}function o(n,s){let a=s.querySelector("#aipkit_bulk_vector_embedding_model");if(!a)return;let c=window.aipkit_post_enhancer||{},l=[];n==="google"?l=c.googleEmbeddingModels||[]:n==="azure"?l=c.azureEmbeddingModels||[]:l=c.openaiEmbeddingModels||[],a.innerHTML="",l.length>0?(a.add(new Option("-- Select Model --","")),l.forEach(d=>{a.add(new Option(p(d.name||d.id),d.id))}),a.disabled=!1):(a.add(new Option("No models found","")),a.disabled=!0)}function i(n){let s=n.querySelector("#aipkit_bulk_vector_store_provider").value,a=n.querySelector(".aipkit_cw_vector_openai_field"),c=n.querySelector(".aipkit_cw_vector_pinecone_field"),l=n.querySelector(".aipkit_cw_vector_qdrant_field"),d=n.querySelector(".aipkit_cw_vector_embedding_config_row");a&&(a.style.display="none"),c&&(c.style.display="none"),l&&(l.style.display="none"),d&&(d.style.display="none"),s==="openai"?(a&&(a.style.display="block"),r("openai",n)):s==="pinecone"?(c&&(c.style.display="block"),d&&(d.style.display="block"),r("pinecone",n),o("openai",n)):s==="qdrant"&&(l&&(l.style.display="block"),d&&(d.style.display="block"),r("qdrant",n),o("openai",n))}function e(n){let s=n.querySelector('input[name="enable_vector_store"]'),a=n.querySelector(".aipkit_cw_vector_store_settings_container"),c=n.querySelector("#aipkit_bulk_vector_store_provider"),l=n.querySelector("#aipkit_bulk_vector_embedding_provider");!s||!a||!c||(s.addEventListener("change",()=>{a.style.display=s.checked?"block":"none"}),c.addEventListener("change",()=>i(n)),l&&l.addEventListener("change",d=>o(d.target.value,n)),a.style.display=s.checked?"block":"none",i(n))}function t(n,s){if(!n)return;function a(){typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess(),n&&(n.classList.remove("aipkit-active"),n.addEventListener("transitionend",()=>n.remove(),{once:!0}),setTimeout(()=>n?.remove(),500))}n.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),n.querySelector("#aipkit_bulk_enhancer_cancel_btn").addEventListener("click",a);let c=n.querySelector(".aipkit-modal-body");c&&c.addEventListener("click",b=>{let v=b.target.closest(".aipkit_accordion-header");if(!v)return;b.preventDefault();let S=v.closest(".aipkit_accordion");if(!S)return;let C=v.nextElementSibling;if(!C||!C.classList.contains("aipkit_accordion-content"))return;let T=S.closest(".aipkit_accordion-group");if(T&&!v.classList.contains("aipkit_active")){let E=T.querySelector(".aipkit_accordion-header.aipkit_active");if(E){E.classList.remove("aipkit_active");let M=E.nextElementSibling;M&&M.classList.remove("aipkit_active")}}v.classList.toggle("aipkit_active"),C.classList.toggle("aipkit_active")});let l=n.querySelector("#aipkit_bulk_ai_provider"),d=n.querySelector("#aipkit_bulk_ai_model"),u=n.querySelector("#aipkit_bulk_ai_temperature"),f=n.querySelector("#aipkit_bulk_ai_temperature_value"),_=n.querySelector("#aipkit_bulk_content_max_tokens"),m=n.querySelector("#aipkit_bulk_content_max_tokens_value"),g=n.querySelector("#aipkit_bulk_enhancer_ai_settings_toggle"),k=n.querySelector("#aipkit_bulk_enhancer_ai_parameters_row");g&&k&&g.addEventListener("click",()=>{let b=k.style.display==="none";k.style.display=b?"block":"none",g.classList.toggle("aipkit_active",b)}),l&&d&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(l.addEventListener("change",()=>window.aipkit_enhancer_populateBulkModels(l,d)),window.aipkit_enhancer_populateBulkModels(l,d)),d&&typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&d.addEventListener("change",()=>window.aipkit_enhancer_toggleReasoningEffort(n)),u&&f&&u.addEventListener("input",()=>f.textContent=u.value),_&&m&&_.addEventListener("input",()=>m.textContent=_.value),typeof window.aipkit_enhancer_initTemplateControls=="function"&&window.aipkit_enhancer_initTemplateControls(n);let w=n.querySelector(".aipkit_enhancer_prompt_tabs"),h=n.querySelector(".aipkit_tab_content_container"),y=n.querySelectorAll('input[name="bulk_enhance_fields"]');w&&h&&w.addEventListener("click",b=>{let v=b.target.closest(".aipkit_tab");if(!v||v.classList.contains("aipkit_active"))return;let S=v.dataset.tab;w.querySelectorAll(".aipkit_tab").forEach(T=>T.classList.remove("aipkit_active")),h.querySelectorAll(".aipkit_tab-content").forEach(T=>T.classList.remove("aipkit_active")),v.classList.add("aipkit_active");let C=h.querySelector(`[data-pane="${S}"]`);C&&C.classList.add("aipkit_active")}),y.forEach(b=>{let v=b.value,S=w?.querySelector(`[data-tab="prompt-${v}"]`);S&&(S.style.display=b.checked?"flex":"none"),b.addEventListener("change",()=>{S&&(S.style.display=b.checked?"flex":"none");let C=w.querySelector(".aipkit_tab.aipkit_active");if(C&&C.style.display==="none"){let T=w.querySelector('.aipkit_tab:not([style*="display: none"])');if(T)T.click();else{let E=h.querySelector(".aipkit_tab-content.aipkit_active");E&&E.classList.remove("aipkit_active")}}else if(!w.querySelector('.aipkit_tab.aipkit_active:not([style*="display: none"])')){let T=w.querySelector('.aipkit_tab:not([style*="display: none"])');T&&T.click()}})}),n.querySelector("#aipkit_bulk_enhancer_start_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_startBulkProcess=="function"&&window.aipkit_enhancer_startBulkProcess(s)}),n.querySelector("#aipkit_bulk_enhancer_stop_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess()}),n.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_returnToSettings=="function"&&window.aipkit_enhancer_returnToSettings()}),e(n)}window.aipkit_enhancer_attachBulkModalListeners=t})();(function(){"use strict"})();(function(){"use strict";function p(r,o,i){let t=(window.aipkit_post_enhancer||{}).text||{};r?window.aipkit_updateModalWithError(r.message||t.error_loading_title,t):o?window.aipkit_updateModalWithSuggestions(o,t):window.aipkit_updateModalWithError(t.error_loading_title||"Unknown error occurred.",t)}window.aipkit_handleTitleSuggestionsResult=p})();(function(){"use strict";function p(r,o,i){let t=(window.aipkit_post_enhancer||{}).text||{};r?window.aipkit_updateModalWithErrorExcerpt(r.message||t.error_loading_excerpt,t):o?window.aipkit_updateModalWithExcerptSuggestions(o,t):window.aipkit_updateModalWithErrorExcerpt(t.error_loading_excerpt||"Unknown error occurred.",t)}window.aipkit_handleExcerptSuggestionsResult=p})();(function(){"use strict";function p(r,o,i){let t=(window.aipkit_post_enhancer||{}).text||{};r?window.aipkit_updateModalWithErrorMeta(r.message||t.error_loading_meta,t):o?window.aipkit_updateModalWithMetaSuggestions(o,t):window.aipkit_updateModalWithErrorMeta(t.error_loading_meta||"Unknown error occurred.",t)}window.aipkit_handleMetaSuggestionsResult=p})();(function(){"use strict";function p(){}function r(){document.getElementById("aipkit_bulk_enhance_btn")}window.aipkit_initBulkEnhancerButton=r})();(function(){"use strict";function p(o){let i=o.target.closest(".aipkit_enhancer_item"),e=o.target.closest("#aipkit_bulk_enhance_btn");if(i){if(i.classList.contains("aipkit_enhancer_placeholder")){o.target.tagName==="A"&&o.preventDefault();return}o.preventDefault();let t=i.getAttribute("data-post-id"),n=i.getAttribute("data-action-type");if(!t||!n)return;let s=window.aipkit_post_enhancer||{},a=s.text||{};switch(n){case"title":window.aipkit_showLoadingModal(t,a,s),window.aipkit_fetchTitleSuggestions(t,window.aipkit_handleTitleSuggestionsResult,i);break;case"excerpt":window.aipkit_showLoadingExcerptModal(t,a,s),window.aipkit_fetchExcerptSuggestions(t,window.aipkit_handleExcerptSuggestionsResult,i);break;case"meta":window.aipkit_showLoadingMetaModal(t,a,s),window.aipkit_fetchMetaSuggestions(t,window.aipkit_handleMetaSuggestionsResult,i);break;case"tags":window.aipkit_showLoadingTagsModal(t,a,s),window.aipkit_fetchTagsSuggestions(t,window.aipkit_handleTagsSuggestionsResult,i);break;default:console.warn(`AIPKit Post Enhancer Events: Unhandled action type '${n}'.`);break}}else if(e){o.preventDefault();let t=document.querySelectorAll('input[name="post[]"]:checked');if(t.length===0){alert("Please select at least one post.");return}let n=Array.from(t).map(a=>a.value),s=window.typenow||"post";typeof window.aipkit_enhancer_createAndShowBulkModal=="function"?window.aipkit_enhancer_createAndShowBulkModal(n,s):alert("Error: Bulk processing feature is not available.")}}function r(){let o=document;if(!o)return;let i="data-post-enhancer-listener";document.body.getAttribute(i)||(o.addEventListener("click",p),document.body.setAttribute(i,"true"))}window.aipkit_initEnhancerEventListeners=r})();(function(){"use strict";function p(){if(!["aipkit_handleTitleSuggestionsResult","aipkit_handleExcerptSuggestionsResult","aipkit_handleMetaSuggestionsResult","aipkit_handleTagsSuggestionsResult","aipkit_initEnhancerEventListeners","aipkit_initBulkEnhancerButton"].every(o=>typeof window[o]=="function")){console.error("AIPKit Post Enhancer Init: One or more required modular functions are missing.");return}window.aipkit_initEnhancerEventListeners(),window.aipkit_initBulkEnhancerButton(),function(){let i=new WeakMap;function e(c){n(c),c.classList.add("aipkit-open")}function t(c){n(c);let l=setTimeout(()=>{c.classList.remove("aipkit-open")},180);i.set(c,l)}function n(c){let l=i.get(c);l&&(clearTimeout(l),i.delete(c))}function s(c){if(!c||c.dataset.aipkitHoverBound==="1")return;c.dataset.aipkitHoverBound="1",c.addEventListener("mouseenter",()=>e(c)),c.addEventListener("mouseleave",()=>t(c));let l=c.querySelector(".aipkit_enhancer_popover");l&&(l.addEventListener("mouseenter",()=>e(c)),l.addEventListener("mouseleave",()=>t(c)))}function a(){document.querySelectorAll(".aipkit_enhancer_action").forEach(s),new MutationObserver(d=>{for(let u of d)u.addedNodes&&u.addedNodes.length&&u.addedNodes.forEach(f=>{f.nodeType===1&&(f.matches&&f.matches(".aipkit_enhancer_action")&&s(f),f.querySelectorAll&&f.querySelectorAll(".aipkit_enhancer_action").forEach(s))})}).observe(document.body,{childList:!0,subtree:!0})}a()}()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p):p(),window.aipkit_initPostEnhancer=p})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(i){return i};function r(){let i=document.getElementById("aipkit_vpp_embedding_provider_select");if(!i){console.error("VPP Embedding Util: Embedding provider select not found.");return}o(i.value)}function o(i){let e=document.getElementById("aipkit_vpp_embedding_model_select");if(!e){console.error("VPP Embedding Util: Embedding model select not found.");return}let t=window.aipkit_vpp_config||{},n=t.text||{};e.innerHTML=`<option value="">${p(n.select_model||"-- Select Model --")}</option>`;let s=[];i==="openai"&&t.openaiEmbeddingModels?s=t.openaiEmbeddingModels:i==="google"&&t.googleEmbeddingModels?s=t.googleEmbeddingModels:i==="azure"&&t.azureEmbeddingModels&&(s=t.azureEmbeddingModels),s.length>0?(s.forEach(a=>{a&&a.id&&e.appendChild(new Option(p(a.name||a.id),a.id))}),e.disabled=!1,e.options.length>1&&(e.selectedIndex=1)):(e.appendChild(new Option(p(`(No ${i} models - Sync in AI Settings)`),"")),e.disabled=!0)}window.aipkit_vpp_populateEmbeddingConfigSelects=r,window.aipkit_vpp_populateEmbeddingModelSelect=o})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(i){return i};function r(){let i=document.getElementById("aipkit_vpp_openai_vector_store_id"),e=document.getElementById("aipkit_vpp_openai_store_status"),t=window.aipkit_vpp_config||{},n=t.text||{},s=t.openai_vector_stores||[];if(!i||!e){console.error("VPP OpenAI Provider: Store select or status div not found.");return}i.innerHTML="",e.textContent="",s.length>0?(i.appendChild(new Option(`-- ${p(n.select_store||"Select Existing Store")} --`,"")),s.forEach(a=>{let c="(Files: N/A)";a.file_counts&&typeof a.file_counts.total=="number"?c=`(${a.file_counts.total} ${a.file_counts.total===1?"File":"Files"})`:a.file_counts&&(c="(Files: ?)");let l=`${p(a.name||a.id)} ${c}`,d=new Option(l,a.id);i.appendChild(d)})):i.appendChild(new Option(p(n.no_stores_found||"No stores found. Create one in AI Training > Knowledge Base."),"")),i.disabled=s.length===0}async function o(i,e,t,n){let s=window.aipkit_vpp_config||{},a=s.text||{},c=i.length,l=0,d=0,u=0,f=[];try{let _=s.nonce_index_posts;if(!_)throw new Error("Nonce for indexing posts is missing in config.");for(let g of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}l++;let k=document.querySelector(`#post-${g}`),w=k?k.querySelector(".title .row-title"):null,h=w?w.textContent.trim():`Post #${g}`;if(typeof window.aipkit_vpp_updateProgress=="function"){let b=l/c*100,v=(a.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",l).replace("%2$d",c)+` "${p(h)}"`;window.aipkit_vpp_updateProgress(b,v)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let y={_ajax_nonce:_,post_ids:[g],post_type:n,target_store_id:e,new_store_name_openai:t||"",provider:"openai"};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",y),d++}catch(b){u++,f.push({id:g,title:h,error:b.message}),console.error(`VPP OpenAI Provider: Failed to index Post ID ${g}:`,b)}}let m=`Indexing complete. ${d} successful, ${u} failed.`;window.aipkit_isIndexingStopped&&l<c?m=`Indexing stopped. ${d} successful, ${u} failed.`:u>0&&(m+=" See browser console for details on failed posts.",console.error("Failed Posts:",f)),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m,u>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${d}/${c}`)}catch(_){console.error("VPP OpenAI Provider: Indexing setup error:",_),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,a.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(_.message||"Failed to start indexing.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),u>0?5e3:2e3)}}window.aipkit_vpp_populateOpenAIStoresSelect=r,window.aipkit_vpp_startIndexingOpenAI=o})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(i){return i};function r(){let i=document.getElementById("aipkit_vpp_pinecone_target_index_select"),e=document.getElementById("aipkit_vpp_pinecone_index_status"),t=window.aipkit_vpp_config||{},n=t.text||{},s=t.pinecone_indexes||[];if(!i||!e){console.error("VPP Pinecone Provider: Index select or status div not found.");return}i.innerHTML="",e.textContent="",s.length>0?(i.appendChild(new Option(`-- ${p(n.select_pinecone_index||"Select Pinecone Index")} --`,"")),s.forEach(a=>{let c=a.name||a.id;if(c){let l=`${p(c)} (${a.dimension||"?"})`;i.appendChild(new Option(l,c))}})):i.appendChild(new Option(p(n.no_pinecone_indexes_found||"No Pinecone indexes found. Create one in AI Training or via Pinecone console."),"")),i.disabled=s.length===0}async function o(i,e,t,n,s){let a=window.aipkit_vpp_config||{},c=a.text||{},l=i.length,d=0,u=0,f=0,_=[];try{let m=a.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let k of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}d++;let w=document.querySelector(`#post-${k}`),h=w?w.querySelector(".title .row-title"):null,y=h?h.textContent.trim():`Post #${k}`;if(typeof window.aipkit_vpp_updateProgress=="function"){let v=d/l*100,S=(c.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",d).replace("%2$d",l)+` "${p(y)}"`;window.aipkit_vpp_updateProgress(v,S)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let b={_ajax_nonce:m,post_ids:[k],post_type:s,target_index_id:e,provider:"pinecone",embedding_provider:t,embedding_model:n};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",b),u++}catch(v){f++,_.push({id:k,title:y,error:v.message}),console.error(`VPP Pinecone Provider: Failed to index Post ID ${k}:`,v)}}let g=`Indexing complete. ${u} successful, ${f} failed.`;window.aipkit_isIndexingStopped&&d<l?g=`Indexing stopped. ${u} successful, ${f} failed.`:f>0&&(g+=" See browser console for details on failed posts.",console.error("Failed Posts:",_)),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,f>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${u}/${l}`)}catch(m){console.error("VPP Pinecone Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,c.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Pinecone.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),f>0?5e3:2e3)}}window.aipkit_vpp_populatePineconeIndexesSelect=r,window.aipkit_vpp_startIndexingPinecone=o})();(function(){"use strict";let p=window.aipkit_escapeHtml||function(i){return i};function r(){let i=document.getElementById("aipkit_vpp_qdrant_target_collection_select"),e=document.getElementById("aipkit_vpp_qdrant_collection_status"),t=window.aipkit_vpp_config||{},n=t.text||{},s=t.qdrant_collections||[];if(!i||!e){console.error("VPP Qdrant Provider: Collection select or status div not found.");return}i.innerHTML="",e.textContent="",s.length>0?(i.appendChild(new Option(`-- ${p(n.select_qdrant_collection||"Select Qdrant Collection")} --`,"")),s.forEach(a=>{let c=a.name||a.id;c&&i.appendChild(new Option(p(c),c))})):i.appendChild(new Option(p(n.no_qdrant_collections_found||"No Qdrant collections found. Create one in AI Training."),"")),i.disabled=s.length===0}async function o(i,e,t,n,s){let a=window.aipkit_vpp_config||{},c=a.text||{},l=i.length,d=0,u=0,f=0,_=[];try{let m=a.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let k of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}d++;let w=document.querySelector(`#post-${k}`),h=w?w.querySelector(".title .row-title"):null,y=h?h.textContent.trim():`Post #${k}`;if(typeof window.aipkit_vpp_updateProgress=="function"){let v=d/l*100,S=(c.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",d).replace("%2$d",l)+` "${p(y)}"`;window.aipkit_vpp_updateProgress(v,S)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let b={_ajax_nonce:m,post_ids:[k],post_type:s,target_collection_name:e,provider:"qdrant",embedding_provider:t,embedding_model:n};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",b),u++}catch(v){f++,_.push({id:k,title:y,error:v.message}),console.error(`VPP Qdrant Provider: Failed to index Post ID ${k}:`,v)}}let g=`Indexing complete. ${u} successful, ${f} failed.`;window.aipkit_isIndexingStopped&&d<l?g=`Indexing stopped. ${u} successful, ${f} failed.`:f>0&&(g+=" See browser console for details on failed posts.",console.error("Failed Posts:",_)),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,f>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${u}/${l}`)}catch(m){console.error("VPP Qdrant Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,c.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Qdrant.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),f>0?5e3:2e3)}}window.aipkit_vpp_populateQdrantCollectionsSelect=r,window.aipkit_vpp_startIndexingQdrant=o})();(function(){"use strict";let p="aipkit_vpp_modal",r=[],o="",i=!1;function e(u,f){if(document.getElementById(p)){console.warn("VPP Modal UI: Modal already exists.");return}r=u,o=f,i=!1;let _=window.aipkit_vpp_config||{},m=_.text||{},g=window.aipkit_escapeHtml||function(C){return C},k=window.aipkit_escapeAttribute||g,w="",h=u.length;h===1?w=(m.items_selected_singular||"You have selected %d item to index.").replace("%d",h):w=(m.items_selected_plural||"You have selected %d items to index.").replace("%d",h);let y=document.createElement("div");y.id=p,y.className="aipkit-modal-overlay aipkit-active";let b=document.createElement("div");b.className="aipkit-modal-content aipkit_vpp_modal_content",b.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${g(m.modal_title||"Index")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${k(m.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <p>${g(w)}</p>

                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="aipkit_vpp_vector_store_provider">${g(m.provider_label||"Provider")}</label>
                    <select id="aipkit_vpp_vector_store_provider" class="aipkit_form-input">
                        <option value="openai" selected>OpenAI</option>
                        <option value="pinecone">Pinecone</option>
                        <option value="qdrant">Qdrant</option>
                    </select>
                </div>

                <div id="aipkit_vpp_openai_options" style="display: block;">
                    <div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="aipkit_vpp_openai_vector_store_id">${g(m.select_store||"Select OpenAI Store")}</label>
                        <select id="aipkit_vpp_openai_vector_store_id" class="aipkit_form-input">
                            <option value="">${g(m.loading_stores||"Loading stores...")}</option>
                        </select>
                        <div class="aipkit_form-help" id="aipkit_vpp_openai_store_status"></div>
                    </div>
                </div>

                <div id="aipkit_vpp_pinecone_options" style="display: none;">
                    <div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="aipkit_vpp_pinecone_target_index_select">${g(m.select_pinecone_index||"Select Pinecone Index")}</label>
                        <select id="aipkit_vpp_pinecone_target_index_select" class="aipkit_form-input">
                            <option value="">${g(m.loading_indexes||"Loading indexes...")}</option>
                        </select>
                        <div class="aipkit_form-help" id="aipkit_vpp_pinecone_index_status"></div>
                    </div>
                </div>
                
                <div id="aipkit_vpp_qdrant_options" style="display: none;">
                    <div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="aipkit_vpp_qdrant_target_collection_select">${g(m.select_qdrant_collection||"Select Qdrant Collection")}</label>
                        <select id="aipkit_vpp_qdrant_target_collection_select" class="aipkit_form-input">
                            <option value="">${g(m.loading_indexes||"Loading collections...")}</option>
                        </select>
                        <div class="aipkit_form-help" id="aipkit_vpp_qdrant_collection_status"></div>
                    </div>
                </div>

                <div id="aipkit_vpp_embedding_config_options" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #eee;">
                     <div class="aipkit_form-row" style="gap: 10px;">
                        <div class="aipkit_form-group aipkit_form-col">
                            <label class="aipkit_form-label" for="aipkit_vpp_embedding_provider_select">${g(m.embedding_provider_label||"Embedding Provider")}</label>
                            <select id="aipkit_vpp_embedding_provider_select" class="aipkit_form-input">
                                <option value="openai" selected>OpenAI</option>
                                <option value="google">Google</option>
                                <option value="azure">Azure</option>
                            </select>
                        </div>
                        <div class="aipkit_form-group aipkit_form-col">
                            <label class="aipkit_form-label" for="aipkit_vpp_embedding_model_select">${g(m.embedding_model_label||"Embedding Model")}</label>
                            <select id="aipkit_vpp_embedding_model_select" class="aipkit_form-input">
                                <option value="">${g(m.select_model||"-- Select Model --")}</option>
                            </select>
                        </div>
                    </div>
                     <div class="aipkit_form-help">${g(_.text.ensure_api_key_for_embedding||"Ensure API key is set for the selected embedding provider in AI Settings.")}</div>
                </div>

                <div id="aipkit_vpp_progress_area" style="margin-top: 15px; display: none;">
                    <div class="aipkit_vpp_progress_bar_container">
                        <div class="aipkit_vpp_progress_bar"></div>
                    </div>
                    <p id="aipkit_vpp_progress_text" class="aipkit_form-help" style="text-align: center; margin-top: 5px;"></p>
                </div>
                <div id="aipkit_vpp_status_message" class="aipkit_form-help" style="margin-top: 10px; min-height: 1.5em;"></div>
            </div>
            <div class="aipkit-modal-footer" style="display: flex; justify-content: flex-end; align-items: center; gap: 8px; padding: 10px 15px; border-top: 1px solid var(--aipkit_container-border);">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_vpp_modal_close_btn">${g(m.close||"Close")}</button>
                <button type="button" id="aipkit_vpp_start_indexing_btn" class="aipkit_btn aipkit_btn-primary">
                     <span class="aipkit_btn-text">${g(m.start_indexing||"Start Indexing")}</span>
                     <span class="aipkit_spinner" style="display:none;"></span>
                </button>
                <button type="button" id="aipkit_vpp_stop_indexing_btn" class="aipkit_btn aipkit_btn-danger" style="display:none;">
                     <span class="aipkit_btn-text">${g(m.stop||"Stop")}</span>
                </button>
            </div>
        `,y.appendChild(b),document.body.appendChild(y),b.addEventListener("click",C=>{let T=C.target;T.closest(".aipkit-modal-close-btn")||T.closest(".aipkit_vpp_modal_close_btn")?n():T.closest("#aipkit_vpp_start_indexing_btn")?d():T.closest("#aipkit_vpp_stop_indexing_btn")&&t()}),y.addEventListener("click",C=>{C.target===y&&n()});let v=document.getElementById("aipkit_vpp_vector_store_provider");v&&(v.addEventListener("change",l),l({target:v}));let S=document.getElementById("aipkit_vpp_embedding_provider_select");S&&typeof window.aipkit_vpp_populateEmbeddingModelSelect=="function"&&S.addEventListener("change",()=>window.aipkit_vpp_populateEmbeddingModelSelect(S.value))}function t(){window.aipkit_isIndexingStopped=!0;let u=document.getElementById("aipkit_vpp_stop_indexing_btn"),f=window.aipkit_vpp_config?.text||{};if(u){u.disabled=!0;let _=u.querySelector(".aipkit_btn-text");_&&(_.textContent=f.stopping||"Stopping...")}}function n(){window.aipkit_isIndexingStopped=!0;let u=document.getElementById(p);u&&(u.classList.remove("aipkit-active"),setTimeout(()=>{u.parentNode&&u.parentNode.removeChild(u)},300))}function s(u,f){let _=document.querySelector(`#${p} .aipkit_vpp_progress_bar`),m=document.getElementById("aipkit_vpp_progress_text");_&&(_.style.width=`${Math.max(0,Math.min(100,u))}%`),m&&(m.textContent=f)}function a(u,f="info"){let _=document.getElementById("aipkit_vpp_status_message");_&&(_.textContent=u,_.className=`aipkit_form-help aipkit_message-${f}`)}function c(){i=!1;let u=document.getElementById("aipkit_vpp_start_indexing_btn"),f=document.getElementById("aipkit_vpp_stop_indexing_btn"),_=document.querySelectorAll(`#${p} .aipkit-modal-close-btn, #${p} .aipkit_vpp_modal_close_btn`),m=window.aipkit_vpp_config?.text||{};if(u){typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(u,m.start_indexing||"Start Indexing"),u.disabled=!1,u.style.display="inline-flex";let g=u.querySelector(".aipkit_spinner");g&&(g.style.display="none")}if(f){f.style.display="none",f.disabled=!1;let g=f.querySelector(".aipkit_btn-text");g&&(g.textContent=m.stop||"Stop")}_.forEach(g=>g.disabled=!1)}function l(u){let f=u.target.value,_=document.getElementById("aipkit_vpp_openai_options"),m=document.getElementById("aipkit_vpp_pinecone_options"),g=document.getElementById("aipkit_vpp_qdrant_options"),k=document.getElementById("aipkit_vpp_embedding_config_options");_&&(_.style.display="none"),m&&(m.style.display="none"),g&&(g.style.display="none"),k&&(k.style.display="none"),f==="openai"?(_&&(_.style.display="block"),typeof window.aipkit_vpp_populateOpenAIStoresSelect=="function"&&window.aipkit_vpp_populateOpenAIStoresSelect()):f==="pinecone"?(m&&(m.style.display="block"),k&&(k.style.display="block"),typeof window.aipkit_vpp_populatePineconeIndexesSelect=="function"&&window.aipkit_vpp_populatePineconeIndexesSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects()):f==="qdrant"&&(g&&(g.style.display="block"),k&&(k.style.display="block"),typeof window.aipkit_vpp_populateQdrantCollectionsSelect=="function"&&window.aipkit_vpp_populateQdrantCollectionsSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects())}function d(){if(i)return;window.aipkit_isIndexingStopped=!1;let u=document.getElementById("aipkit_vpp_vector_store_provider").value,f=window.aipkit_vpp_config?.text||{},_="",m={post_ids:r,post_type:o,provider:u};if(u==="openai"){if(_=document.getElementById("aipkit_vpp_openai_vector_store_id").value,!_){a(f.error_no_store_selected_vpp||"Please select an existing OpenAI store.","error");return}m.target_store_id=_}else if(u==="pinecone"){if(_=document.getElementById("aipkit_vpp_pinecone_target_index_select").value,!_){a(f.error_no_pinecone_index_selected||"Please select a Pinecone index.","error");return}if(m.target_index_id=_,m.embedding_provider=document.getElementById("aipkit_vpp_embedding_provider_select").value,m.embedding_model=document.getElementById("aipkit_vpp_embedding_model_select").value,!m.embedding_provider||!m.embedding_model){a(f.error_no_embedding_config||"Please select embedding provider and model for Pinecone.","error");return}}else if(u==="qdrant"){if(_=document.getElementById("aipkit_vpp_qdrant_target_collection_select").value,!_){a(f.error_no_qdrant_collection_selected||"Please select a Qdrant collection.","error");return}if(m.target_collection_name=_,m.embedding_provider=document.getElementById("aipkit_vpp_embedding_provider_select").value,m.embedding_model=document.getElementById("aipkit_vpp_embedding_model_select").value,!m.embedding_provider||!m.embedding_model){a(f.error_no_embedding_config||"Please select embedding provider and model for Qdrant.","error");return}}else{a(`Provider ${u} not yet supported for indexing.`,"error");return}i=!0;let g=document.getElementById("aipkit_vpp_start_indexing_btn"),k=document.getElementById("aipkit_vpp_stop_indexing_btn"),w=document.querySelectorAll(`#${p} .aipkit-modal-close-btn, #${p} .aipkit_vpp_modal_close_btn`);if(g&&(g.style.display="none"),k){k.style.display="inline-flex",k.disabled=!1;let h=k.querySelector(".aipkit_btn-text");h&&(h.textContent=f.stop||"Stop")}document.getElementById("aipkit_vpp_progress_area").style.display="block",s(0,f.status_preparing||"Preparing..."),u==="openai"&&typeof window.aipkit_vpp_startIndexingOpenAI=="function"?window.aipkit_vpp_startIndexingOpenAI(r,_,null,o):u==="pinecone"&&typeof window.aipkit_vpp_startIndexingPinecone=="function"?window.aipkit_vpp_startIndexingPinecone(r,_,m.embedding_provider,m.embedding_model,o):u==="qdrant"&&typeof window.aipkit_vpp_startIndexingQdrant=="function"&&window.aipkit_vpp_startIndexingQdrant(r,_,m.embedding_provider,m.embedding_model,o)}window.aipkit_vpp_showModal=e,window.aipkit_vpp_closeModal=n,window.aipkit_vpp_updateProgress=s,window.aipkit_vpp_updateStatus=a,window.aipkit_vpp_resetModalAfterProcessing=c})();(function(){"use strict";let p="aipkit_add_to_vector_store_btn";function o(){let t=document.querySelectorAll('#the-list input[type="checkbox"][name="post[]"]:checked');if(t.length===0){alert(window.aipkit_vpp_config.text.error_no_posts_selected||"Please select at least one post.");return}let n=Array.from(t).map(s=>s.value);typeof window.aipkit_vpp_showModal=="function"?window.aipkit_vpp_showModal(n,window.aipkit_vpp_config.post_type):(console.error("Vector Post Processor Main: Modal show function (aipkit_vpp_showModal) not found."),alert("Error: UI component for vector store selection is not available."))}function i(){let t=document.getElementById(p);return t&&!t.dataset.vppBound?(t.addEventListener("click",o),t.dataset.vppBound="1",!0):!!(t&&t.dataset.vppBound)}function e(){if(i())return;let t=document.querySelector("#wpbody-content")||document.body,n=Date.now();if(!t)return;let s=new MutationObserver(()=>{(i()||Date.now()-n>15e3)&&s.disconnect()});s.observe(t,{childList:!0,subtree:!0});let a=setInterval(()=>{(i()||Date.now()-n>15e3)&&clearInterval(a)},300)}document.readyState==="loading"||document.readyState==="interactive"?document.addEventListener("DOMContentLoaded",e):e()})();(function(){"use strict";function p(i,e,t="Processing..."){let n=document.querySelector(`#aipkit_migration_row_${i}`);if(!n)return;let s=n.querySelector(".aipkit_spinner"),a=n.querySelector(".aipkit_status-tag"),c=n.querySelectorAll("button");e?(a&&(a.textContent=t,a.className="aipkit_status-tag"),s&&(s.style.display="inline-block"),c.forEach(l=>l.disabled=!0)):s&&(s.style.display="none")}function r(i,e,t){let n=document.querySelector(`#aipkit_migration_row_${i}`);if(!n)return;let s=n.querySelector(".aipkit_spinner"),a=n.querySelector(".aipkit_status-tag"),c=n.querySelectorAll("button");s&&(s.style.display="none"),a&&(a.textContent=e,a.className=`aipkit_status-tag ${t}`),c.forEach(l=>l.disabled=!0)}function o(i,e="info"){let t=document.getElementById("aipkit_migration_messages_area");if(!t)return;let n=e==="success"?"notice-success":e==="error"?"notice-error":"notice-info";t.innerHTML=`<div class="notice ${n} is-dismissible" style="margin: 0 0 15px 0;"><p>${i}</p></div>`}window.aipkitMigrationUI={setCategoryLoadingState:p,updateCategoryStatus:r,showGlobalMessage:o}})();(function(){"use strict";async function p(i){if(typeof window.aipkit_apiRequest!="function")throw new Error("AIPKit API request function is not available.");return window.aipkit_apiRequest("aipkit_analyze_old_data",{_ajax_nonce:i})}async function r(i,e,t){if(typeof window.aipkit_apiRequest!="function")throw new Error("AIPKit API request function is not available.");return window.aipkit_apiRequest(e,{_ajax_nonce:t,category:i})}async function o(i,e,t){if(typeof window.aipkit_apiRequest!="function")throw new Error("AIPKit API request function is not available.");return window.aipkit_apiRequest(e,{_ajax_nonce:t,category:i})}window.aipkitMigrationAjax={executeAnalysisStep:p,executeMigrationStep:r,executeDeleteStep:o}})();(function(){"use strict";function p(){let r=window.aipkitMigrationToolData;if(!r||!r.steps){console.error("AIPKit Migration Tool: Localized data or steps not found.");return}let o=window.aipkitMigrationUI,i=window.aipkitMigrationAjax;if(!o||!i){console.error("AIPKit Migration Tool: UI or AJAX helper modules not found.");return}let e=document.getElementById("aipkit_analyze_data_btn");e&&e.addEventListener("click",async()=>{let a=e.querySelector(".aipkit_btn-text"),c=e.querySelector(".aipkit_spinner");e.disabled=!0,a&&(a.textContent=r.text.analyzing),c&&(c.style.display="inline-block");try{await i.executeAnalysisStep(r.nonce),o.showGlobalMessage("Analysis complete. Reloading page...","success"),setTimeout(()=>window.location.reload(),1500)}catch(l){o.showGlobalMessage(`Analysis failed: ${l.message}`,"error"),e.disabled=!1,a&&(a.textContent="Analyze Legacy Data"),c&&(c.style.display="none")}});let t=document.getElementById("aipkit_analyze_again_btn");t&&t.addEventListener("click",async()=>{let a=t.querySelector(".aipkit_btn-text"),c=t.querySelector(".aipkit_spinner");t.disabled=!0,a&&(a.textContent=r.text.analyzing),c&&(c.style.display="inline-block");try{await i.executeAnalysisStep(r.nonce),o.showGlobalMessage("Re-analysis complete. Reloading page...","success"),setTimeout(()=>window.location.reload(),1500)}catch(l){o.showGlobalMessage(`Analysis failed: ${l.message}`,"error"),t.disabled=!1,a&&(a.textContent=r.text.analyzeAgain||"Analyze Again"),c&&(c.style.display="none")}});let n=document.getElementById("aipkit_migrate_start_fresh_btn");n&&n.addEventListener("click",()=>{if(confirm(r.text.confirmStartFresh)){if(typeof window.aipkit_apiRequest!="function")return;window.aipkit_apiRequest("aipkit_handle_migration_choice",{_ajax_nonce:r.nonce,choice:"start_fresh"}).then(()=>{o.showGlobalMessage("Choice saved. Reloading...","success"),setTimeout(()=>window.location.reload(),1500)}).catch(a=>o.showGlobalMessage(`Error: ${a.message}`,"error"))}});let s=document.getElementById("aipkit_migration_dashboard_tbody");s&&s.addEventListener("click",async a=>{let c=a.target.closest(".aipkit_migrate_category_btn"),l=a.target.closest(".aipkit_delete_category_btn");if(!c&&!l)return;let d=c?c.dataset.category:l.dataset.category,u=r.steps[d];if(!u){console.error("Could not find step info for category:",d);return}if(l){if(!confirm(r.text.confirmDeleteData))return;o.setCategoryLoadingState(d,!0,r.text.deleting);try{let f=await i.executeDeleteStep(d,u.delete_action,r.nonce);o.updateCategoryStatus(d,r.text.statusDeleted,"aipkit_status-success"),o.showGlobalMessage(f.message,"success")}catch(f){o.showGlobalMessage(`Error deleting ${u.label}: ${f.message}`,"error"),o.updateCategoryStatus(d,r.text.statusFailed,"aipkit_status-warning")}}else if(c){o.setCategoryLoadingState(d,!0,r.text.migrating);try{let f=await i.executeMigrationStep(d,u.action,r.nonce);o.updateCategoryStatus(d,r.text.statusMigrated,"aipkit_status-success"),o.showGlobalMessage(f.message,"success")}catch(f){o.showGlobalMessage(`Error migrating ${u.label}: ${f.message}`,"error"),o.updateCategoryStatus(d,r.text.statusFailed,"aipkit_status-warning")}}})}window.aipkit_initMigrationTool=p})();})();
